<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BitHash | Leading BTC Mining Firm</title>
    <meta name="description" content="Need liquidity? Borrow against your mining rewards at 9.99%.">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rowdies:wght@300;400;700&family=Inter:wght@300;400;500;600;700&family=Manrope:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" type="image/png">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #00D395;
            --primary-dark: #00B783;
            --primary-light: #00E5A1;
            --secondary: #1E1E1E;
            --secondary-dark: #121212;
            --dark: #E5E5E5;
            --darker: #0A0A0A;
            --light: #121212;
            --lighter: #1E1E1E;
            --gray: #8E8E8E;
            --gray-light: #2E2E2E;
            --gray-lighter: #252525;
            --success: #00D395;
            --warning: #FFB800;
            --error: #FF3D57;
            --gold: #D4AF37;
            --gold-light: #FFD700;
            --gold-dark: #996515;
            --blue: #003366;
            --blue-dark: #002244;
            --blue-light: #004488;
            --purple: #784FED;
            --pink: #EC4899;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            --gold-gradient: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            --blue-gradient: linear-gradient(135deg, var(--blue) 0%, var(--blue-dark) 100%);
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --box-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --security-blue: #1A73E8;
            --security-green: #34A853;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            overflow-x: hidden;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: var(--dark);
            background-color: var(--light);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Bitcoin Logo Animation */
        @keyframes bitcoinFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(90deg); }
            50% { transform: translateY(0) rotate(180deg); }
            75% { transform: translateY(-10px) rotate(270deg); }
        }

        .bitcoin-animation {
            display: inline-block;
            animation: bitcoinFloat 4s ease-in-out infinite;
            margin-right: 5px;
            vertical-align: middle;
            color: var(--gold);
            text-shadow: 0 0 10px var(--gold-light);
            font-weight: bold;
            transform-origin: center;
        }

        /* Mining Animation */
        @keyframes miningPulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; text-shadow: 0 0 10px var(--gold-light); }
            100% { transform: scale(1); opacity: 0.8; }
        }

        .mining-animation {
            display: inline-block;
            animation: miningPulse 2s ease-in-out infinite;
            color: var(--gold);
        }

        /* Security Badge */
        .security-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--darker);
            padding: 12px 16px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 100;
            border-left: 4px solid var(--security-green);
            color: var(--dark);
            border: 1px solid var(--gray-light);
        }
        
        .security-badge i {
            color: var(--security-green);
            font-size: 1rem;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--darker);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loading-logo {
            width: 80px;
            height: 80px;
            animation: pulse 1.5s infinite ease-in-out;
            filter: drop-shadow(0 0 10px rgba(0, 211, 149, 0.3));
        }
        
        .loading-text {
            margin-top: 20px;
            font-weight: 500;
            color: var(--gray);
            font-size: 1rem;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(0.95); opacity: 0.8; }
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Enhanced Header Styles - More compact */
        header {
            background-color: var(--darker);
            box-shadow: var(--box-shadow);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            padding: 8px 0;
            transition: var(--transition-slow);
            border-bottom: 1px solid var(--gray-light);
            height: 70px;
        }
        
        header.scrolled {
            background-color: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(5px);
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            height: 100%;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            z-index: 1001;
        }
        
        .logo img {
            height: 32px;
            width: auto;
            transition: var(--transition);
        }
        
        .logo:hover img {
            transform: scale(1.05);
        }
        
        .logo-text {
            font-family: 'Rowdies', sans-serif;
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--primary);
            background-clip: text;
            position: relative;
        }
        
        /* Auth Buttons - More compact */
        .auth-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .auth-buttons .btn {
            padding: 6px 12px;
            font-size: 0.85rem;
        }
        
        .user-balance-container {
            width: 100%;
            background-color: var(--lighter);
            padding: 8px 0;
            position: fixed;
            top: 70px;
            z-index: 999;
            border-bottom: 1px solid var(--gray-light);
            display: none;
        }
        
        .user-balance {
            background-color: var(--primary);
            color: var(--darker);
            padding: 6px 12px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            margin: 0 auto;
            width: fit-content;
        }
        
        .user-balance:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
        }
        
        .user-balance i {
            font-size: 0.85rem;
        }
        
        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--dark);
            font-size: 1.3rem;
            cursor: pointer;
            padding: 5px;
            z-index: 1001;
            transition: var(--transition);
        }
        
        .mobile-menu-toggle:hover {
            color: var(--primary);
        }
        
        .mobile-menu-dropdown {
            position: absolute;
            top: 70px;
            right: 20px;
            background-color: var(--darker);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            padding: 10px 0;
            transform: translateY(-20px);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 1000;
            border: 1px solid var(--gray-light);
            min-width: 200px;
        }
        
        .mobile-menu-dropdown.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
        
        .mobile-menu-dropdown ul {
            list-style: none;
        }
        
        .mobile-menu-dropdown li {
            padding: 8px 15px;
        }
        
        .mobile-menu-dropdown a {
            color: var(--dark);
            text-decoration: none;
            font-size: 0.9rem;
            transition: var(--transition);
            display: block;
        }
        
        .mobile-menu-dropdown a:hover {
            color: var(--primary);
        }
        
        /* PC Toggle Menu */
        .pc-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--dark);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 5px;
            z-index: 1001;
            transition: var(--transition);
            margin-left: 15px;
        }
        
        .pc-menu-toggle:hover {
            color: var(--primary);
        }
        
        .pc-menu-dropdown {
            position: absolute;
            top: 70px;
            right: 20px;
            background-color: var(--darker);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            padding: 10px 0;
            transform: translateY(-20px);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 1000;
            border: 1px solid var(--gray-light);
            min-width: 200px;
        }
        
        .pc-menu-dropdown.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
        
        .pc-menu-dropdown ul {
            list-style: none;
        }
        
        .pc-menu-dropdown li {
            padding: 8px 15px;
        }
        
        .pc-menu-dropdown a {
            color: var(--dark);
            text-decoration: none;
            font-size: 0.9rem;
            transition: var(--transition);
            display: block;
        }
        
        .pc-menu-dropdown a:hover {
            color: var(--primary);
        }
        
        nav {
            transition: var(--transition-slow);
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        nav a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            font-size: 0.9rem;
            padding: 3px 0;
        }
        
        nav a:hover {
            color: var(--primary);
        }
        
        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: var(--transition);
        }
        
        nav a:hover::after {
            width: 100%;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: var(--gradient);
            color: var(--darker);
            box-shadow: 0 4px 15px rgba(0, 211, 149, 0.3));
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 211, 149, 0.4));
        }
        
        .btn-outline {
            background-color: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: var(--darker);
            transform: translateY(-2px);
        }
        
        .btn-gold {
            background: var(--gold-gradient);
            color: var(--darker);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3));
        }
        
        .btn-gold:hover {
            background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4));
        }
        
        /* ============================================= */
        /* Critical Error Notification System */
        /* ============================================= */
        
        .notification-center {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: flex-start;
            pointer-events: none;
            width: 100%;
            max-width: 350px;
        }
        
        .notification {
            width: 100%;
            padding: 12px 16px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            display: flex;
            align-items: flex-start;
            gap: 10px;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform: translateX(30px) scale(0.95);
            opacity: 0;
            margin-bottom: 10px;
            font-size: 0.85rem;
            font-weight: 500;
            backdrop-filter: blur(10px);
            background-color: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: auto;
            position: relative;
        }
        
        .notification.show {
            transform: translateX(0) scale(1);
            opacity: 1;
        }
        
        .notification.error {
            background-color: rgba(255, 61, 87, 0.95);
            color: white;
            border-left: 4px solid #cc2c4d;
        }
        
        .notification.success {
            background-color: rgba(0, 211, 149, 0.95);
            color: var(--darker);
            border-left: 4px solid #00B783;
        }
        
        .notification.warning {
            background-color: rgba(255, 184, 0, 0.95);
            color: var(--darker);
            border-left: 4px solid #e6a600;
        }
        
        .notification i {
            font-size: 1.2rem;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .notification-content {
            flex: 1;
            padding-right: 10px;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.95rem;
        }
        
        .notification-message {
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        .notification-close {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
        }
        
        .notification-close:hover {
            background-color: rgba(0, 0, 0, 0.2);
            transform: rotate(90deg);
        }
        
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        .notification.error.show {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        /* Loan Qualification Popup */
        .loan-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--darker);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            padding: 15px;
            width: 300px;
            z-index: 999;
            transform: translateY(-20px);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            border-left: 4px solid var(--primary);
        }
        
        .loan-popup.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
        
        .loan-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .loan-popup-title {
            font-weight: 600;
            color: var(--primary);
            font-size: 1rem;
        }
        
        .loan-popup-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1rem;
        }
        
        .loan-popup-content {
            font-size: 0.85rem;
            color: var(--dark);
            margin-bottom: 15px;
        }
        
        .loan-popup-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .loan-popup-btn {
            padding: 6px 12px;
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .loan-popup-btn-primary {
            background: var(--gradient);
            color: var(--darker);
        }
        
        .loan-popup-btn-secondary {
            background-color: var(--gray-light);
            color: var(--dark);
        }       
        
        /* Security Indicators */
        .security-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 10px;
        }
        
        .security-indicator i {
            color: var(--security-green);
        }
        
        /* Hero Section */
        .hero-section {
            padding: 140px 0 80px;
            background-color: var(--light);
            position: relative;
            overflow: hidden;
        }
        
        .hero-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: center;
        }
        
        .hero-content {
            max-width: 600px;
        }
        
        .hero-content h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            color: var(--dark);
            line-height: 1.2;
        }
        
        .hero-content h1 span {
            color: var(--primary);
        }
        
        .hero-content p {
            font-size: 1.1rem;
            margin-bottom: 30px;
            color: var(--gray);
        }






        
        
       /* Bitcoin Price Container */
.btc-price-container {
    width: 100%;
    max-width: 380px;
    background: var(--darker);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--box-shadow-lg);
    overflow: hidden;
    border: 1px solid var(--gray-light);
    transition: var(--transition);
}

.btc-price-container:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    border-color: var(--gold);
}

.btc-price-header {
    background: linear-gradient(135deg, rgba(212, 175, 55, 0.2) 0%, rgba(10, 10, 10, 0.8) 100%);
    padding: 15px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    border-bottom: 1px solid var(--gray-light);
}

.btc-price-header i {
    font-size: 1.5rem;
    color: var(--gold);
}

.btc-price-header h3 {
    font-size: 1.2rem;
    color: var(--dark);
    margin: 0;
}

.btc-price-display {
    padding: 20px;
}

.btc-price-main {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
}

.btc-price {
    font-size: 2rem;
    font-weight: 700;
    color: var(--gold);
    font-family: 'Manrope', sans-serif;
}

.btc-change {
    padding: 5px 10px;
    border-radius: var(--border-radius);
    font-weight: 600;
    font-size: 0.9rem;
}

.btc-change.positive {
    background-color: rgba(0, 211, 149, 0.2);
    color: var(--success);
}

.btc-change.negative {
    background-color: rgba(255, 61, 87, 0.2);
    color: var(--error);
}

.btc-price-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.btc-price-detail {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.btc-price-detail span:first-child {
    font-size: 0.8rem;
    color: var(--gray);
}

.btc-price-detail span:last-child {
    font-size: 0.95rem;
    color: var(--dark);
    font-weight: 500;
}

.btc-price-footer {
    padding: 10px 20px;
    background-color: var(--gray-light);
    font-size: 0.7rem;
    color: var(--gray);
    text-align: center;
}
        
        /* Enhanced Stats Section */
        .stats-section {
            padding: 80px 0;
            background-color: var(--lighter);
            position: relative;
            overflow: hidden;
        }

        .stats-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 211, 149, 0.05) 0%, rgba(0, 0, 0, 0) 100%);
            z-index: 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 30px;
            position: relative;
            z-index: 1;
        }

        .stat-card {
            background-color: var(--light);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            text-align: center;
            transition: var(--transition);
            box-shadow: var(--box-shadow);
            border: 1px solid var(--gray-light);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 211, 149, 0.1) 0%, rgba(0, 0, 0, 0) 100%);
            opacity: 0;
            transition: var(--transition);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, var(--light) 0%, var(--lighter) 100%);
        }

        .stat-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.1);
            color: var(--primary-light);
        }

        .stat-number {
            font-size: clamp(1.2rem, 2vw, 1.8rem); /* Responsive font scaling */
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
            font-family: 'Manrope', sans-serif;
            transition: var(--transition);
        }

        .stat-card:hover .stat-number {
            color: var(--primary);
        }

        .stat-label {
            font-size: 1rem;
            color: var(--gray);
            line-height: 1.5;
            min-height: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .stat-label span {
            font-size: 0.85rem;
            margin-top: 5px;
            display: inline-flex;
            align-items: center;
        }

        /* Pulse animation for real-time updates */
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 0 0 rgba(0, 211, 149, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 211, 149, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 211, 149, 0); }
        }

        .stat-card.updating {
            animation: pulseGlow 1.5s ease-out;
        }
        
        /* About Section */
        .about-section {
            padding: 80px 0;
            background-color: var(--lighter);
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .section-title h2 {
            font-size: 2.2rem;
            color: var(--dark);
            margin-bottom: 15px;
        }
        
        .section-title p {
            color: var(--gray);
            max-width: 700px;
            margin: 0 auto;
        }
        
        .about-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
        }
        
        .about-image {
            position: relative;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--box-shadow-lg);
        }
        
        .about-image img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .about-content h3 {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: var(--dark);
        }
        
        .about-content p {
            margin-bottom: 20px;
            color: var(--gray);
            font-size: 1rem;
        }
        
        .about-features {
            margin-top: 25px;
        }
        
        .about-feature {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .about-feature-icon {
            width: 22px;
            height: 22px;
            background: var(--gradient);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--darker);
            flex-shrink: 0;
            margin-top: 2px;
            font-size: 0.9rem;
        }
        
        .about-feature-text h4 {
            font-size: 1rem;
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .about-feature-text p {
            font-size: 0.9rem;
            margin-bottom: 0;
        }
        
       /* Enhanced Plans Section */
.plans-section {
    padding: 80px 0;
    background-color: var(--light);
    position: relative;
    overflow: hidden;
}

.plans-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 20% 50%, rgba(0, 211, 149, 0.05) 0%, transparent 30%);
    pointer-events: none;
}

.plans-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-top: 40px;
}

.plan-card {
    background-color: var(--lighter);
    border-radius: var(--border-radius-lg);
    padding: 35px 30px;
    box-shadow: var(--box-shadow);
    transition: var(--transition-slow);
    position: relative;
    overflow: hidden;
    z-index: 1;
    border: 1px solid var(--gray-light);
}

.plan-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--plan-primary) 0%, var(--plan-secondary) 100%);
    opacity: 0.1;
    z-index: -1;
    transition: var(--transition-slow);
}

.plan-card:hover::before {
    opacity: 0.2;
}

.plan-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    border-color: var(--plan-accent);
}

.plan-card:hover .plan-name {
    color: var(--plan-accent);
}

.plan-card:hover .plan-button {
    background: linear-gradient(135deg, var(--plan-primary) 0%, var(--plan-secondary) 100%);
    color: white;
}

.plan-name {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 15px;
    color: var(--dark);
    transition: var(--transition);
}

.plan-description {
    font-size: 1rem;
    color: var(--gray);
    margin-bottom: 20px;
    min-height: 60px;
}

.plan-features {
    margin-bottom: 25px;
}

.plan-feature {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    font-size: 0.95rem;
    color: var(--gray);
}

.plan-feature i {
    color: var(--plan-accent);
    font-size: 0.9rem;
    width: 20px;
    text-align: center;
}

.plan-button {
    width: 100%;
    padding: 12px 20px;
    font-size: 0.95rem;
    font-weight: 600;
    border-radius: var(--border-radius);
    background-color: var(--light);
    color: var(--dark);
    border: none;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.plan-button i {
    font-size: 1rem;
}

.plan-button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.plan-limits {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid var(--gray-light);
    font-size: 0.9rem;
}

.plan-min, .plan-max {
    display: flex;
    flex-direction: column;
}

.plan-min span:first-child, .plan-max span:first-child {
    color: var(--gray);
    font-size: 0.8rem;
}

.plan-min span:last-child, .plan-max span:last-child {
    color: var(--dark);
    font-weight: 600;
}

/* Investment Modal */
.investment-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(10, 10, 10, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition-slow);
    backdrop-filter: blur(5px);
}

.investment-modal.active {
    opacity: 1;
    visibility: visible;
}

.modal-content {
    background-color: var(--lighter);
    border-radius: var(--border-radius-lg);
    width: 100%;
    max-width: 500px;
    box-shadow: var(--box-shadow-lg);
    transform: translateY(20px);
    transition: var(--transition-slow);
    border: 1px solid var(--gray-light);
}

.investment-modal.active .modal-content {
    transform: translateY(0);
}

.modal-header {
    padding: 20px 25px;
    border-bottom: 1px solid var(--gray-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    font-size: 1.4rem;
    color: var(--dark);
    margin: 0;
}

.modal-close {
    background: none;
    border: none;
    color: var(--gray);
    font-size: 1.5rem;
    cursor: pointer;
    transition: var(--transition);
}

.modal-close:hover {
    color: var(--primary);
}

.modal-body {
    padding: 25px;
}

.plan-details {
    margin-bottom: 25px;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 12px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--gray-light);
}

.detail-row:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.detail-label {
    color: var(--gray);
    font-size: 0.95rem;
}

.detail-value {
    color: var(--dark);
    font-weight: 600;
}

.investment-form {
    margin-top: 20px;
}

.investment-form .form-group {
    margin-bottom: 20px;
}

.investment-form label {
    display: block;
    margin-bottom: 8px;
    color: var(--gray);
    font-size: 0.95rem;
}

.investment-form .form-control {
    width: 100%;
    padding: 12px 15px;
    border-radius: var(--border-radius);
    border: 1px solid var(--gray-light);
    background-color: var(--light);
    color: var(--dark);
    font-size: 1rem;
    transition: var(--transition);
}

.investment-form .form-control:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 211, 149, 0.2);
}

.amount-error {
    color: var(--error);
    font-size: 0.85rem;
    margin-top: 5px;
    min-height: 18px;
}

.expected-return {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 25px 0;
    padding: 15px;
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: var(--border-radius);
    font-size: 1.05rem;
}

.expected-return span:first-child {
    color: var(--gray);
}

.expected-return span:last-child {
    color: var(--primary);
    font-weight: 600;
}

#confirm-investment {
    width: 100%;
    padding: 14px;
    font-size: 1rem;
}

.investment-status {
    margin-top: 15px;
    text-align: center;
    font-size: 0.9rem;
    min-height: 20px;
}

/* Responsive Styles */
@media (max-width: 768px) {
    .plans-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-content {
        max-width: 90%;
    }
}

@media (max-width: 480px) {
    .modal-body {
        padding: 20px 15px;
    }
    
    .detail-row {
        flex-direction: column;
        gap: 5px;
    }
}
        /* How It Works Section */
        .how-it-works-section {
            padding: 80px 0;
            background-color: var(--lighter);
        }
        
        .steps-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-top: 40px;
        }
        
        .step-card {
            background-color: var(--light);
            border-radius: var(--border-radius-lg);
            padding: 25px;
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        
        .step-number {
            width: 45px;
            height: 45px;
            background: var(--gradient);
            color: var(--darker);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            margin: 0 auto 15px;
        }
        
        .step-card h3 {
            font-size: 1.2rem;
            margin-bottom: 12px;
            color: var(--dark);
        }
        
        .step-card p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Mining Video Section */
        .mining-video-section {
            padding: 80px 0;
            background-color: var(--light);
            text-align: center;
        }
        
        .video-container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--box-shadow-lg);
        }
        
        .video-container video {
            width: 100%;
            display: block;
            object-fit: cover;
        }
        
        /* Loans & Savings Section */
        .loans-section {
            padding: 80px 0;
            background-color: var(--blue);
        }
        
        .loans-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .loan-calculator {
            background-color: var(--blue-dark);
            border-radius: var(--border-radius-lg);
            padding: 35px;
            box-shadow: var(--box-shadow);
            color: white;
        }
        
        .loan-calculator h3 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            text-align: center;
            color: white;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: white;
            font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--blue-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 211, 149, 0.2);
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        


/* BTC News Section */
.btc-news-section {
    padding: 80px 0;
    background-color: var(--lighter);
}

.news-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 25px;
    margin-top: 40px;
    min-height: 300px;
}

.news-card {
    background-color: var(--light);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    box-shadow: var(--box-shadow);
    transition: var(--transition);
    display: flex;
    flex-direction: column;
}

.news-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
}

.news-image-container {
    height: 180px;
    overflow: hidden;
    position: relative;
}

.news-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.news-card:hover .news-image {
    transform: scale(1.05);
}

.news-content {
    padding: 20px;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.news-title {
    font-size: 1.1rem;
    margin-bottom: 10px;
    color: var(--dark);
    line-height: 1.4;
    flex: 1;
}

.news-meta {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    font-size: 0.8rem;
    color: var(--gray);
}

.news-source {
    font-weight: 600;
    color: var(--primary);
}

.news-date {
    color: var(--gray);
}

.news-navigation {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 30px;
}

#news-page-info {
    font-size: 0.9rem;
    color: var(--gray);
    min-width: 80px;
    text-align: center;
}

.news-loading {
    grid-column: 1 / -1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 0;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(0, 211, 149, 0.2);
    border-radius: 50%;
    border-top-color: var(--primary);
    animation: spin 1s ease-in-out infinite;
    margin-bottom: 15px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* News Modal */
.news-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition-slow);
    padding: 20px;
}

.news-modal.active {
    opacity: 1;
    visibility: visible;
}

.news-modal-content {
    background-color: var(--darker);
    border-radius: var(--border-radius-lg);
    max-width: 800px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    box-shadow: var(--box-shadow-lg);
}

.news-modal-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    color: var(--gray);
    font-size: 1.5rem;
    cursor: pointer;
    z-index: 1;
    transition: var(--transition);
}

.news-modal-close:hover {
    color: var(--primary);
    transform: rotate(90deg);
}

.news-modal-header {
    position: relative;
    height: 250px;
    overflow: hidden;
}

#news-modal-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.news-modal-header-text {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 30px;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
}

#news-modal-title {
    color: white;
    font-size: 1.5rem;
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
}

.news-modal-meta {
    display: flex;
    gap: 15px;
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
}

.news-modal-body {
    padding: 30px;
}

#news-modal-description {
    color: var(--dark);
    margin-bottom: 25px;
    line-height: 1.6;
    font-size: 1rem;
}

/* Responsive adjustments */
@media (max-width: 1024px) {
    .news-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .news-modal-header {
        height: 200px;
    }
}

@media (max-width: 768px) {
    .news-grid {
        grid-template-columns: 1fr;
        max-width: 500px;
        margin: 40px auto 0;
    }
    
    .news-modal-content {
        max-height: 95vh;
    }
    
    .news-modal-header {
        height: 180px;
    }
    
    #news-modal-title {
        font-size: 1.3rem;
    }
    
    .news-modal-body {
        padding: 20px;
    }
}

@media (max-width: 480px) {
    .news-modal-header {
        height: 150px;
    }
    
    .news-modal-header-text {
        padding: 20px;
    }
    
    #news-modal-title {
        font-size: 1.2rem;
    }
    
    #news-modal-description {
        font-size: 0.95rem;
    }
}
        
        /* CTA Section */
        .cta-section {
            padding: 80px 0;
            background: linear-gradient(135deg, var(--darker) 0%, var(--light) 100%);
            text-align: center;
            color: white;
        }
        
        .cta-container {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .cta-container h2 {
            font-size: 2.2rem;
            margin-bottom: 20px;
        }
        
        .cta-container p {
            margin-bottom: 30px;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        /* Footer */
        footer {
            background-color: var(--darker);
            color: white;
            padding: 50px 0 20px;
        }
        
        .footer-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .footer-logo img {
            height: 28px;
            width: auto;
        }
        
        .footer-logo-text {
            font-family: 'Rowdies', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary);
        }
        
        .footer-about p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .footer-social {
            display: flex;
            gap: 10px;
        }
        
        .social-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            color: white;
        }
        
        /* Social media icons */
        .social-icon.twitter {
            background-color: #1DA1F2;
        }
        
        .social-icon.linkedin {
            background-color: #0077B5;
        }
        
        .social-icon.facebook {
            background-color: #1877F2;
        }
        
        .social-icon.instagram {
            background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D, #F56040, #F77737, #FCAF45, #FFDC80);
        }
        
        .social-icon:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .footer-title {
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.1rem;
            color: white;
        }
        
        .footer-links ul {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: var(--transition);
            font-size: 0.9rem;
            display: inline-block;
        }
        
        .footer-links a:hover {
            color: var(--primary);
            transform: translateX(3px);
        }
        
        .footer-contact p {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 12px;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .footer-contact i {
            color: var(--primary);
            width: 18px;
            text-align: center;
            margin-top: 2px;
            font-size: 0.9rem;
        }
        
        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
        }
        



/* Chat Widget Styles */
.chat-widget-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 350px;
  max-height: 500px;
  background-color: var(--lighter);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--box-shadow-lg);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  z-index: 1000;
  transform: translateY(100%);
  opacity: 0;
  transition: var(--transition-slow);
  border: 1px solid var(--gray-light);
}

.chat-widget-container.open {
  transform: translateY(0);
  opacity: 1;
}

.chat-widget-header {
  background-color: var(--primary);
  color: var(--darker);
  padding: 12px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  font-weight: 600;
}

.chat-status-indicator {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background-color: var(--success);
  margin-right: 8px;
  animation: pulse 2s infinite;
}

.chat-widget-header h3 {
  margin: 0;
  font-size: 16px;
  flex-grow: 1;
}

.chat-toggle {
  background: none;
  border: none;
  color: var(--darker);
  cursor: pointer;
  padding: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.chat-window {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  height: 400px;
  background-color: var(--lighter);
}

.chat-messages {
  flex-grow: 1;
  padding: 16px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.message {
  max-width: 80%;
  padding: 10px 14px;
  border-radius: var(--border-radius);
  font-size: 14px;
  line-height: 1.4;
  position: relative;
  word-wrap: break-word;
}

.message-user {
  align-self: flex-end;
  background-color: var(--primary);
  color: var(--darker);
  border-top-right-radius: 0;
}

.message-agent {
  align-self: flex-start;
  background-color: var(--gray-light);
  color: var(--dark);
  border-top-left-radius: 0;
}

.message-system {
  align-self: center;
  background-color: var(--gray-lighter);
  color: var(--gray);
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 4px;
}

.message-time {
  font-size: 10px;
  opacity: 0.7;
  margin-top: 4px;
  display: block;
  text-align: right;
}

.typing-indicator {
  display: flex;
  align-items: center;
  padding: 8px 16px;
  background-color: var(--gray-light);
  border-radius: var(--border-radius);
  align-self: flex-start;
}

.typing-dot {
  width: 8px;
  height: 8px;
  background-color: var(--gray);
  border-radius: 50%;
  margin: 0 2px;
  animation: typingAnimation 1.4s infinite ease-in-out;
}

.typing-dot:nth-child(1) { animation-delay: 0s; }
.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes typingAnimation {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-5px); }
}

.chat-input-container {
  display: flex;
  padding: 12px;
  background-color: var(--secondary-dark);
  border-top: 1px solid var(--gray-light);
}

#chat-input {
  flex-grow: 1;
  background-color: var(--gray-lighter);
  border: 1px solid var(--gray-light);
  border-radius: var(--border-radius);
  padding: 10px 12px;
  color: var(--dark);
  font-size: 14px;
  resize: none;
  outline: none;
  transition: var(--transition);
  max-height: 100px;
}

#chat-input:focus {
  border-color: var(--primary);
}

.send-button {
  background-color: var(--primary);
  color: var(--darker);
  border: none;
  border-radius: var(--border-radius);
  width: 40px;
  height: 40px;
  margin-left: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
}

.send-button:hover {
  background-color: var(--primary-dark);
}

.send-button:disabled {
  background-color: var(--gray);
  cursor: not-allowed;
}

.chat-options {
  display: flex;
  padding: 8px 16px;
  background-color: var(--secondary-dark);
  border-top: 1px solid var(--gray-light);
  flex-wrap: wrap;
  gap: 6px;
}

.option-button {
  background-color: var(--gray-light);
  color: var(--dark);
  border: none;
  border-radius: 4px;
  padding: 6px 12px;
  font-size: 12px;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 4px;
}

.option-button:hover {
  background-color: var(--gray);
}

.end-chat-button {
  background-color: var(--error);
  color: white;
  border: none;
  border-radius: 4px;
  padding: 6px 12px;
  font-size: 12px;
  cursor: pointer;
  transition: var(--transition);
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 4px;
}

.end-chat-button:hover {
  background-color: #d32f2f;
}

/* Rating system */
.rating-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 16px;
  background-color: var(--secondary-dark);
  border-top: 1px solid var(--gray-light);
}

.rating-title {
  color: var(--dark);
  margin-bottom: 8px;
  font-size: 14px;
}

.rating-stars {
  display: flex;
  gap: 4px;
}

.rating-star {
  font-size: 24px;
  color: var(--gray);
  cursor: pointer;
  transition: var(--transition);
}

.rating-star:hover,
.rating-star.active {
  color: var(--gold-light);
}

/* Minimized state */
.chat-widget-minimized {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  background-color: var(--primary);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 1000;
  box-shadow: var(--box-shadow-lg);
  transition: var(--transition);
}

.chat-widget-minimized:hover {
  transform: scale(1.1);
}

.chat-open-button {
  background: none;
  border: none;
  color: var(--darker);
  font-size: 24px;
  cursor: pointer;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}

.chat-badge {
  position: absolute;
  top: -5px;
  right: -5px;
  background-color: var(--error);
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: bold;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .chat-widget-container {
    width: 100%;
    bottom: 0;
    right: 0;
    border-radius: 0;
    max-height: 70vh;
  }
  
  .chat-widget-minimized {
    bottom: 80px;
    right: 20px;
  }
}




        
        
        
        /* Enhanced Loan Calculator */
        .loan-calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .loan-summary {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: var(--border-radius-lg);
            padding: 20px;
        }
        
        .loan-summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .loan-summary-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .loan-summary-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }
        
        .loan-summary-value {
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .loan-summary-value.highlight {
            color: var(--gold);
            font-size: 1.1rem;
        }
        
        /* Responsive Styles */
        @media (max-width: 1024px) {
            .hero-container, .about-container {
                gap: 30px;
            }
            
            .plans-grid, .steps-container, .testimonials-grid, .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .footer-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 25px;
            }
            
            .loan-calculator-grid {
                grid-template-columns: 1fr;
            }
            
            .pc-menu-toggle {
                display: block;
            }
            
            nav {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            .pc-menu-toggle {
                display: none;
            }
            
            nav {
                display: none;
            }
            
            .hero-container, .about-container {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .hero-image {
                order: -1;
            }
            
            .about-image {
                order: -1;
            }
            
            .about-features {
                max-width: 500px;
                margin: 25px auto 0;
            }
            
            .plans-grid, .steps-container, .testimonials-grid, .stats-grid {
                grid-template-columns: 1fr;
                max-width: 500px;
                margin: 40px auto 0;
            }
            
            .footer-container {
                grid-template-columns: 1fr;
                gap: 25px;
            }
            
            .chat-widget {
                width: 280px;
                right: 20px;
                bottom: 20px;
            }
            
            /* Mobile header */
            .header-container {
                flex-wrap: wrap;
                padding: 10px 15px;
            }
            
            .auth-buttons {
                order: 3;
                width: 100%;
                justify-content: center;
                margin-top: 15px;
                display: none;
            }
            
            .auth-buttons.active {
                display: flex;
            }
            
            .user-balance-container {
                display: none;
            }
            
            .user-balance-container.active {
                display: block;
            }
            
            /* Adjust notification for mobile */
            .notification {
                max-width: 90%;
                font-size: 0.8rem;
                padding: 10px 15px;
            }
        }
        
        @media (max-width: 480px) {
            .hero-section {
                padding: 120px 0 60px;
            }
            
            .hero-content h1, .section-title h2 {
                font-size: 2rem;
            }
            
            .hero-content p {
                font-size: 1rem;
            }
            
            .section-title h2 {
                margin-bottom: 10px;
            }
            
            .section-title p {
                font-size: 0.95rem;
            }
            
            .plan-card.popular::before {
                right: -25px;
                font-size: 0.7rem;
                padding: 5px 25px;
            }
            
            .loan-calculator {
                padding: 25px 15px;
            }
            
            .chat-widget {
                width: calc(100% - 40px);
                right: 20px;
                bottom: 80px;
            }
            
            .chat-toggle {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
            }
            
            /* Mobile buttons */
            .btn {
                padding: 10px 18px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash Logo" class="loading-logo">    
        <div class="loading-text">Establishing Secure Connection</div>
    </div>

    <!-- Security Badge -->
    <div class="security-badge">
        <i class="fas fa-shield-alt"></i>
        <span>256-bit AES & TLS 1.3 Encrypted</span>
    </div>

    <!-- Critical Error Notification System -->
    <div class="notification-center" id="notification-center">
        <!-- Critical error notifications will be dynamically inserted here -->
    </div>

    <!-- Loan Qualification Popup -->
    <div class="loan-popup" id="loan-popup">
        <div class="loan-popup-header">
            <div class="loan-popup-title">Loan Qualification</div>
            <button class="loan-popup-close" id="loan-popup-close">&times;</button>
        </div>
        <div class="loan-popup-content" id="loan-popup-content">
            <!-- Content will be dynamically inserted here -->
        </div>
        <div class="loan-popup-footer">
            <button class="loan-popup-btn loan-popup-btn-secondary" id="loan-popup-cancel">Cancel</button>
            <button class="loan-popup-btn loan-popup-btn-primary" id="loan-popup-apply">Apply Now</button>
        </div>
    </div>



    <!-- Enhanced Header - Smaller and Neater -->
    <header id="main-header">
        <div class="container header-container">
            <div class="logo" onclick="window.location.href='index.html'">
        <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash Logo" class="loading-logo">    
                <span class="logo-text">
                    <span class="bitcoin-animation">₿</span>itHash
                </span>
            </div>
            
            <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>
            
            <button class="pc-menu-toggle" id="pc-menu-toggle" aria-label="Toggle navigation">
                <i class="fas fa-ellipsis-v"></i>
            </button>
            
            <div class="mobile-menu-dropdown" id="mobile-menu-dropdown">
                <ul>
                    <li><a href="#plans">Investment Plans</a></li>
                    <li><a href="#how-it-works">How It Works</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="accountsetting.html">Settings</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </div>
            
            <div class="pc-menu-dropdown" id="pc-menu-dropdown">
                <ul>
                    <li><a href="#plans">Investment Plans</a></li>
                    <li><a href="#how-it-works">How It Works</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="accountsetting.html">Settings</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </div>
            
            <nav id="main-nav">
                <ul>
                    <li><a href="#plans">Investment Plans</a></li>
                    <li><a href="#how-it-works">How It Works</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="accountsetting.html">Settings</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </nav>
            
            <div class="auth-buttons" id="auth-buttons">
                <button class="btn btn-outline" onclick="window.location.href='login.html'">Login</button>
                <button class="btn btn-primary" onclick="window.location.href='signup.html'">Sign Up</button>
            </div>
        </div>
    </header>

    <div class="user-balance-container" id="user-balance-container">
    <div class="container">
        <div class="user-balance" id="user-balance" onclick="redirectToDashboard()">
            <i class="fas fa-wallet"></i>
            <span id="balance-amount">Loading...</span>
        </div>
    </div>
</div>

    <!-- Hero Section -->
    <section class="hero-section" id="home">
        <div class="container">
            <div class="hero-container">
                <div class="hero-content" data-aos="fade-right">
                    <h1><span class="bitcoin-animation">₿</span>itcoin Mining Powered  <span>by Efficiency and Scale</span></h1>
                    <p>Join BitHash and access SHA-256 ASIC miners operating across energy-efficient data centers.
Investments are tied directly to live mining units, with payouts based on verified output and distributed per your selected plan.

Track real time mining stats, hash rate, rewards, and uptime, all from your dashboard.</p>
                    
                    <div class="hero-buttons">
                        <button class="btn btn-primary" onclick="window.location.href='signup.html'">Get Started</button>
                        <button class="btn btn-outline" onclick="window.location.href='#plans'">View Plans</button>
                    </div>
                    
                    <!-- Security Indicators -->
                    <div class="security-indicator">
                        <i class="fas fa-lock"></i>
                        <span>256-bit AES Encryption</span>
                    </div>
                    <div class="security-indicator">
                        <i class="fas fa-shield-alt"></i>
                        <span>Multi-Signature Wallets</span>
                    </div>
                    <div class="security-indicator">
                        <i class="fas fa-user-shield"></i>
                        <span>SOC 2 Type II Certified</span>
                    </div>
                </div>
               <div class="hero-image" data-aos="fade-left">
    <div class="btc-price-container">
        <div class="btc-price-header">
            <i class="fab fa-bitcoin"></i>
            <h3>Bitcoin Price</h3>
        </div>
        <div class="btc-price-display">
            <div class="btc-price-main">
                <span class="btc-price" id="btc-price">$0.00</span>
                <span class="btc-change" id="btc-change">0.00%</span>
            </div>
            <div class="btc-price-details">
                <div class="btc-price-detail">
                    <span>24h High</span>
                    <span id="btc-high">$0.00</span>
                </div>
                <div class="btc-price-detail">
                    <span>24h Low</span>
                    <span id="btc-low">$0.00</span>
                </div>
                <div class="btc-price-detail">
                    <span>24h Volume</span>
                    <span id="btc-volume">0 BTC</span>
                </div>
            </div>
        </div>
        <div class="btc-price-footer">
            <span>Real-time prices from <spanclass="bitcoin-animation">₿</span>itHash LCC</span>
        </div>
    </div> 
    </div>
    </section>


<section class="stats-section">
    <div class="container">
        <div class="section-title" data-aos="fade-up">
            <h2>Live Operational Stats</h2>
            <p>Live metrics from BitHash operations across all active data centers worldwide..</p>
        </div>
        
        <div class="stats-grid" id="stats-container">
            <div class="stat-card" data-aos="fade-up" data-aos-delay="100">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-number" id="total-investors">0</div>
                <div class="stat-label">
                    Total Active Investors
                    <span id="investors-change"></span>
                </div>
            </div>
            
            <div class="stat-card" data-aos="fade-up" data-aos-delay="200">
                <div class="stat-icon">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="stat-number" id="total-invested">$0</div>
                <div class="stat-label">
                    24-Hour Investment Volume
                    <span id="invested-change"></span>
                </div>
            </div>
            
            <div class="stat-card" data-aos="fade-up" data-aos-delay="300">
                <div class="stat-icon">
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <div class="stat-number" id="total-withdrawals">$0</div>
                <div class="stat-label">
                    24-Hour Withdrawals Processed
                    <span id="withdrawals-change"></span>
                </div>
            </div>
            
            <div class="stat-card" data-aos="fade-up" data-aos-delay="400">
                <div class="stat-icon">
                    <i class="fas fa-piggy-bank"></i>
                </div>
                <div class="stat-number" id="total-loans">$0</div>
                <div class="stat-label">
                    24-Hour Loan Disbursements
                    <span id="loans-change"></span>
                </div>
            </div>
        </div>
    </div>
</section>


    
    
    
    <!-- About Section -->
    <section class="about-section" id="about">
        <div class="container">
            <div class="section-title" data-aos="fade-up">
                <h2>Why Choose BitHash?</h2>
<p>BitHash connects you to high efficiency Bitcoin mining systems, with real-time performance tracking and secure, automated payouts.</p>

            </div>
            
            <div class="about-container">
                <div class="about-image" data-aos="fade-right">
                    <img src="https://www.dropbox.com/scl/fi/0qn1054f0y3d3dzvn9w5h/WhatsApp-Image-2025-07-19-at-17.16.42_679cc7d5.jpg?rlkey=la1zhkgazqsoh182cn67wtc19&raw=1" alt="BitHash Mining Facility">
                </div>
                <div class="about-content" data-aos="fade-left">
                    <h3>Professional Mining Infrastructure</h3>
<p>BitHash runs a globally distributed Bitcoin mining network with data centers strategically located across North America, Europe, and Asia for optimal energy efficiency and uptime.</p>
<p>Our facilities deploy next-generation SHA-256 ASIC miners with advanced thermal management, including liquid cooling, to deliver sustained high hash rates beyond the reach of individual setups.</p>

                    
                    <div class="about-features">
                        <div class="about-feature">
                            <div class="about-feature-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="about-feature-text">
                                <h4>Renewable Energy</h4>
                                <p>85% of our energy comes from sustainable sources, reducing environmental impact.</p>
                            </div>
                        </div>
                        <div class="about-feature">
                            <div class="about-feature-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="about-feature-text">
                                <h4>High-Level Security</h4>
                                <p>Biometric access controls and 24/7 monitoring protect our facilities.</p>
                            </div>
                        </div>
                        <div class="about-feature">
                            <div class="about-feature-icon">
                                <i class="fas fa-network-wired"></i>
                            </div>
                            <div class="about-feature-text">
                                <h4>99.99% Uptime</h4>
                                <p>Redundant network connections ensure continuous mining operations.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

<!-- Plans Section -->
<section class="plans-section" id="plans">
    <div class="container">
        <div class="section-title" data-aos="fade-up">
            <h2>BTC Mining Contract Ledger</h2>
            <p>Each plan operates under a distinct contract hash, tied to live ASIC miner deployments. Metrics such as hash rate, block height, and earnings distribution are logged and verifiable through the blockchain ledger.</p>
            <div id="balance-display" style="display: none; margin-top: 15px;">
                <span style="color: var(--primary); font-weight: 600;">Your Balance: </span>
                <span id="current-balance">$0.00</span>
            </div>
        </div>


        
        <div class="plans-grid" id="plans-container">
            <!-- Plans will be dynamically loaded here -->
        </div>
    </div>
</section>

<!-- Investment Modal -->
<div class="investment-modal" id="investment-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-plan-name">Investment Plan</h3>
            <button class="modal-close" id="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="plan-details">
                <div class="detail-row">
                    <span class="detail-label">Plan Return:</span>
                    <span class="detail-value" id="modal-plan-return">0%</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Duration:</span>
                    <span class="detail-value" id="modal-plan-duration">0 hours</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Minimum:</span>
                    <span class="detail-value" id="modal-plan-min">$0</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Maximum:</span>
                    <span class="detail-value" id="modal-plan-max">$0</span>
                </div>
            </div>
            
            <div class="investment-form">
                <div class="form-group">
                    <label for="investment-amount">Investment Amount ($)</label>
                    <input type="number" id="investment-amount" class="form-control" placeholder="Enter amount">
                    <div class="amount-error" id="amount-error"></div>
                </div>
                
                <div class="expected-return">
                    <span>Expected Return:</span>
                    <span id="expected-return">$0.00</span>
                </div>
                
                <button class="btn btn-primary" id="confirm-investment">Confirm Investment</button>
                <div class="investment-status" id="investment-status"></div>
            </div>
        </div>
    </div>
</div>

    <!-- How It Works Section -->
    <section class="how-it-works-section" id="how-it-works">
        <div class="container">
            <div class="section-title" data-aos="fade-up">
                <h2>How BitHash Works</h2>
                <p>Our streamlined process makes Bitcoin mining accessible to everyone</p>
            </div>
            
            <div class="steps-container">
                <div class="step-card" data-aos="fade-up" data-aos-delay="100">
                    <div class="step-number">1</div>
                    <h3>Create Account</h3>
                    <p>Register in minutes with our secure onboarding process. No technical knowledge required.</p>
                </div>
                <div class="step-card" data-aos="fade-up" data-aos-delay="200">
                    <div class="step-number">2</div>
                    <h3>Choose Plan</h3>
                    <p>Select an investment plan that matches your goals and deposit funds securely.</p>
                </div>
                <div class="step-card" data-aos="fade-up" data-aos-delay="300">
                    <div class="step-number">3</div>
                    <h3>Start Earning</h3>
                    <p>Watch your investment grow with daily updates. Withdraw profits anytime.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Mining Video Section -->
    <section class="mining-video-section">
        <div class="container">
            <div class="section-title" data-aos="fade-up">
    <h2>Real-Time Crypto Mining Operations</h2>
    <p>Our 24/7 Bitcoin mining hubs equipped with high efficiency ASIC rigs and live performance monitoring</p>
</div>
            
            <div class="video-container" data-aos="fade-up">
                <video autoplay loop muted playsinline disablePictureInPicture disableRemotePlayback>
                    <source src="https://www.dropbox.com/scl/fi/2ln68i04x0ep95aisvtnz/Cryptocurrency-Bitcoins-mining-in-4K-UHD-flat-animation-1.mp4?rlkey=vpsim9qc57886qu8dppx9npax&raw=1" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div class="video-overlay"></div>
            </div>
        </div>
    </section>

    <!-- Loans Section -->
    <section class="loans-section" id="loans">
        <div class="container">
            <div class="section-title" data-aos="fade-up">
                <h2><span class="bitcoin-animation">₿</span>itHash Loans</h2>
                <p>We now qualify borrowers based on their transaction history. Build your creditworthiness through consistent activity.</p>
            </div>
            
            <div class="loan-calculator" data-aos="fade-up">
                <h3>Loan Eligibility Calculator</h3>
                <div class="loan-calculator-grid">
                    <div class="form-group">
                        <label for="loan-amount" class="form-label">Desired Loan Amount</label>
                        <input type="number" id="loan-amount-input" class="form-control" placeholder="Enter amount in USD" min="1000">
                    </div>
                    <div class="form-group">
                        <label for="loan-term" class="form-label">Loan Term (months)</label>
                        <select id="loan-term" class="form-control">
                            <option value="3">3 Months</option>
                            <option value="6">6 Months</option>
                            <option value="12" selected>12 Months</option>
                            <option value="24">24 Months</option>
                        </select>
                    </div>
                </div>
                
                <div class="loan-summary">
                    <div class="loan-summary-item">
                        <span class="loan-summary-label">Estimated Monthly Payment:</span>
                        <span class="loan-summary-value" id="monthly-payment">$0.00</span>
                    </div>
                    <div class="loan-summary-item">
                        <span class="loan-summary-label">Monthly Interest Rate:</span>
                        <span class="loan-summary-value">9.99%</span>
                    </div>
                    <div class="loan-summary-item">
                        <span class="loan-summary-label">Total Repayment:</span>
                        <span class="loan-summary-value highlight" id="total-repayment">$0.00</span>
                    </div>
                </div>
                
                <button class="btn btn-primary" style="width: 100%;" onclick="checkLoanEligibility()">Check Eligibility</button>
                
                <div style="margin-top: 25px; padding: 15px; background-color: rgba(0, 0, 0, 0.3); border-radius: var(--border-radius);">
                    <h4 style="margin-bottom: 12px; font-size: 1.1rem;">How Our Loans Work</h4>
                    <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem; line-height: 1.6;">
                       <p>Your loan eligibility is algorithmically assessed based on your historical account activity with BitHash. We evaluate factors such as deposit behavior, investment consistency, and overall platform engagement to calculate creditworthiness. The minimum loan amount is $1,000, with a fixed monthly interest rate of 9.99%.</p>

                    <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem; line-height: 1.6; margin-top: 10px;">
                        <strong>Note:</strong> Loan approval is subject to verification of your transaction history and requires at least 3 months of consistent activity with BitHash.
                    </p>
                </div>
            </div>
        </div>
    </section>




<!-- BTC News Section -->
<section class="btc-news-section" id="news">
    <div class="container">
        <div class="section-title" data-aos="fade-up">
            <h2>Latest Bitcoin News</h2>
            <p>Stay updated with the latest developments in Bitcoin and cryptocurrency mining</p>
        </div>
        
        <div class="news-grid" id="news-container">
            <!-- News cards will be dynamically loaded here -->
            <div class="news-loading">
                <div class="loading-spinner"></div>
                <p>Loading latest Bitcoin news...</p>
            </div>
        </div>
        
        <div class="news-navigation">
            <button class="btn btn-outline" id="prev-news" disabled>Previous</button>
            <span id="news-page-info">Page 1</span>
            <button class="btn btn-outline" id="next-news">Next</button>
        </div>
    </div>
</section>

<!-- News Modal -->
<div class="news-modal" id="news-modal">
    <div class="news-modal-content">
        <button class="news-modal-close" id="news-modal-close">&times;</button>
        <div class="news-modal-header">
            <img id="news-modal-image" src="" alt="News Image">
            <div class="news-modal-header-text">
                <h3 id="news-modal-title"></h3>
                <div class="news-modal-meta">
                    <span id="news-modal-source"></span>
                    <span id="news-modal-date"></span>
                </div>
            </div>
        </div>
        <div class="news-modal-body">
            <p id="news-modal-description"></p>
            <a href="#" target="_blank" id="news-modal-link" class="btn btn-primary">Read Full Article</a>
        </div>
    </div>
</div>

    
    <!-- CTA Section -->
    <section class="cta-section">
        <div class="container">
            <div class="cta-container" data-aos="fade-up">
                <h2>Ready to Start Mining Bitcoin?</h2>
                <p>Start with as little as $150 and begin earning 9.99% monthly returns today.</p>
                <button class="btn btn-gold" onclick="window.location.href='signup.html'">Get Started Now</button>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contact">
        <div class="container">
            <div class="footer-container">
                <div class="footer-about">
                    <div class="footer-logo">
        <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash Logo" class="loading-logo">    
                        <span class="footer-logo-text"><span class="bitcoin-animation">₿</span>itHash</span>
                    </div>
                    <p>Bitcoin mining platform serving investors worldwide with transparent operations and reliable returns.</p>
                    <div class="footer-social">
    <!-- Social Share Buttons -->
<a href="https://twitter.com/intent/tweet?url=https://bithhash.vercel.app/&text=Check%20out%20this%20Bitcoin%20mining%20platform!" 
   class="social-icon twitter" aria-label="Twitter" target="_blank" rel="noopener">
   <i class="fab fa-twitter"></i>
</a>

<a href="https://www.linkedin.com/sharing/share-offsite/?url=https://bithhash.vercel.app/" 
   class="social-icon linkedin" aria-label="LinkedIn" target="_blank" rel="noopener">
   <i class="fab fa-linkedin-in"></i>
</a>

<a href="https://www.facebook.com/sharer/sharer.php?u=https://bithhash.vercel.app/" 
   class="social-icon facebook" aria-label="Facebook" target="_blank" rel="noopener">
   <i class="fab fa-facebook-f"></i>
</a>

<a href="https://www.instagram.com" 
   class="social-icon instagram" aria-label="Instagram" target="_blank" rel="noopener" 
   onclick="alert('Instagram does not support direct sharing via links. Please share manually.'); return false;">
   <i class="fab fa-instagram"></i>
</a>

</div>
                    </div>
                </div>
                
                <div class="footer-links">
                    <h3 class="footer-title">Platform</h3>
                    <ul>
                        <li><a href="#home">Dashboard</a></li>
                        <li><a href="#plans">Investment Plans</a></li>
                        <li><a href="#loans">Loans</a></li>
                        <li><a href="dashboard.html">My Account</a></li>
                        <li><a href="rewards.html">Rewards</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h3 class="footer-title">Company</h3>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="careers.html">Careers</a></li>
                        <li><a href="press.html">Press</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="partners.html">Partners</a></li>
                    </ul>
                </div>
                
                <div class="footer-contact">
                    <h3 class="footer-title">Contact Us</h3>
                    <p><i class="fas fa-envelope"></i> support@bithash.com</p>
                    <p><i class="fas fa-phone"></i> +1 606-363-2032</p>
                    <p><i class="fas fa-map-marker-alt"></i> 800 Plant St, Wilmington, DE 19801, United States</p>
                    <p><i class="fas fa-clock"></i> 24/7 Support</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; <span id="current-year"></span> BitHash LLC. All Rights Reserved. Registered in Delaware, USA. FINRA/SIPC Member.</p>
            </div>
        </div>
    </footer>




<!-- Add this right before the closing </body> tag -->
<div id="chat-widget-container" class="chat-widget-container">
  <div class="chat-widget-header">
    <div class="chat-status-indicator"></div>
    <h3>BitHash Support</h3>
    <button id="chat-toggle" class="chat-toggle">
      <i class="fas fa-comment-dots"></i>
    </button>
  </div>
  
  <div class="chat-window">
    <div id="chat-messages" class="chat-messages">
      <!-- Messages will be inserted here -->
    </div>
    
    <div class="chat-input-container">
      <textarea id="chat-input" placeholder="Type your message..."></textarea>
      <button id="send-button" class="send-button">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
    
    <div class="chat-options">
      <button class="option-button" data-question="What are your investment plans?">
        <i class="fas fa-coins"></i> Plans
      </button>
      <button class="option-button" data-question="How do withdrawals work?">
        <i class="fas fa-wallet"></i> Withdrawals
      </button>
      <button class="option-button" data-question="What's the minimum investment?">
        <i class="fas fa-dollar-sign"></i> Minimums
      </button>
      <button id="end-chat-button" class="end-chat-button">
        <i class="fas fa-times"></i> End Chat
      </button>
    </div>
  </div>
</div>

<div id="chat-widget-minimized" class="chat-widget-minimized">
  <div class="chat-badge" id="unread-badge">0</div>
  <button id="chat-open-button" class="chat-open-button">
    <i class="fas fa-comment-dots"></i>
  </button>
</div>


                

    <!-- AOS Animation -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize AOS animation
        AOS.init({
            duration: 800,
            once: true,
            easing: 'ease-in-out'
        });
        
        // Hide loading overlay when page is loaded
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('loading-overlay').classList.add('hidden');
            }, 1000);
            
            // Load all dynamic data from backend
     loadStatsData();
loadPlansData();
checkAuthState();
            
            // Initialize video autoplay
            const video = document.querySelector('video');
            if (video) {
                video.setAttribute('autoplay', '');
                video.setAttribute('loop', '');
                video.setAttribute('muted', '');
                video.setAttribute('playsinline', '');
                
                // Prevent right-click menu on video
                video.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                });
                
                // Ensure video plays even if autoplay is blocked
                const playVideo = () => {
                    video.play().catch(error => {
                        console.log('Video autoplay prevented:', error);
                    });
                };
                
                // Try to play when page loads
                playVideo();
                
                // Try to play when user interacts with page
                document.addEventListener('click', playVideo, { once: true });
                document.addEventListener('scroll', playVideo, { once: true });
            }
        });
        
        // Set current year in footer
        document.getElementById('current-year').textContent = new Date().getFullYear();
        
        // Mobile menu toggle functionality
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mobileMenuDropdown = document.getElementById('mobile-menu-dropdown');
        
        mobileMenuToggle.addEventListener('click', function() {
            mobileMenuDropdown.classList.toggle('active');
            this.innerHTML = mobileMenuDropdown.classList.contains('active') ? 
                '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
            this.setAttribute('aria-expanded', mobileMenuDropdown.classList.contains('active'));
        });
        
        // PC menu toggle functionality
        const pcMenuToggle = document.getElementById('pc-menu-toggle');
        const pcMenuDropdown = document.getElementById('pc-menu-dropdown');
        
        pcMenuToggle.addEventListener('click', function() {
            pcMenuDropdown.classList.toggle('active');
            this.setAttribute('aria-expanded', pcMenuDropdown.classList.contains('active'));
        });
        
        // Close menus when clicking outside
        document.addEventListener('click', function(event) {
            if (!mobileMenuToggle.contains(event.target)) {
                mobileMenuDropdown.classList.remove('active');
                mobileMenuToggle.innerHTML = '<i class="fas fa-bars"></i>';
                mobileMenuToggle.setAttribute('aria-expanded', 'false');
            }
            
            if (!pcMenuToggle.contains(event.target)) {
                pcMenuDropdown.classList.remove('active');
                pcMenuToggle.setAttribute('aria-expanded', 'false');
            }
        });
        
        /* ============================================= */
        /* Critical Error Notification System */
        /* ============================================= */
        
        // Notification queue to manage multiple notifications
        const notificationQueue = [];
        let isNotificationShowing = false;
        
        /**
         * Show a notification in the top right corner
         * @param {string} type - 'error' or 'success'
         * @param {string} title - Notification title
         * @param {string} message - Notification message
         * @param {number} duration - Time in ms to show the notification (0 for persistent)
         */
        function showNotification(type, title, message, duration = 5000) {
            // Add to queue
            notificationQueue.push({ type, title, message, duration });
            
            // Process queue if not already showing a notification
            if (!isNotificationShowing) {
                processNotificationQueue();
            }
        }
        
        function processNotificationQueue() {
            if (notificationQueue.length === 0) {
                isNotificationShowing = false;
                return;
            }
            
            isNotificationShowing = true;
            const { type, title, message, duration } = notificationQueue.shift();
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = type === 'error' ? 'fa-exclamation-circle' : 
                        type === 'warning' ? 'fa-exclamation-triangle' : 'fa-check-circle';
            
            notification.innerHTML = `
                <i class="fas ${icon}"></i>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <div class="notification-close">&times;</div>
            `;
            
            // Add to notification center
            const notificationCenter = document.getElementById('notification-center');
            notificationCenter.appendChild(notification);
            
            // Force reflow to enable animation
            void notification.offsetWidth;
            
            // Show notification
            notification.classList.add('show');
            
            // Add vibration for mobile devices on error
            if (type === 'error' && 'vibrate' in navigator) {
                navigator.vibrate([200, 100, 200]);
            }
            
            // Close button functionality
            notification.querySelector('.notification-close').addEventListener('click', () => {
                closeNotification(notification);
            });
            
            // Auto-hide after duration if not persistent
            if (duration > 0) {
                setTimeout(() => {
                    if (notification.parentNode) {
                        closeNotification(notification);
                    }
                }, duration);
            }
        }
        
        function closeNotification(notification) {
            notification.classList.remove('show');
            
            // Remove after animation completes
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
                
                // Process next notification in queue
                processNotificationQueue();
            }, 400);
        }







        
        

// Fetch Bitcoin price from CoinGecko API
async function fetchBitcoinPrice() {
    try {
        const response = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false&sparkline=false');
        
        if (!response.ok) {
            throw new Error('Failed to fetch Bitcoin price');
        }
        
        const data = await response.json();
        return data.market_data;
    } catch (error) {
        console.error('Error fetching Bitcoin price:', error);
        // Fallback to CoinGecko's simple price API if detailed fails
        return fetchSimpleBitcoinPrice();
    }
}

// Fallback API call if main API fails
async function fetchSimpleBitcoinPrice() {
    try {
        const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true');
        
        if (!response.ok) {
            throw new Error('Failed to fetch simple Bitcoin price');
        }
        
        const data = await response.json();
        return {
            current_price: { usd: data.bitcoin.usd },
            price_change_percentage_24h: data.bitcoin.usd_24h_change,
            high_24h: { usd: data.bitcoin.usd * 1.05 }, // Approximate since simple API doesn't provide
            low_24h: { usd: data.bitcoin.usd * 0.95 }, // Approximate since simple API doesn't provide
            total_volume: { btc: 0 } // Not available in simple API
        };
    } catch (error) {
        console.error('Error fetching simple Bitcoin price:', error);
        return null;
    }
}

// Update Bitcoin price display
function updateBitcoinPriceDisplay(marketData) {
    if (!marketData) {
        showNotification('error', 'Price Error', 'Failed to load Bitcoin price data');
        return;
    }

    const currentPrice = marketData.current_price.usd;
    const priceChange = marketData.price_change_percentage_24h;
    const high24h = marketData.high_24h.usd;
    const low24h = marketData.low_24h.usd;
    const volume24h = marketData.total_volume.btc;

    // Format numbers
    const formatCurrency = num => '$' + num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    const formatPercentage = num => num.toFixed(2) + '%';
    const formatVolume = num => num.toLocaleString('en-US', { maximumFractionDigits: 2 }) + ' BTC';

    // Update DOM elements
    document.getElementById('btc-price').textContent = formatCurrency(currentPrice);
    
    const changeElement = document.getElementById('btc-change');
    changeElement.textContent = formatPercentage(priceChange);
    changeElement.className = priceChange >= 0 ? 'btc-change positive' : 'btc-change negative';
    
    document.getElementById('btc-high').textContent = formatCurrency(high24h);
    document.getElementById('btc-low').textContent = formatCurrency(low24h);
    document.getElementById('btc-volume').textContent = formatVolume(volume24h);
}

// Initialize Bitcoin price updates
async function initBitcoinPriceUpdates() {
    // First load
    const marketData = await fetchBitcoinPrice();
    updateBitcoinPriceDisplay(marketData);
    
    // Update every 60 seconds
    setInterval(async () => {
        const marketData = await fetchBitcoinPrice();
        updateBitcoinPriceDisplay(marketData);
    }, 60000);
}

// Start Bitcoin price updates when page loads
document.addEventListener('DOMContentLoaded', initBitcoinPriceUpdates);


        
        
        
// Enhanced stats loading with real-time updates and animations
async function loadStatsData() {
    try {
        const response = await fetch('https://website-backendd-1.onrender.com/api/stats');
        if (response.ok) {
            const data = await response.json();
            
            // Format numbers with commas and animate changes
            animateNumberChange('total-investors', data.totalInvestors, 0);
            animateNumberChange('total-invested', data.totalInvested, 2);
            animateNumberChange('total-withdrawals', data.totalWithdrawals, 2);
            animateNumberChange('total-loans', data.totalLoans, 2);
            
            // Update change indicators
            updateChangeIndicator('investors-change', data.changeRates.investors);
            updateChangeIndicator('invested-change', data.changeRates.invested);
            updateChangeIndicator('withdrawals-change', data.changeRates.withdrawals);
            updateChangeIndicator('loans-change', data.changeRates.loans);
            
            // Schedule next update (every 5 seconds)
            setTimeout(loadStatsData, 5000);
        } else {
            console.error('Failed to load stats data');
            showNotification('error', 'Backend Error', 'Failed to load statistics data. Please try again later.');
            // Retry after 30 seconds if error
            setTimeout(loadStatsData, 30000);
        }
    } catch (error) {
        console.error('Error loading stats data:', error);
        showNotification('error', 'Connection Error', 'Failed to connect to statistics service. Please check your connection.');
        // Retry after 30 seconds if error
        setTimeout(loadStatsData, 30000);
    }
}

// Animate number changes
function animateNumberChange(elementId, targetValue, decimals) {
    const element = document.getElementById(elementId);
    const currentValue = parseFloat(element.textContent.replace(/,/g, '') || '0');
    const duration = 1000; // Animation duration in ms
    const startTime = performance.now();
    
    const formatNumber = (num) => {
        if (decimals === 0) {
            return num.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        return num.toFixed(decimals).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    };

    function updateNumber(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const value = currentValue + (targetValue - currentValue) * progress;
        
        element.textContent = formatNumber(value);
        
        if (progress < 1) {
            requestAnimationFrame(updateNumber);
        } else {
            element.textContent = formatNumber(targetValue);
        }
    }
    
    requestAnimationFrame(updateNumber);
}

// Update change indicators with arrows
function updateChangeIndicator(elementId, changeRate) {
    const element = document.getElementById(elementId);
    if (!element) return;
    
    element.innerHTML = '';
    
    const arrow = document.createElement('span');
    arrow.style.marginLeft = '5px';
    arrow.style.fontSize = '0.8em';
    
    if (changeRate > 0) {
        arrow.innerHTML = `<i class="fas fa-arrow-up" style="color: var(--success);"></i> ${Math.abs(changeRate)}%`;
    } else if (changeRate < 0) {
        arrow.innerHTML = `<i class="fas fa-arrow-down" style="color: var(--error);"></i> ${Math.abs(changeRate)}%`;
    } else {
        arrow.innerHTML = `<i class="fas fa-minus" style="color: var(--gray);"></i> 0%`;
    }
    
    element.appendChild(arrow);
}



        // BTC News functionality
let currentNewsPage = 1;
const newsPerPage = 3;
let allNewsData = [];

// DOM elements
const newsContainer = document.getElementById('news-container');
const prevNewsBtn = document.getElementById('prev-news');
const nextNewsBtn = document.getElementById('next-news');
const newsPageInfo = document.getElementById('news-page-info');
const newsModal = document.getElementById('news-modal');
const newsModalClose = document.getElementById('news-modal-close');

// Fetch BTC news from backend
async function fetchBTCNews() {
    try {
        newsContainer.innerHTML = `
            <div class="news-loading">
                <div class="loading-spinner"></div>
                <p>Loading latest Bitcoin news...</p>
            </div>
        `;
        
        const response = await fetch('https://website-backendd-1.onrender.com/api/btc-news');
        if (response.ok) {
            const data = await response.json();
            allNewsData = data.data || [];
            renderNews();
        } else {
            throw new Error('Failed to fetch news');
        }
    } catch (error) {
        console.error('Error fetching BTC news:', error);
        newsContainer.innerHTML = `
            <div class="news-loading">
                <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: var(--error); margin-bottom: 15px;"></i>
                <p>Failed to load news. Please try again later.</p>
                <button class="btn btn-outline" onclick="fetchBTCNews()" style="margin-top: 15px;">Retry</button>
            </div>
        `;
    }
}

// Render news based on current page
function renderNews() {
    if (allNewsData.length === 0) {
        newsContainer.innerHTML = `
            <div class="news-loading">
                <i class="fas fa-newspaper" style="font-size: 2rem; color: var(--gray); margin-bottom: 15px;"></i>
                <p>No news available at the moment.</p>
            </div>
        `;
        return;
    }

    const startIndex = (currentNewsPage - 1) * newsPerPage;
    const endIndex = startIndex + newsPerPage;
    const newsToDisplay = allNewsData.slice(startIndex, endIndex);

    newsContainer.innerHTML = newsToDisplay.map(news => `
        <div class="news-card" data-aos="fade-up" data-id="${news.id}">
            <div class="news-image-container">
                <img src="${news.image || 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1'}" 
                     alt="${news.title}" class="news-image" 
                     onerror="this.src='https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1'">
            </div>
            <div class="news-content">
                <h3 class="news-title">${news.title}</h3>
                <div class="news-meta">
                    <span class="news-source">${news.source}</span>
                    <span class="news-date">${formatDate(news.publishedAt)}</span>
                </div>
            </div>
        </div>
    `).join('');

    // Add click event to news cards
    document.querySelectorAll('.news-card').forEach(card => {
        card.addEventListener('click', () => {
            const newsId = card.getAttribute('data-id');
            const newsItem = allNewsData.find(item => item.id === newsId);
            if (newsItem) {
                openNewsModal(newsItem);
            }
        });
    });

    // Update pagination controls
    updatePaginationControls();
}

// Format date for display
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
    });
}

// Update pagination controls
function updatePaginationControls() {
    const totalPages = Math.ceil(allNewsData.length / newsPerPage);
    
    prevNewsBtn.disabled = currentNewsPage <= 1;
    nextNewsBtn.disabled = currentNewsPage >= totalPages;
    
    newsPageInfo.textContent = `Page ${currentNewsPage} of ${totalPages}`;
}

// Open news modal
function openNewsModal(newsItem) {
    document.getElementById('news-modal-title').textContent = newsItem.title;
    document.getElementById('news-modal-description').textContent = newsItem.description || 'No description available.';
    document.getElementById('news-modal-source').textContent = newsItem.source;
    document.getElementById('news-modal-date').textContent = formatDate(newsItem.publishedAt);
    document.getElementById('news-modal-link').href = newsItem.url;
    
    const modalImage = document.getElementById('news-modal-image');
    modalImage.src = newsItem.image || 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1';
    modalImage.alt = newsItem.title;
    
    newsModal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

// Close news modal
function closeNewsModal() {
    newsModal.classList.remove('active');
    document.body.style.overflow = '';
}

// Event listeners
prevNewsBtn.addEventListener('click', () => {
    if (currentNewsPage > 1) {
        currentNewsPage--;
        renderNews();
        window.scrollTo({
            top: document.getElementById('news').offsetTop - 100,
            behavior: 'smooth'
        });
    }
});

nextNewsBtn.addEventListener('click', () => {
    const totalPages = Math.ceil(allNewsData.length / newsPerPage);
    if (currentNewsPage < totalPages) {
        currentNewsPage++;
        renderNews();
        window.scrollTo({
            top: document.getElementById('news').offsetTop - 100,
            behavior: 'smooth'
        });
    }
});

newsModalClose.addEventListener('click', closeNewsModal);
newsModal.addEventListener('click', (e) => {
    if (e.target === newsModal) {
        closeNewsModal();
    }
});

// Initialize news on page load
document.addEventListener('DOMContentLoaded', fetchBTCNews);
        

// Device and location tracking
function trackUserInfo() {
    // Device information
    const deviceInfo = {
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        screenWidth: window.screen.width,
        screenHeight: window.screen.height,
        colorDepth: window.screen.colorDepth,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        language: navigator.language,
        cookiesEnabled: navigator.cookieEnabled,
        doNotTrack: navigator.doNotTrack || 'unspecified',
        hardwareConcurrency: navigator.hardwareConcurrency || 'unknown',
        deviceMemory: navigator.deviceMemory || 'unknown',
        touchSupport: 'ontouchstart' in window,
        browserName: getBrowserName(),
        browserVersion: getBrowserVersion(),
        os: getOS(),
        deviceType: getDeviceType(),
        ipAddress: 'pending' // Will be updated by IP lookup
    };

    // Get IP address and approximate location
    fetch('https://ipapi.co/json/')
        .then(response => response.json())
        .then(ipData => {
            deviceInfo.ipAddress = ipData.ip || 'unknown';
            deviceInfo.ipCountry = ipData.country_name || 'unknown';
            deviceInfo.ipRegion = ipData.region || 'unknown';
            deviceInfo.ipCity = ipData.city || 'unknown';
            
            // Send device info to backend
            sendToBackend(deviceInfo);
        })
        .catch(error => {
            console.error('IP lookup failed:', error);
            // Send device info without IP details
            sendToBackend(deviceInfo);
        });

    // Try to get precise GPS location if user grants permission
    if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                deviceInfo.gpsLocation = {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                    accuracy: position.coords.accuracy,
                    timestamp: new Date(position.timestamp)
                };
                // Update backend with GPS data
                updateBackendWithGPS(deviceInfo);
            },
            (error) => {
                console.log('Geolocation error:', error);
                deviceInfo.gpsError = error.message;
                // Update backend with GPS error
                updateBackendWithGPS(deviceInfo);
            },
            {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
            }
        );
    } else {
        deviceInfo.gpsError = 'Geolocation not supported';
        // Update backend with GPS error
        updateBackendWithGPS(deviceInfo);
    }
}

// Helper functions to parse browser/device info
function getBrowserName() {
    const userAgent = navigator.userAgent;
    if (userAgent.includes('Firefox')) return 'Firefox';
    if (userAgent.includes('SamsungBrowser')) return 'Samsung Browser';
    if (userAgent.includes('Opera') || userAgent.includes('OPR/')) return 'Opera';
    if (userAgent.includes('Trident')) return 'Internet Explorer';
    if (userAgent.includes('Edge')) return 'Edge';
    if (userAgent.includes('Chrome')) return 'Chrome';
    if (userAgent.includes('Safari')) return 'Safari';
    return 'Unknown';
}

function getBrowserVersion() {
    const userAgent = navigator.userAgent;
    const matches = userAgent.match(/(firefox|opera|chrome|safari|edg|trident(?=\/))\/?\s*(\d+)/i) || [];
    return matches[2] || 'unknown';
}

function getOS() {
    const userAgent = navigator.userAgent;
    if (/Windows/.test(userAgent)) return 'Windows';
    if (/Macintosh/.test(userAgent)) return 'Mac';
    if (/Linux/.test(userAgent)) return 'Linux';
    if (/Android/.test(userAgent)) return 'Android';
    if (/iOS|iPhone|iPad|iPod/.test(userAgent)) return 'iOS';
    return 'Unknown';
}

function getDeviceType() {
    const userAgent = navigator.userAgent;
    if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(userAgent)) {
        return 'Tablet';
    }
    if (/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(userAgent)) {
        return 'Mobile';
    }
    return 'Desktop';
}

// Send initial device info to backend
function sendToBackend(data) {
    // Don't track if Do Not Track is enabled
    if (data.doNotTrack === '1') return;
    
    fetch('https://website-backendd-1.onrender.com/api/tracking', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            type: 'device_info',
            data: data,
            timestamp: new Date().toISOString(),
            page: window.location.href
        })
    }).catch(error => {
        console.error('Tracking error:', error);
    });
}

// Update backend with GPS data
function updateBackendWithGPS(data) {
    if (data.doNotTrack === '1') return;
    
    fetch('https://website-backendd-1.onrender.com/api/tracking', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            type: 'gps_update',
            data: {
                gpsLocation: data.gpsLocation,
                gpsError: data.gpsError,
                ipAddress: data.ipAddress
            },
            timestamp: new Date().toISOString(),
            page: window.location.href
        })
    }).catch(error => {
        console.error('GPS tracking error:', error);
    });
}

// Run tracking when page loads
document.addEventListener('DOMContentLoaded', trackUserInfo);

        
        // Check authentication state on page load
     async function checkAuthState() {
    try {
        const token = localStorage.getItem('jwtToken');
        if (!token) {
            document.getElementById('auth-buttons').style.display = 'flex';
            document.getElementById('user-balance-container').style.display = 'none';
            return;
        }
        
        const response = await fetch('https://website-backendd-1.onrender.com/api/users/me', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (response.ok) {
            const userData = await response.json();
            document.getElementById('auth-buttons').style.display = 'none';
            fetchAndUpdateBalance(); // Fetch and show balance
        } else {
            localStorage.removeItem('jwtToken');
            document.getElementById('auth-buttons').style.display = 'flex';
            document.getElementById('user-balance-container').style.display = 'none';
            showNotification('error', 'Session Expired', 'Your session has expired. Please login again.');
        }
    } catch (error) {
        console.error('Authentication check failed:', error);
        showNotification('error', 'Session Error', 'Failed to verify your session. Please login again.');
    }
}


// Load and render plans
// Load and render plans
async function loadPlansData() {
    try {
        const token = localStorage.getItem('jwtToken');
        const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
        
        // Fetch plans
        const plansResponse = await fetch('https://website-backendd-1.onrender.com/api/plans', {
            headers: headers
        });
        
        if (!plansResponse.ok) {
            throw new Error('Failed to load plans data');
        }
        
        const plansData = await plansResponse.json();
        let userBalance = null;
        
        // If user is logged in, fetch their balance
        if (token) {
            const balanceResponse = await fetch('https://website-backendd-1.onrender.com/api/users/me', {
                headers: headers
            });
            
            if (balanceResponse.ok) {
                const userData = await balanceResponse.json();
                userBalance = userData.balances?.main || 0;
            }
        }
        
        renderPlans(plansData.data.plans, userBalance);
    } catch (error) {
        console.error('Error loading plans data:', error);
        showNotification('error', 'Connection Error', 'Failed to connect to plans service. Please check your connection.');
    }
}


// Render plans to the DOM
function renderPlans(plans, userBalance = null) {
    const plansContainer = document.getElementById('plans-container');
    plansContainer.innerHTML = '';
    
    // Show user balance if logged in
    const balanceDisplay = document.getElementById('balance-display');
    if (userBalance !== null) {
        balanceDisplay.style.display = 'block';
        document.getElementById('current-balance').textContent = formatCurrency(userBalance);
    } else {
        balanceDisplay.style.display = 'none';
    }
    
    plans.forEach((plan, index) => {
        const delay = (index + 1) * 100;
        
        const planCard = document.createElement('div');
        planCard.className = 'plan-card';
        planCard.setAttribute('data-aos', 'fade-up');
        planCard.setAttribute('data-aos-delay', delay);
        
        // Set CSS variables for plan colors
        planCard.style.setProperty('--plan-primary', plan.colorScheme.primary);
        planCard.style.setProperty('--plan-secondary', plan.colorScheme.secondary);
        planCard.style.setProperty('--plan-accent', plan.colorScheme.accent);
        
        // Format features list
        const featuresList = [
            `${plan.percentage}% return after ${plan.duration} hours`,
            `Min: $${plan.minAmount}`,
            `Max: $${plan.maxAmount}`,
            `Referral bonus: ${plan.referralBonus}%`,
            'Principal protection'
        ].map(feature => `
            <div class="plan-feature">
                <i class="fas fa-check"></i>
                <span>${feature}</span>
            </div>
        `).join('');
        
        const isLoggedIn = localStorage.getItem('jwtToken') !== null;
        const hasSufficientBalance = userBalance !== null && userBalance >= plan.minAmount;
        
        planCard.innerHTML = `
            <h3 class="plan-name">${plan.name}</h3>
            <p class="plan-description">${plan.description}</p>
            <div class="plan-features">
                ${featuresList}
            </div>
            <div class="plan-limits">
                <div class="plan-min">
                    <span>Minimum</span>
                    <span>$${plan.minAmount}</span>
                </div>
                <div class="plan-max">
                    <span>Maximum</span>
                    <span>$${plan.maxAmount}</span>
                </div>
            </div>
            <button class="btn plan-button" 
                onclick="handlePlanSelection('${plan.id}', ${plan.minAmount}, ${plan.maxAmount}, ${plan.percentage}, ${plan.duration}, '${plan.name}')" 
                ${!isLoggedIn ? 'disabled' : hasSufficientBalance ? '' : 'disabled'}
                title="${!isLoggedIn ? 'Please login to invest' : !hasSufficientBalance ? `Minimum balance required: $${plan.minAmount}` : ''}">
                <i class="fas ${isLoggedIn ? 'fa-coins' : 'fa-lock'}"></i>
                ${isLoggedIn ? (hasSufficientBalance ? 'Invest Now' : 'Insufficient Balance') : 'Login to Invest'}
            </button>
        `;
        
        plansContainer.appendChild(planCard);
    });
    
    // Re-initialize AOS for dynamically added elements
    AOS.refresh();
}

        
// Handle plan selection
async function handlePlanSelection(planId, minAmount, maxAmount, percentage, duration, planName) {
    const token = localStorage.getItem('jwtToken');
    if (!token) {
        showNotification('error', 'Authentication Required', 'Please login or sign up to invest in a plan.');
        setTimeout(() => {
            window.location.href = 'signup.html';
        }, 1500);
        return;
    }
    
    try {
        // Double-check user balance before opening modal
        const response = await fetch('https://website-backendd-1.onrender.com/api/users/me', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (response.ok) {
            const userData = await response.json();
            const userBalance = userData.balances?.main || 0;
            
            if (userBalance < minAmount) {
                showNotification('error', 'Insufficient Balance', `You need at least $${minAmount} to invest in this plan. Current balance: $${userBalance.toFixed(2)}`);
                // Refresh plans to update UI
                loadPlansData();
                return;
            }
            
            // Open investment modal with plan details
            openInvestmentModal(planId, minAmount, maxAmount, percentage, duration, planName);
        } else {
            throw new Error('Failed to verify balance');
        }
    } catch (error) {
        console.error('Error checking balance:', error);
        showNotification('error', 'Balance Check Failed', 'Unable to verify your account balance. Please try again.');
    }
}

        
// Open investment modal
function openInvestmentModal(planId, minAmount, maxAmount, percentage, duration, planName) {
    const modal = document.getElementById('investment-modal');
    const modalPlanName = document.getElementById('modal-plan-name');
    const modalPlanReturn = document.getElementById('modal-plan-return');
    const modalPlanDuration = document.getElementById('modal-plan-duration');
    const modalPlanMin = document.getElementById('modal-plan-min');
    const modalPlanMax = document.getElementById('modal-plan-max');
    
    // Set plan details
    modalPlanName.textContent = planName;
    modalPlanReturn.textContent = `${percentage}%`;
    modalPlanDuration.textContent = `${duration} hours`;
    modalPlanMin.textContent = `$${minAmount}`;
    modalPlanMax.textContent = `$${maxAmount}`;
    
    // Reset form
    document.getElementById('investment-amount').value = minAmount;
    document.getElementById('amount-error').textContent = '';
    document.getElementById('expected-return').textContent = '$0.00';
    document.getElementById('investment-status').textContent = '';
    
    // Calculate initial expected return
    calculateExpectedReturn(minAmount, percentage);
    
    // Show modal
    modal.classList.add('active');
    
    // Add event listeners
    document.getElementById('investment-amount').addEventListener('input', function() {
        const amount = parseFloat(this.value) || 0;
        validateInvestmentAmount(amount, minAmount, maxAmount);
        calculateExpectedReturn(amount, percentage);
    });
    
    document.getElementById('confirm-investment').addEventListener('click', function() {
        const amount = parseFloat(document.getElementById('investment-amount').value);
        if (validateInvestmentAmount(amount, minAmount, maxAmount)) {
            createInvestment(planId, amount);
        }
    });
}

// Close investment modal
function closeInvestmentModal() {
    const modal = document.getElementById('investment-modal');
    modal.classList.remove('active');
}

// Validate investment amount
// Validate investment amount
async function validateInvestmentAmount(amount, minAmount, maxAmount) {
    const errorElement = document.getElementById('amount-error');
    
    if (isNaN(amount)) {
        errorElement.textContent = 'Please enter a valid amount';
        return false;
    }
    
    if (amount < minAmount) {
        errorElement.textContent = `Minimum investment is $${minAmount}`;
        return false;
    }
    
    if (amount > maxAmount) {
        errorElement.textContent = `Maximum investment is $${maxAmount}`;
        return false;
    }
    
    // Check if user has sufficient balance
    try {
        const token = localStorage.getItem('jwtToken');
        if (!token) {
            errorElement.textContent = 'Please login to invest';
            return false;
        }
        
        const response = await fetch('https://website-backendd-1.onrender.com/api/users/me', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (response.ok) {
            const userData = await response.json();
            const userBalance = userData.balances?.main || 0;
            
            if (userBalance < amount) {
                errorElement.textContent = `Insufficient balance. Current balance: $${userBalance.toFixed(2)}`;
                return false;
            }
        } else {
            throw new Error('Failed to verify balance');
        }
    } catch (error) {
        console.error('Balance check error:', error);
        errorElement.textContent = 'Failed to verify balance. Please try again.';
        return false;
    }
    
    errorElement.textContent = '';
    return true;
}

// Calculate expected return
function calculateExpectedReturn(amount, percentage) {
    if (isNaN(amount)) {
        document.getElementById('expected-return').textContent = '$0.00';
        return;
    }
    
    const expectedReturn = amount + (amount * percentage / 100);
    document.getElementById('expected-return').textContent = formatCurrency(expectedReturn);
}

// Create investment via API
async function createInvestment(planId, amount) {
    const token = localStorage.getItem('jwtToken');
    if (!token) return;
    
    const confirmBtn = document.getElementById('confirm-investment');
    const statusElement = document.getElementById('investment-status');
    
    try {
        confirmBtn.disabled = true;
        statusElement.textContent = 'Processing investment...';
        statusElement.style.color = '';
        
        const response = await fetch('https://website-backendd-1.onrender.com/api/investments', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                planId,
                amount
            })
        });
        
        if (response.ok) {
            const data = await response.json();
            statusElement.textContent = 'Investment created successfully!';
            statusElement.style.color = 'var(--primary)';
            
            // Update UI after successful investment
            setTimeout(() => {
                closeInvestmentModal();
                loadPlansData(); // Refresh plans to update balances
                showNotification('success', 'Investment Created', `You've successfully invested $${amount} in the plan.`);
            }, 1500);
        } else {
            const errorData = await response.json();
            throw new Error(errorData.message || 'Failed to create investment');
        }
    } catch (error) {
        console.error('Investment error:', error);
        statusElement.textContent = error.message || 'Failed to create investment';
        statusElement.style.color = 'var(--error)';
    } finally {
        confirmBtn.disabled = false;
    }
}

// Format currency helper function
function formatCurrency(amount) {
    return '$' + amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

// Initialize modal close button
document.getElementById('modal-close').addEventListener('click', closeInvestmentModal);

// Close modal when clicking outside
document.getElementById('investment-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeInvestmentModal();
    }
});



// Function to fetch and update the balance
async function fetchAndUpdateBalance() {
    try {
        const token = localStorage.getItem('jwtToken');
        if (!token) {
            document.getElementById('user-balance-container').style.display = 'none';
            return;
        }
        
        const response = await fetch('https://website-backendd-1.onrender.com/api/users/balance', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            const balance = data.balance || 0;
            document.getElementById('balance-amount').textContent = `$${balance.toFixed(2)}`;
            document.getElementById('user-balance-container').style.display = 'block';
        } else {
            throw new Error('Failed to fetch balance');
        }
    } catch (error) {
        console.error('Error fetching balance:', error);
        document.getElementById('balance-amount').textContent = '$0.00';
    }
}

// Function to redirect to dashboard
function redirectToDashboard() {
    window.location.href = 'dashboard.html';
}

// Function to periodically update the balance
function startBalanceUpdates() {
    // Initial fetch
    fetchAndUpdateBalance();
    
    // Update every 30 seconds
    setInterval(fetchAndUpdateBalance, 30000);
}

// Start balance updates when page loads
document.addEventListener('DOMContentLoaded', startBalanceUpdates);








        
// Initialize all functionality when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Load plans when page loads
    loadPlansData();
    
    // Refresh plans when authentication state changes
    document.addEventListener('authStateChanged', loadPlansData);
});









        
        // Loan calculator - now based on transaction history
      async function checkLoanEligibility() {
    const loanAmount = parseFloat(document.getElementById('loan-amount-input').value);
    const term = parseInt(document.getElementById('loan-term').value);
    
    if (isNaN(loanAmount)) {
        showNotification('error', 'Invalid Input', 'Please enter a valid loan amount.');
        return;
    }
    
    if (loanAmount < 1000) {
        showNotification('error', 'Minimum Loan', 'Minimum loan amount is $1,000');
        return;
    }
    
    // Check if user is authenticated
    const token = localStorage.getItem('jwtToken');
    if (!token) {
        showNotification('error', 'Authentication Required', 'Please login to check your loan eligibility.');
        return;
    }
    
    try {
        // Calculate loan details
        const monthlyInterestRate = 0.0999; // 9.99% monthly
        const monthlyPayment = (loanAmount * monthlyInterestRate) / (1 - Math.pow(1 + monthlyInterestRate, -term));
        const totalRepayment = monthlyPayment * term;
        
        // Format currency
        const formatCurrency = num => '$' + num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        
        // Update UI
        document.getElementById('monthly-payment').textContent = formatCurrency(monthlyPayment);
        document.getElementById('total-repayment').textContent = formatCurrency(totalRepayment);
        
        // Check eligibility with backend
        const eligibilityResponse = await fetch('https://website-backendd-1.onrender.com/api/loans/limit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                loanAmount,
                term
            })
        });
        
        if (eligibilityResponse.ok) {
            const eligibilityData = await eligibilityResponse.json();
            
            // Show qualification popup
            showLoanQualificationPopup({
                qualified: eligibilityData.qualified,
                loanAmount: loanAmount,
                term: term,
                monthlyPayment: monthlyPayment,
                totalRepayment: totalRepayment,
                message: eligibilityData.message
            });
        } else {
            throw new Error('Failed to check eligibility');
        }
        
    } catch (error) {
        console.error('Error checking loan eligibility:', error);
        showNotification('error', 'Loan Error', 'Failed to check loan eligibility. Please try again later.');
    }
}
        
        // Show loan qualification popup
        function showLoanQualificationPopup(data) {
            const popup = document.getElementById('loan-popup');
            const popupContent = document.getElementById('loan-popup-content');
            
            if (data.qualified) {
                popupContent.innerHTML = `
                    <p>${data.message || 'Congratulations! Based on your transaction history, you qualify for this loan.'}</p>
                    <p><strong>Loan Amount:</strong> ${formatCurrency(data.loanAmount)}</p>
                    <p><strong>Term:</strong> ${data.term} months</p>
                    <p><strong>Monthly Payment:</strong> ${formatCurrency(data.monthlyPayment)}</p>
                    <p><strong>Total Repayment:</strong> ${formatCurrency(data.totalRepayment)}</p>
                `;
                
                // Show apply button
                document.getElementById('loan-popup-apply').style.display = 'inline-block';
            } else {
                popupContent.innerHTML = `
                    <p>${data.message || 'Based on your transaction history, you currently do not qualify for this loan amount.'}</p>
                    <p><strong>Suggested Actions:</strong></p>
                    <ul>
                        <li>Increase your transaction volume</li>
                        <li>Maintain consistent activity for 3+ months</li>
                        <li>Consider a smaller loan amount</li>
                    </ul>
                `;
                
                // Hide apply button
                document.getElementById('loan-popup-apply').style.display = 'none';
            }
            
            // Show popup
            popup.classList.add('active');
        }
        
        
        // Close loan popup
        document.getElementById('loan-popup-close').addEventListener('click', function() {
            document.getElementById('loan-popup').classList.remove('active');
        });
        
        document.getElementById('loan-popup-cancel').addEventListener('click', function() {
            document.getElementById('loan-popup').classList.remove('active');
        });
        
        // Apply for loan
        document.getElementById('loan-popup-apply').addEventListener('click', function() {
            // Redirect to dashboard for loan application
            window.location.href = 'dashboard.html#loans';
        });

       







/**
 * Enterprise Chat Widget for BitHash Support System
 * Designed to handle 5M+ users with high reliability
 * Connects to backend: https://website-backendd-1.onrender.com
 */

class BitHashEnterpriseChat {
  constructor() {
    // Core state management
    this.state = {
      sessionId: this.generateSessionId(),
      conversationId: null,
      userId: null,
      isAgent: false,
      isTyping: false,
      unreadMessages: 0,
      connectionAttempts: 0,
      maxConnectionAttempts: 5,
      reconnectDelay: 5000,
      messageQueue: [],
      isSending: false,
      lastActivity: null,
      connectionStatus: 'disconnected'
    };

    // Performance tracking
    this.metrics = {
      messagesSent: 0,
      messagesReceived: 0,
      connectionTime: null,
      latency: null
    };

    // DOM elements
    this.elements = {};
    
    // WebSocket and API configuration
    this.config = {
      wsEndpoint: 'wss://website-backendd-1.onrender.com/api/support/ws',
      apiBaseUrl: 'https://website-backendd-1.onrender.com/api/support',
      heartbeatInterval: 25000, // 25 seconds
      typingTimeoutDuration: 3000, // 3 seconds
      maxMessageLength: 2000,
      maxMessageQueueSize: 50,
      messageRetryInterval: 3000 // 3 seconds
    };

    this.initialize();
  }

  // Initialization sequence
  initialize() {
    this.initializeElements();
    this.setupEventListeners();
    this.checkAuthentication();
    this.setupActivityMonitor();
    this.setupPerformanceMonitoring();
    this.renderInitialState();
  }

  // DOM element initialization with error handling
  initializeElements() {
    try {
      this.elements = {
        container: document.getElementById('chat-widget-container'),
        minimized: document.getElementById('chat-widget-minimized'),
        toggleButton: document.getElementById('chat-toggle'),
        openButton: document.getElementById('chat-open-button'),
        chatWindow: document.querySelector('.chat-window'),
        chatMessages: document.getElementById('chat-messages'),
        chatInput: document.getElementById('chat-input'),
        sendButton: document.getElementById('send-button'),
        optionButtons: document.querySelectorAll('.option-button'),
        endChatButton: document.getElementById('end-chat-button'),
        unreadBadge: document.getElementById('unread-badge'),
        statusIndicator: document.querySelector('.chat-status-indicator'),
        loadingIndicator: document.getElementById('chat-loading-indicator'),
        errorDisplay: document.getElementById('chat-error-display')
      };

      // Validate all required elements exist
      Object.entries(this.elements).forEach(([key, element]) => {
        if (!element && key !== 'optionButtons') {
          throw new Error(`Critical element missing: ${key}`);
        }
      });
    } catch (error) {
      console.error('Element initialization failed:', error);
      this.showCriticalError('Chat system initialization failed. Please refresh the page.');
    }
  }

  // Event listeners with proper memory management
  setupEventListeners() {
    // Main chat controls
    this.elements.toggleButton?.addEventListener('click', () => this.toggleChat());
    this.elements.openButton?.addEventListener('click', () => this.openChat());
    
    // Message sending
    this.elements.sendButton?.addEventListener('click', (e) => {
      e.preventDefault();
      this.sendMessage();
    });
    
    this.elements.chatInput?.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        this.sendMessage();
      } else {
        this.handleTyping();
      }
    });
    
    // Quick option buttons
    this.elements.optionButtons?.forEach(button => {
      button.addEventListener('click', () => {
        const question = button.getAttribute('data-question');
        this.setInputValue(question);
      });
    });
    
    // Chat management
    this.elements.endChatButton?.addEventListener('click', () => this.endChat());
    
    // Input auto-resize
    this.elements.chatInput?.addEventListener('input', () => {
      this.adjustInputHeight();
    });
    
    // Window events for connection management
    window.addEventListener('focus', () => this.checkConnectionState());
    window.addEventListener('online', () => this.handleOnlineStatus());
    window.addEventListener('offline', () => this.handleOfflineStatus());
  }

  // Authentication and session management
  async checkAuthentication() {
    try {
      const token = this.getAuthToken();
      
      if (!token) {
        this.showLoginPrompt();
        return;
      }
      
      const payload = this.decodeJWT(token);
      
      if (!payload || !payload.id) {
        this.showLoginPrompt();
        return;
      }
      
      this.state.userId = payload.id;
      this.state.isAgent = payload.isAdmin || false;
      
      // Initialize connection
      await this.initializeConnection(token);
      
      // Load conversation history
      await this.loadConversation();
      
    } catch (error) {
      console.error('Authentication check failed:', error);
      this.showError('Failed to initialize chat session. Please try again.');
    }
  }

  // Connection management
  async initializeConnection(token) {
    if (this.state.connectionStatus === 'connected') return;
    
    this.state.connectionStatus = 'connecting';
    this.updateConnectionUI();
    
    try {
      // Clear any existing connection
      if (this.socket) {
        this.socket.close();
        clearInterval(this.heartbeatInterval);
      }
      
      // Initialize WebSocket
      this.socket = new WebSocket(this.config.wsEndpoint);
      
      // Connection established
      this.socket.onopen = () => {
        this.state.connectionAttempts = 0;
        this.state.connectionStatus = 'connected';
        this.metrics.connectionTime = new Date();
        this.updateConnectionUI();
        
        // Authenticate
        this.socket.send(JSON.stringify({
          type: 'authenticate',
          token: token,
          sessionId: this.state.sessionId,
          userId: this.state.userId
        }));
        
        // Start heartbeat
        this.heartbeatInterval = setInterval(() => {
          if (this.socket?.readyState === WebSocket.OPEN) {
            const startTime = Date.now();
            this.socket.send(JSON.stringify({ 
              type: 'heartbeat',
              timestamp: startTime
            }));
          }
        }, this.config.heartbeatInterval);
        
        // Process any queued messages
        this.processMessageQueue();
      };
      
      // Message handling
      this.socket.onmessage = (event) => {
        this.state.lastActivity = new Date();
        try {
          const data = JSON.parse(event.data);
          this.handleSocketMessage(data);
        } catch (error) {
          console.error('Message parsing error:', error);
          this.logError('MESSAGE_PARSE_ERROR', error);
        }
      };
      
      // Connection closed
      this.socket.onclose = (event) => {
        this.state.connectionStatus = 'disconnected';
        this.updateConnectionUI();
        clearInterval(this.heartbeatInterval);
        
        // Reconnect logic (only for unexpected closures)
        if (event.code !== 1000 && this.state.connectionAttempts < this.state.maxConnectionAttempts) {
          this.state.connectionAttempts++;
          const delay = this.calculateReconnectDelay();
          
          setTimeout(() => {
            if (this.state.connectionStatus !== 'connected') {
              this.initializeConnection(token);
            }
          }, delay);
        }
      };
      
      // Error handling
      this.socket.onerror = (error) => {
        this.state.connectionStatus = 'error';
        this.updateConnectionUI();
        console.error('WebSocket error:', error);
        this.logError('WEBSOCKET_ERROR', error);
      };
      
    } catch (error) {
      console.error('Connection initialization failed:', error);
      this.state.connectionStatus = 'error';
      this.updateConnectionUI();
      this.logError('CONNECTION_INIT_ERROR', error);
    }
  }

  // Message handling with proper validation
  handleSocketMessage(data) {
    if (!data || !data.type) {
      console.warn('Received malformed message:', data);
      return;
    }

    // Update last activity timestamp
    this.state.lastActivity = new Date();
    
    // Handle heartbeat responses for latency calculation
    if (data.type === 'heartbeat_response' && data.timestamp) {
      this.metrics.latency = Date.now() - data.timestamp;
      return;
    }

    // Process different message types
    switch (data.type) {
      case 'authentication':
        this.handleAuthResponse(data);
        break;
      
      case 'new_message':
        this.handleNewMessage(data);
        break;
        
      case 'system_message':
        this.handleSystemMessage(data);
        break;
        
      case 'typing_indicator':
        this.handleTypingIndicator(data);
        break;
        
      case 'conversation_update':
        this.handleConversationUpdate(data);
        break;
        
      case 'conversations_list':
        this.handleConversationsList(data);
        break;
        
      case 'error':
        this.handleErrorMessage(data);
        break;
        
      case 'rate_limit':
        this.handleRateLimit(data);
        break;
        
      default:
        console.warn('Unhandled message type:', data.type);
        this.logError('UNHANDLED_MESSAGE_TYPE', data);
    }
  }

  // Specific message handlers
  handleAuthResponse(data) {
    if (data.success) {
      console.log('WebSocket authenticated successfully');
      if (data.userType === 'agent') {
        this.state.isAgent = true;
      }
      this.state.connectionStatus = 'connected';
      this.updateConnectionUI();
    } else {
      this.state.connectionStatus = 'authentication_failed';
      this.updateConnectionUI();
      this.showError('Authentication failed. Please login again.');
      this.logError('AUTHENTICATION_FAILED', data);
    }
  }

  handleNewMessage(data) {
    if (!this.validateMessage(data.message)) return;
    
    const { message, sender, conversationId, timestamp } = data.message;
    
    // Only display if it's for the current conversation or a new one
    if (!this.state.conversationId || conversationId === this.state.conversationId) {
      this.addMessage(message, sender, new Date(timestamp));
      this.metrics.messagesReceived++;
      
      if (!this.elements.container.classList.contains('open')) {
        this.incrementUnread();
      }
      
      // Update conversation ID if this is a new conversation
      if (!this.state.conversationId && conversationId) {
        this.state.conversationId = conversationId;
      }
    }
  }

  handleSystemMessage(data) {
    if (!data.message) return;
    
    this.addSystemMessage(data.message);
    this.metrics.messagesReceived++;
    
    if (!this.elements.container.classList.contains('open')) {
      this.incrementUnread();
    }
  }

  handleTypingIndicator(data) {
    if (!data.conversationId || data.conversationId !== this.state.conversationId) return;
    
    if (data.isTyping) {
      this.showTypingIndicator(data.senderName || 'Agent');
    } else {
      this.hideTypingIndicator();
    }
  }

  handleConversationUpdate(data) {
    if (!data.conversationId) return;
    
    if (data.status === 'closed' && data.conversationId === this.state.conversationId) {
      this.showRatingSystem();
      this.state.conversationId = null;
      this.addSystemMessage('The support agent has ended the chat session.');
    }
  }

  handleConversationsList(data) {
    if (!data.conversations || !Array.isArray(data.conversations)) return;
    
    const activeConv = data.conversations.find(c => 
      ['open', 'active', 'waiting'].includes(c.status)
    );
    
    if (activeConv) {
      this.state.conversationId = activeConv.conversationId;
      this.loadMessages();
    } else if (this.state.isAgent) {
      // Agent-specific handling for available conversations
    }
  }

  handleErrorMessage(data) {
    console.error('Server error:', data.error);
    this.addSystemMessage(`Error: ${data.error || 'An unknown error occurred'}`);
    this.logError('SERVER_ERROR', data);
  }

  handleRateLimit(data) {
    console.warn('Rate limit exceeded:', data);
    this.addSystemMessage('Please wait a moment before sending another message.');
    this.logError('RATE_LIMIT_EXCEEDED', data);
  }

  // Message sending with queue management
  async sendMessage() {
    const message = this.getInputValue().trim();
    
    // Validate message
    if (!message) return;
    if (message.length > this.config.maxMessageLength) {
      this.addSystemMessage(`Message too long. Maximum ${this.config.maxMessageLength} characters allowed.`);
      return;
    }
    if (!this.socket || this.socket.readyState !== WebSocket.OPEN) {
      this.queueMessage(message);
      return;
    }
    
    // Add to UI immediately for better UX
    this.addMessage(message, 'user', new Date());
    this.clearInput();
    
    try {
      // Create conversation if needed
      if (!this.state.conversationId) {
        await this.createConversation(message);
      }
      
      // Send via WebSocket
      const messageData = {
        type: 'new_message',
        conversationId: this.state.conversationId,
        message: message,
        sender: 'user',
        senderId: this.state.userId,
        sessionId: this.state.sessionId,
        timestamp: new Date().toISOString()
      };
      
      this.socket.send(JSON.stringify(messageData));
      this.metrics.messagesSent++;
      
      // Clear typing indicator
      this.sendTypingIndicator(false);
      
    } catch (error) {
      console.error('Message sending failed:', error);
      this.queueMessage(message);
      this.addSystemMessage('Failed to send message. Will retry...');
      this.logError('MESSAGE_SEND_ERROR', error);
    }
  }

  // Queue management for offline/error scenarios
  queueMessage(message) {
    if (this.state.messageQueue.length >= this.config.maxMessageQueueSize) {
      this.addSystemMessage('Too many pending messages. Please try again later.');
      return;
    }
    
    this.state.messageQueue.push(message);
    this.addSystemMessage('Message queued. Will send when connection is restored.');
    
    // Start processing if not already doing so
    if (!this.state.isSending) {
      this.processMessageQueue();
    }
  }

  async processMessageQueue() {
    if (this.state.isSending || this.state.messageQueue.length === 0) return;
    
    this.state.isSending = true;
    
    try {
      while (this.state.messageQueue.length > 0) {
        const message = this.state.messageQueue[0];
        
        // Ensure we have an active conversation
        if (!this.state.conversationId) {
          await this.createConversation(message);
        }
        
        // Send the message
        if (this.socket?.readyState === WebSocket.OPEN) {
          this.socket.send(JSON.stringify({
            type: 'new_message',
            conversationId: this.state.conversationId,
            message: message,
            sender: 'user',
            senderId: this.state.userId,
            sessionId: this.state.sessionId,
            timestamp: new Date().toISOString()
          }));
          
          this.metrics.messagesSent++;
          this.state.messageQueue.shift();
        } else {
          // Wait for connection to be restored
          await new Promise(resolve => setTimeout(resolve, this.config.messageRetryInterval));
        }
      }
    } catch (error) {
      console.error('Message queue processing failed:', error);
      this.logError('QUEUE_PROCESSING_ERROR', error);
    } finally {
      this.state.isSending = false;
    }
  }

  // Conversation management
  async createConversation(initialMessage) {
    try {
      const response = await this.apiRequest('/conversations', 'POST', {
        message: initialMessage,
        topic: 'general',
        priority: 'medium',
        sessionId: this.state.sessionId
      });
      
      if (response?.data?.conversation?.conversationId) {
        this.state.conversationId = response.data.conversation.conversationId;
        return true;
      }
      
      throw new Error('Invalid response format');
    } catch (error) {
      console.error('Conversation creation failed:', error);
      this.addSystemMessage('Failed to start conversation. Please try again.');
      this.logError('CONVERSATION_CREATION_ERROR', error);
      throw error;
    }
  }

  async loadConversation() {
    try {
      const response = await this.apiRequest('/conversations');
      
      if (response?.data) {
        const activeConversation = response.data.find(c => 
          ['open', 'active', 'waiting'].includes(c.status)
        );
        
        if (activeConversation) {
          this.state.conversationId = activeConversation.conversationId;
          await this.loadMessages();
        } else {
          this.addSystemMessage('Welcome to BitHash support. How can we help you today?');
        }
        return true;
      }
      
      throw new Error('Invalid response format');
    } catch (error) {
      console.error('Conversation loading failed:', error);
      this.addSystemMessage('Failed to load conversation history.');
      this.logError('CONVERSATION_LOAD_ERROR', error);
      return false;
    }
  }

  async loadMessages() {
    if (!this.state.conversationId) return false;
    
    try {
      this.showLoading(true);
      
      const response = await this.apiRequest(`/conversations/${this.state.conversationId}/messages`);
      
      if (response?.data) {
        this.elements.chatMessages.innerHTML = '';
        response.data.forEach(message => {
          if (message.sender === 'system') {
            this.addSystemMessage(message.content, new Date(message.timestamp));
          } else {
            this.addMessage(message.content, message.sender, new Date(message.timestamp));
          }
        });
        
        this.scrollToBottom();
        return true;
      }
      
      throw new Error('Invalid response format');
    } catch (error) {
      console.error('Message loading failed:', error);
      this.addSystemMessage('Failed to load messages.');
      this.logError('MESSAGE_LOAD_ERROR', error);
      return false;
    } finally {
      this.showLoading(false);
    }
  }

  async endChat() {
    if (!this.state.conversationId) return;
    
    try {
      if (this.socket?.readyState === WebSocket.OPEN) {
        this.socket.send(JSON.stringify({
          type: 'close_conversation',
          conversationId: this.state.conversationId,
          sessionId: this.state.sessionId
        }));
      }
      
      await this.apiRequest(`/conversations/${this.state.conversationId}/close`, 'POST');
      
      this.addSystemMessage('You have ended the chat session. Thank you for contacting BitHash support.');
      this.state.conversationId = null;
      
      // Show rating for ended chats
      this.showRatingSystem();
    } catch (error) {
      console.error('Chat ending failed:', error);
      this.addSystemMessage('Failed to end chat session.');
      this.logError('CHAT_END_ERROR', error);
    }
  }

  // Typing indicators
  handleTyping() {
    if (!this.state.isTyping && this.state.conversationId) {
      this.state.isTyping = true;
      this.sendTypingIndicator(true);
      
      clearTimeout(this.typingTimeout);
      this.typingTimeout = setTimeout(() => {
        if (this.state.isTyping) {
          this.sendTypingIndicator(false);
        }
      }, this.config.typingTimeoutDuration);
    }
  }

  sendTypingIndicator(isTyping) {
    if (!this.state.conversationId || !this.socket || this.socket.readyState !== WebSocket.OPEN) return;
    
    try {
      this.socket.send(JSON.stringify({
        type: 'typing_indicator',
        conversationId: this.state.conversationId,
        isTyping: isTyping,
        senderId: this.state.userId,
        sessionId: this.state.sessionId
      }));
      
      this.state.isTyping = !isTyping;
    } catch (error) {
      console.error('Typing indicator failed:', error);
      this.logError('TYPING_INDICATOR_ERROR', error);
    }
  }

  // Rating system
  showRatingSystem() {
    // Remove any existing rating UI
    const existingRating = this.elements.chatMessages.querySelector('.rating-container');
    if (existingRating) return;
    
    const ratingContainer = document.createElement('div');
    ratingContainer.classList.add('rating-container');
    ratingContainer.innerHTML = `
      <div class="rating-title">How would you rate your support experience?</div>
      <div class="rating-stars">
        <span class="rating-star" data-rating="1">★</span>
        <span class="rating-star" data-rating="2">★</span>
        <span class="rating-star" data-rating="3">★</span>
        <span class="rating-star" data-rating="4">★</span>
        <span class="rating-star" data-rating="5">★</span>
      </div>
      <textarea class="rating-feedback" placeholder="Optional feedback (max 500 chars)" maxlength="500"></textarea>
      <button class="rating-submit">Submit Rating</button>
    `;
    
    this.elements.chatMessages.appendChild(ratingContainer);
    
    // Star interaction
    const stars = ratingContainer.querySelectorAll('.rating-star');
    stars.forEach(star => {
      star.addEventListener('click', () => {
        stars.forEach((s, i) => {
          s.classList.toggle('active', i < star.dataset.rating);
        });
      });
    });
    
    // Rating submission
    const submitButton = ratingContainer.querySelector('.rating-submit');
    submitButton.addEventListener('click', async () => {
      const selectedStar = ratingContainer.querySelector('.rating-star.active:last-child');
      if (!selectedStar) {
        this.addSystemMessage('Please select a rating before submitting.');
        return;
      }
      
      const rating = parseInt(selectedStar.dataset.rating);
      const feedback = ratingContainer.querySelector('.rating-feedback').value.trim();
      
      await this.submitRating(rating, feedback);
    });
  }

  async submitRating(rating, feedback = '') {
    if (!this.state.conversationId) return;
    
    try {
      const response = await this.apiRequest(
        `/conversations/${this.state.conversationId}/rating`, 
        'POST', 
        { rating, feedback }
      );
      
      if (response.success) {
        this.addSystemMessage('Thank you for your feedback!');
        
        // Remove rating UI
        const ratingContainer = this.elements.chatMessages.querySelector('.rating-container');
        if (ratingContainer) {
          ratingContainer.remove();
        }
      } else {
        throw new Error(response.error || 'Failed to submit rating');
      }
    } catch (error) {
      console.error('Rating submission failed:', error);
      this.addSystemMessage('Failed to submit rating. Please try again.');
      this.logError('RATING_SUBMISSION_ERROR', error);
    }
  }

  // UI Helpers
  addMessage(content, sender, timestamp = new Date()) {
    if (!content || !sender) return;
    
    const messageElement = document.createElement('div');
    messageElement.classList.add('message', `message-${sender}`);
    
    const messageContent = document.createElement('div');
    messageContent.classList.add('message-content');
    messageContent.textContent = content;
    messageElement.appendChild(messageContent);
    
    const messageMeta = document.createElement('div');
    messageMeta.classList.add('message-meta');
    
    const timeElement = document.createElement('span');
    timeElement.classList.add('message-time');
    timeElement.textContent = this.formatTime(timestamp);
    messageMeta.appendChild(timeElement);
    
    if (sender !== 'user') {
      const senderElement = document.createElement('span');
      senderElement.classList.add('message-sender');
      senderElement.textContent = sender === 'agent' ? 'Support Agent' : 'System';
      messageMeta.appendChild(senderElement);
    }
    
    messageElement.appendChild(messageMeta);
    this.elements.chatMessages.appendChild(messageElement);
    this.scrollToBottom();
  }

  addSystemMessage(content, timestamp = new Date()) {
    if (!content) return;
    
    const messageElement = document.createElement('div');
    messageElement.classList.add('message', 'message-system');
    
    const messageContent = document.createElement('div');
    messageContent.classList.add('message-content');
    messageContent.textContent = content;
    messageElement.appendChild(messageContent);
    
    const timeElement = document.createElement('span');
    timeElement.classList.add('message-time');
    timeElement.textContent = this.formatTime(timestamp);
    messageElement.appendChild(timeElement);
    
    this.elements.chatMessages.appendChild(messageElement);
    this.scrollToBottom();
  }

  showTypingIndicator(senderName = 'Agent') {
    this.hideTypingIndicator();
    
    const typingElement = document.createElement('div');
    typingElement.classList.add('typing-indicator');
    typingElement.innerHTML = `
      <div class="typing-sender">${senderName} is typing</div>
      <div class="typing-dots">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
    `;
    this.elements.chatMessages.appendChild(typingElement);
    this.scrollToBottom();
  }

  hideTypingIndicator() {
    const existingIndicator = this.elements.chatMessages.querySelector('.typing-indicator');
    if (existingIndicator) {
      existingIndicator.remove();
    }
  }

  showLoading(show) {
    if (this.elements.loadingIndicator) {
      this.elements.loadingIndicator.style.display = show ? 'block' : 'none';
    }
  }

  showError(message) {
    if (this.elements.errorDisplay) {
      this.elements.errorDisplay.textContent = message;
      this.elements.errorDisplay.style.display = 'block';
      
      setTimeout(() => {
        this.elements.errorDisplay.style.display = 'none';
      }, 5000);
    }
  }

  showCriticalError(message) {
    const errorElement = document.createElement('div');
    errorElement.classList.add('chat-critical-error');
    errorElement.innerHTML = `
      <div class="error-icon">!</div>
      <div class="error-message">${message}</div>
      <button class="error-retry">Retry</button>
    `;
    
    this.elements.chatWindow.innerHTML = '';
    this.elements.chatWindow.appendChild(errorElement);
    
    errorElement.querySelector('.error-retry').addEventListener('click', () => {
      window.location.reload();
    });
  }

  showLoginPrompt() {
    this.addSystemMessage('Please login to use the chat support.');
    
    if (this.elements.chatInput && this.elements.sendButton) {
      this.elements.chatInput.disabled = true;
      this.elements.sendButton.disabled = true;
    }
    
    // Add login button
    const loginButton = document.createElement('button');
    loginButton.classList.add('chat-login-button');
    loginButton.textContent = 'Login to BitHash';
    loginButton.addEventListener('click', () => {
      window.location.href = '/login?redirect=' + encodeURIComponent(window.location.pathname);
    });
    
    this.elements.chatMessages.appendChild(loginButton);
  }

  // Chat window management
  toggleChat() {
    this.elements.container.classList.toggle('open');
    this.elements.minimized.style.display = this.elements.container.classList.contains('open') ? 'none' : 'flex';
    
    if (this.elements.container.classList.contains('open')) {
      this.resetUnread();
      this.scrollToBottom();
    }
  }

  openChat() {
    this.elements.container.classList.add('open');
    this.elements.minimized.style.display = 'none';
    this.resetUnread();
    this.scrollToBottom();
  }

  closeChat() {
    this.elements.container.classList.remove('open');
    this.elements.minimized.style.display = 'flex';
  }

  incrementUnread() {
    this.state.unreadMessages++;
    
    if (this.elements.unreadBadge) {
      this.elements.unreadBadge.textContent = Math.min(this.state.unreadMessages, 99);
      this.elements.unreadBadge.style.display = 'flex';
    }
  }

  resetUnread() {
    this.state.unreadMessages = 0;
    
    if (this.elements.unreadBadge) {
      this.elements.unreadBadge.style.display = 'none';
    }
  }

  scrollToBottom() {
    if (this.elements.chatMessages) {
      this.elements.chatMessages.scrollTop = this.elements.chatMessages.scrollHeight;
    }
  }

  adjustInputHeight() {
    if (!this.elements.chatInput) return;
    
    this.elements.chatInput.style.height = 'auto';
    this.elements.chatInput.style.height = `${Math.min(this.elements.chatInput.scrollHeight, 150)}px`;
  }

  setInputValue(value) {
    if (this.elements.chatInput) {
      this.elements.chatInput.value = value;
      this.elements.chatInput.focus();
      this.adjustInputHeight();
    }
  }

  getInputValue() {
    return this.elements.chatInput?.value || '';
  }

  clearInput() {
    if (this.elements.chatInput) {
      this.elements.chatInput.value = '';
      this.elements.chatInput.style.height = 'auto';
    }
  }

  updateConnectionUI() {
    if (!this.elements.statusIndicator) return;
    
    switch (this.state.connectionStatus) {
      case 'connected':
        this.elements.statusIndicator.style.backgroundColor = '#4CAF50';
        this.elements.statusIndicator.title = 'Connected';
        break;
      case 'connecting':
        this.elements.statusIndicator.style.backgroundColor = '#FFC107';
        this.elements.statusIndicator.title = 'Connecting...';
        break;
      case 'disconnected':
        this.elements.statusIndicator.style.backgroundColor = '#F44336';
        this.elements.statusIndicator.title = 'Disconnected';
        break;
      case 'error':
        this.elements.statusIndicator.style.backgroundColor = '#9C27B0';
        this.elements.statusIndicator.title = 'Connection Error';
        break;
      default:
        this.elements.statusIndicator.style.backgroundColor = '#9E9E9E';
    }
  }

  // Utility functions
  generateSessionId() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  }

  formatTime(date) {
    if (!(date instanceof Date)) return '';
    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  }

  decodeJWT(token) {
    try {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      
      return JSON.parse(jsonPayload);
    } catch (error) {
      console.error('JWT decode error:', error);
      return null;
    }
  }

  getAuthToken() {
    try {
      return localStorage.getItem('jwtToken') || sessionStorage.getItem('jwtToken');
    } catch (error) {
      console.error('Token access error:', error);
      return null;
    }
  }

  validateMessage(message) {
    return message && 
           typeof message === 'object' && 
           message.message && 
           message.sender && 
           message.timestamp;
  }

  calculateReconnectDelay() {
    // Exponential backoff with jitter
    const baseDelay = Math.min(
      this.state.reconnectDelay * Math.pow(2, this.state.connectionAttempts - 1),
      30000 // Max 30 seconds
    );
    
    return baseDelay * (0.7 + Math.random() * 0.6); // Add 30% jitter
  }

  // API request helper
  async apiRequest(endpoint, method = 'GET', body = null) {
    const url = `${this.config.apiBaseUrl}${endpoint}`;
    const headers = {
      'Authorization': `Bearer ${this.getAuthToken()}`,
      'Content-Type': 'application/json'
    };
    
    try {
      const response = await fetch(url, {
        method,
        headers,
        body: body ? JSON.stringify(body) : null
      });
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      return await response.json();
    } catch (error) {
      console.error(`API request failed (${method} ${endpoint}):`, error);
      throw error;
    }
  }

  // Activity monitoring
  setupActivityMonitor() {
    setInterval(() => {
      if (this.state.lastActivity && (Date.now() - this.state.lastActivity.getTime()) > 60000) {
        // Send heartbeat to keep connection alive
        if (this.socket?.readyState === WebSocket.OPEN) {
          this.socket.send(JSON.stringify({ type: 'heartbeat' }));
        }
      }
    }, 30000);
  }

  // Performance monitoring
  setupPerformanceMonitoring() {
    if (window.PerformanceObserver) {
      const observer = new PerformanceObserver((list) => {
        const entries = list.getEntries();
        entries.forEach(entry => {
          if (entry.entryType === 'measure') {
            console.debug(`Performance: ${entry.name} took ${entry.duration}ms`);
          }
        });
      });
      
      observer.observe({ entryTypes: ['measure'] });
    }
    
    // Log connection metrics periodically
    setInterval(() => {
      if (this.metrics.connectionTime) {
        const connectionDuration = (new Date() - this.metrics.connectionTime) / 1000;
        console.debug(`Connection metrics: ${connectionDuration}s uptime, ${this.metrics.messagesSent} sent, ${this.metrics.messagesReceived} received, latency ${this.metrics.latency || 'N/A'}ms`);
      }
    }, 60000);
  }

  // Error logging
  logError(type, error, additionalData = {}) {
    const errorData = {
      type,
      timestamp: new Date().toISOString(),
      sessionId: this.state.sessionId,
      userId: this.state.userId,
      conversationId: this.state.conversationId,
      error: error instanceof Error ? {
        name: error.name,
        message: error.message,
        stack: error.stack
      } : error,
      ...additionalData
    };
    
    // Send to error tracking service
    if (navigator.sendBeacon) {
      navigator.sendBeacon('/api/error-log', JSON.stringify(errorData));
    } else {
      console.error('Error occurred:', errorData);
    }
  }

  // Network status handling
  handleOnlineStatus() {
    if (this.state.connectionStatus !== 'connected') {
      this.checkAuthentication();
    }
    this.addSystemMessage('Connection restored.');
  }

  handleOfflineStatus() {
    this.addSystemMessage('Connection lost. Messages will be queued and sent when back online.');
  }

  checkConnectionState() {
    if (this.state.connectionStatus !== 'connected' && navigator.onLine) {
      this.checkAuthentication();
    }
  }

  // Initial rendering
  renderInitialState() {
    this.updateConnectionUI();
    
    if (this.elements.chatInput && this.elements.sendButton) {
      this.elements.chatInput.disabled = false;
      this.elements.sendButton.disabled = false;
    }
  }
}

// Initialize chat with error handling
document.addEventListener('DOMContentLoaded', () => {
  try {
    // Performance mark for initialization
    if (window.performance?.mark) {
      performance.mark('chat-widget-init-start');
    }
    
    const chatWidget = new BitHashEnterpriseChat();
    
    // Expose for debugging if needed
    window.BitHashChat = chatWidget;
    
    if (window.performance?.mark) {
      performance.mark('chat-widget-init-end');
      performance.measure('chat-widget-init', 'chat-widget-init-start', 'chat-widget-init-end');
    }
  } catch (error) {
    console.error('Chat widget initialization failed:', error);
    
    // Fallback UI
    const fallbackElement = document.createElement('div');
    fallbackElement.className = 'chat-fallback';
    fallbackElement.innerHTML = `
      <p>We're having trouble loading the chat system.</p>
      <button onclick="window.location.reload()">Try Again</button>
      <p>Or contact us at <a href="mailto:support@bithash.com">support@bithash.com</a></p>
    `;
    
    const container = document.getElementById('chat-widget-container') || document.body;
    container.innerHTML = '';
    container.appendChild(fallbackElement);
  }
});







        


        
        
        // Initialize all functionality when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Smooth scrolling for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;
                    
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });
            
            // Header scroll effect
            window.addEventListener('scroll', function() {
                const header = document.getElementById('main-header');
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });
            
            // Security badge animation
            const securityBadge = document.querySelector('.security-badge');
            if (securityBadge) {
                setInterval(() => {
                    securityBadge.style.boxShadow = `0 0 10px ${Math.random() > 0.5 ? 'rgba(52, 168, 83, 0.5)' : 'rgba(26, 115, 232, 0.5)'}`;
                }, 2000);
            }
            
            // Auto-calculate loan when amount changes
            document.getElementById('loan-amount-input').addEventListener('input', function() {
                if (parseFloat(this.value) >= 1000) {
                    const term = parseInt(document.getElementById('loan-term').value);
                    const loanAmount = parseFloat(this.value);
                    const monthlyInterestRate = 0.0999;
                    const monthlyPayment = (loanAmount * monthlyInterestRate) / (1 - Math.pow(1 + monthlyInterestRate, -term));
                    const totalRepayment = monthlyPayment * term;
                    
                    document.getElementById('monthly-payment').textContent = formatCurrency(monthlyPayment);
                    document.getElementById('total-repayment').textContent = formatCurrency(totalRepayment);
                }
            });
            
            // Auto-calculate loan when term changes
            document.getElementById('loan-term').addEventListener('change', function() {
                const loanAmount = parseFloat(document.getElementById('loan-amount-input').value);
                if (loanAmount >= 1000) {
                    const term = parseInt(this.value);
                    const monthlyInterestRate = 0.0999;
                    const monthlyPayment = (loanAmount * monthlyInterestRate) / (1 - Math.pow(1 + monthlyInterestRate, -term));
                    const totalRepayment = monthlyPayment * term;
                    
                    document.getElementById('monthly-payment').textContent = formatCurrency(monthlyPayment);
                    document.getElementById('total-repayment').textContent = formatCurrency(totalRepayment);
                }
            });
        });
    </script>
</body>
</html>
