<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Dashboard | BitHash LLC - Institutional Bitcoin Mining</title>
    <meta name="description" content="BitHash LLC Admin Dashboard for managing institutional-grade Bitcoin mining operations with enterprise security standards.">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rowdies:wght@300;400;700&family=Inter:wght@300;400;500;600;700&family=Manrope:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" type="image/png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
    
    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- Toastr -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    
    <style>
        :root {
            --primary: #00D395;
            --primary-dark: #00B783;
            --primary-light: #00E5A1;
            --secondary: #1E1E1E;
            --secondary-dark: #121212;
            --dark: #E5E5E5;
            --darker: #0A0A0A;
            --light: #121212;
            --lighter: #1E1E1E;
            --gray: #8E8E8E;
            --gray-light: #2E2E2E;
            --gray-lighter: #252525;
            --success: #00D395;
            --warning: #FFB800;
            --error: #FF3D57;
            --gold: #D4AF37;
            --gold-light: #FFD700;
            --gold-dark: #996515;
            --blue: #003366;
            --blue-dark: #002244;
            --blue-light: #004488;
            --purple: #784FED;
            --pink: #EC4899;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            --gold-gradient: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            --blue-gradient: linear-gradient(135deg, var(--blue) 0%, var(--blue-dark) 100%);
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --box-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --visa-blue: #1A1F71;
            --visa-gold: #F7B600;
            --security-blue: #1A73E8;
            --security-green: #34A853;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--secondary-dark);
            color: var(--dark);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .admin-sidebar {
            width: 280px;
            background-color: var(--secondary);
            border-right: 1px solid var(--gray-light);
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            z-index: 1000;
            transition: var(--transition);
        }

        .sidebar-collapsed .admin-sidebar {
            width: 80px;
        }

        .sidebar-collapsed .admin-main {
            margin-left: 80px;
        }

        .admin-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 20px;
        }

        .admin-logo img {
            height: 40px;
        }

        .admin-logo span {
            font-family: 'Rowdies', sans-serif;
            font-size: 20px;
            margin-left: 10px;
            color: var(--primary);
            transition: var(--transition);
        }

        .sidebar-collapsed .admin-logo span {
            display: none;
        }

        .admin-menu {
            list-style: none;
            padding: 0 15px;
        }

        .admin-menu li {
            margin-bottom: 5px;
        }

        .admin-menu a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: var(--gray);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .admin-menu a:hover {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        .admin-menu a.active {
            background-color: var(--primary-dark);
            color: white;
        }

        .admin-menu i {
            font-size: 18px;
            margin-right: 10px;
            width: 24px;
            text-align: center;
        }

        .sidebar-collapsed .admin-menu span {
            display: none;
        }

        .sidebar-collapsed .admin-menu i {
            margin-right: 0;
            font-size: 20px;
        }

        .sidebar-collapsed .admin-menu a {
            justify-content: center;
            padding: 15px 0;
        }

        .menu-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gray);
            padding: 15px 15px 5px;
            margin-top: 15px;
            display: block;
            border-top: 1px solid var(--gray-light);
        }

        .sidebar-collapsed .menu-label {
            display: none;
        }

        /* Main Content Styles */
        .admin-main {
            flex: 1;
            margin-left: 280px;
            transition: var(--transition);
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background-color: var(--secondary);
            border-bottom: 1px solid var(--gray-light);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .toggle-sidebar {
            background: none;
            border: none;
            color: var(--dark);
            font-size: 20px;
            cursor: pointer;
            margin-right: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .toggle-sidebar:hover {
            background-color: var(--gray-light);
        }

        .header-title h1 {
            font-size: 22px;
            font-weight: 600;
            color: var(--dark);
        }

        .header-right {
            display: flex;
            align-items: center;
        }

        .header-icon {
            position: relative;
            margin-left: 20px;
            cursor: pointer;
        }

        .header-icon i {
            font-size: 20px;
            color: var(--gray);
            transition: var(--transition);
        }

        .header-icon:hover i {
            color: var(--dark);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--error);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-profile {
            display: flex;
            align-items: center;
            margin-left: 20px;
            cursor: pointer;
            position: relative;
        }

        .profile-image {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
            border: 2px solid var(--primary);
        }

        .profile-name {
            font-weight: 500;
        }

        .profile-dropdown {
            position: absolute;
            top: 60px;
            right: 0;
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            width: 200px;
            padding: 10px 0;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 100;
        }

        .admin-profile:hover .profile-dropdown {
            opacity: 1;
            visibility: visible;
            top: 50px;
        }

        .profile-dropdown a {
            display: block;
            padding: 10px 20px;
            color: var(--gray);
            text-decoration: none;
            transition: var(--transition);
        }

        .profile-dropdown a:hover {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        .profile-dropdown a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .admin-content {
            padding: 30px;
        }

        /* Dashboard Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--secondary);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-lg);
        }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .stat-card-icon.users {
            background-color: rgba(0, 211, 149, 0.1);
            color: var(--primary);
        }

        .stat-card-icon.deposits {
            background-color: rgba(212, 175, 55, 0.1);
            color: var(--gold);
        }

        .stat-card-icon.withdrawals {
            background-color: rgba(120, 79, 237, 0.1);
            color: var(--purple);
        }

        .stat-card-icon.balance {
            background-color: rgba(0, 51, 102, 0.1);
            color: var(--blue);
        }

        .stat-card-title {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .stat-card-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-card-change {
            font-size: 12px;
            display: flex;
            align-items: center;
        }

        .stat-card-change.positive {
            color: var(--success);
        }

        .stat-card-change.negative {
            color: var(--error);
        }

        /* Data Tables */
        .data-table-container {
            background-color: var(--secondary);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background-color: var(--gray);
        }

        .btn-danger {
            background-color: var(--error);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: var(--primary-dark);
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e6a800;
        }

        /* Login Page */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: var(--secondary-dark);
            padding: 20px;
        }

        .login-box {
            background-color: var(--secondary);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow-lg);
            width: 100%;
            max-width: 450px;
            padding: 40px;
            position: relative;
            overflow: hidden;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo img {
            height: 50px;
        }

        .login-title {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-title h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .login-title p {
            color: var(--gray);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background-color: var(--secondary-dark);
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            color: var(--dark);
            font-size: 14px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 211, 149, 0.2);
        }

        .login-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .remember-me {
            display: flex;
            align-items: center;
        }

        .remember-me input {
            margin-right: 8px;
        }

        .forgot-password {
            color: var(--primary);
            text-decoration: none;
            font-size: 14px;
            transition: var(--transition);
        }

        .forgot-password:hover {
            text-decoration: underline;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 20px;
        }

        .login-btn:hover {
            background-color: var(--primary-dark);
        }

        .login-divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: var(--gray);
            font-size: 14px;
        }

        .login-divider::before,
        .login-divider::after {
            content: "";
            flex: 1;
            height: 1px;
            background-color: var(--gray-light);
            margin: 0 10px;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-slow);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: var(--secondary);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow-lg);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: translateY(20px);
            transition: var(--transition-slow);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--dark);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Chat Widget */
        .chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            background-color: var(--secondary);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow-lg);
            z-index: 1000;
            overflow: hidden;
            transform: translateY(100px);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-slow);
        }

        .chat-widget.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .chat-header {
            background-color: var(--primary);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .chat-title {
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .chat-title i {
            margin-right: 10px;
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .chat-body {
            height: 300px;
            overflow-y: auto;
            padding: 15px;
            background-color: var(--secondary-dark);
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .message.admin {
            align-items: flex-end;
        }

        .message.user {
            align-items: flex-start;
        }

        .message-content {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }

        .message.admin .message-content {
            background-color: var(--primary);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.user .message-content {
            background-color: var(--gray-light);
            color: var(--dark);
            border-bottom-left-radius: 4px;
        }

        .message-time {
            font-size: 11px;
            color: var(--gray);
            margin-top: 5px;
        }

        .chat-input {
            display: flex;
            padding: 10px;
            background-color: var(--secondary);
            border-top: 1px solid var(--gray-light);
        }

        .chat-input input {
            flex: 1;
            padding: 10px 15px;
            background-color: var(--secondary-dark);
            border: 1px solid var(--gray-light);
            border-radius: 20px;
            color: var(--dark);
            outline: none;
        }

        .chat-send {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .chat-send:hover {
            background-color: var(--primary-dark);
        }

        /* Responsive */
        @media (max-width: 992px) {
            .admin-sidebar {
                transform: translateX(-100%);
            }
            
            .admin-sidebar.active {
                transform: translateX(0);
            }
            
            .admin-main {
                margin-left: 0;
            }
            
            .sidebar-collapsed .admin-sidebar {
                width: 280px;
                transform: translateX(-100%);
            }
            
            .sidebar-collapsed .admin-sidebar.active {
                transform: translateX(0);
            }
            
            .sidebar-collapsed .admin-main {
                margin-left: 0;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .admin-header {
                padding: 15px;
            }
            
            .admin-content {
                padding: 15px;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .table-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }

        /* Custom DataTables */
        .dataTables_wrapper {
            color: var(--dark);
        }

        .dataTables_wrapper .dataTables_length select {
            background-color: var(--secondary-dark);
            color: var(--dark);
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            padding: 5px;
        }

        .dataTables_wrapper .dataTables_filter input {
            background-color: var(--secondary-dark);
            color: var(--dark);
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            padding: 5px 10px;
            margin-left: 10px;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            color: var(--dark) !important;
            border: 1px solid var(--gray-light) !important;
            background-color: var(--secondary) !important;
            border-radius: var(--border-radius) !important;
            margin: 0 3px;
            padding: 5px 10px !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button.current,
        .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
            background: var(--primary) !important;
            color: white !important;
            border: 1px solid var(--primary) !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background: var(--gray-light) !important;
            color: white !important;
        }

        .dataTables_wrapper .dataTables_info {
            color: var(--gray);
        }

        table.dataTable thead th,
        table.dataTable thead td {
            border-bottom: 1px solid var(--gray-light);
        }

        table.dataTable tbody th,
        table.dataTable tbody td {
            border-bottom: 1px solid var(--gray-light);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--secondary-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-light);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background-color: rgba(255, 184, 0, 0.1);
            color: var(--warning);
        }

        .status-approved {
            background-color: rgba(0, 211, 149, 0.1);
            color: var(--success);
        }

        .status-rejected {
            background-color: rgba(255, 61, 87, 0.1);
            color: var(--error);
        }

        .status-completed {
            background-color: rgba(0, 51, 102, 0.1);
            color: var(--blue);
        }

        /* Tabs */
        .admin-tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 20px;
        }

        .tab-item {
            padding: 10px 20px;
            cursor: pointer;
            position: relative;
            color: var(--gray);
            font-weight: 500;
            transition: var(--transition);
        }

        .tab-item.active {
            color: var(--primary);
        }

        .tab-item.active::after {
            content: "";
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary);
        }

        .tab-item:hover:not(.active) {
            color: var(--dark);
        }

        /* User Profile */
        .user-profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 20px;
            border: 3px solid var(--primary);
        }

        .user-info h2 {
            font-size: 22px;
            margin-bottom: 5px;
        }

        .user-info p {
            color: var(--gray);
            margin-bottom: 10px;
        }

        .user-stats {
            display: flex;
            gap: 20px;
        }

        .user-stat {
            background-color: var(--secondary-dark);
            padding: 10px 15px;
            border-radius: var(--border-radius);
        }

        .user-stat-label {
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .user-stat-value {
            font-size: 18px;
            font-weight: 600;
        }

        /* Form Groups */
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-col {
            flex: 1;
        }

        /* Action Buttons */
        .action-btn {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 16px;
            margin: 0 5px;
            transition: var(--transition);
        }

        .action-btn:hover {
            color: var(--dark);
        }

        .action-btn.edit {
            color: var(--primary);
        }

        .action-btn.delete {
            color: var(--error);
        }

        .action-btn.view {
            color: var(--blue);
        }

        /* 2FA Modal */
        .two-factor-box {
            text-align: center;
            padding: 20px;
        }

        .two-factor-box img {
            margin: 20px auto;
            display: block;
        }

        .two-factor-code {
            font-family: monospace;
            font-size: 24px;
            letter-spacing: 5px;
            background-color: var(--secondary-dark);
            padding: 10px 15px;
            border-radius: var(--border-radius);
            margin: 20px auto;
            display: inline-block;
        }

        /* Notifications */
        .notification-item {
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
            cursor: pointer;
            transition: var(--transition);
        }

        .notification-item:hover {
            background-color: var(--gray-light);
        }

        .notification-item.unread {
            background-color: rgba(0, 211, 149, 0.05);
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .notification-time {
            font-size: 12px;
            color: var(--gray);
        }

        .notification-message {
            font-size: 14px;
            color: var(--gray);
        }

        /* Responsive Tables */
        @media (max-width: 600px) {
            .dataTables_wrapper .dataTables_length,
            .dataTables_wrapper .dataTables_filter {
                text-align: left;
                margin-bottom: 15px;
            }
            
            .dataTables_wrapper .dataTables_info,
            .dataTables_wrapper .dataTables_paginate {
                text-align: center;
                margin-top: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="login-container">
        <div class="login-box" data-aos="fade-up">
            <div class="login-logo">
                <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash LLC">
            </div>
            <div class="login-title">
                <h1>Admin Portal</h1>
                <p>Sign in to access the dashboard</p>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" class="form-control" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                </div>
                <div class="login-footer">
                    <div class="remember-me">
                        <input type="checkbox" id="remember">
                        <label for="remember">Remember me</label>
                    </div>
                    <a href="#" class="forgot-password" id="forgot-password">Forgot password?</a>
                </div>
                <button type="submit" class="login-btn" id="login-btn">
                    <span id="login-btn-text">Sign In</span>
                    <span id="login-spinner" class="loading-spinner" style="display: none;"></span>
                </button>
            </form>
            <div id="two-factor-auth" style="display: none;">
                <div class="login-divider"></div>
                <div class="form-group">
                    <label for="two-factor-code">Two-Factor Authentication Code</label>
                    <input type="text" id="two-factor-code" class="form-control" placeholder="Enter 6-digit code" maxlength="6">
                </div>
                <button type="button" class="login-btn" id="verify-2fa-btn">
                    <span id="verify-btn-text">Verify</span>
                    <span id="verify-spinner" class="loading-spinner" style="display: none;"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="admin-container" style="display: none;">
        <!-- Sidebar -->
        <div class="admin-sidebar">
            <div class="admin-logo">
                <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash LLC">
                <span>BitHash</span>
            </div>
            <ul class="admin-menu">
                <li><a href="#" class="active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>
                <span class="menu-label">Management</span>
                <li><a href="#" data-section="users"><i class="fas fa-users"></i><span>Users</span></a></li>
                <li><a href="#" data-section="deposits"><i class="fas fa-money-bill-wave"></i><span>Deposits</span></a></li>
                <li><a href="#" data-section="withdrawals"><i class="fas fa-wallet"></i><span>Withdrawals</span></a></li>
                <li><a href="#" data-section="transactions"><i class="fas fa-exchange-alt"></i><span>Transactions</span></a></li>
                <li><a href="#" data-section="cards"><i class="fas fa-credit-card"></i><span>Saved Cards</span></a></li>
                <span class="menu-label">Support</span>
                <li><a href="#" data-section="tickets"><i class="fas fa-ticket-alt"></i><span>Support Tickets</span></a></li>
                <li><a href="#" data-section="chat"><i class="fas fa-comments"></i><span>Live Chat</span></a></li>
                <span class="menu-label">Settings</span>
                <li><a href="#" data-section="settings"><i class="fas fa-cog"></i><span>Settings</span></a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="admin-main">
            <!-- Header -->
            <div class="admin-header">
                <div class="header-left">
                    <button class="toggle-sidebar" id="toggle-sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="header-title">
                        <h1 id="page-title">Dashboard</h1>
                    </div>
                </div>
                <div class="header-right">
                    <div class="header-icon" id="notifications-icon">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notification-count">0</span>
                    </div>
                    <div class="admin-profile" id="admin-profile">
                        <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" class="profile-image" id="admin-avatar">
                        <span class="profile-name" id="admin-name">Admin</span>
                        <div class="profile-dropdown">
                            <a href="#" id="profile-link"><i class="fas fa-user"></i> Profile</a>
                            <a href="#" id="settings-link"><i class="fas fa-cog"></i> Settings</a>
                            <a href="#" id="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="admin-content">
                <!-- Dashboard Section -->
                <div id="dashboard-section">
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>
                                    <div class="stat-card-title">Total Users</div>
                                    <div class="stat-card-value" id="total-users">0</div>
                                    <div class="stat-card-change positive">
                                        <i class="fas fa-arrow-up"></i> <span id="users-change">0%</span> from yesterday
                                    </div>
                                </div>
                                <div class="stat-card-icon users">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>
                                    <div class="stat-card-title">Total Deposits</div>
                                    <div class="stat-card-value" id="total-deposits">$0</div>
                                    <div class="stat-card-change positive">
                                        <i class="fas fa-arrow-up"></i> <span id="deposits-change">0%</span> from yesterday
                                    </div>
                                </div>
                                <div class="stat-card-icon deposits">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>
                                    <div class="stat-card-title">Total Withdrawals</div>
                                    <div class="stat-card-value" id="total-withdrawals">$0</div>
                                    <div class="stat-card-change negative">
                                        <i class="fas fa-arrow-down"></i> <span id="withdrawals-change">0%</span> from yesterday
                                    </div>
                                </div>
                                <div class="stat-card-icon withdrawals">
                                    <i class="fas fa-wallet"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div>
                                    <div class="stat-card-title">Platform Balance</div>
                                    <div class="stat-card-value" id="platform-balance">$0</div>
                                    <div class="stat-card-change positive">
                                        <i class="fas fa-arrow-up"></i> <span id="balance-change">0%</span> from yesterday
                                    </div>
                                </div>
                                <div class="stat-card-icon balance">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">Recent Activity</div>
                            <div class="table-actions">
                                <button class="btn btn-secondary" id="refresh-activity">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <table id="activity-table" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Activity</th>
                                    <th>IP Address</th>
                                    <th>Device</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Users Section -->
                <div id="users-section" style="display: none;">
                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">User Management</div>
                            <div class="table-actions">
                                <button class="btn btn-primary" id="add-user-btn">
                                    <i class="fas fa-plus"></i> Add User
                                </button>
                                <button class="btn btn-secondary" id="refresh-users">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <table id="users-table" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Balance</th>
                                    <th>Status</th>
                                    <th>Joined</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Deposits Section -->
                <div id="deposits-section" style="display: none;">
                    <div class="admin-tabs">
                        <div class="tab-item active" data-status="pending">Pending</div>
                        <div class="tab-item" data-status="completed">Completed</div>
                        <div class="tab-item" data-status="rejected">Rejected</div>
                        <div class="tab-item" data-status="all">All Deposits</div>
                    </div>
                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">Deposit Requests</div>
                            <div class="table-actions">
                                <button class="btn btn-secondary" id="refresh-deposits">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <table id="deposits-table" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Withdrawals Section -->
                <div id="withdrawals-section" style="display: none;">
                    <div class="admin-tabs">
                        <div class="tab-item active" data-status="pending">Pending</div>
                        <div class="tab-item" data-status="completed">Completed</div>
                        <div class="tab-item" data-status="rejected">Rejected</div>
                        <div class="tab-item" data-status="all">All Withdrawals</div>
                    </div>
                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">Withdrawal Requests</div>
                            <div class="table-actions">
                                <button class="btn btn-secondary" id="refresh-withdrawals">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <table id="withdrawals-table" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Transactions Section -->
                <div id="transactions-section" style="display: none;">
                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">All Transactions</div>
                            <div class="table-actions">
                                <div class="form-group" style="margin-bottom: 0;">
                                    <select id="transaction-type" class="form-control">
                                        <option value="all">All Types</option>
                                        <option value="deposit">Deposits</option>
                                        <option value="withdrawal">Withdrawals</option>
                                        <option value="transfer">Transfers</option>
                                        <option value="investment">Investments</option>
                                    </select>
                                </div>
                                <button class="btn btn-secondary" id="refresh-transactions">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <table id="transactions-table" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Saved Cards Section -->
                <div id="cards-section" style="display: none;">
                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">Saved Payment Cards</div>
                            <div class="table-actions">
                                <button class="btn btn-secondary" id="refresh-cards">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <table id="cards-table" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Card Type</th>
                                    <th>Last 4 Digits</th>
                                    <th>Expiry</th>
                                    <th>Added</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Support Tickets Section -->
                <div id="tickets-section" style="display: none;">
                    <div class="admin-tabs">
                        <div class="tab-item active" data-status="open">Open</div>
                        <div class="tab-item" data-status="pending">Pending</div>
                        <div class="tab-item" data-status="resolved">Resolved</div>
                        <div class="tab-item" data-status="all">All Tickets</div>
                    </div>
                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">Support Tickets</div>
                            <div class="table-actions">
                                <button class="btn btn-secondary" id="refresh-tickets">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <table id="tickets-table" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Subject</th>
                                    <th>Status</th>
                                    <th>Priority</th>
                                    <th>Last Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Live Chat Section -->
                <div id="chat-section" style="display: none;">
                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">Active Chats</div>
                            <div class="table-actions">
                                <button class="btn btn-secondary" id="refresh-chats">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <table id="chats-table" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Status</th>
                                    <th>Last Message</th>
                                    <th>Started</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings-section" style="display: none;">
                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">Admin Settings</div>
                        </div>
                        <div class="form-group">
                            <label>Two-Factor Authentication</label>
                            <div id="2fa-status" style="margin-top: 10px;">
                                <span class="status-badge status-pending">Loading...</span>
                            </div>
                            <button class="btn btn-primary" id="toggle-2fa" style="margin-top: 15px;">
                                <i class="fas fa-shield-alt"></i> Configure 2FA
                            </button>
                        </div>
                        <div class="form-group">
                            <label>Change Password</label>
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="current-password">Current Password</label>
                                    <input type="password" id="current-password" class="form-control">
                                </div>
                                <div class="form-col">
                                    <label for="new-password">New Password</label>
                                    <input type="password" id="new-password" class="form-control">
                                </div>
                                <div class="form-col">
                                    <label for="confirm-password">Confirm Password</label>
                                    <input type="password" id="confirm-password" class="form-control">
                                </div>
                            </div>
                            <button class="btn btn-primary" id="change-password-btn" style="margin-top: 15px;">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Widget -->
    <div class="chat-widget" id="chat-widget">
        <div class="chat-header">
            <div class="chat-title">
                <i class="fas fa-comment-dots"></i>
                <span id="chat-user-name">Live Chat</span>
            </div>
            <button class="chat-close" id="close-chat">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="chat-body" id="chat-messages">
            <!-- Messages will be loaded here -->
        </div>
        <div class="chat-input">
            <input type="text" id="chat-input" placeholder="Type your message...">
            <button class="chat-send" id="send-message">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Modals -->
    <!-- View User Modal -->
    <div class="modal-overlay" id="view-user-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">User Details</div>
                <button class="modal-close" id="close-view-user">&times;</button>
            </div>
            <div class="modal-body">
                <div class="user-profile-header">
                    <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" class="user-avatar" id="user-avatar">
                    <div class="user-info">
                        <h2 id="user-full-name">Loading...</h2>
                        <p id="user-email">user@example.com</p>
                        <div class="user-stats">
                            <div class="user-stat">
                                <div class="user-stat-label">Balance</div>
                                <div class="user-stat-value" id="user-balance">$0.00</div>
                            </div>
                            <div class="user-stat">
                                <div class="user-stat-label">Status</div>
                                <div class="user-stat-value" id="user-status">Active</div>
                            </div>
                            <div class="user-stat">
                                <div class="user-stat-label">Joined</div>
                                <div class="user-stat-value" id="user-joined">2023-01-01</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label>First Name</label>
                        <input type="text" class="form-control" id="user-first-name" readonly>
                    </div>
                    <div class="form-col">
                        <label>Last Name</label>
                        <input type="text" class="form-control" id="user-last-name" readonly>
                    </div>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-control" id="user-email-input" readonly>
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="text" class="form-control" id="user-phone" readonly>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" class="form-control" id="user-address" readonly>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label>City</label>
                        <input type="text" class="form-control" id="user-city" readonly>
                    </div>
                    <div class="form-col">
                        <label>Country</label>
                        <input type="text" class="form-control" id="user-country" readonly>
                    </div>
                </div>
                <div class="form-group">
                    <label>KYC Status</label>
                    <input type="text" class="form-control" id="user-kyc" readonly>
                </div>
                <div class="form-group">
                    <label>Last Login</label>
                    <input type="text" class="form-control" id="user-last-login" readonly>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-view-user-btn">Close</button>
                <button class="btn btn-primary" id="edit-user-btn">Edit User</button>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal-overlay" id="edit-user-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Edit User</div>
                <button class="modal-close" id="close-edit-user">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-col">
                        <label>First Name</label>
                        <input type="text" class="form-control" id="edit-first-name">
                    </div>
                    <div class="form-col">
                        <label>Last Name</label>
                        <input type="text" class="form-control" id="edit-last-name">
                    </div>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-control" id="edit-email">
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="text" class="form-control" id="edit-phone">
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" class="form-control" id="edit-address">
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label>City</label>
                        <input type="text" class="form-control" id="edit-city">
                    </div>
                    <div class="form-col">
                        <label>Country</label>
                        <input type="text" class="form-control" id="edit-country">
                    </div>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select class="form-control" id="edit-status">
                        <option value="active">Active</option>
                        <option value="suspended">Suspended</option>
                        <option value="banned">Banned</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>KYC Status</label>
                    <select class="form-control" id="edit-kyc">
                        <option value="verified">Verified</option>
                        <option value="pending">Pending</option>
                        <option value="unverified">Unverified</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Balance Adjustment</label>
                    <div class="form-row">
                        <div class="form-col">
                            <select class="form-control" id="balance-action">
                                <option value="add">Add Funds</option>
                                <option value="subtract">Subtract Funds</option>
                                <option value="set">Set Exact Amount</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <input type="number" class="form-control" id="balance-amount" placeholder="Amount">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea class="form-control" id="edit-notes" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-edit-user">Cancel</button>
                <button class="btn btn-primary" id="save-user-changes">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal-overlay" id="add-user-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Add New User</div>
                <button class="modal-close" id="close-add-user">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-col">
                        <label>First Name</label>
                        <input type="text" class="form-control" id="add-first-name" required>
                    </div>
                    <div class="form-col">
                        <label>Last Name</label>
                        <input type="text" class="form-control" id="add-last-name" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-control" id="add-email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-control" id="add-password" required>
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="text" class="form-control" id="add-phone">
                </div>
                <div class="form-group">
                    <label>Initial Balance</label>
                    <input type="number" class="form-control" id="add-balance" value="0">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select class="form-control" id="add-status">
                        <option value="active">Active</option>
                        <option value="suspended">Suspended</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-add-user">Cancel</button>
                <button class="btn btn-primary" id="create-user">Create User</button>
            </div>
        </div>
    </div>

    <!-- Deposit Action Modal -->
    <div class="modal-overlay" id="deposit-action-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Process Deposit</div>
                <button class="modal-close" id="close-deposit-action">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Deposit ID</label>
                    <input type="text" class="form-control" id="deposit-id" readonly>
                </div>
                <div class="form-group">
                    <label>User</label>
                    <input type="text" class="form-control" id="deposit-user" readonly>
                </div>
                <div class="form-group">
                    <label>Amount</label>
                    <input type="text" class="form-control" id="deposit-amount" readonly>
                </div>
                <div class="form-group">
                    <label>Payment Method</label>
                    <input type="text" class="form-control" id="deposit-method" readonly>
                </div>
                <div class="form-group">
                    <label>Transaction ID</label>
                    <input type="text" class="form-control" id="deposit-txid" readonly>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select class="form-control" id="deposit-status">
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Admin Notes</label>
                    <textarea class="form-control" id="deposit-notes" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-deposit-action">Cancel</button>
                <button class="btn btn-primary" id="save-deposit-action">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Withdrawal Action Modal -->
    <div class="modal-overlay" id="withdrawal-action-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Process Withdrawal</div>
                <button class="modal-close" id="close-withdrawal-action">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Withdrawal ID</label>
                    <input type="text" class="form-control" id="withdrawal-id" readonly>
                </div>
                <div class="form-group">
                    <label>User</label>
                    <input type="text" class="form-control" id="withdrawal-user" readonly>
                </div>
                <div class="form-group">
                    <label>Amount</label>
                    <input type="text" class="form-control" id="withdrawal-amount" readonly>
                </div>
                <div class="form-group">
                    <label>Payment Method</label>
                    <input type="text" class="form-control" id="withdrawal-method" readonly>
                </div>
                <div class="form-group">
                    <label>Wallet Address</label>
                    <input type="text" class="form-control" id="withdrawal-wallet" readonly>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select class="form-control" id="withdrawal-status">
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Transaction ID (for completed withdrawals)</label>
                    <input type="text" class="form-control" id="withdrawal-txid">
                </div>
                <div class="form-group">
                    <label>Admin Notes</label>
                    <textarea class="form-control" id="withdrawal-notes" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-withdrawal-action">Cancel</button>
                <button class="btn btn-primary" id="save-withdrawal-action">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- View Ticket Modal -->
    <div class="modal-overlay" id="view-ticket-modal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">Support Ticket #<span id="ticket-id"></span></div>
                <button class="modal-close" id="close-view-ticket">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-col">
                        <label>User</label>
                        <input type="text" class="form-control" id="ticket-user" readonly>
                    </div>
                    <div class="form-col">
                        <label>Status</label>
                        <input type="text" class="form-control" id="ticket-status" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label>Priority</label>
                        <input type="text" class="form-control" id="ticket-priority" readonly>
                    </div>
                    <div class="form-col">
                        <label>Created</label>
                        <input type="text" class="form-control" id="ticket-created" readonly>
                    </div>
                </div>
                <div class="form-group">
                    <label>Subject</label>
                    <input type="text" class="form-control" id="ticket-subject" readonly>
                </div>
                <div class="form-group">
                    <label>Message</label>
                    <textarea class="form-control" id="ticket-message" rows="5" readonly></textarea>
                </div>
                <div class="form-group">
                    <label>Attachments</label>
                    <div id="ticket-attachments">
                        <!-- Attachments will be loaded here -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Conversation</label>
                    <div id="ticket-conversation" style="max-height: 300px; overflow-y: auto; background-color: var(--secondary-dark); padding: 15px; border-radius: var(--border-radius);">
                        <!-- Conversation will be loaded here -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Reply</label>
                    <textarea class="form-control" id="ticket-reply" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Change Status</label>
                    <select class="form-control" id="ticket-new-status">
                        <option value="open">Open</option>
                        <option value="pending">Pending</option>
                        <option value="resolved">Resolved</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-ticket-btn">Close</button>
                <button class="btn btn-primary" id="send-ticket-reply">Send Reply</button>
            </div>
        </div>
    </div>

    <!-- 2FA Setup Modal -->
    <div class="modal-overlay" id="2fa-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Two-Factor Authentication Setup</div>
                <button class="modal-close" id="close-2fa">&times;</button>
            </div>
            <div class="modal-body">
                <div class="two-factor-box">
                    <p>Scan the QR code below with your authenticator app:</p>
                    <div id="qrcode"></div>
                    <p>Or enter this secret key manually:</p>
                    <div class="two-factor-code" id="2fa-secret"></div>
                    <p>Enter the 6-digit code from your authenticator app to verify:</p>
                    <input type="text" class="form-control" id="2fa-verify-code" placeholder="123456" maxlength="6" style="text-align: center; letter-spacing: 5px; font-size: 18px;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-2fa">Cancel</button>
                <button class="btn btn-primary" id="verify-2fa">Verify & Enable</button>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div class="modal-overlay" id="notifications-modal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <div class="modal-title">Notifications</div>
                <button class="modal-close" id="close-notifications">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div id="notifications-list">
                    <!-- Notifications will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="mark-all-read">Mark All as Read</button>
                <button class="btn btn-primary" id="close-notifications-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
    
    <!-- AOS Animation -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <!-- QR Code Generator -->
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    
    <!-- Toastr -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    
    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <script>
        // Initialize AOS
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true
        });

        // Toastr configuration
        toastr.options = {
            positionClass: "toast-top-right",
            timeOut: 5000,
            extendedTimeOut: 1000,
            closeButton: true,
            progressBar: true,
            newestOnTop: true,
            preventDuplicates: true
        };

        // Global variables
        let adminToken = localStorage.getItem('adminToken');
        let csrfToken = localStorage.getItem('csrfToken');
        let currentUser = null;
        let socket = null;
        let activeChatUserId = null;
        let dataTables = {};

        // Check authentication on page load
        $(document).ready(function() {
            checkAuth();
            
            // Initialize event listeners
            initEventListeners();
            
            // Initialize DataTables
            initDataTables();
        });

        // Check authentication status
        function checkAuth() {
            if (adminToken) {
                verifyToken();
            } else {
                $('#login-page').show();
                $('#admin-dashboard').hide();
            }
        }

        // Verify admin token with backend
        function verifyToken() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/verify',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        currentUser = response.data.admin;
                        $('#admin-name').text(currentUser.name);
                        $('#admin-avatar').attr('src', 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1');
                        
                        $('#login-page').hide();
                        $('#admin-dashboard').show();
                        
                        // Load dashboard data
                        loadDashboardData();
                        
                        // Connect to WebSocket
                        connectWebSocket();
                    } else {
                        localStorage.removeItem('adminToken');
                        localStorage.removeItem('csrfToken');
                        $('#login-page').show();
                        $('#admin-dashboard').hide();
                        toastr.error('Session expired. Please log in again.');
                    }
                },
                error: function(xhr, status, error) {
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('csrfToken');
                    $('#login-page').show();
                    $('#admin-dashboard').hide();
                    toastr.error('Session verification failed. Please log in again.');
                }
            });
        }

        // Initialize event listeners
        function initEventListeners() {
            // Login form
            $('#login-form').on('submit', function(e) {
                e.preventDefault();
                adminLogin();
            });
            
            // Forgot password
            $('#forgot-password').on('click', function(e) {
                e.preventDefault();
                forgotPassword();
            });
            
            // Verify 2FA
            $('#verify-2fa-btn').on('click', function() {
                verify2FACode();
            });
            
            // Logout
            $('#logout-link').on('click', function(e) {
                e.preventDefault();
                adminLogout();
            });
            
            // Toggle sidebar
            $('#toggle-sidebar').on('click', function() {
                $('.admin-container').toggleClass('sidebar-collapsed');
            });
            
            // Menu navigation
            $('.admin-menu a').on('click', function(e) {
                e.preventDefault();
                const section = $(this).data('section');
                showSection(section);
            });
            
            // Refresh buttons
            $('[id^="refresh-"]').on('click', function() {
                const section = this.id.replace('refresh-', '');
                refreshSection(section);
            });
            
            // Tab navigation
            $('.tab-item').on('click', function() {
                const status = $(this).data('status');
                const section = $(this).closest('[id$="-section"]').attr('id').replace('-section', '');
                
                $('.tab-item').removeClass('active');
                $(this).addClass('active');
                
                refreshSection(section, { status: status });
            });
            
            // Transaction type filter
            $('#transaction-type').on('change', function() {
                const type = $(this).val();
                refreshSection('transactions', { type: type });
            });
            
            // Modal close buttons
            $('[id^="close-"]').on('click', function() {
                const modalId = this.id.replace('close-', '');
                $('#' + modalId + '-modal').removeClass('active');
            });
            
            // View user modal
            $(document).on('click', '.view-user', function() {
                const userId = $(this).data('id');
                viewUser(userId);
            });
            
            // Edit user modal
            $('#edit-user-btn').on('click', function() {
                $('#view-user-modal').removeClass('active');
                $('#edit-user-modal').addClass('active');
            });
            
            // Save user changes
            $('#save-user-changes').on('click', function() {
                saveUserChanges();
            });
            
            // Cancel edit user
            $('#cancel-edit-user').on('click', function() {
                $('#edit-user-modal').removeClass('active');
                $('#view-user-modal').addClass('active');
            });
            
            // Close view user
            $('#close-view-user-btn').on('click', function() {
                $('#view-user-modal').removeClass('active');
            });
            
            // Add user button
            $('#add-user-btn').on('click', function() {
                $('#add-user-modal').addClass('active');
            });
            
            // Create user
            $('#create-user').on('click', function() {
                createUser();
            });
            
            // Cancel add user
            $('#cancel-add-user').on('click', function() {
                $('#add-user-modal').removeClass('active');
            });
            
            // Process deposit
            $(document).on('click', '.process-deposit', function() {
                const depositId = $(this).data('id');
                viewDeposit(depositId);
            });
            
            // Save deposit action
            $('#save-deposit-action').on('click', function() {
                processDeposit();
            });
            
            // Cancel deposit action
            $('#cancel-deposit-action').on('click', function() {
                $('#deposit-action-modal').removeClass('active');
            });
            
            // Process withdrawal
            $(document).on('click', '.process-withdrawal', function() {
                const withdrawalId = $(this).data('id');
                viewWithdrawal(withdrawalId);
            });
            
            // Save withdrawal action
            $('#save-withdrawal-action').on('click', function() {
                processWithdrawal();
            });
            
            // Cancel withdrawal action
            $('#cancel-withdrawal-action').on('click', function() {
                $('#withdrawal-action-modal').removeClass('active');
            });
            
            // View ticket
            $(document).on('click', '.view-ticket', function() {
                const ticketId = $(this).data('id');
                viewTicket(ticketId);
            });
            
            // Send ticket reply
            $('#send-ticket-reply').on('click', function() {
                sendTicketReply();
            });
            
            // Close ticket
            $('#close-ticket-btn').on('click', function() {
                $('#view-ticket-modal').removeClass('active');
            });
            
            // View chat
            $(document).on('click', '.view-chat', function() {
                const userId = $(this).data('id');
                openChat(userId);
            });
            
            // Close chat widget
            $('#close-chat').on('click', function() {
                $('#chat-widget').removeClass('active');
                activeChatUserId = null;
            });
            
            // Send message
            $('#send-message').on('click', function() {
                sendChatMessage();
            });
            
            // Chat input enter key
            $('#chat-input').on('keypress', function(e) {
                if (e.which === 13) {
                    sendChatMessage();
                }
            });
            
            // Toggle 2FA
            $('#toggle-2fa').on('click', function() {
                toggle2FA();
            });
            
            // Verify 2FA setup
            $('#verify-2fa').on('click', function() {
                verify2FASetup();
            });
            
            // Cancel 2FA setup
            $('#cancel-2fa').on('click', function() {
                $('#2fa-modal').removeClass('active');
            });
            
            // Change password
            $('#change-password-btn').on('click', function() {
                changePassword();
            });
            
            // Notifications icon
            $('#notifications-icon').on('click', function() {
                showNotifications();
            });
            
            // Close notifications
            $('#close-notifications-btn').on('click', function() {
                $('#notifications-modal').removeClass('active');
            });
            
            // Mark all as read
            $('#mark-all-read').on('click', function() {
                markAllNotificationsRead();
            });
        }

        // Initialize DataTables
        function initDataTables() {
            // Activity table
            dataTables.activity = $('#activity-table').DataTable({
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/activity',
                    type: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + adminToken,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'id' },
                    { data: 'user.name' },
                    { data: 'activity' },
                    { data: 'ipAddress' },
                    { data: 'device' },
                    { 
                        data: 'createdAt',
                        render: function(data) {
                            return moment(data).format('YYYY-MM-DD HH:mm');
                        }
                    }
                ],
                order: [[5, 'desc']],
                responsive: true,
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                pageLength: 10
            });
            
            // Users table
            dataTables.users = $('#users-table').DataTable({
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/users',
                    type: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + adminToken,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'id' },
                    { data: 'name' },
                    { data: 'email' },
                    { 
                        data: 'balance',
                        render: function(data) {
                            return '$' + parseFloat(data).toFixed(2);
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-pending';
                            if (data === 'active') badgeClass = 'status-approved';
                            if (data === 'banned') badgeClass = 'status-rejected';
                            return '<span class="status-badge ' + badgeClass + '">' + data.charAt(0).toUpperCase() + data.slice(1) + '</span>';
                        }
                    },
                    { 
                        data: 'createdAt',
                        render: function(data) {
                            return moment(data).format('YYYY-MM-DD');
                        }
                    },
                    {
                        data: 'id',
                        render: function(data) {
                            return '<button class="action-btn view view-user" data-id="' + data + '" title="View"><i class="fas fa-eye"></i></button>' +
                                   '<button class="action-btn edit" title="Edit"><i class="fas fa-edit"></i></button>' +
                                   '<button class="action-btn delete" title="Delete"><i class="fas fa-trash"></i></button>';
                        },
                        orderable: false
                    }
                ],
                order: [[5, 'desc']],
                responsive: true,
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                pageLength: 10
            });
            
            // Deposits table
            dataTables.deposits = $('#deposits-table').DataTable({
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/deposits',
                    type: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + adminToken,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    data: function(d) {
                        d.status = $('.tab-item.active').data('status');
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'id' },
                    { data: 'user.name' },
                    { 
                        data: 'amount',
                        render: function(data) {
                            return '$' + parseFloat(data).toFixed(2);
                        }
                    },
                    { data: 'method' },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-pending';
                            if (data === 'completed') badgeClass = 'status-approved';
                            if (data === 'rejected') badgeClass = 'status-rejected';
                            return '<span class="status-badge ' + badgeClass + '">' + data.charAt(0).toUpperCase() + data.slice(1) + '</span>';
                        }
                    },
                    { 
                        data: 'createdAt',
                        render: function(data) {
                            return moment(data).format('YYYY-MM-DD HH:mm');
                        }
                    },
                    {
                        data: 'id',
                        render: function(data, type, row) {
                            if (row.status === 'pending') {
                                return '<button class="btn btn-sm btn-success process-deposit" data-id="' + data + '">Process</button>';
                            } else {
                                return '<button class="btn btn-sm btn-primary process-deposit" data-id="' + data + '">View</button>';
                            }
                        },
                        orderable: false
                    }
                ],
                order: [[5, 'desc']],
                responsive: true,
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                pageLength: 10
            });
            
            // Withdrawals table
            dataTables.withdrawals = $('#withdrawals-table').DataTable({
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/withdrawals',
                    type: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + adminToken,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    data: function(d) {
                        d.status = $('.tab-item.active').data('status');
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'id' },
                    { data: 'user.name' },
                    { 
                        data: 'amount',
                        render: function(data) {
                            return '$' + parseFloat(data).toFixed(2);
                        }
                    },
                    { data: 'method' },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-pending';
                            if (data === 'completed') badgeClass = 'status-approved';
                            if (data === 'rejected') badgeClass = 'status-rejected';
                            return '<span class="status-badge ' + badgeClass + '">' + data.charAt(0).toUpperCase() + data.slice(1) + '</span>';
                        }
                    },
                    { 
                        data: 'createdAt',
                        render: function(data) {
                            return moment(data).format('YYYY-MM-DD HH:mm');
                        }
                    },
                    {
                        data: 'id',
                        render: function(data, type, row) {
                            if (row.status === 'pending') {
                                return '<button class="btn btn-sm btn-success process-withdrawal" data-id="' + data + '">Process</button>';
                            } else {
                                return '<button class="btn btn-sm btn-primary process-withdrawal" data-id="' + data + '">View</button>';
                            }
                        },
                        orderable: false
                    }
                ],
                order: [[5, 'desc']],
                responsive: true,
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                pageLength: 10
            });
            
            // Transactions table
            dataTables.transactions = $('#transactions-table').DataTable({
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/transactions',
                    type: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + adminToken,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    data: function(d) {
                        d.type = $('#transaction-type').val();
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'id' },
                    { data: 'user.name' },
                    { 
                        data: 'type',
                        render: function(data) {
                            return data.charAt(0).toUpperCase() + data.slice(1);
                        }
                    },
                    { 
                        data: 'amount',
                        render: function(data) {
                            return '$' + parseFloat(data).toFixed(2);
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-pending';
                            if (data === 'completed') badgeClass = 'status-approved';
                            if (data === 'failed') badgeClass = 'status-rejected';
                            return '<span class="status-badge ' + badgeClass + '">' + data.charAt(0).toUpperCase() + data.slice(1) + '</span>';
                        }
                    },
                    { 
                        data: 'createdAt',
                        render: function(data) {
                            return moment(data).format('YYYY-MM-DD HH:mm');
                        }
                    },
                    {
                        data: 'id',
                        render: function(data) {
                            return '<button class="btn btn-sm btn-primary">Details</button>';
                        },
                        orderable: false
                    }
                ],
                order: [[5, 'desc']],
                responsive: true,
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                pageLength: 10
            });
            
            // Cards table
            dataTables.cards = $('#cards-table').DataTable({
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/cards',
                    type: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + adminToken,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'id' },
                    { data: 'user.name' },
                    { data: 'brand' },
                    { data: 'last4' },
                    { 
                        data: null,
                        render: function(data) {
                            return data.exp_month + '/' + data.exp_year;
                        }
                    },
                    { 
                        data: 'createdAt',
                        render: function(data) {
                            return moment(data).format('YYYY-MM-DD');
                        }
                    },
                    {
                        data: 'id',
                        render: function(data) {
                            return '<button class="btn btn-sm btn-danger">Delete</button>';
                        },
                        orderable: false
                    }
                ],
                order: [[5, 'desc']],
                responsive: true,
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                pageLength: 10
            });
            
            // Tickets table
            dataTables.tickets = $('#tickets-table').DataTable({
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/tickets',
                    type: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + adminToken,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    data: function(d) {
                        d.status = $('.tab-item.active').data('status');
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'id' },
                    { data: 'user.name' },
                    { data: 'subject' },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-pending';
                            if (data === 'open') badgeClass = 'status-approved';
                            if (data === 'resolved') badgeClass = 'status-completed';
                            return '<span class="status-badge ' + badgeClass + '">' + data.charAt(0).toUpperCase() + data.slice(1) + '</span>';
                        }
                    },
                    { 
                        data: 'priority',
                        render: function(data) {
                            return data.charAt(0).toUpperCase() + data.slice(1);
                        }
                    },
                    { 
                        data: 'updatedAt',
                        render: function(data) {
                            return moment(data).format('YYYY-MM-DD HH:mm');
                        }
                    },
                    {
                        data: 'id',
                        render: function(data) {
                            return '<button class="btn btn-sm btn-primary view-ticket" data-id="' + data + '">View</button>';
                        },
                        orderable: false
                    }
                ],
                order: [[5, 'desc']],
                responsive: true,
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                pageLength: 10
            });
            
            // Chats table
            dataTables.chats = $('#chats-table').DataTable({
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/chats',
                    type: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + adminToken,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'id' },
                    { data: 'user.name' },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-pending';
                            if (data === 'active') badgeClass = 'status-approved';
                            if (data === 'closed') badgeClass = 'status-completed';
                            return '<span class="status-badge ' + badgeClass + '">' + data.charAt(0).toUpperCase() + data.slice(1) + '</span>';
                        }
                    },
                    { 
                        data: 'lastMessage',
                        render: function(data) {
                            return data ? data.substring(0, 30) + (data.length > 30 ? '...' : '') : 'No messages';
                        }
                    },
                    { 
                        data: 'createdAt',
                        render: function(data) {
                            return moment(data).format('YYYY-MM-DD HH:mm');
                        }
                    },
                    {
                        data: 'user.id',
                        render: function(data) {
                            return '<button class="btn btn-sm btn-primary view-chat" data-id="' + data + '">Chat</button>';
                        },
                        orderable: false
                    }
                ],
                order: [[4, 'desc']],
                responsive: true,
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                pageLength: 10
            });
        }

        // Admin login
        function adminLogin() {
            const email = $('#email').val();
            const password = $('#password').val();
            const remember = $('#remember').is(':checked');
            
            $('#login-btn-text').hide();
            $('#login-spinner').show();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/login',
                type: 'POST',
                data: {
                    email: email,
                    password: password
                },
                success: function(response) {
                    if (response.status === 'success') {
                        if (response.twoFactorRequired) {
                            // Show 2FA input
                            $('#two-factor-auth').show();
                            $('#login-form').hide();
                            $('#login-btn-text').show();
                            $('#login-spinner').hide();
                        } else {
                            // Login successful
                            adminToken = response.token;
                            csrfToken = response.csrfToken;
                            
                            if (remember) {
                                localStorage.setItem('adminToken', adminToken);
                                localStorage.setItem('csrfToken', csrfToken);
                            } else {
                                sessionStorage.setItem('adminToken', adminToken);
                                sessionStorage.setItem('csrfToken', csrfToken);
                            }
                            
                            checkAuth();
                        }
                    } else {
                        $('#login-btn-text').show();
                        $('#login-spinner').hide();
                        toastr.error(response.message || 'Login failed');
                    }
                },
                error: function(xhr) {
                    $('#login-btn-text').show();
                    $('#login-spinner').hide();
                    const error = xhr.responseJSON || {};
                    toastr.error(error.message || 'Login failed. Please try again.');
                }
            });
        }

        // Verify 2FA code
        function verify2FACode() {
            const code = $('#two-factor-code').val();
            const email = $('#email').val();
            
            if (!code || code.length !== 6) {
                toastr.error('Please enter a valid 6-digit code');
                return;
            }
            
            $('#verify-btn-text').hide();
            $('#verify-spinner').show();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/verify-2fa',
                type: 'POST',
                data: {
                    token: code,
                    email: email
                },
                success: function(response) {
                    if (response.status === 'success') {
                        adminToken = response.token;
                        csrfToken = crypto.randomBytes(32).toString('hex');
                        
                        localStorage.setItem('adminToken', adminToken);
                        localStorage.setItem('csrfToken', csrfToken);
                        
                        checkAuth();
                    } else {
                        $('#verify-btn-text').show();
                        $('#verify-spinner').hide();
                        toastr.error(response.message || '2FA verification failed');
                    }
                },
                error: function(xhr) {
                    $('#verify-btn-text').show();
                    $('#verify-spinner').hide();
                    const error = xhr.responseJSON || {};
                    toastr.error(error.message || '2FA verification failed. Please try again.');
                }
            });
        }

        // Forgot password
        function forgotPassword() {
            const email = $('#email').val();
            
            if (!email) {
                toastr.error('Please enter your email address');
                return;
            }
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/forgot-password',
                type: 'POST',
                data: {
                    email: email
                },
                success: function(response) {
                    toastr.success('Password reset link sent to your email');
                },
                error: function(xhr) {
                    const error = xhr.responseJSON || {};
                    toastr.error(error.message || 'Failed to send password reset link');
                }
            });
        }

        // Admin logout
        function adminLogout() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/logout',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function() {
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('csrfToken');
                    sessionStorage.removeItem('adminToken');
                    sessionStorage.removeItem('csrfToken');
                    adminToken = null;
                    csrfToken = null;
                    
                    if (socket) {
                        socket.disconnect();
                        socket = null;
                    }
                    
                    $('#login-page').show();
                    $('#admin-dashboard').hide();
                    
                    // Reset login form
                    $('#email').val('');
                    $('#password').val('');
                    $('#two-factor-auth').hide();
                    $('#login-form').show();
                },
                error: function() {
                    toastr.error('Logout failed. Please try again.');
                }
            });
        }

        // Show section
        function showSection(section) {
            // Hide all sections
            $('[id$="-section"]').hide();
            
            // Show selected section
            $('#' + section + '-section').show();
            
            // Update page title
            $('#page-title').text(section.charAt(0).toUpperCase() + section.slice(1));
            
            // Update active menu item
            $('.admin-menu a').removeClass('active');
            $('.admin-menu a[data-section="' + section + '"]').addClass('active');
            
            // Refresh section data
            refreshSection(section);
        }

        // Refresh section data
        function refreshSection(section, params = {}) {
            if (dataTables[section]) {
                dataTables[section].ajax.reload();
            }
            
            // Special cases
            if (section === 'dashboard') {
                loadDashboardData();
            }
        }

        // Load dashboard data
        function loadDashboardData() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/stats',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const stats = response.data;
                        
                        $('#total-users').text(stats.totalUsers.toLocaleString());
                        $('#users-change').text(stats.usersChange + '%');
                        
                        $('#total-deposits').text('$' + stats.totalDeposits.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                        $('#deposits-change').text(stats.depositsChange + '%');
                        
                        $('#total-withdrawals').text('$' + stats.totalWithdrawals.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                        $('#withdrawals-change').text(stats.withdrawalsChange + '%');
                        
                        $('#platform-balance').text('$' + stats.platformBalance.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
                        $('#balance-change').text(stats.balanceChange + '%');
                    }
                },
                error: function() {
                    toastr.error('Failed to load dashboard data');
                }
            });
        }

        // View user details
        function viewUser(userId) {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users/' + userId,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const user = response.data.user;
                        
                        $('#user-full-name').text(user.name);
                        $('#user-email').text(user.email);
                        $('#user-balance').text('$' + parseFloat(user.balance).toFixed(2));
                        $('#user-status').text(user.status.charAt(0).toUpperCase() + user.status.slice(1));
                        $('#user-joined').text(moment(user.createdAt).format('YYYY-MM-DD'));
                        
                        $('#user-first-name').val(user.firstName || 'N/A');
                        $('#user-last-name').val(user.lastName || 'N/A');
                        $('#user-email-input').val(user.email || 'N/A');
                        $('#user-phone').val(user.phone || 'N/A');
                        $('#user-address').val(user.address || 'N/A');
                        $('#user-city').val(user.city || 'N/A');
                        $('#user-country').val(user.country || 'N/A');
                        $('#user-kyc').val(user.kycStatus || 'N/A');
                        $('#user-last-login').val(user.lastLogin ? moment(user.lastLogin).format('YYYY-MM-DD HH:mm') : 'Never');
                        
                        $('#view-user-modal').addClass('active');
                    } else {
                        toastr.error(response.message || 'Failed to load user data');
                    }
                },
                error: function() {
                    toastr.error('Failed to load user data');
                }
            });
        }

        // Save user changes
        function saveUserChanges() {
            const userId = $('#view-user-modal').data('userId');
            const firstName = $('#edit-first-name').val();
            const lastName = $('#edit-last-name').val();
            const email = $('#edit-email').val();
            const phone = $('#edit-phone').val();
            const address = $('#edit-address').val();
            const city = $('#edit-city').val();
            const country = $('#edit-country').val();
            const status = $('#edit-status').val();
            const kycStatus = $('#edit-kyc').val();
            const balanceAction = $('#balance-action').val();
            const balanceAmount = parseFloat($('#balance-amount').val()) || 0;
            const notes = $('#edit-notes').val();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users/' + userId,
                type: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: {
                    firstName: firstName,
                    lastName: lastName,
                    email: email,
                    phone: phone,
                    address: address,
                    city: city,
                    country: country,
                    status: status,
                    kycStatus: kycStatus,
                    balanceAction: balanceAction,
                    balanceAmount: balanceAmount,
                    notes: notes
                },
                success: function(response) {
                    if (response.status === 'success') {
                        toastr.success('User updated successfully');
                        $('#edit-user-modal').removeClass('active');
                        $('#view-user-modal').removeClass('active');
                        refreshSection('users');
                    } else {
                        toastr.error(response.message || 'Failed to update user');
                    }
                },
                error: function() {
                    toastr.error('Failed to update user');
                }
            });
        }

        // Create new user
        function createUser() {
            const firstName = $('#add-first-name').val();
            const lastName = $('#add-last-name').val();
            const email = $('#add-email').val();
            const password = $('#add-password').val();
            const phone = $('#add-phone').val();
            const balance = parseFloat($('#add-balance').val()) || 0;
            const status = $('#add-status').val();
            
            if (!firstName || !lastName || !email || !password) {
                toastr.error('Please fill all required fields');
                return;
            }
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: {
                    firstName: firstName,
                    lastName: lastName,
                    email: email,
                    password: password,
                    phone: phone,
                    balance: balance,
                    status: status
                },
                success: function(response) {
                    if (response.status === 'success') {
                        toastr.success('User created successfully');
                        $('#add-user-modal').removeClass('active');
                        refreshSection('users');
                        
                        // Reset form
                        $('#add-first-name').val('');
                        $('#add-last-name').val('');
                        $('#add-email').val('');
                        $('#add-password').val('');
                        $('#add-phone').val('');
                        $('#add-balance').val('0');
                        $('#add-status').val('active');
                    } else {
                        toastr.error(response.message || 'Failed to create user');
                    }
                },
                error: function(xhr) {
                    const error = xhr.responseJSON || {};
                    toastr.error(error.message || 'Failed to create user');
                }
            });
        }

        // View deposit
        function viewDeposit(depositId) {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/deposits/' + depositId,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const deposit = response.data.deposit;
                        
                        $('#deposit-id').val(deposit.id);
                        $('#deposit-user').val(deposit.user.name);
                        $('#deposit-amount').val('$' + parseFloat(deposit.amount).toFixed(2));
                        $('#deposit-method').val(deposit.method);
                        $('#deposit-txid').val(deposit.transactionId || 'N/A');
                        $('#deposit-status').val(deposit.status);
                        $('#deposit-notes').val(deposit.adminNotes || '');
                        
                        $('#deposit-action-modal').addClass('active');
                    } else {
                        toastr.error(response.message || 'Failed to load deposit data');
                    }
                },
                error: function() {
                    toastr.error('Failed to load deposit data');
                }
            });
        }

        // Process deposit
        function processDeposit() {
            const depositId = $('#deposit-id').val();
            const status = $('#deposit-status').val();
            const notes = $('#deposit-notes').val();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/deposits/' + depositId,
                type: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: {
                    status: status,
                    adminNotes: notes
                },
                success: function(response) {
                    if (response.status === 'success') {
                        toastr.success('Deposit updated successfully');
                        $('#deposit-action-modal').removeClass('active');
                        refreshSection('deposits');
                    } else {
                        toastr.error(response.message || 'Failed to update deposit');
                    }
                },
                error: function() {
                    toastr.error('Failed to update deposit');
                }
            });
        }

        // View withdrawal
        function viewWithdrawal(withdrawalId) {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/withdrawals/' + withdrawalId,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const withdrawal = response.data.withdrawal;
                        
                        $('#withdrawal-id').val(withdrawal.id);
                        $('#withdrawal-user').val(withdrawal.user.name);
                        $('#withdrawal-amount').val('$' + parseFloat(withdrawal.amount).toFixed(2));
                        $('#withdrawal-method').val(withdrawal.method);
                        $('#withdrawal-wallet').val(withdrawal.walletAddress || 'N/A');
                        $('#withdrawal-status').val(withdrawal.status);
                        $('#withdrawal-txid').val(withdrawal.transactionId || '');
                        $('#withdrawal-notes').val(withdrawal.adminNotes || '');
                        
                        $('#withdrawal-action-modal').addClass('active');
                    } else {
                        toastr.error(response.message || 'Failed to load withdrawal data');
                    }
                },
                error: function() {
                    toastr.error('Failed to load withdrawal data');
                }
            });
        }

        // Process withdrawal
        function processWithdrawal() {
            const withdrawalId = $('#withdrawal-id').val();
            const status = $('#withdrawal-status').val();
            const txid = $('#withdrawal-txid').val();
            const notes = $('#withdrawal-notes').val();
            
            if (status === 'completed' && !txid) {
                toastr.error('Please enter transaction ID for completed withdrawals');
                return;
            }
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/withdrawals/' + withdrawalId,
                type: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: {
                    status: status,
                    transactionId: txid,
                    adminNotes: notes
                },
                success: function(response) {
                    if (response.status === 'success') {
                        toastr.success('Withdrawal updated successfully');
                        $('#withdrawal-action-modal').removeClass('active');
                        refreshSection('withdrawals');
                    } else {
                        toastr.error(response.message || 'Failed to update withdrawal');
                    }
                },
                error: function() {
                    toastr.error('Failed to update withdrawal');
                }
            });
        }

        // View ticket
        function viewTicket(ticketId) {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/tickets/' + ticketId,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const ticket = response.data.ticket;
                        
                        $('#ticket-id').text(ticket.id);
                        $('#ticket-user').val(ticket.user.name);
                        $('#ticket-status').val(ticket.status.charAt(0).toUpperCase() + ticket.status.slice(1));
                        $('#ticket-priority').val(ticket.priority.charAt(0).toUpperCase() + ticket.priority.slice(1));
                        $('#ticket-created').val(moment(ticket.createdAt).format('YYYY-MM-DD HH:mm'));
                        $('#ticket-subject').val(ticket.subject);
                        $('#ticket-message').val(ticket.message);
                        $('#ticket-new-status').val(ticket.status);
                        
                        // Load attachments
                        $('#ticket-attachments').empty();
                        if (ticket.attachments && ticket.attachments.length > 0) {
                            ticket.attachments.forEach(attachment => {
                                $('#ticket-attachments').append(
                                    '<a href="' + attachment.url + '" target="_blank" style="display: inline-block; margin-right: 10px;">' +
                                    '<i class="fas fa-paperclip"></i> ' + attachment.name + '</a>'
                                );
                            });
                        } else {
                            $('#ticket-attachments').text('No attachments');
                        }
                        
                        // Load conversation
                        $('#ticket-conversation').empty();
                        if (ticket.conversation && ticket.conversation.length > 0) {
                            ticket.conversation.forEach(message => {
                                const isAdmin = message.sender === 'admin';
                                const time = moment(message.createdAt).format('HH:mm');
                                
                                $('#ticket-conversation').append(
                                    '<div style="margin-bottom: 15px; text-align: ' + (isAdmin ? 'right' : 'left') + ';">' +
                                    '<div style="font-weight: bold; color: ' + (isAdmin ? 'var(--primary)' : 'var(--dark)') + ';">' +
                                    (isAdmin ? 'You' : ticket.user.name) + '</div>' +
                                    '<div style="background-color: ' + (isAdmin ? 'var(--primary)' : 'var(--gray-light)') + '; ' +
                                    'color: ' + (isAdmin ? 'white' : 'var(--dark)') + '; ' +
                                    'display: inline-block; padding: 8px 12px; border-radius: 12px; max-width: 80%;">' +
                                    message.message + '</div>' +
                                    '<div style="font-size: 11px; color: var(--gray); margin-top: 5px;">' + time + '</div>' +
                                    '</div>'
                                );
                            });
                        } else {
                            $('#ticket-conversation').text('No conversation yet');
                        }
                        
                        $('#view-ticket-modal').addClass('active');
                    } else {
                        toastr.error(response.message || 'Failed to load ticket data');
                    }
                },
                error: function() {
                    toastr.error('Failed to load ticket data');
                }
            });
        }

        // Send ticket reply
        function sendTicketReply() {
            const ticketId = $('#ticket-id').text();
            const message = $('#ticket-reply').val();
            const status = $('#ticket-new-status').val();
            
            if (!message) {
                toastr.error('Please enter a message');
                return;
            }
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/tickets/' + ticketId + '/reply',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: {
                    message: message,
                    status: status
                },
                success: function(response) {
                    if (response.status === 'success') {
                        toastr.success('Reply sent successfully');
                        $('#ticket-reply').val('');
                        viewTicket(ticketId);
                        refreshSection('tickets');
                    } else {
                        toastr.error(response.message || 'Failed to send reply');
                    }
                },
                error: function() {
                    toastr.error('Failed to send reply');
                }
            });
        }

        // Open chat with user
        function openChat(userId) {
            activeChatUserId = userId;
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/chats/' + userId,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const chat = response.data.chat;
                        const user = response.data.user;
                        
                        $('#chat-user-name').text(user.name);
                        $('#chat-messages').empty();
                        
                        if (chat.messages && chat.messages.length > 0) {
                            chat.messages.forEach(message => {
                                const isAdmin = message.sender === 'admin';
                                const time = moment(message.createdAt).format('HH:mm');
                                
                                $('#chat-messages').append(
                                    '<div class="message ' + (isAdmin ? 'admin' : 'user') + '">' +
                                    '<div class="message-content">' + message.text + '</div>' +
                                    '<div class="message-time">' + time + '</div>' +
                                    '</div>'
                                );
                            });
                            
                            // Scroll to bottom
                            $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
                        } else {
                            $('#chat-messages').append(
                                '<div style="text-align: center; color: var(--gray); padding: 20px;">' +
                                'No messages yet. Start the conversation.' +
                                '</div>'
                            );
                        }
                        
                        $('#chat-widget').addClass('active');
                    } else {
                        toastr.error(response.message || 'Failed to load chat');
                    }
                },
                error: function() {
                    toastr.error('Failed to load chat');
                }
            });
        }

        // Send chat message
        function sendChatMessage() {
            const message = $('#chat-input').val();
            
            if (!message || !activeChatUserId) {
                return;
            }
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/chats/' + activeChatUserId + '/send',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: {
                    message: message
                },
                success: function(response) {
                    if (response.status === 'success') {
                        $('#chat-input').val('');
                        
                        // Add message to chat
                        const time = moment().format('HH:mm');
                        
                        $('#chat-messages').append(
                            '<div class="message admin">' +
                            '<div class="message-content">' + message + '</div>' +
                            '<div class="message-time">' + time + '</div>' +
                            '</div>'
                        );
                        
                        // Scroll to bottom
                        $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
                        
                        // Refresh chats list
                        refreshSection('chat');
                    } else {
                        toastr.error(response.message || 'Failed to send message');
                    }
                },
                error: function() {
                    toastr.error('Failed to send message');
                }
            });
        }

        // Toggle 2FA
        function toggle2FA() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/2fa/status',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        if (response.data.enabled) {
                            // Disable 2FA
                            disable2FA();
                        } else {
                            // Enable 2FA - show setup modal
                            setup2FA();
                        }
                    } else {
                        toastr.error(response.message || 'Failed to check 2FA status');
                    }
                },
                error: function() {
                    toastr.error('Failed to check 2FA status');
                }
            });
        }

        // Setup 2FA
        function setup2FA() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/2fa/setup',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const secret = response.data.secret;
                        const qrCodeUrl = response.data.qrCodeUrl;
                        
                        $('#2fa-secret').text(secret);
                        
                        // Generate QR code
                        $('#qrcode').empty();
                        new QRCode(document.getElementById('qrcode'), {
                            text: qrCodeUrl,
                            width: 200,
                            height: 200,
                            colorDark: '#000000',
                            colorLight: '#ffffff',
                            correctLevel: QRCode.CorrectLevel.H
                        });
                        
                        $('#2fa-modal').addClass('active');
                    } else {
                        toastr.error(response.message || 'Failed to setup 2FA');
                    }
                },
                error: function() {
                    toastr.error('Failed to setup 2FA');
                }
            });
        }

        // Verify 2FA setup
        function verify2FASetup() {
            const code = $('#2fa-verify-code').val();
            
            if (!code || code.length !== 6) {
                toastr.error('Please enter a valid 6-digit code');
                return;
            }
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/2fa/verify',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: {
                    code: code
                },
                success: function(response) {
                    if (response.status === 'success') {
                        toastr.success('Two-factor authentication enabled successfully');
                        $('#2fa-modal').removeClass('active');
                        check2FAStatus();
                    } else {
                        toastr.error(response.message || 'Invalid verification code');
                    }
                },
                error: function() {
                    toastr.error('Failed to verify 2FA code');
                }
            });
        }

        // Disable 2FA
        function disable2FA() {
            if (confirm('Are you sure you want to disable two-factor authentication? This reduces your account security.')) {
                $.ajax({
                    url: 'https://website-backendd-1.onrender.com/api/admin/auth/2fa/disable',
                    type: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + adminToken,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    success: function(response) {
                        if (response.status === 'success') {
                            toastr.success('Two-factor authentication disabled successfully');
                            check2FAStatus();
                        } else {
                            toastr.error(response.message || 'Failed to disable 2FA');
                        }
                    },
                    error: function() {
                        toastr.error('Failed to disable 2FA');
                    }
                });
            }
        }

        // Check 2FA status
        function check2FAStatus() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/2fa/status',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        if (response.data.enabled) {
                            $('#2fa-status').html('<span class="status-badge status-approved">Enabled</span>');
                            $('#toggle-2fa').html('<i class="fas fa-shield-alt"></i> Disable 2FA');
                        } else {
                            $('#2fa-status').html('<span class="status-badge status-rejected">Disabled</span>');
                            $('#toggle-2fa').html('<i class="fas fa-shield-alt"></i> Enable 2FA');
                        }
                    } else {
                        toastr.error(response.message || 'Failed to check 2FA status');
                    }
                },
                error: function() {
                    toastr.error('Failed to check 2FA status');
                }
            });
        }

        // Change password
        function changePassword() {
            const currentPassword = $('#current-password').val();
            const newPassword = $('#new-password').val();
            const confirmPassword = $('#confirm-password').val();
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                toastr.error('Please fill all password fields');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                toastr.error('New passwords do not match');
                return;
            }
            
            if (newPassword.length < 8) {
                toastr.error('Password must be at least 8 characters');
                return;
            }
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/change-password',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: {
                    currentPassword: currentPassword,
                    newPassword: newPassword,
                    confirmPassword: confirmPassword
                },
                success: function(response) {
                    if (response.status === 'success') {
                        toastr.success('Password changed successfully');
                        
                        // Clear fields
                        $('#current-password').val('');
                        $('#new-password').val('');
                        $('#confirm-password').val('');
                    } else {
                        toastr.error(response.message || 'Failed to change password');
                    }
                },
                error: function(xhr) {
                    const error = xhr.responseJSON || {};
                    toastr.error(error.message || 'Failed to change password');
                }
            });
        }

        // Show notifications
        function showNotifications() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/notifications',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const notifications = response.data.notifications;
                        
                        $('#notifications-list').empty();
                        
                        if (notifications.length > 0) {
                            notifications.forEach(notification => {
                                $('#notifications-list').append(
                                    '<div class="notification-item' + (notification.read ? '' : ' unread') + '" data-id="' + notification.id + '">' +
                                    '<div class="notification-title">' +
                                    '<span>' + notification.title + '</span>' +
                                    '<span class="notification-time">' + moment(notification.createdAt).fromNow() + '</span>' +
                                    '</div>' +
                                    '<div class="notification-message">' + notification.message + '</div>' +
                                    '</div>'
                                );
                            });
                        } else {
                            $('#notifications-list').append(
                                '<div style="text-align: center; padding: 20px; color: var(--gray);">' +
                                'No notifications' +
                                '</div>'
                            );
                        }
                        
                        // Update badge count
                        const unreadCount = notifications.filter(n => !n.read).length;
                        $('#notification-count').text(unreadCount);
                        
                        $('#notifications-modal').addClass('active');
                    } else {
                        toastr.error(response.message || 'Failed to load notifications');
                    }
                },
                error: function() {
                    toastr.error('Failed to load notifications');
                }
            });
        }

        // Mark all notifications as read
        function markAllNotificationsRead() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/notifications/mark-all-read',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        toastr.success('All notifications marked as read');
                        $('#notification-count').text('0');
                        $('.notification-item').removeClass('unread');
                    } else {
                        toastr.error(response.message || 'Failed to mark notifications as read');
                    }
                },
                error: function() {
                    toastr.error('Failed to mark notifications as read');
                }
            });
        }

        // Connect to WebSocket for real-time updates
        function connectWebSocket() {
            if (socket) {
                socket.disconnect();
            }
            
            socket = io('https://website-backendd-1.onrender.com', {
                transports: ['websocket'],
                query: {
                    token: adminToken
                }
            });
            
            socket.on('connect', function() {
                console.log('Connected to WebSocket');
            });
            
            socket.on('disconnect', function() {
                console.log('Disconnected from WebSocket');
            });
            
            socket.on('error', function(error) {
                console.error('WebSocket error:', error);
            });
            
            // Listen for new notifications
            socket.on('new_notification', function(data) {
                const unreadCount = parseInt($('#notification-count').text()) + 1;
                $('#notification-count').text(unreadCount);
                
                toastr.info(data.message, data.title);
            });
            
            // Listen for new deposit requests
            socket.on('new_deposit', function(data) {
                toastr.info('New deposit request: $' + data.amount.toFixed(2) + ' via ' + data.method, 'New Deposit');
                
                if ($('#deposits-section').is(':visible')) {
                    refreshSection('deposits');
                }
            });
            
            // Listen for new withdrawal requests
            socket.on('new_withdrawal', function(data) {
                toastr.info('New withdrawal request: $' + data.amount.toFixed(2) + ' via ' + data.method, 'New Withdrawal');
                
                if ($('#withdrawals-section').is(':visible')) {
                    refreshSection('withdrawals');
                }
            });
            
            // Listen for new user signups
            socket.on('new_user', function(data) {
                toastr.success('New user registered: ' + data.name, 'New User');
                
                if ($('#users-section').is(':visible')) {
                    refreshSection('users');
                }
                
                if ($('#dashboard-section').is(':visible')) {
                    loadDashboardData();
                }
            });
            
            // Listen for new support tickets
            socket.on('new_ticket', function(data) {
                toastr.warning('New support ticket: ' + data.subject, 'New Ticket');
                
                if ($('#tickets-section').is(':visible')) {
                    refreshSection('tickets');
                }
            });
            
            // Listen for new chat messages
            socket.on('new_chat_message', function(data) {
                if (activeChatUserId && activeChatUserId === data.userId) {
                    // Add message to active chat
                    const time = moment().format('HH:mm');
                    
                    $('#chat-messages').append(
                        '<div class="message user">' +
                        '<div class="message-content">' + data.message + '</div>' +
                        '<div class="message-time">' + time + '</div>' +
                        '</div>'
                    );
                    
                    // Scroll to bottom
                    $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
                } else {
                    // Show notification
                    toastr.info('New message from ' + data.userName, 'New Chat Message');
                }
                
                if ($('#chat-section').is(':visible')) {
                    refreshSection('chat');
                }
            });
        }
    </script>
</body>
</html>
