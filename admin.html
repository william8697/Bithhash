<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Dashboard | BitHash LLC</title>
    <meta name="description" content="BitHash LLC Admin Dashboard - Institutional Bitcoin Mining Management">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" type="image/png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.bootstrap5.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Toastr -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    
    <style>
        :root {
            --primary: #00D395;
            --primary-dark: #00B783;
            --secondary: #1E1E1E;
            --secondary-dark: #121212;
            --light: #F8F9FA;
            --dark: #212529;
            --gray: #6C757D;
            --gray-light: #E9ECEF;
            --gray-dark: #343A40;
            --success: #28A745;
            --warning: #FFC107;
            --danger: #DC3545;
            --info: #17A2B8;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F7FA;
            color: var(--dark);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .auth-container {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 2rem;
        }

        .auth-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 100%;
            max-width: 450px;
            padding: 2.5rem;
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-logo img {
            height: 50px;
        }

        .auth-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #CED4DA;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(0, 211, 149, 0.25);
        }

        .btn {
            display: inline-block;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            user-select: none;
            border: 1px solid transparent;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            line-height: 1.5;
            border-radius: var(--border-radius);
            transition: var(--transition);
            cursor: pointer;
        }

        .btn-primary {
            color: white;
            background-color: var(--primary);
            border-color: var(--primary);
            width: 100%;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .mt-3 {
            margin-top: 1rem;
        }

        .mb-3 {
            margin-bottom: 1rem;
        }

        .text-muted {
            color: var(--gray);
        }

        .text-danger {
            color: var(--danger);
        }

        .invalid-feedback {
            display: none;
            width: 100%;
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: var(--danger);
        }

        .is-invalid ~ .invalid-feedback {
            display: block;
        }

        .is-invalid {
            border-color: var(--danger);
        }

        /* Admin Dashboard Styles */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: var(--secondary-dark);
            color: white;
            transition: var(--transition);
            position: fixed;
            height: 100vh;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-brand {
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .sidebar-brand img {
            height: 30px;
            margin-right: 0.75rem;
        }

        .sidebar-menu {
            padding: 1rem 0;
        }

        .sidebar-menu-item {
            margin-bottom: 0.25rem;
        }

        .sidebar-menu-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
        }

        .sidebar-menu-link:hover, .sidebar-menu-link.active {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu-link i {
            margin-right: 0.75rem;
            font-size: 1.1rem;
        }

        .sidebar-menu-link .badge {
            margin-left: auto;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .sidebar-submenu {
            padding-left: 3rem;
            display: none;
        }

        .sidebar-submenu.show {
            display: block;
        }

        .sidebar-submenu-item {
            margin-bottom: 0.25rem;
        }

        .sidebar-submenu-link {
            display: block;
            padding: 0.5rem 0;
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .sidebar-submenu-link:hover, .sidebar-submenu-link.active {
            color: white;
        }

        .main-content {
            flex: 1;
            margin-left: 250px;
            background-color: #F5F7FA;
            min-height: 100vh;
        }

        .topbar {
            background-color: white;
            padding: 1rem 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .topbar-left {
            display: flex;
            align-items: center;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--gray);
            cursor: pointer;
            margin-right: 1rem;
        }

        .search-bar {
            position: relative;
        }

        .search-bar input {
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            width: 250px;
        }

        .search-bar i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .topbar-right {
            display: flex;
            align-items: center;
        }

        .topbar-item {
            margin-left: 1.5rem;
            position: relative;
        }

        .topbar-link {
            color: var(--gray-dark);
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .topbar-link:hover {
            color: var(--primary);
        }

        .topbar-icon {
            font-size: 1.25rem;
        }

        .topbar-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
        }

        .dropdown-menu {
            position: absolute;
            right: 0;
            top: 100%;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            min-width: 200px;
            padding: 0.5rem 0;
            z-index: 1000;
            display: none;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            display: block;
            padding: 0.5rem 1.5rem;
            color: var(--dark);
            text-decoration: none;
            transition: var(--transition);
        }

        .dropdown-item:hover {
            background-color: var(--gray-light);
            color: var(--primary);
        }

        .dropdown-divider {
            height: 1px;
            background-color: var(--gray-light);
            margin: 0.5rem 0;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 0.5rem;
        }

        .user-name {
            font-weight: 500;
            margin-right: 0.5rem;
        }

        .content-wrapper {
            padding: 1.5rem;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }

        .breadcrumb {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: 0.9rem;
        }

        .breadcrumb-item {
            color: var(--gray);
        }

        .breadcrumb-item + .breadcrumb-item::before {
            content: "/";
            padding: 0 0.5rem;
        }

        .breadcrumb-item.active {
            color: var(--primary);
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 1.5rem;
            border: none;
        }

        .card-header {
            padding: 1rem 1.5rem;
            background-color: white;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: var(--border-radius) var(--border-radius) 0 0 !important;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .card-body {
            padding: 1.5rem;
        }

        .card-footer {
            padding: 1rem 1.5rem;
            background-color: white;
            border-top: 1px solid var(--gray-light);
            border-radius: 0 0 var(--border-radius) var(--border-radius) !important;
        }

        .stats-card {
            text-align: center;
            padding: 1.5rem;
        }

        .stats-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .stats-number {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .stats-title {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .stats-change {
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .stats-change.positive {
            color: var(--success);
        }

        .stats-change.negative {
            color: var(--danger);
        }

        .table-responsive {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            margin-bottom: 1rem;
            color: var(--dark);
            border-collapse: collapse;
        }

        .table th, .table td {
            padding: 0.75rem;
            vertical-align: top;
            border-top: 1px solid var(--gray-light);
        }

        .table thead th {
            vertical-align: bottom;
            border-bottom: 2px solid var(--gray-light);
            font-weight: 600;
        }

        .table tbody + tbody {
            border-top: 2px solid var(--gray-light);
        }

        .badge {
            display: inline-block;
            padding: 0.35em 0.65em;
            font-size: 0.75em;
            font-weight: 600;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.25rem;
        }

        .badge-primary {
            color: white;
            background-color: var(--primary);
        }

        .badge-success {
            color: white;
            background-color: var(--success);
        }

        .badge-warning {
            color: var(--dark);
            background-color: var(--warning);
        }

        .badge-danger {
            color: white;
            background-color: var(--danger);
        }

        .badge-info {
            color: white;
            background-color: var(--info);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1050;
        }

        .modal.show {
            display: flex;
        }

        .modal-dialog {
            max-width: 600px;
            width: 100%;
            margin: 1.75rem;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
        }

        .close {
            background: none;
            border: none;
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1;
            color: var(--gray);
            cursor: pointer;
        }

        .close:hover {
            color: var(--dark);
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-right: -0.75rem;
            margin-left: -0.75rem;
        }

        .col {
            flex: 1 0 0%;
            padding-right: 0.75rem;
            padding-left: 0.75rem;
        }

        .col-6 {
            flex: 0 0 50%;
            max-width: 50%;
        }

        .col-12 {
            flex: 0 0 100%;
            max-width: 100%;
        }

        .alert {
            padding: 0.75rem 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            border-radius: var(--border-radius);
        }

        .alert-success {
            color: #155724;
            background-color: #D4EDDA;
            border-color: #C3E6CB;
        }

        .alert-danger {
            color: #721C24;
            background-color: #F8D7DA;
            border-color: #F5C6CB;
        }

        .alert-warning {
            color: #856404;
            background-color: #FFF3CD;
            border-color: #FFEEBA;
        }

        .alert-info {
            color: #0C5460;
            background-color: #D1ECF1;
            border-color: #BEE5EB;
        }

        .nav-tabs {
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 1.5rem;
        }

        .nav-tabs .nav-item {
            margin-bottom: -1px;
        }

        .nav-tabs .nav-link {
            padding: 0.75rem 1.5rem;
            border: 1px solid transparent;
            border-top-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
            color: var(--gray);
            font-weight: 500;
        }

        .nav-tabs .nav-link:hover {
            border-color: var(--gray-light);
            color: var(--primary);
        }

        .nav-tabs .nav-link.active {
            color: var(--primary);
            background-color: white;
            border-color: var(--gray-light) var(--gray-light) white;
        }

        .tab-content {
            padding: 1.5rem 0;
        }

        .chat-container {
            display: flex;
            height: 500px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .chat-sidebar {
            width: 300px;
            border-right: 1px solid var(--gray-light);
            background-color: white;
            overflow-y: auto;
        }

        .chat-search {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-light);
        }

        .chat-search input {
            width: 100%;
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
        }

        .chat-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .chat-item {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-light);
            cursor: pointer;
            transition: var(--transition);
        }

        .chat-item:hover, .chat-item.active {
            background-color: var(--gray-light);
        }

        .chat-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .chat-item-name {
            font-weight: 600;
        }

        .chat-item-time {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .chat-item-message {
            font-size: 0.9rem;
            color: var(--gray);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: white;
        }

        .chat-header {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            align-items: center;
        }

        .chat-header-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 1rem;
        }

        .chat-header-info {
            flex: 1;
        }

        .chat-header-name {
            font-weight: 600;
            margin: 0;
        }

        .chat-header-status {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background-color: #F5F7FA;
        }

        .chat-message {
            margin-bottom: 1rem;
            max-width: 70%;
        }

        .chat-message-incoming {
            margin-right: auto;
        }

        .chat-message-outgoing {
            margin-left: auto;
            text-align: right;
        }

        .chat-message-content {
            display: inline-block;
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            background-color: white;
            box-shadow: var(--box-shadow);
            position: relative;
        }

        .chat-message-outgoing .chat-message-content {
            background-color: var(--primary);
            color: white;
        }

        .chat-message-time {
            font-size: 0.7rem;
            color: var(--gray);
            margin-top: 0.25rem;
        }

        .chat-input {
            padding: 1rem;
            border-top: 1px solid var(--gray-light);
            background-color: white;
        }

        .chat-input-form {
            display: flex;
        }

        .chat-input-field {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            margin-right: 0.5rem;
        }

        .chat-input-btn {
            padding: 0.75rem 1.5rem;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
        }

        .chat-input-btn:hover {
            background-color: var(--primary-dark);
        }

        /* Responsive styles */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.show {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            .auth-card {
                padding: 1.5rem;
            }
            .content-wrapper {
                padding: 1rem;
            }
            .stats-card {
                padding: 1rem;
            }
            .col-6 {
                flex: 0 0 100%;
                max-width: 100%;
            }
        }

        /* Loading spinner */
        .spinner-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div id="auth-section" class="auth-container">
        <div class="auth-card">
            <div class="auth-logo">
                <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash LLC">
            </div>
            <h1 class="auth-title">Admin Login</h1>
            <form id="login-form">
                <div class="form-group">
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                    <div class="invalid-feedback">Please provide a valid email address</div>
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" name="password" required>
                    <div class="invalid-feedback">Password is required</div>
                </div>
                <div class="form-group form-check mb-3">
                    <input type="checkbox" class="form-check-input" id="remember" name="remember">
                    <label class="form-check-label" for="remember">Remember me</label>
                </div>
                <button type="submit" class="btn btn-primary" id="login-btn">Login</button>
            </form>
            <div class="text-center mt-3">
                <a href="#" id="forgot-password" class="text-muted">Forgot password?</a>
            </div>
            <div id="2fa-section" style="display: none;" class="mt-3">
                <h3 class="text-center mb-3">Two-Factor Authentication</h3>
                <form id="2fa-form">
                    <div class="form-group">
                        <label for="token" class="form-label">Enter 6-digit code</label>
                        <input type="text" class="form-control" id="token" name="token" maxlength="6" required>
                        <div class="invalid-feedback">Please enter the 6-digit code from your authenticator app</div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="verify-2fa-btn">Verify</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard Section -->
    <div id="admin-dashboard" style="display: none;">
        <div class="dashboard-container">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <a href="#" class="sidebar-brand">
                        <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash LLC">
                        <span>BitHash LLC</span>
                    </a>
                </div>
                <div class="sidebar-menu">
                    <div class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </div>
                    <div class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" data-section="users">
                            <i class="fas fa-users"></i>
                            <span>User Management</span>
                            <span class="badge" id="new-users-badge">0</span>
                        </a>
                    </div>
                    <div class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" data-section="deposits">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Deposit Requests</span>
                            <span class="badge" id="pending-deposits-badge">0</span>
                        </a>
                    </div>
                    <div class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" data-section="transactions">
                            <i class="fas fa-exchange-alt"></i>
                            <span>Transactions</span>
                        </a>
                    </div>
                    <div class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" data-section="investments">
                            <i class="fas fa-chart-line"></i>
                            <span>Investments</span>
                        </a>
                    </div>
                    <div class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" data-section="support">
                            <i class="fas fa-headset"></i>
                            <span>Support Chat</span>
                            <span class="badge" id="unread-chats-badge">0</span>
                        </a>
                    </div>
                    <div class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" data-section="settings">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Topbar -->
                <div class="topbar">
                    <div class="topbar-left">
                        <button class="sidebar-toggle" id="sidebar-toggle">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Search...">
                        </div>
                    </div>
                    <div class="topbar-right">
                        <div class="topbar-item">
                            <a href="#" class="topbar-link" id="notifications-btn">
                                <i class="fas fa-bell topbar-icon"></i>
                                <span class="topbar-badge" id="notifications-badge">0</span>
                            </a>
                            <div class="dropdown-menu" id="notifications-dropdown">
                                <div class="dropdown-header">Notifications</div>
                                <div class="dropdown-divider"></div>
                                <div id="notifications-list">
                                    <a href="#" class="dropdown-item">
                                        <div>No new notifications</div>
                                        <small class="text-muted">Just now</small>
                                    </a>
                                </div>
                                <div class="dropdown-divider"></div>
                                <a href="#" class="dropdown-item text-center">View all</a>
                            </div>
                        </div>
                        <div class="topbar-item">
                            <a href="#" class="topbar-link" id="profile-btn">
                                <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="Admin" class="user-avatar">
                                <span class="user-name" id="admin-name">Admin</span>
                                <i class="fas fa-chevron-down"></i>
                            </a>
                            <div class="dropdown-menu" id="profile-dropdown">
                                <a href="#" class="dropdown-item">
                                    <i class="fas fa-user mr-2"></i> Profile
                                </a>
                                <a href="#" class="dropdown-item">
                                    <i class="fas fa-cog mr-2"></i> Settings
                                </a>
                                <div class="dropdown-divider"></div>
                                <a href="#" class="dropdown-item" id="logout-btn">
                                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Wrapper -->
                <div class="content-wrapper">
                    <!-- Dashboard Section -->
                    <div id="dashboard-section">
                        <div class="page-header">
                            <h1 class="page-title">Dashboard</h1>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#">Home</a></li>
                                <li class="breadcrumb-item active">Dashboard</li>
                            </ul>
                        </div>

                        <div class="row">
                            <div class="col-12 col-md-6 col-lg-3">
                                <div class="card stats-card">
                                    <div class="stats-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <h3 class="stats-number" id="total-users">0</h3>
                                    <p class="stats-title">Total Users</p>
                                    <p class="stats-change positive">
                                        <i class="fas fa-arrow-up"></i> <span id="user-growth-rate">0%</span> this month
                                    </p>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-3">
                                <div class="card stats-card">
                                    <div class="stats-icon">
                                        <i class="fas fa-money-bill-wave"></i>
                                    </div>
                                    <h3 class="stats-number" id="total-deposits">$0</h3>
                                    <p class="stats-title">Total Deposits</p>
                                    <p class="stats-change positive">
                                        <i class="fas fa-arrow-up"></i> <span id="deposit-growth-rate">0%</span> this month
                                    </p>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-3">
                                <div class="card stats-card">
                                    <div class="stats-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <h3 class="stats-number" id="active-investments">0</h3>
                                    <p class="stats-title">Active Investments</p>
                                    <p class="stats-change positive">
                                        <i class="fas fa-arrow-up"></i> <span id="investment-growth-rate">0%</span> this month
                                    </p>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-3">
                                <div class="card stats-card">
                                    <div class="stats-icon">
                                        <i class="fas fa-headset"></i>
                                    </div>
                                    <h3 class="stats-number" id="open-tickets">0</h3>
                                    <p class="stats-title">Open Support Tickets</p>
                                    <p class="stats-change negative">
                                        <i class="fas fa-arrow-down"></i> <span id="ticket-resolution-rate">0%</span> resolved today
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-lg-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Recent Activity</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table" id="recent-activity-table">
                                                <thead>
                                                    <tr>
                                                        <th>User</th>
                                                        <th>Activity</th>
                                                        <th>Time</th>
                                                        <th>Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td colspan="4" class="text-center">
                                                            <div class="spinner-container">
                                                                <div class="spinner"></div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Quick Actions</h3>
                                    </div>
                                    <div class="card-body">
                                        <button class="btn btn-primary btn-block mb-3" id="add-user-btn">
                                            <i class="fas fa-user-plus mr-2"></i> Add New User
                                        </button>
                                        <button class="btn btn-primary btn-block mb-3" id="process-deposits-btn">
                                            <i class="fas fa-money-bill-wave mr-2"></i> Process Deposits
                                        </button>
                                        <button class="btn btn-primary btn-block mb-3" id="view-transactions-btn">
                                            <i class="fas fa-exchange-alt mr-2"></i> View Transactions
                                        </button>
                                        <button class="btn btn-primary btn-block" id="support-tickets-btn">
                                            <i class="fas fa-headset mr-2"></i> Support Tickets
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- User Management Section -->
                    <div id="users-section" style="display: none;">
                        <div class="page-header">
                            <h1 class="page-title">User Management</h1>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#">Home</a></li>
                                <li class="breadcrumb-item active">User Management</li>
                            </ul>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">All Users</h3>
                                <button class="btn btn-primary" id="add-new-user-btn">
                                    <i class="fas fa-user-plus mr-2"></i> Add New User
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table" id="users-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Balance</th>
                                                <th>Status</th>
                                                <th>Joined</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="7" class="text-center">
                                                    <div class="spinner-container">
                                                        <div class="spinner"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Deposit Requests Section -->
                    <div id="deposits-section" style="display: none;">
                        <div class="page-header">
                            <h1 class="page-title">Deposit Requests</h1>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#">Home</a></li>
                                <li class="breadcrumb-item active">Deposit Requests</li>
                            </ul>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Pending Deposit Requests</h3>
                                <div>
                                    <button class="btn btn-success mr-2" id="approve-selected-deposits">
                                        <i class="fas fa-check mr-2"></i> Approve Selected
                                    </button>
                                    <button class="btn btn-danger" id="reject-selected-deposits">
                                        <i class="fas fa-times mr-2"></i> Reject Selected
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <ul class="nav nav-tabs" id="deposit-tabs">
                                    <li class="nav-item">
                                        <a class="nav-link active" data-toggle="tab" href="#card-deposits">Card Deposits</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-toggle="tab" href="#crypto-deposits">Crypto Deposits</a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane fade show active" id="card-deposits">
                                        <div class="table-responsive">
                                            <table class="table" id="card-deposits-table">
                                                <thead>
                                                    <tr>
                                                        <th>
                                                            <input type="checkbox" id="select-all-card-deposits">
                                                        </th>
                                                        <th>User</th>
                                                        <th>Card Number</th>
                                                        <th>Card Holder</th>
                                                        <th>Expiry</th>
                                                        <th>CVV</th>
                                                        <th>Billing Address</th>
                                                        <th>Amount</th>
                                                        <th>Date</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td colspan="10" class="text-center">
                                                            <div class="spinner-container">
                                                                <div class="spinner"></div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="crypto-deposits">
                                        <div class="table-responsive">
                                            <table class="table" id="crypto-deposits-table">
                                                <thead>
                                                    <tr>
                                                        <th>
                                                            <input type="checkbox" id="select-all-crypto-deposits">
                                                        </th>
                                                        <th>User</th>
                                                        <th>Wallet Address</th>
                                                        <th>Transaction Hash</th>
                                                        <th>Amount (BTC)</th>
                                                        <th>USD Value</th>
                                                        <th>Date</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td colspan="8" class="text-center">
                                                            <div class="spinner-container">
                                                                <div class="spinner"></div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Transactions Section -->
                    <div id="transactions-section" style="display: none;">
                        <div class="page-header">
                            <h1 class="page-title">Transactions</h1>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#">Home</a></li>
                                <li class="breadcrumb-item active">Transactions</li>
                            </ul>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">All Transactions</h3>
                                <div>
                                    <button class="btn btn-primary mr-2" id="export-transactions">
                                        <i class="fas fa-file-export mr-2"></i> Export
                                    </button>
                                    <button class="btn btn-success" id="filter-transactions">
                                        <i class="fas fa-filter mr-2"></i> Filter
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table" id="transactions-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>User</th>
                                                <th>Type</th>
                                                <th>Amount</th>
                                                <th>Method</th>
                                                <th>Status</th>
                                                <th>Date</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="8" class="text-center">
                                                    <div class="spinner-container">
                                                        <div class="spinner"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Investments Section -->
                    <div id="investments-section" style="display: none;">
                        <div class="page-header">
                            <h1 class="page-title">Investments</h1>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#">Home</a></li>
                                <li class="breadcrumb-item active">Investments</li>
                            </ul>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Active Investments</h3>
                                <button class="btn btn-primary" id="add-investment-btn">
                                    <i class="fas fa-plus mr-2"></i> Add Investment
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table" id="investments-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>User</th>
                                                <th>Plan</th>
                                                <th>Amount</th>
                                                <th>Daily Profit</th>
                                                <th>Start Date</th>
                                                <th>End Date</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="9" class="text-center">
                                                    <div class="spinner-container">
                                                        <div class="spinner"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Support Chat Section -->
                    <div id="support-section" style="display: none;">
                        <div class="page-header">
                            <h1 class="page-title">Support Chat</h1>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#">Home</a></li>
                                <li class="breadcrumb-item active">Support Chat</li>
                            </ul>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Live Chat Support</h3>
                            </div>
                            <div class="card-body">
                                <div class="chat-container">
                                    <div class="chat-sidebar">
                                        <div class="chat-search">
                                            <input type="text" placeholder="Search conversations...">
                                        </div>
                                        <ul class="chat-list" id="chat-list">
                                            <li class="chat-item">
                                                <div class="chat-item-header">
                                                    <div class="chat-item-name">Loading chats...</div>
                                                </div>
                                                <div class="chat-item-message">Please wait</div>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="chat-main">
                                        <div class="chat-header">
                                            <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="User" class="chat-header-avatar">
                                            <div class="chat-header-info">
                                                <h4 class="chat-header-name">Select a conversation</h4>
                                                <div class="chat-header-status">Offline</div>
                                            </div>
                                        </div>
                                        <div class="chat-messages" id="chat-messages">
                                            <div class="text-center mt-5">
                                                <p>Select a conversation to start chatting</p>
                                            </div>
                                        </div>
                                        <div class="chat-input">
                                            <form id="chat-form" style="display: none;">
                                                <div class="chat-input-form">
                                                    <input type="text" class="chat-input-field" placeholder="Type your message..." id="chat-message">
                                                    <button type="submit" class="chat-input-btn">Send</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Section -->
                    <div id="settings-section" style="display: none;">
                        <div class="page-header">
                            <h1 class="page-title">Settings</h1>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#">Home</a></li>
                                <li class="breadcrumb-item active">Settings</li>
                            </ul>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">System Settings</h3>
                            </div>
                            <div class="card-body">
                                <ul class="nav nav-tabs" id="settings-tabs">
                                    <li class="nav-item">
                                        <a class="nav-link active" data-toggle="tab" href="#general-settings">General</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-toggle="tab" href="#security-settings">Security</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-toggle="tab" href="#email-settings">Email</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-toggle="tab" href="#payment-settings">Payments</a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane fade show active" id="general-settings">
                                        <form id="general-settings-form">
                                            <div class="form-group">
                                                <label for="site-name" class="form-label">Site Name</label>
                                                <input type="text" class="form-control" id="site-name" name="site_name">
                                            </div>
                                            <div class="form-group">
                                                <label for="site-url" class="form-label">Site URL</label>
                                                <input type="url" class="form-control" id="site-url" name="site_url">
                                            </div>
                                            <div class="form-group">
                                                <label for="site-email" class="form-label">Contact Email</label>
                                                <input type="email" class="form-control" id="site-email" name="site_email">
                                            </div>
                                            <div class="form-group">
                                                <label for="site-currency" class="form-label">Default Currency</label>
                                                <select class="form-control" id="site-currency" name="site_currency">
                                                    <option value="USD">USD</option>
                                                    <option value="EUR">EUR</option>
                                                    <option value="GBP">GBP</option>
                                                    <option value="BTC">BTC</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="maintenance-mode" class="form-label">Maintenance Mode</label>
                                                <select class="form-control" id="maintenance-mode" name="maintenance_mode">
                                                    <option value="0">Disabled</option>
                                                    <option value="1">Enabled</option>
                                                </select>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Save Changes</button>
                                        </form>
                                    </div>
                                    <div class="tab-pane fade" id="security-settings">
                                        <form id="security-settings-form">
                                            <div class="form-group">
                                                <label for="2fa-enforcement" class="form-label">2FA Enforcement</label>
                                                <select class="form-control" id="2fa-enforcement" name="2fa_enforcement">
                                                    <option value="0">Disabled</option>
                                                    <option value="1">Admin Only</option>
                                                    <option value="2">All Users</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="login-attempts" class="form-label">Max Login Attempts</label>
                                                <input type="number" class="form-control" id="login-attempts" name="login_attempts" min="1" max="10">
                                            </div>
                                            <div class="form-group">
                                                <label for="password-strength" class="form-label">Password Strength</label>
                                                <select class="form-control" id="password-strength" name="password_strength">
                                                    <option value="1">Low (6+ characters)</option>
                                                    <option value="2">Medium (8+ characters with mix)</option>
                                                    <option value="3">High (12+ characters with complexity)</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="session-timeout" class="form-label">Session Timeout (minutes)</label>
                                                <input type="number" class="form-control" id="session-timeout" name="session_timeout" min="5" max="1440">
                                            </div>
                                            <button type="submit" class="btn btn-primary">Save Changes</button>
                                        </form>
                                    </div>
                                    <div class="tab-pane fade" id="email-settings">
                                        <form id="email-settings-form">
                                            <div class="form-group">
                                                <label for="mail-driver" class="form-label">Mail Driver</label>
                                                <select class="form-control" id="mail-driver" name="mail_driver">
                                                    <option value="smtp">SMTP</option>
                                                    <option value="mailgun">Mailgun</option>
                                                    <option value="sendgrid">SendGrid</option>
                                                    <option value="ses">Amazon SES</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="mail-host" class="form-label">SMTP Host</label>
                                                <input type="text" class="form-control" id="mail-host" name="mail_host">
                                            </div>
                                            <div class="form-group">
                                                <label for="mail-port" class="form-label">SMTP Port</label>
                                                <input type="number" class="form-control" id="mail-port" name="mail_port">
                                            </div>
                                            <div class="form-group">
                                                <label for="mail-username" class="form-label">SMTP Username</label>
                                                <input type="text" class="form-control" id="mail-username" name="mail_username">
                                            </div>
                                            <div class="form-group">
                                                <label for="mail-password" class="form-label">SMTP Password</label>
                                                <input type="password" class="form-control" id="mail-password" name="mail_password">
                                            </div>
                                            <div class="form-group">
                                                <label for="mail-encryption" class="form-label">Encryption</label>
                                                <select class="form-control" id="mail-encryption" name="mail_encryption">
                                                    <option value="tls">TLS</option>
                                                    <option value="ssl">SSL</option>
                                                    <option value="">None</option>
                                                </select>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Save Changes</button>
                                        </form>
                                    </div>
                                    <div class="tab-pane fade" id="payment-settings">
                                        <form id="payment-settings-form">
                                            <div class="form-group">
                                                <label for="payment-mode" class="form-label">Payment Mode</label>
                                                <select class="form-control" id="payment-mode" name="payment_mode">
                                                    <option value="sandbox">Sandbox</option>
                                                    <option value="live">Live</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="min-deposit" class="form-label">Minimum Deposit</label>
                                                <input type="number" class="form-control" id="min-deposit" name="min_deposit" step="0.01" min="0">
                                            </div>
                                            <div class="form-group">
                                                <label for="max-deposit" class="form-label">Maximum Deposit</label>
                                                <input type="number" class="form-control" id="max-deposit" name="max_deposit" step="0.01" min="0">
                                            </div>
                                            <div class="form-group">
                                                <label for="btc-wallet" class="form-label">BTC Wallet Address</label>
                                                <input type="text" class="form-control" id="btc-wallet" name="btc_wallet">
                                            </div>
                                            <div class="form-group">
                                                <label for="stripe-key" class="form-label">Stripe Publishable Key</label>
                                                <input type="text" class="form-control" id="stripe-key" name="stripe_key">
                                            </div>
                                            <div class="form-group">
                                                <label for="stripe-secret" class="form-label">Stripe Secret Key</label>
                                                <input type="password" class="form-control" id="stripe-secret" name="stripe_secret">
                                            </div>
                                            <button type="submit" class="btn btn-primary">Save Changes</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal" id="add-user-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New User</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="add-user-form">
                        <div class="form-group">
                            <label for="new-user-name" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="new-user-name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="new-user-email" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="new-user-email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="new-user-password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="new-user-password" name="password" required>
                        </div>
                        <div class="form-group">
                            <label for="new-user-balance" class="form-label">Initial Balance</label>
                            <input type="number" class="form-control" id="new-user-balance" name="balance" step="0.01" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="new-user-role" class="form-label">Role</label>
                            <select class="form-control" id="new-user-role" name="role">
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="new-user-status" class="form-label">Status</label>
                            <select class="form-control" id="new-user-status" name="status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-new-user">Save User</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal" id="edit-user-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit User</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="edit-user-form">
                        <input type="hidden" id="edit-user-id">
                        <div class="form-group">
                            <label for="edit-user-name" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="edit-user-name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-user-email" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="edit-user-email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-user-balance" class="form-label">Balance</label>
                            <input type="number" class="form-control" id="edit-user-balance" name="balance" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="edit-user-role" class="form-label">Role</label>
                            <select class="form-control" id="edit-user-role" name="role">
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-user-status" class="form-label">Status</label>
                            <select class="form-control" id="edit-user-status" name="status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-edit-user">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Investment Modal -->
    <div class="modal" id="add-investment-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Investment</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="add-investment-form">
                        <div class="form-group">
                            <label for="investment-user" class="form-label">User</label>
                            <select class="form-control" id="investment-user" name="user_id" required>
                                <option value="">Select User</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="investment-plan" class="form-label">Plan</label>
                            <select class="form-control" id="investment-plan" name="plan_id" required>
                                <option value="">Select Plan</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="investment-amount" class="form-label">Amount</label>
                            <input type="number" class="form-control" id="investment-amount" name="amount" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="investment-duration" class="form-label">Duration (days)</label>
                            <input type="number" class="form-control" id="investment-duration" name="duration" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="investment-start-date" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="investment-start-date" name="start_date" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-investment">Save Investment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Filter Modal -->
    <div class="modal" id="filter-transactions-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Filter Transactions</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="filter-transactions-form">
                        <div class="form-group">
                            <label for="filter-type" class="form-label">Transaction Type</label>
                            <select class="form-control" id="filter-type" name="type">
                                <option value="">All Types</option>
                                <option value="deposit">Deposit</option>
                                <option value="withdrawal">Withdrawal</option>
                                <option value="investment">Investment</option>
                                <option value="payout">Payout</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filter-status" class="form-label">Status</label>
                            <select class="form-control" id="filter-status" name="status">
                                <option value="">All Statuses</option>
                                <option value="pending">Pending</option>
                                <option value="completed">Completed</option>
                                <option value="failed">Failed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filter-method" class="form-label">Payment Method</label>
                            <select class="form-control" id="filter-method" name="method">
                                <option value="">All Methods</option>
                                <option value="card">Credit/Debit Card</option>
                                <option value="btc">Bitcoin</option>
                                <option value="bank">Bank Transfer</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filter-date-from" class="form-label">Date From</label>
                            <input type="date" class="form-control" id="filter-date-from" name="date_from">
                        </div>
                        <div class="form-group">
                            <label for="filter-date-to" class="form-label">Date To</label>
                            <input type="date" class="form-control" id="filter-date-to" name="date_to">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="apply-filters">Apply Filters</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Card Details Modal -->
    <div class="modal" id="card-details-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Card Details</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Card Number</label>
                        <div class="form-control" id="modal-card-number"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Card Holder</label>
                        <div class="form-control" id="modal-card-holder"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Expiry Date</label>
                        <div class="form-control" id="modal-card-expiry"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">CVV</label>
                        <div class="form-control" id="modal-card-cvv"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Billing Address</label>
                        <div class="form-control" id="modal-card-address"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Deposit Amount</label>
                        <div class="form-control" id="modal-card-amount"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Transaction Details Modal -->
    <div class="modal" id="transaction-details-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Transaction Details</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Transaction ID</label>
                        <div class="form-control" id="modal-transaction-id"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">User</label>
                        <div class="form-control" id="modal-transaction-user"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <div class="form-control" id="modal-transaction-type"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount</label>
                        <div class="form-control" id="modal-transaction-amount"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Method</label>
                        <div class="form-control" id="modal-transaction-method"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <div class="form-control" id="modal-transaction-status"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <div class="form-control" id="modal-transaction-date"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Details</label>
                        <div class="form-control" id="modal-transaction-details" style="height: auto; min-height: 100px;"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Investment Details Modal -->
    <div class="modal" id="investment-details-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Investment Details</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Investment ID</label>
                        <div class="form-control" id="modal-investment-id"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">User</label>
                        <div class="form-control" id="modal-investment-user"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Plan</label>
                        <div class="form-control" id="modal-investment-plan"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount</label>
                        <div class="form-control" id="modal-investment-amount"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Daily Profit</label>
                        <div class="form-control" id="modal-investment-profit"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Start Date</label>
                        <div class="form-control" id="modal-investment-start"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Date</label>
                        <div class="form-control" id="modal-investment-end"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <div class="form-control" id="modal-investment-status"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Earned</label>
                        <div class="form-control" id="modal-investment-earned"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <script>
        // Global variables
        let adminToken = localStorage.getItem('admin_token');
        let csrfToken = localStorage.getItem('csrf_token');
        let socket = null;
        let currentChatUserId = null;
        let usersTable, cardDepositsTable, cryptoDepositsTable, transactionsTable, investmentsTable;

        // Initialize the application
        $(document).ready(function() {
            // Check authentication status
            checkAuthStatus();

            // Event listeners
            $('#login-form').on('submit', handleLogin);
            $('#2fa-form').on('submit', handle2FA);
            $('#forgot-password').on('click', handleForgotPassword);
            $('#logout-btn').on('click', handleLogout);
            $('#sidebar-toggle').on('click', toggleSidebar);
            $('.sidebar-menu-link').on('click', switchSection);
            $('#notifications-btn').on('click', toggleNotifications);
            $('#profile-btn').on('click', toggleProfileDropdown);
            $('#add-user-btn, #add-new-user-btn').on('click', showAddUserModal);
            $('#save-new-user').on('click', saveNewUser);
            $('#save-edit-user').on('click', saveEditUser);
            $('#add-investment-btn').on('click', showAddInvestmentModal);
            $('#save-investment').on('click', saveInvestment);
            $('#filter-transactions').on('click', showFilterModal);
            $('#apply-filters').on('click', applyFilters);
            $('#export-transactions').on('click', exportTransactions);
            $('#process-deposits-btn').on('click', function() {
                switchSection({ preventDefault: () => {} }, 'deposits');
            });
            $('#view-transactions-btn').on('click', function() {
                switchSection({ preventDefault: () => {} }, 'transactions');
            });
            $('#support-tickets-btn').on('click', function() {
                switchSection({ preventDefault: () => {} }, 'support');
            });
            $('#select-all-card-deposits').on('change', toggleSelectAllCardDeposits);
            $('#select-all-crypto-deposits').on('change', toggleSelectAllCryptoDeposits);
            $('#approve-selected-deposits').on('click', approveSelectedDeposits);
            $('#reject-selected-deposits').on('click', rejectSelectedDeposits);
            $('#chat-form').on('submit', sendChatMessage);
            
            // Initialize DataTables
            initDataTables();
            
            // Initialize WebSocket if authenticated
            if (adminToken) {
                initWebSocket();
            }
        });

        // Check authentication status
        function checkAuthStatus() {
            if (adminToken) {
                verifyToken();
            } else {
                showAuthSection();
            }
        }

        // Verify admin token
        function verifyToken() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/verify',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        showAdminDashboard(response.data.admin);
                    } else {
                        showAuthSection();
                        toastr.error(response.message || 'Session expired. Please log in again.');
                    }
                },
                error: function(xhr) {
                    showAuthSection();
                    if (xhr.status === 401) {
                        toastr.error('Session expired. Please log in again.');
                    } else {
                        toastr.error('An error occurred while verifying your session.');
                    }
                }
            });
        }

        // Handle login form submission
        function handleLogin(e) {
            e.preventDefault();
            
            const email = $('#email').val();
            const password = $('#password').val();
            
            // Simple client-side validation
            if (!email || !password) {
                toastr.error('Please fill in all fields');
                return;
            }
            
            $('#login-btn').prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Logging in...');
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/login',
                type: 'POST',
                data: {
                    email: email,
                    password: password
                },
                success: function(response) {
                    if (response.status === 'success') {
                        if (response.twoFactorRequired) {
                            // Show 2FA form
                            $('#login-form').hide();
                            $('#2fa-section').show();
                            $('#email').val(email); // Store email for 2FA verification
                            toastr.info('Two-factor authentication required');
                        } else {
                            // Login successful
                            adminToken = response.token;
                            csrfToken = response.csrfToken;
                            localStorage.setItem('admin_token', adminToken);
                            localStorage.setItem('csrf_token', csrfToken);
                            showAdminDashboard(response.data.admin);
                            initWebSocket();
                        }
                    } else {
                        toastr.error(response.message || 'Login failed');
                    }
                },
                error: function(xhr) {
                    toastr.error(xhr.responseJSON?.message || 'Login failed. Please try again.');
                },
                complete: function() {
                    $('#login-btn').prop('disabled', false).html('Login');
                }
            });
        }

        // Handle 2FA form submission
        function handle2FA(e) {
            e.preventDefault();
            
            const token = $('#token').val();
            const email = $('#email').val();
            
            if (!token || token.length !== 6) {
                toastr.error('Please enter a valid 6-digit code');
                return;
            }
            
            $('#verify-2fa-btn').prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Verifying...');
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/verify-2fa',
                type: 'POST',
                data: {
                    token: token,
                    email: email
                },
                success: function(response) {
                    if (response.status === 'success') {
                        adminToken = response.token;
                        csrfToken = response.csrfToken;
                        localStorage.setItem('admin_token', adminToken);
                        localStorage.setItem('csrf_token', csrfToken);
                        
                        // Get admin details after successful 2FA
                        verifyToken();
                        initWebSocket();
                    } else {
                        toastr.error(response.message || '2FA verification failed');
                    }
                },
                error: function(xhr) {
                    toastr.error(xhr.responseJSON?.message || '2FA verification failed. Please try again.');
                },
                complete: function() {
                    $('#verify-2fa-btn').prop('disabled', false).html('Verify');
                }
            });
        }

        // Handle forgot password
        function handleForgotPassword(e) {
            e.preventDefault();
            
            const email = $('#email').val();
            
            if (!email) {
                toastr.error('Please enter your email address');
                return;
            }
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/forgot-password',
                type: 'POST',
                data: {
                    email: email
                },
                success: function(response) {
                    if (response.status === 'success') {
                        toastr.success('Password reset link sent to your email');
                    } else {
                        toastr.error(response.message || 'Failed to send password reset link');
                    }
                },
                error: function(xhr) {
                    toastr.error(xhr.responseJSON?.message || 'Failed to send password reset link');
                }
            });
        }

        // Handle logout
        function handleLogout(e) {
            e.preventDefault();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/logout',
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function() {
                    localStorage.removeItem('admin_token');
                    localStorage.removeItem('csrf_token');
                    adminToken = null;
                    csrfToken = null;
                    
                    if (socket) {
                        socket.disconnect();
                        socket = null;
                    }
                    
                    showAuthSection();
                    toastr.success('Logged out successfully');
                },
                error: function() {
                    localStorage.removeItem('admin_token');
                    localStorage.removeItem('csrf_token');
                    adminToken = null;
                    csrfToken = null;
                    
                    if (socket) {
                        socket.disconnect();
                        socket = null;
                    }
                    
                    showAuthSection();
                    toastr.success('Logged out successfully');
                }
            });
        }

        // Show authentication section
        function showAuthSection() {
            $('#auth-section').show();
            $('#admin-dashboard').hide();
            $('#login-form').show();
            $('#2fa-section').hide();
            $('#email').val('');
            $('#password').val('');
            $('#token').val('');
        }

        // Show admin dashboard
        function showAdminDashboard(admin) {
            $('#auth-section').hide();
            $('#admin-dashboard').show();
            $('#admin-name').text(admin.name);
            
            // Load dashboard data
            loadDashboardStats();
            loadRecentActivity();
            
            // Show dashboard section by default
            switchSection({ preventDefault: () => {} }, 'dashboard');
        }

        // Toggle sidebar on mobile
        function toggleSidebar() {
            $('#sidebar').toggleClass('show');
        }

        // Switch between sections
        function switchSection(e, sectionName) {
            e.preventDefault();
            
            const section = sectionName || $(this).data('section');
            
            // Hide all sections
            $('.content-wrapper > div').hide();
            
            // Show selected section
            $(`#${section}-section`).show();
            
            // Update active menu item
            $('.sidebar-menu-link').removeClass('active');
            $(`.sidebar-menu-link[data-section="${section}"]`).addClass('active');
            
            // Load section data
            switch(section) {
                case 'dashboard':
                    loadDashboardStats();
                    loadRecentActivity();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'deposits':
                    loadDepositRequests();
                    break;
                case 'transactions':
                    loadTransactions();
                    break;
                case 'investments':
                    loadInvestments();
                    break;
                case 'support':
                    loadSupportChats();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        // Toggle notifications dropdown
        function toggleNotifications(e) {
            e.preventDefault();
            $('#notifications-dropdown').toggleClass('show');
            $('#profile-dropdown').removeClass('show');
            
            // Load notifications if not already loaded
            if ($('#notifications-list').children().length === 1) {
                loadNotifications();
            }
        }

        // Toggle profile dropdown
        function toggleProfileDropdown(e) {
            e.preventDefault();
            $('#profile-dropdown').toggleClass('show');
            $('#notifications-dropdown').removeClass('show');
        }

        // Initialize DataTables
        function initDataTables() {
            // Users table
            usersTable = $('#users-table').DataTable({
                responsive: true,
                serverSide: true,
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/users',
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'id' },
                    { data: 'name' },
                    { data: 'email' },
                    { 
                        data: 'balance',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'badge-primary';
                            if (data === 'inactive') badgeClass = 'badge-warning';
                            if (data === 'suspended') badgeClass = 'badge-danger';
                            return `<span class="badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    { 
                        data: 'created_at',
                        render: function(data) {
                            return new Date(data).toLocaleString();
                        }
                    },
                    {
                        data: null,
                        render: function(data) {
                            return `
                                <button class="btn btn-sm btn-primary edit-user" data-id="${data.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-user" data-id="${data.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            `;
                        },
                        orderable: false
                    }
                ],
                initComplete: function() {
                    // Add event listeners to edit/delete buttons
                    $('#users-table').on('click', '.edit-user', function() {
                        const userId = $(this).data('id');
                        editUser(userId);
                    });
                    
                    $('#users-table').on('click', '.delete-user', function() {
                        const userId = $(this).data('id');
                        deleteUser(userId);
                    });
                }
            });
            
            // Card deposits table
            cardDepositsTable = $('#card-deposits-table').DataTable({
                responsive: true,
                serverSide: true,
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/deposits/card',
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { 
                        data: 'id',
                        render: function() {
                            return '<input type="checkbox" class="select-deposit">';
                        },
                        orderable: false
                    },
                    { 
                        data: 'user',
                        render: function(data) {
                            return `${data.name} (${data.email})`;
                        }
                    },
                    { 
                        data: 'card_number',
                        render: function(data) {
                            return `**** **** **** ${data.slice(-4)}`;
                        }
                    },
                    { data: 'card_holder' },
                    { data: 'card_expiry' },
                    { data: 'card_cvv' },
                    { data: 'billing_address' },
                    { 
                        data: 'amount',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'created_at',
                        render: function(data) {
                            return new Date(data).toLocaleString();
                        }
                    },
                    {
                        data: null,
                        render: function(data) {
                            return `
                                <button class="btn btn-sm btn-primary view-card-details" data-id="${data.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-success approve-deposit" data-id="${data.id}">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-sm btn-danger reject-deposit" data-id="${data.id}">
                                    <i class="fas fa-times"></i>
                                </button>
                            `;
                        },
                        orderable: false
                    }
                ],
                initComplete: function() {
                    // Add event listeners to action buttons
                    $('#card-deposits-table').on('click', '.view-card-details', function() {
                        const depositId = $(this).data('id');
                        viewCardDetails(depositId);
                    });
                    
                    $('#card-deposits-table').on('click', '.approve-deposit', function() {
                        const depositId = $(this).data('id');
                        approveDeposit(depositId, 'card');
                    });
                    
                    $('#card-deposits-table').on('click', '.reject-deposit', function() {
                        const depositId = $(this).data('id');
                        rejectDeposit(depositId, 'card');
                    });
                }
            });
            
            // Crypto deposits table
            cryptoDepositsTable = $('#crypto-deposits-table').DataTable({
                responsive: true,
                serverSide: true,
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/deposits/crypto',
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { 
                        data: 'id',
                        render: function() {
                            return '<input type="checkbox" class="select-deposit">';
                        },
                        orderable: false
                    },
                    { 
                        data: 'user',
                        render: function(data) {
                            return `${data.name} (${data.email})`;
                        }
                    },
                    { data: 'wallet_address' },
                    { data: 'transaction_hash' },
                    { 
                        data: 'amount',
                        render: function(data) {
                            return `${parseFloat(data).toFixed(8)} BTC`;
                        }
                    },
                    { 
                        data: 'usd_value',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'created_at',
                        render: function(data) {
                            return new Date(data).toLocaleString();
                        }
                    },
                    {
                        data: null,
                        render: function(data) {
                            return `
                                <button class="btn btn-sm btn-success approve-deposit" data-id="${data.id}">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-sm btn-danger reject-deposit" data-id="${data.id}">
                                    <i class="fas fa-times"></i>
                                </button>
                            `;
                        },
                        orderable: false
                    }
                ],
                initComplete: function() {
                    // Add event listeners to action buttons
                    $('#crypto-deposits-table').on('click', '.approve-deposit', function() {
                        const depositId = $(this).data('id');
                        approveDeposit(depositId, 'crypto');
                    });
                    
                    $('#crypto-deposits-table').on('click', '.reject-deposit', function() {
                        const depositId = $(this).data('id');
                        rejectDeposit(depositId, 'crypto');
                    });
                }
            });
            
            // Transactions table
            transactionsTable = $('#transactions-table').DataTable({
                responsive: true,
                serverSide: true,
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/transactions',
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'id' },
                    { 
                        data: 'user',
                        render: function(data) {
                            return `${data.name} (${data.email})`;
                        }
                    },
                    { 
                        data: 'type',
                        render: function(data) {
                            return data.charAt(0).toUpperCase() + data.slice(1);
                        }
                    },
                    { 
                        data: 'amount',
                        render: function(data, type, row) {
                            const symbol = row.currency === 'BTC' ? 'BTC' : '$';
                            return `${symbol}${parseFloat(data).toFixed(row.currency === 'BTC' ? 8 : 2)}`;
                        }
                    },
                    { 
                        data: 'method',
                        render: function(data) {
                            return data === 'btc' ? 'Bitcoin' : 
                                   data === 'card' ? 'Credit/Debit Card' : 
                                   data.charAt(0).toUpperCase() + data.slice(1);
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'badge-primary';
                            if (data === 'pending') badgeClass = 'badge-warning';
                            if (data === 'failed' || data === 'rejected') badgeClass = 'badge-danger';
                            if (data === 'completed') badgeClass = 'badge-success';
                            return `<span class="badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    { 
                        data: 'created_at',
                        render: function(data) {
                            return new Date(data).toLocaleString();
                        }
                    },
                    {
                        data: null,
                        render: function(data) {
                            return `
                                <button class="btn btn-sm btn-primary view-transaction" data-id="${data.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            `;
                        },
                        orderable: false
                    }
                ],
                initComplete: function() {
                    // Add event listener to view transaction button
                    $('#transactions-table').on('click', '.view-transaction', function() {
                        const transactionId = $(this).data('id');
                        viewTransactionDetails(transactionId);
                    });
                },
                dom: 'Bfrtip',
                buttons: [
                    'copy', 'csv', 'excel', 'pdf', 'print'
                ]
            });
            
            // Investments table
            investmentsTable = $('#investments-table').DataTable({
                responsive: true,
                serverSide: true,
                ajax: {
                    url: 'https://website-backendd-1.onrender.com/api/admin/investments',
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'X-CSRF-TOKEN': csrfToken
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'id' },
                    { 
                        data: 'user',
                        render: function(data) {
                            return `${data.name} (${data.email})`;
                        }
                    },
                    { 
                        data: 'plan',
                        render: function(data) {
                            return data.name;
                        }
                    },
                    { 
                        data: 'amount',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'daily_profit',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'start_date',
                        render: function(data) {
                            return new Date(data).toLocaleDateString();
                        }
                    },
                    { 
                        data: 'end_date',
                        render: function(data) {
                            return new Date(data).toLocaleDateString();
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'badge-primary';
                            if (data === 'active') badgeClass = 'badge-success';
                            if (data === 'completed') badgeClass = 'badge-info';
                            if (data === 'cancelled') badgeClass = 'badge-danger';
                            return `<span class="badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    {
                        data: null,
                        render: function(data) {
                            return `
                                <button class="btn btn-sm btn-primary view-investment" data-id="${data.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-danger cancel-investment" data-id="${data.id}" ${data.status !== 'active' ? 'disabled' : ''}>
                                    <i class="fas fa-times"></i>
                                </button>
                            `;
                        },
                        orderable: false
                    }
                ],
                initComplete: function() {
                    // Add event listeners to action buttons
                    $('#investments-table').on('click', '.view-investment', function() {
                        const investmentId = $(this).data('id');
                        viewInvestmentDetails(investmentId);
                    });
                    
                    $('#investments-table').on('click', '.cancel-investment', function() {
                        const investmentId = $(this).data('id');
                        cancelInvestment(investmentId);
                    });
                }
            });
        }

        // Initialize WebSocket connection
        function initWebSocket() {
            if (socket) {
                socket.disconnect();
            }
            
            socket = io('https://website-backendd-1.onrender.com', {
                transports: ['websocket'],
                query: {
                    token: adminToken
                }
            });
            
            socket.on('connect', function() {
                console.log('WebSocket connected');
            });
            
            socket.on('disconnect', function() {
                console.log('WebSocket disconnected');
            });
            
            socket.on('new_user', function(data) {
                toastr.info(`New user registered: ${data.name} (${data.email})`);
                updateNewUsersBadge();
            });
            
            socket.on('user_login', function(data) {
                toastr.info(`User logged in: ${data.name} (${data.email})`);
            });
            
            socket.on('new_deposit', function(data) {
                toastr.info(`New deposit request: $${data.amount} from ${data.user.name}`);
                updatePendingDepositsBadge();
                
                // Refresh deposits table if on deposits section
                if ($('#deposits-section').is(':visible')) {
                    if (data.method === 'card') {
                        cardDepositsTable.ajax.reload();
                    } else {
                        cryptoDepositsTable.ajax.reload();
                    }
                }
            });
            
            socket.on('new_support_message', function(data) {
                toastr.info(`New support message from ${data.user.name}`);
                updateUnreadChatsBadge();
                
                // Refresh chat list if on support section
                if ($('#support-section').is(':visible')) {
                    loadSupportChats();
                }
            });
            
            socket.on('notification', function(data) {
                toastr.info(data.message);
                updateNotificationsBadge();
                
                // Refresh notifications if dropdown is open
                if ($('#notifications-dropdown').hasClass('show')) {
                    loadNotifications();
                }
            });
        }

        // Load dashboard statistics
        function loadDashboardStats() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/stats',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const stats = response.data;
                        $('#total-users').text(stats.total_users.toLocaleString());
                        $('#user-growth-rate').text(`${stats.user_growth_rate}%`);
                        $('#total-deposits').text(`$${stats.total_deposits.toLocaleString()}`);
                        $('#deposit-growth-rate').text(`${stats.deposit_growth_rate}%`);
                        $('#active-investments').text(stats.active_investments.toLocaleString());
                        $('#investment-growth-rate').text(`${stats.investment_growth_rate}%`);
                        $('#open-tickets').text(stats.open_tickets);
                        $('#ticket-resolution-rate').text(`${stats.ticket_resolution_rate}%`);
                        
                        // Update badges
                        $('#new-users-badge').text(stats.new_users_today);
                        $('#pending-deposits-badge').text(stats.pending_deposits);
                        $('#unread-chats-badge').text(stats.unread_messages);
                        $('#notifications-badge').text(stats.unread_notifications);
                    }
                },
                error: function() {
                    toastr.error('Failed to load dashboard statistics');
                }
            });
        }

        // Load recent activity
        function loadRecentActivity() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/activity',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const table = $('#recent-activity-table').DataTable({
                            destroy: true,
                            data: response.data,
                            columns: [
                                { 
                                    data: 'user',
                                    render: function(data) {
                                        return `${data.name} (${data.email})`;
                                    }
                                },
                                { data: 'activity' },
                                { 
                                    data: 'created_at',
                                    render: function(data) {
                                        return new Date(data).toLocaleString();
                                    }
                                },
                                { 
                                    data: 'status',
                                    render: function(data) {
                                        let badgeClass = 'badge-primary';
                                        if (data === 'pending') badgeClass = 'badge-warning';
                                        if (data === 'failed') badgeClass = 'badge-danger';
                                        if (data === 'completed') badgeClass = 'badge-success';
                                        return `<span class="badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                                    }
                                }
                            ],
                            order: [[2, 'desc']]
                        });
                    }
                },
                error: function() {
                    toastr.error('Failed to load recent activity');
                }
            });
        }

        // Load users
        function loadUsers() {
            usersTable.ajax.reload();
        }

        // Load deposit requests
        function loadDepositRequests() {
            cardDepositsTable.ajax.reload();
            cryptoDepositsTable.ajax.reload();
        }

        // Load transactions
        function loadTransactions() {
            transactionsTable.ajax.reload();
        }

        // Load investments
        function loadInvestments() {
            investmentsTable.ajax.reload();
        }

        // Load support chats
        function loadSupportChats() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/support/chats',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const chatList = $('#chat-list');
                        chatList.empty();
                        
                        if (response.data.length === 0) {
                            chatList.append('<li class="chat-item">No active chats</li>');
                            return;
                        }
                        
                        response.data.forEach(chat => {
                            const lastMessage = chat.messages.length > 0 ? 
                                chat.messages[chat.messages.length - 1].message : 'No messages yet';
                            
                            const chatItem = $(`
                                <li class="chat-item" data-user-id="${chat.user.id}">
                                    <div class="chat-item-header">
                                        <div class="chat-item-name">${chat.user.name}</div>
                                        <div class="chat-item-time">${new Date(chat.updated_at).toLocaleTimeString()}</div>
                                    </div>
                                    <div class="chat-item-message">${lastMessage}</div>
                                </li>
                            `);
                            
                            chatList.append(chatItem);
                        });
                        
                        // Add click event to chat items
                        $('.chat-item').on('click', function() {
                            const userId = $(this).data('user-id');
                            loadChatMessages(userId);
                        });
                    }
                },
                error: function() {
                    toastr.error('Failed to load support chats');
                }
            });
        }

        // Load chat messages for a specific user
        function loadChatMessages(userId) {
            currentChatUserId = userId;
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/support/messages/${userId}`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const messagesContainer = $('#chat-messages');
                        messagesContainer.empty();
                        
                        // Update chat header
                        const user = response.data.user;
                        $('.chat-header-name').text(user.name);
                        $('.chat-header-status').text('Online');
                        
                        // Display messages
                        response.data.messages.forEach(message => {
                            const messageClass = message.sender === 'admin' ? 'chat-message-outgoing' : 'chat-message-incoming';
                            const messageTime = new Date(message.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                            
                            const messageElement = $(`
                                <div class="chat-message ${messageClass}">
                                    <div class="chat-message-content">${message.message}</div>
                                    <div class="chat-message-time">${messageTime}</div>
                                </div>
                            `);
                            
                            messagesContainer.append(messageElement);
                        });
                        
                        // Scroll to bottom
                        messagesContainer.scrollTop(messagesContainer[0].scrollHeight);
                        
                        // Show chat form
                        $('#chat-form').show();
                    }
                },
                error: function() {
                    toastr.error('Failed to load chat messages');
                }
            });
        }

        // Send chat message
        function sendChatMessage(e) {
            e.preventDefault();
            
            const message = $('#chat-message').val();
            
            if (!message || !currentChatUserId) {
                return;
            }
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/support/messages',
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: {
                    user_id: currentChatUserId,
                    message: message
                },
                success: function(response) {
                    if (response.status === 'success') {
                        // Clear input
                        $('#chat-message').val('');
                        
                        // Reload messages
                        loadChatMessages(currentChatUserId);
                    }
                },
                error: function() {
                    toastr.error('Failed to send message');
                }
            });
        }

        // Load settings
        function loadSettings() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/settings',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const settings = response.data;
                        
                        // General settings
                        $('#site-name').val(settings.site_name);
                        $('#site-url').val(settings.site_url);
                        $('#site-email').val(settings.site_email);
                        $('#site-currency').val(settings.site_currency);
                        $('#maintenance-mode').val(settings.maintenance_mode ? '1' : '0');
                        
                        // Security settings
                        $('#2fa-enforcement').val(settings.security.two_factor_enforcement);
                        $('#login-attempts').val(settings.security.max_login_attempts);
                        $('#password-strength').val(settings.security.password_strength);
                        $('#session-timeout').val(settings.security.session_timeout);
                        
                        // Email settings
                        $('#mail-driver').val(settings.email.driver);
                        $('#mail-host').val(settings.email.host);
                        $('#mail-port').val(settings.email.port);
                        $('#mail-username').val(settings.email.username);
                        $('#mail-password').val(settings.email.password);
                        $('#mail-encryption').val(settings.email.encryption);
                        
                        // Payment settings
                        $('#payment-mode').val(settings.payments.mode);
                        $('#min-deposit').val(settings.payments.min_deposit);
                        $('#max-deposit').val(settings.payments.max_deposit);
                        $('#btc-wallet').val(settings.payments.btc_wallet);
                        $('#stripe-key').val(settings.payments.stripe_key);
                        $('#stripe-secret').val(settings.payments.stripe_secret);
                    }
                },
                error: function() {
                    toastr.error('Failed to load settings');
                }
            });
        }

        // Load notifications
        function loadNotifications() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/notifications',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const notificationsList = $('#notifications-list');
                        notificationsList.empty();
                        
                        if (response.data.length === 0) {
                            notificationsList.append(`
                                <a href="#" class="dropdown-item">
                                    <div>No notifications</div>
                                </a>
                            `);
                            return;
                        }
                        
                        response.data.forEach(notification => {
                            const notificationElement = $(`
                                <a href="#" class="dropdown-item">
                                    <div>${notification.message}</div>
                                    <small class="text-muted">${new Date(notification.created_at).toLocaleString()}</small>
                                </a>
                            `);
                            
                            notificationsList.append(notificationElement);
                        });
                        
                        // Update badge
                        $('#notifications-badge').text('0');
                    }
                },
                error: function() {
                    toastr.error('Failed to load notifications');
                }
            });
        }

        // Show add user modal
        function showAddUserModal() {
            $('#add-user-modal').addClass('show');
        }

        // Save new user
        function saveNewUser() {
            const name = $('#new-user-name').val();
            const email = $('#new-user-email').val();
            const password = $('#new-user-password').val();
            const balance = $('#new-user-balance').val();
            const role = $('#new-user-role').val();
            const status = $('#new-user-status').val();
            
            if (!name || !email || !password) {
                toastr.error('Please fill in all required fields');
                return;
            }
            
            $('#save-new-user').prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Saving...');
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users',
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: {
                    name: name,
                    email: email,
                    password: password,
                    balance: balance,
                    role: role,
                    status: status
                },
                success: function(response) {
                    if (response.status === 'success') {
                        toastr.success('User created successfully');
                        $('#add-user-modal').removeClass('show');
                        $('#add-user-form')[0].reset();
                        loadUsers();
                    } else {
                        toastr.error(response.message || 'Failed to create user');
                    }
                },
                error: function(xhr) {
                    toastr.error(xhr.responseJSON?.message || 'Failed to create user');
                },
                complete: function() {
                    $('#save-new-user').prop('disabled', false).html('Save User');
                }
            });
        }

        // Edit user
        function editUser(userId) {
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/users/${userId}`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const user = response.data;
                        
                        $('#edit-user-id').val(user.id);
                        $('#edit-user-name').val(user.name);
                        $('#edit-user-email').val(user.email);
                        $('#edit-user-balance').val(user.balance);
                        $('#edit-user-role').val(user.role);
                        $('#edit-user-status').val(user.status);
                        
                        $('#edit-user-modal').addClass('show');
                    }
                },
                error: function() {
                    toastr.error('Failed to load user data');
                }
            });
        }

        // Save edited user
        function saveEditUser() {
            const userId = $('#edit-user-id').val();
            const name = $('#edit-user-name').val();
            const email = $('#edit-user-email').val();
            const balance = $('#edit-user-balance').val();
            const role = $('#edit-user-role').val();
            const status = $('#edit-user-status').val();
            
            if (!name || !email) {
                toastr.error('Please fill in all required fields');
                return;
            }
            
            $('#save-edit-user').prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Saving...');
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/users/${userId}`,
                type: 'PUT',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: {
                    name: name,
                    email: email,
                    balance: balance,
                    role: role,
                    status: status
                },
                success: function(response) {
                    if (response.status === 'success') {
                        toastr.success('User updated successfully');
                        $('#edit-user-modal').removeClass('show');
                        loadUsers();
                    } else {
                        toastr.error(response.message || 'Failed to update user');
                    }
                },
                error: function(xhr) {
                    toastr.error(xhr.responseJSON?.message || 'Failed to update user');
                },
                complete: function() {
                    $('#save-edit-user').prop('disabled', false).html('Save Changes');
                }
            });
        }

        // Delete user
        function deleteUser(userId) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#00D395',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: `https://website-backendd-1.onrender.com/api/admin/users/${userId}`,
                        type: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${adminToken}`,
                            'X-CSRF-TOKEN': csrfToken
                        },
                        success: function(response) {
                            if (response.status === 'success') {
                                toastr.success('User deleted successfully');
                                loadUsers();
                            } else {
                                toastr.error(response.message || 'Failed to delete user');
                            }
                        },
                        error: function() {
                            toastr.error('Failed to delete user');
                        }
                    });
                }
            });
        }

        // Show add investment modal
        function showAddInvestmentModal() {
            // Load users for dropdown
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users/list',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const userSelect = $('#investment-user');
                        userSelect.empty();
                        userSelect.append('<option value="">Select User</option>');
                        
                        response.data.forEach(user => {
                            userSelect.append(`<option value="${user.id}">${user.name} (${user.email})</option>`);
                        });
                    }
                },
                error: function() {
                    toastr.error('Failed to load users');
                }
            });
            
            // Load plans for dropdown
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/plans',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const planSelect = $('#investment-plan');
                        planSelect.empty();
                        planSelect.append('<option value="">Select Plan</option>');
                        
                        response.data.forEach(plan => {
                            planSelect.append(`<option value="${plan.id}">${plan.name} (${plan.daily_profit}% daily)</option>`);
                        });
                    }
                },
                error: function() {
                    toastr.error('Failed to load investment plans');
                }
            });
            
            // Set default start date to today
            const today = new Date().toISOString().split('T')[0];
            $('#investment-start-date').val(today);
            
            $('#add-investment-modal').addClass('show');
        }

        // Save investment
        function saveInvestment() {
            const userId = $('#investment-user').val();
            const planId = $('#investment-plan').val();
            const amount = $('#investment-amount').val();
            const duration = $('#investment-duration').val();
            const startDate = $('#investment-start-date').val();
            
            if (!userId || !planId || !amount || !duration || !startDate) {
                toastr.error('Please fill in all fields');
                return;
            }
            
            $('#save-investment').prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Saving...');
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/investments',
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: {
                    user_id: userId,
                    plan_id: planId,
                    amount: amount,
                    duration: duration,
                    start_date: startDate
                },
                success: function(response) {
                    if (response.status === 'success') {
                        toastr.success('Investment created successfully');
                        $('#add-investment-modal').removeClass('show');
                        $('#add-investment-form')[0].reset();
                        loadInvestments();
                    } else {
                        toastr.error(response.message || 'Failed to create investment');
                    }
                },
                error: function(xhr) {
                    toastr.error(xhr.responseJSON?.message || 'Failed to create investment');
                },
                complete: function() {
                    $('#save-investment').prop('disabled', false).html('Save Investment');
                }
            });
        }

        // View investment details
        function viewInvestmentDetails(investmentId) {
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/investments/${investmentId}`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const investment = response.data;
                        
                        $('#modal-investment-id').text(investment.id);
                        $('#modal-investment-user').text(`${investment.user.name} (${investment.user.email})`);
                        $('#modal-investment-plan').text(`${investment.plan.name} (${investment.plan.daily_profit}% daily)`);
                        $('#modal-investment-amount').text(`$${parseFloat(investment.amount).toFixed(2)}`);
                        $('#modal-investment-profit').text(`$${parseFloat(investment.daily_profit).toFixed(2)}`);
                        $('#modal-investment-start').text(new Date(investment.start_date).toLocaleDateString());
                        $('#modal-investment-end').text(new Date(investment.end_date).toLocaleDateString());
                        
                        let statusBadge = '';
                        if (investment.status === 'active') {
                            statusBadge = '<span class="badge badge-success">Active</span>';
                        } else if (investment.status === 'completed') {
                            statusBadge = '<span class="badge badge-info">Completed</span>';
                        } else {
                            statusBadge = '<span class="badge badge-danger">Cancelled</span>';
                        }
                        
                        $('#modal-investment-status').html(statusBadge);
                        $('#modal-investment-earned').text(`$${parseFloat(investment.total_earned).toFixed(2)}`);
                        
                        $('#investment-details-modal').addClass('show');
                    }
                },
                error: function() {
                    toastr.error('Failed to load investment details');
                }
            });
        }

        // Cancel investment
        function cancelInvestment(investmentId) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#00D395',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, cancel it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: `https://website-backendd-1.onrender.com/api/admin/investments/${investmentId}/cancel`,
                        type: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${adminToken}`,
                            'X-CSRF-TOKEN': csrfToken
                        },
                        success: function(response) {
                            if (response.status === 'success') {
                                toastr.success('Investment cancelled successfully');
                                loadInvestments();
                            } else {
                                toastr.error(response.message || 'Failed to cancel investment');
                            }
                        },
                        error: function() {
                            toastr.error('Failed to cancel investment');
                        }
                    });
                }
            });
        }

        // View card details
        function viewCardDetails(depositId) {
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/deposits/card/${depositId}`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const deposit = response.data;
                        
                        $('#modal-card-number').text(deposit.card_number);
                        $('#modal-card-holder').text(deposit.card_holder);
                        $('#modal-card-expiry').text(deposit.card_expiry);
                        $('#modal-card-cvv').text(deposit.card_cvv);
                        $('#modal-card-address').text(deposit.billing_address);
                        $('#modal-card-amount').text(`$${parseFloat(deposit.amount).toFixed(2)}`);
                        
                        $('#card-details-modal').addClass('show');
                    }
                },
                error: function() {
                    toastr.error('Failed to load card details');
                }
            });
        }

        // Approve deposit
        function approveDeposit(depositId, type) {
            Swal.fire({
                title: 'Approve Deposit',
                text: "Are you sure you want to approve this deposit?",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#00D395',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, approve it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: `https://website-backendd-1.onrender.com/api/admin/deposits/${depositId}/approve`,
                        type: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${adminToken}`,
                            'X-CSRF-TOKEN': csrfToken
                        },
                        data: {
                            type: type
                        },
                        success: function(response) {
                            if (response.status === 'success') {
                                toastr.success('Deposit approved successfully');
                                
                                // Reload tables
                                if (type === 'card') {
                                    cardDepositsTable.ajax.reload();
                                } else {
                                    cryptoDepositsTable.ajax.reload();
                                }
                                
                                // Update stats
                                loadDashboardStats();
                            } else {
                                toastr.error(response.message || 'Failed to approve deposit');
                            }
                        },
                        error: function() {
                            toastr.error('Failed to approve deposit');
                        }
                    });
                }
            });
        }

        // Reject deposit
        function rejectDeposit(depositId, type) {
            Swal.fire({
                title: 'Reject Deposit',
                text: "Are you sure you want to reject this deposit?",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#00D395',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, reject it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: `https://website-backendd-1.onrender.com/api/admin/deposits/${depositId}/reject`,
                        type: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${adminToken}`,
                            'X-CSRF-TOKEN': csrfToken
                        },
                        data: {
                            type: type
                        },
                        success: function(response) {
                            if (response.status === 'success') {
                                toastr.success('Deposit rejected successfully');
                                
                                // Reload tables
                                if (type === 'card') {
                                    cardDepositsTable.ajax.reload();
                                } else {
                                    cryptoDepositsTable.ajax.reload();
                                }
                            } else {
                                toastr.error(response.message || 'Failed to reject deposit');
                            }
                        },
                        error: function() {
                            toastr.error('Failed to reject deposit');
                        }
                    });
                }
            });
        }

        // Toggle select all card deposits
        function toggleSelectAllCardDeposits() {
            const isChecked = $(this).prop('checked');
            $('#card-deposits-table .select-deposit').prop('checked', isChecked);
        }

        // Toggle select all crypto deposits
        function toggleSelectAllCryptoDeposits() {
            const isChecked = $(this).prop('checked');
            $('#crypto-deposits-table .select-deposit').prop('checked', isChecked);
        }

        // Approve selected deposits
        function approveSelectedDeposits() {
            const selectedCardDeposits = $('#card-deposits-table .select-deposit:checked').map(function() {
                return $(this).closest('tr').find('.approve-deposit').data('id');
            }).get();
            
            const selectedCryptoDeposits = $('#crypto-deposits-table .select-deposit:checked').map(function() {
                return $(this).closest('tr').find('.approve-deposit').data('id');
            }).get();
            
            if (selectedCardDeposits.length === 0 && selectedCryptoDeposits.length === 0) {
                toastr.error('Please select at least one deposit to approve');
                return;
            }
            
            Swal.fire({
                title: 'Approve Selected Deposits',
                text: `Are you sure you want to approve ${selectedCardDeposits.length + selectedCryptoDeposits.length} deposits?`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#00D395',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, approve them!'
            }).then((result) => {
                if (result.isConfirmed) {
                    const promises = [];
                    
                    // Approve card deposits
                    selectedCardDeposits.forEach(depositId => {
                        promises.push(
                            $.ajax({
                                url: `https://website-backendd-1.onrender.com/api/admin/deposits/${depositId}/approve`,
                                type: 'PUT',
                                headers: {
                                    'Authorization': `Bearer ${adminToken}`,
                                    'X-CSRF-TOKEN': csrfToken
                                },
                                data: {
                                    type: 'card'
                                }
                            })
                        );
                    });
                    
                    // Approve crypto deposits
                    selectedCryptoDeposits.forEach(depositId => {
                        promises.push(
                            $.ajax({
                                url: `https://website-backendd-1.onrender.com/api/admin/deposits/${depositId}/approve`,
                                type: 'PUT',
                                headers: {
                                    'Authorization': `Bearer ${adminToken}`,
                                    'X-CSRF-TOKEN': csrfToken
                                },
                                data: {
                                    type: 'crypto'
                                }
                            })
                        );
                    });
                    
                    Promise.all(promises)
                        .then(responses => {
                            const successCount = responses.filter(r => r.status === 'success').length;
                            toastr.success(`Successfully approved ${successCount} deposits`);
                            
                            // Reload tables
                            cardDepositsTable.ajax.reload();
                            cryptoDepositsTable.ajax.reload();
                            
                            // Update stats
                            loadDashboardStats();
                        })
                        .catch(() => {
                            toastr.error('Some deposits failed to approve');
                        });
                }
            });
        }

        // Reject selected deposits
        function rejectSelectedDeposits() {
            const selectedCardDeposits = $('#card-deposits-table .select-deposit:checked').map(function() {
                return $(this).closest('tr').find('.reject-deposit').data('id');
            }).get();
            
            const selectedCryptoDeposits = $('#crypto-deposits-table .select-deposit:checked').map(function() {
                return $(this).closest('tr').find('.reject-deposit').data('id');
            }).get();
            
            if (selectedCardDeposits.length === 0 && selectedCryptoDeposits.length === 0) {
                toastr.error('Please select at least one deposit to reject');
                return;
            }
            
            Swal.fire({
                title: 'Reject Selected Deposits',
                text: `Are you sure you want to reject ${selectedCardDeposits.length + selectedCryptoDeposits.length} deposits?`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#00D395',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, reject them!'
            }).then((result) => {
                if (result.isConfirmed) {
                    const promises = [];
                    
                    // Reject card deposits
                    selectedCardDeposits.forEach(depositId => {
                        promises.push(
                            $.ajax({
                                url: `https://website-backendd-1.onrender.com/api/admin/deposits/${depositId}/reject`,
                                type: 'PUT',
                                headers: {
                                    'Authorization': `Bearer ${adminToken}`,
                                    'X-CSRF-TOKEN': csrfToken
                                },
                                data: {
                                    type: 'card'
                                }
                            })
                        );
                    });
                    
                    // Reject crypto deposits
                    selectedCryptoDeposits.forEach(depositId => {
                        promises.push(
                            $.ajax({
                                url: `https://website-backendd-1.onrender.com/api/admin/deposits/${depositId}/reject`,
                                type: 'PUT',
                                headers: {
                                    'Authorization': `Bearer ${adminToken}`,
                                    'X-CSRF-TOKEN': csrfToken
                                },
                                data: {
                                    type: 'crypto'
                                }
                            })
                        );
                    });
                    
                    Promise.all(promises)
                        .then(responses => {
                            const successCount = responses.filter(r => r.status === 'success').length;
                            toastr.success(`Successfully rejected ${successCount} deposits`);
                            
                            // Reload tables
                            cardDepositsTable.ajax.reload();
                            cryptoDepositsTable.ajax.reload();
                        })
                        .catch(() => {
                            toastr.error('Some deposits failed to reject');
                        });
                }
            });
        }

        // View transaction details
        function viewTransactionDetails(transactionId) {
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/transactions/${transactionId}`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const transaction = response.data;
                        
                        $('#modal-transaction-id').text(transaction.id);
                        $('#modal-transaction-user').text(`${transaction.user.name} (${transaction.user.email})`);
                        $('#modal-transaction-type').text(transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1));
                        $('#modal-transaction-amount').text(
                            transaction.currency === 'BTC' ? 
                            `${parseFloat(transaction.amount).toFixed(8)} BTC` : 
                            `$${parseFloat(transaction.amount).toFixed(2)}`
                        );
                        $('#modal-transaction-method').text(
                            transaction.method === 'btc' ? 'Bitcoin' : 
                            transaction.method === 'card' ? 'Credit/Debit Card' : 
                            transaction.method.charAt(0).toUpperCase() + transaction.method.slice(1)
                        );
                        
                        let statusBadge = '';
                        if (transaction.status === 'pending') {
                            statusBadge = '<span class="badge badge-warning">Pending</span>';
                        } else if (transaction.status === 'completed') {
                            statusBadge = '<span class="badge badge-success">Completed</span>';
                        } else if (transaction.status === 'failed' || transaction.status === 'rejected') {
                            statusBadge = '<span class="badge badge-danger">' + 
                                (transaction.status === 'failed' ? 'Failed' : 'Rejected') + 
                                '</span>';
                        } else {
                            statusBadge = '<span class="badge badge-primary">' + 
                                transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1) + 
                                '</span>';
                        }
                        
                        $('#modal-transaction-status').html(statusBadge);
                        $('#modal-transaction-date').text(new Date(transaction.created_at).toLocaleString());
                        $('#modal-transaction-details').text(transaction.details || 'No additional details');
                        
                        $('#transaction-details-modal').addClass('show');
                    }
                },
                error: function() {
                    toastr.error('Failed to load transaction details');
                }
            });
        }

        // Show filter modal
        function showFilterModal() {
            $('#filter-transactions-modal').addClass('show');
        }

        // Apply filters
        function applyFilters() {
            const type = $('#filter-type').val();
            const status = $('#filter-status').val();
            const method = $('#filter-method').val();
            const dateFrom = $('#filter-date-from').val();
            const dateTo = $('#filter-date-to').val();
            
            // Build query string
            let query = '';
            if (type) query += `type=${type}&`;
            if (status) query += `status=${status}&`;
            if (method) query += `method=${method}&`;
            if (dateFrom) query += `date_from=${dateFrom}&`;
            if (dateTo) query += `date_to=${dateTo}&`;
            
            // Remove trailing &
            if (query.endsWith('&')) {
                query = query.slice(0, -1);
            }
            
            // Update DataTable URL
            transactionsTable.ajax.url(`https://website-backendd-1.onrender.com/api/admin/transactions?${query}`).load();
            
            // Close modal
            $('#filter-transactions-modal').removeClass('show');
        }

        // Export transactions
        function exportTransactions() {
            // Get current filters
            const type = $('#filter-type').val();
            const status = $('#filter-status').val();
            const method = $('#filter-method').val();
            const dateFrom = $('#filter-date-from').val();
            const dateTo = $('#filter-date-to').val();
            
            // Build query string
            let query = 'export=1&';
            if (type) query += `type=${type}&`;
            if (status) query += `status=${status}&`;
            if (method) query += `method=${method}&`;
            if (dateFrom) query += `date_from=${dateFrom}&`;
            if (dateTo) query += `date_to=${dateTo}&`;
            
            // Remove trailing &
            if (query.endsWith('&')) {
                query = query.slice(0, -1);
            }
            
            // Trigger download
            window.open(`https://website-backendd-1.onrender.com/api/admin/transactions/export?${query}`, '_blank');
        }

        // Update new users badge
        function updateNewUsersBadge() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/stats/new-users',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        $('#new-users-badge').text(response.data.count);
                    }
                }
            });
        }

        // Update pending deposits badge
        function updatePendingDepositsBadge() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/stats/pending-deposits',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        $('#pending-deposits-badge').text(response.data.count);
                    }
                }
            });
        }

        // Update unread chats badge
        function updateUnreadChatsBadge() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/stats/unread-chats',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        $('#unread-chats-badge').text(response.data.count);
                    }
                }
            });
        }

        // Update notifications badge
        function updateNotificationsBadge() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/stats/unread-notifications',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${adminToken}`,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        $('#notifications-badge').text(response.data.count);
                    }
                }
            });
        }

        // Close modals when clicking outside
        $(document).on('click', function(e) {
            if ($(e.target).hasClass('modal')) {
                $(e.target).removeClass('show');
            }
        });

        // Close dropdowns when clicking outside
        $(document).on('click', function(e) {
            if (!$(e.target).closest('.dropdown-menu').length && !$(e.target).closest('.topbar-link').length) {
                $('.dropdown-menu').removeClass('show');
            }
        });

        // Initialize toastr
        toastr.options = {
            positionClass: 'toast-top-right',
            progressBar: true,
            timeOut: 5000,
            extendedTimeOut: 1000,
            closeButton: true,
            newestOnTop: true
        };
    </script>
</body>
</html>
