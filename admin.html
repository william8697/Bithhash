<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Dashboard | BitHash LLC - Institutional Bitcoin Mining</title>
    <meta name="description" content="BitHash LLC Admin Dashboard for managing institutional-grade Bitcoin mining platform with enterprise security standards.">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rowdies:wght@300;400;700&family=Inter:wght@300;400;500;600;700&family=Manrope:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" type="image/png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">
    
    <!-- Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    
    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- Toastr -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    
    <style>
        :root {
            --primary: #00D395;
            --primary-dark: #00B783;
            --primary-light: #00E5A1;
            --secondary: #1E1E1E;
            --secondary-dark: #121212;
            --dark: #E5E5E5;
            --darker: #0A0A0A;
            --light: #121212;
            --lighter: #1E1E1E;
            --gray: #8E8E8E;
            --gray-light: #2E2E2E;
            --gray-lighter: #252525;
            --success: #00D395;
            --warning: #FFB800;
            --error: #FF3D57;
            --gold: #D4AF37;
            --gold-light: #FFD700;
            --gold-dark: #996515;
            --blue: #003366;
            --blue-dark: #002244;
            --blue-light: #004488;
            --purple: #784FED;
            --pink: #EC4899;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            --gold-gradient: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            --blue-gradient: linear-gradient(135deg, var(--blue) 0%, var(--blue-dark) 100%);
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --box-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --visa-blue: #1A1F71;
            --visa-gold: #F7B600;
            --security-blue: #1A73E8;
            --security-green: #34A853;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--secondary-dark);
            color: var(--dark);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .admin-sidebar {
            width: 280px;
            background-color: var(--secondary);
            color: var(--dark);
            position: fixed;
            height: 100vh;
            padding: 20px 0;
            transition: var(--transition);
            z-index: 1000;
            border-right: 1px solid var(--gray-light);
        }

        .admin-sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 20px;
        }

        .admin-sidebar-header img {
            height: 40px;
        }

        .admin-sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .admin-sidebar-menu li {
            position: relative;
        }

        .admin-sidebar-menu li a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--dark);
            text-decoration: none;
            transition: var(--transition);
            font-weight: 500;
        }

        .admin-sidebar-menu li a:hover,
        .admin-sidebar-menu li a.active {
            background-color: var(--gray-light);
            color: var(--primary);
        }

        .admin-sidebar-menu li a i {
            margin-right: 10px;
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .admin-sidebar-menu li .submenu {
            list-style: none;
            padding: 0;
            margin: 0;
            background-color: var(--gray-lighter);
            display: none;
        }

        .admin-sidebar-menu li.active .submenu {
            display: block;
        }

        .admin-sidebar-menu li .submenu li a {
            padding: 10px 20px 10px 50px;
            font-size: 14px;
        }

        .admin-sidebar-menu li.has-submenu > a:after {
            content: '\f078';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 20px;
            transition: var(--transition);
        }

        .admin-sidebar-menu li.has-submenu.active > a:after {
            transform: rotate(180deg);
        }

        /* Main Content Styles */
        .admin-main {
            flex: 1;
            margin-left: 280px;
            transition: var(--transition);
        }

        .admin-header {
            background-color: var(--secondary);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--gray-light);
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .admin-header-left h1 {
            font-size: 24px;
            margin: 0;
            font-weight: 700;
            color: var(--dark);
        }

        .admin-header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .admin-notification {
            position: relative;
        }

        .admin-notification-btn {
            background: none;
            border: none;
            color: var(--dark);
            font-size: 20px;
            cursor: pointer;
            position: relative;
        }

        .admin-notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--error);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            position: relative;
        }

        .admin-profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .admin-profile-name {
            font-weight: 600;
        }

        .admin-profile-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            padding: 10px 0;
            min-width: 200px;
            box-shadow: var(--box-shadow-lg);
            display: none;
            z-index: 1000;
        }

        .admin-profile:hover .admin-profile-dropdown {
            display: block;
        }

        .admin-profile-dropdown a {
            display: block;
            padding: 8px 20px;
            color: var(--dark);
            text-decoration: none;
            transition: var(--transition);
        }

        .admin-profile-dropdown a:hover {
            background-color: var(--gray-light);
            color: var(--primary);
        }

        .admin-content {
            padding: 30px;
        }

        .admin-card {
            background-color: var(--secondary);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
            border: 1px solid var(--gray-light);
        }

        .admin-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .admin-card-title {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
            color: var(--dark);
        }

        .admin-card-actions {
            display: flex;
            gap: 10px;
        }

        .admin-btn {
            padding: 8px 16px;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .admin-btn-primary {
            background-color: var(--primary);
            color: var(--secondary-dark);
        }

        .admin-btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .admin-btn-secondary {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        .admin-btn-secondary:hover {
            background-color: var(--gray);
        }

        .admin-btn-danger {
            background-color: var(--error);
            color: white;
        }

        .admin-btn-danger:hover {
            background-color: #d32f2f;
        }

        .admin-btn-success {
            background-color: var(--success);
            color: var(--secondary-dark);
        }

        .admin-btn-success:hover {
            background-color: #00b383;
        }

        .admin-btn-warning {
            background-color: var(--warning);
            color: var(--secondary-dark);
        }

        .admin-btn-warning:hover {
            background-color: #e6a200;
        }

        .admin-btn-sm {
            padding: 5px 10px;
            font-size: 13px;
        }

        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .admin-stat-card {
            background-color: var(--secondary);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--gray-light);
        }

        .admin-stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .admin-stat-card-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .admin-stat-card-icon.users {
            background-color: rgba(0, 211, 149, 0.1);
            color: var(--primary);
        }

        .admin-stat-card-icon.deposits {
            background-color: rgba(212, 175, 55, 0.1);
            color: var(--gold);
        }

        .admin-stat-card-icon.withdrawals {
            background-color: rgba(255, 61, 87, 0.1);
            color: var(--error);
        }

        .admin-stat-card-icon.profit {
            background-color: rgba(120, 79, 237, 0.1);
            color: var(--purple);
        }

        .admin-stat-card-title {
            font-size: 14px;
            color: var(--gray);
            margin: 0;
        }

        .admin-stat-card-value {
            font-size: 24px;
            font-weight: 700;
            margin: 5px 0;
            color: var(--dark);
        }

        .admin-stat-card-change {
            font-size: 12px;
            display: flex;
            align-items: center;
        }

        .admin-stat-card-change.positive {
            color: var(--success);
        }

        .admin-stat-card-change.negative {
            color: var(--error);
        }

        /* DataTables Customization */
        .dataTables_wrapper {
            margin-top: 20px;
        }

        .dataTables_filter input {
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
            color: var(--dark);
            padding: 5px 10px;
            border-radius: var(--border-radius);
        }

        .dataTables_length select {
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
            color: var(--dark);
            padding: 5px;
            border-radius: var(--border-radius);
        }

        .dataTables_info {
            color: var(--gray) !important;
        }

        .page-item.active .page-link {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .page-link {
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
            color: var(--dark);
        }

        .page-link:hover {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        table.dataTable {
            border-collapse: collapse !important;
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }

        table.dataTable thead th, 
        table.dataTable thead td {
            border-bottom: 1px solid var(--gray-light) !important;
            color: var(--gray);
            font-weight: 600;
        }

        table.dataTable tbody tr {
            background-color: var(--secondary);
        }

        table.dataTable tbody tr:nth-child(odd) {
            background-color: var(--lighter);
        }

        table.dataTable tbody tr:hover {
            background-color: var(--gray-light);
        }

        table.dataTable tbody th, 
        table.dataTable tbody td {
            border-top: 1px solid var(--gray-light);
            color: var(--dark);
            padding: 12px 15px;
        }

        /* Modal Styles */
        .admin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1100;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-slow);
        }

        .admin-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .admin-modal-content {
            background-color: var(--secondary);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--box-shadow-lg);
            transform: translateY(20px);
            transition: var(--transition-slow);
        }

        .admin-modal.active .admin-modal-content {
            transform: translateY(0);
        }

        .admin-modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-modal-title {
            margin: 0;
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
        }

        .admin-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }

        .admin-modal-close:hover {
            color: var(--error);
        }

        .admin-modal-body {
            padding: 20px;
        }

        .admin-modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .admin-form-group {
            margin-bottom: 20px;
        }

        .admin-form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .admin-form-control {
            width: 100%;
            padding: 10px 15px;
            background-color: var(--lighter);
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            color: var(--dark);
            transition: var(--transition);
        }

        .admin-form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 211, 149, 0.2);
        }

        .admin-form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%238E8E8E' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 16px 12px;
        }

        .admin-form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Tabs */
        .admin-tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 20px;
        }

        .admin-tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            border-bottom: 2px solid transparent;
            transition: var(--transition);
        }

        .admin-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .admin-sidebar {
                transform: translateX(-100%);
            }
            
            .admin-sidebar.active {
                transform: translateX(0);
            }
            
            .admin-main {
                margin-left: 0;
            }
            
            .admin-header-left h1 {
                font-size: 20px;
            }
        }

        @media (max-width: 768px) {
            .admin-stats-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .admin-header {
                padding: 15px;
            }
            
            .admin-content {
                padding: 15px;
            }
        }

        @media (max-width: 576px) {
            .admin-stats-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-card-actions {
                flex-direction: column;
                gap: 5px;
            }
            
            .admin-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Loading Spinner */
        .admin-loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Status Badges */
        .admin-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .admin-badge-success {
            background-color: rgba(0, 211, 149, 0.1);
            color: var(--success);
        }

        .admin-badge-warning {
            background-color: rgba(255, 184, 0, 0.1);
            color: var(--warning);
        }

        .admin-badge-danger {
            background-color: rgba(255, 61, 87, 0.1);
            color: var(--error);
        }

        .admin-badge-info {
            background-color: rgba(56, 139, 253, 0.1);
            color: #388bfd;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-lighter);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* Chat Widget */
        .admin-chat-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 350px;
            background-color: var(--secondary);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow-lg);
            border: 1px solid var(--gray-light);
            z-index: 1000;
            transform: translateY(20px);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-slow);
        }

        .admin-chat-widget.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .admin-chat-header {
            padding: 15px;
            background-color: var(--lighter);
            border-bottom: 1px solid var(--gray-light);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .admin-chat-title {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
        }

        .admin-chat-toggle {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 18px;
            cursor: pointer;
        }

        .admin-chat-body {
            height: 300px;
            overflow-y: auto;
            padding: 15px;
        }

        .admin-chat-message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .admin-chat-message.admin {
            align-items: flex-end;
        }

        .admin-chat-message.user {
            align-items: flex-start;
        }

        .admin-chat-message-content {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            position: relative;
            word-wrap: break-word;
        }

        .admin-chat-message.admin .admin-chat-message-content {
            background-color: var(--primary);
            color: var(--secondary-dark);
            border-bottom-right-radius: 0;
        }

        .admin-chat-message.user .admin-chat-message-content {
            background-color: var(--gray-light);
            color: var(--dark);
            border-bottom-left-radius: 0;
        }

        .admin-chat-message-info {
            font-size: 11px;
            color: var(--gray);
            margin-top: 5px;
        }

        .admin-chat-footer {
            padding: 15px;
            border-top: 1px solid var(--gray-light);
        }

        .admin-chat-form {
            display: flex;
            gap: 10px;
        }

        .admin-chat-input {
            flex: 1;
            padding: 10px 15px;
            background-color: var(--lighter);
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            color: var(--dark);
        }

        .admin-chat-submit {
            background-color: var(--primary);
            color: var(--secondary-dark);
            border: none;
            border-radius: var(--border-radius);
            padding: 0 15px;
            cursor: pointer;
            transition: var(--transition);
        }

        .admin-chat-submit:hover {
            background-color: var(--primary-dark);
        }

        /* Login Page */
        .admin-login-container {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            background-color: var(--secondary-dark);
            padding: 20px;
        }

        .admin-login-card {
            background-color: var(--secondary);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 450px;
            padding: 40px;
            box-shadow: var(--box-shadow-lg);
            border: 1px solid var(--gray-light);
        }

        .admin-login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .admin-login-logo {
            height: 50px;
            margin-bottom: 20px;
        }

        .admin-login-title {
            font-size: 24px;
            font-weight: 700;
            margin: 0 0 10px;
            color: var(--dark);
        }

        .admin-login-subtitle {
            font-size: 14px;
            color: var(--gray);
            margin: 0;
        }

        .admin-login-form .admin-form-group {
            margin-bottom: 25px;
        }

        .admin-login-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .admin-login-remember {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-login-remember input {
            width: 16px;
            height: 16px;
        }

        .admin-login-remember label {
            font-size: 14px;
            color: var(--gray);
        }

        .admin-login-forgot {
            font-size: 14px;
            color: var(--primary);
            text-decoration: none;
        }

        .admin-login-forgot:hover {
            text-decoration: underline;
        }

        .admin-login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: var(--secondary-dark);
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
        }

        .admin-login-btn:hover {
            background-color: var(--primary-dark);
        }

        .admin-login-footer {
            text-align: center;
            font-size: 14px;
            color: var(--gray);
        }

        .admin-login-footer a {
            color: var(--primary);
            text-decoration: none;
        }

        .admin-login-footer a:hover {
            text-decoration: underline;
        }

        /* 2FA Modal */
        .admin-2fa-modal .admin-modal-content {
            max-width: 400px;
        }

        .admin-2fa-code {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .admin-2fa-code input {
            width: 40px;
            height: 50px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            background-color: var(--lighter);
            color: var(--dark);
        }

        .admin-2fa-code input:focus {
            border-color: var(--primary);
            outline: none;
        }

        .admin-2fa-secret {
            background-color: var(--lighter);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            text-align: center;
            font-family: monospace;
            font-size: 18px;
            color: var(--dark);
            word-break: break-all;
        }

        .admin-2fa-qr {
            text-align: center;
            margin-bottom: 20px;
        }

        .admin-2fa-qr img {
            max-width: 200px;
            height: auto;
        }

        /* Mobile Menu Toggle */
        .admin-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--dark);
            font-size: 24px;
            cursor: pointer;
        }

        @media (max-width: 992px) {
            .admin-menu-toggle {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page (shown when not authenticated) -->
    <div id="admin-login-page" class="admin-login-container">
        <div class="admin-login-card">
            <div class="admin-login-header">
                <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash LLC" class="admin-login-logo">
                <h1 class="admin-login-title">Admin Dashboard</h1>
                <p class="admin-login-subtitle">Sign in to access the control panel</p>
            </div>
            <form id="admin-login-form" class="admin-login-form">
                <div class="admin-form-group">
                    <label for="login-email" class="admin-form-label">Email Address</label>
                    <input type="email" id="login-email" class="admin-form-control" required>
                </div>
                <div class="admin-form-group">
                    <label for="login-password" class="admin-form-label">Password</label>
                    <input type="password" id="login-password" class="admin-form-control" required>
                </div>
                <div class="admin-login-actions">
                    <div class="admin-login-remember">
                        <input type="checkbox" id="login-remember">
                        <label for="login-remember">Remember me</label>
                    </div>
                    <a href="#" id="login-forgot" class="admin-login-forgot">Forgot password?</a>
                </div>
                <button type="submit" class="admin-login-btn" id="login-submit">
                    <span id="login-submit-text">Sign In</span>
                    <span id="login-submit-spinner" class="admin-loading" style="display: none;"></span>
                </button>
            </form>
            <div class="admin-login-footer">
                <p>Â© 2023 BitHash LLC. All rights reserved.</p>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard (shown when authenticated) -->
    <div id="admin-dashboard" class="admin-container" style="display: none;">
        <!-- Sidebar -->
        <div class="admin-sidebar" id="admin-sidebar">
            <div class="admin-sidebar-header">
                <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash LLC">
            </div>
            <ul class="admin-sidebar-menu">
                <li>
                    <a href="#" class="active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="has-submenu">
                    <a href="#">
                        <i class="fas fa-users"></i>
                        <span>User Management</span>
                    </a>
                    <ul class="submenu">
                        <li><a href="#" data-section="users-all">All Users</a></li>
                        <li><a href="#" data-section="users-active">Active Users</a></li>
                        <li><a href="#" data-section="users-suspended">Suspended Users</a></li>
                        <li><a href="#" data-section="users-kyc">KYC Verification</a></li>
                    </ul>
                </li>
                <li class="has-submenu">
                    <a href="#">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Financial</span>
                    </a>
                    <ul class="submenu">
                        <li><a href="#" data-section="transactions">Transactions</a></li>
                        <li><a href="#" data-section="deposits">Deposits</a></li>
                        <li><a href="#" data-section="withdrawals">Withdrawals</a></li>
                        <li><a href="#" data-section="balances">User Balances</a></li>
                    </ul>
                </li>
                <li class="has-submenu">
                    <a href="#">
                        <i class="fas fa-chart-line"></i>
                        <span>Investments</span>
                    </a>
                    <ul class="submenu">
                        <li><a href="#" data-section="investments-all">All Investments</a></li>
                        <li><a href="#" data-section="investments-active">Active Investments</a></li>
                        <li><a href="#" data-section="investments-plans">Investment Plans</a></li>
                        <li><a href="#" data-section="investments-profits">Profit History</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#" data-section="support">
                        <i class="fas fa-headset"></i>
                        <span>Support Tickets</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-section="notifications">
                        <i class="fas fa-bell"></i>
                        <span>Notifications</span>
                    </a>
                </li>
                <li class="has-submenu">
                    <a href="#">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                    <ul class="submenu">
                        <li><a href="#" data-section="settings-general">General Settings</a></li>
                        <li><a href="#" data-section="settings-security">Security</a></li>
                        <li><a href="#" data-section="settings-email">Email Templates</a></li>
                        <li><a href="#" data-section="settings-payment">Payment Methods</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#" data-section="reports">
                        <i class="fas fa-file-alt"></i>
                        <span>Reports</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="admin-main">
            <!-- Header -->
            <header class="admin-header">
                <div class="admin-header-left">
                    <button class="admin-menu-toggle" id="admin-menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="admin-page-title">Dashboard</h1>
                </div>
                <div class="admin-header-right">
                    <div class="admin-notification">
                        <button class="admin-notification-btn" id="admin-notification-btn">
                            <i class="fas fa-bell"></i>
                            <span class="admin-notification-count" id="admin-notification-count">0</span>
                        </button>
                    </div>
                    <div class="admin-profile" id="admin-profile">
                        <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="Admin" class="admin-profile-img">
                        <span class="admin-profile-name" id="admin-profile-name">Admin</span>
                        <div class="admin-profile-dropdown">
                            <a href="#" id="admin-profile-link"><i class="fas fa-user-circle"></i> My Profile</a>
                            <a href="#" id="admin-settings-link"><i class="fas fa-cog"></i> Settings</a>
                            <a href="#" id="admin-logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="admin-content" id="admin-content">
                <!-- Dashboard content will be loaded here dynamically -->
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="admin-modal" id="admin-user-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 class="admin-modal-title" id="user-modal-title">User Details</h3>
                <button class="admin-modal-close" id="user-modal-close">&times;</button>
            </div>
            <div class="admin-modal-body">
                <form id="admin-user-form">
                    <div class="admin-form-group">
                        <label for="user-id" class="admin-form-label">User ID</label>
                        <input type="text" id="user-id" class="admin-form-control" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="user-email" class="admin-form-label">Email</label>
                        <input type="email" id="user-email" class="admin-form-control" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="user-firstname" class="admin-form-label">First Name</label>
                        <input type="text" id="user-firstname" class="admin-form-control" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="user-lastname" class="admin-form-label">Last Name</label>
                        <input type="text" id="user-lastname" class="admin-form-control" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="user-phone" class="admin-form-label">Phone</label>
                        <input type="text" id="user-phone" class="admin-form-control">
                    </div>
                    <div class="admin-form-group">
                        <label for="user-status" class="admin-form-label">Status</label>
                        <select id="user-status" class="admin-form-control admin-form-select">
                            <option value="active">Active</option>
                            <option value="suspended">Suspended</option>
                            <option value="pending">Pending</option>
                            <option value="banned">Banned</option>
                        </select>
                    </div>
                    <div class="admin-form-group">
                        <label for="user-kyc" class="admin-form-label">KYC Status</label>
                        <select id="user-kyc" class="admin-form-control admin-form-select">
                            <option value="verified">Verified</option>
                            <option value="pending">Pending</option>
                            <option value="unverified">Unverified</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div class="admin-form-group">
                        <label for="user-balance" class="admin-form-label">Account Balance (USD)</label>
                        <input type="number" id="user-balance" class="admin-form-control" step="0.01" min="0">
                    </div>
                    <div class="admin-form-group">
                        <label for="user-invested" class="admin-form-label">Total Invested (USD)</label>
                        <input type="number" id="user-invested" class="admin-form-control" step="0.01" min="0" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="user-earnings" class="admin-form-label">Total Earnings (USD)</label>
                        <input type="number" id="user-earnings" class="admin-form-control" step="0.01" min="0" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="user-referrals" class="admin-form-label">Referrals Count</label>
                        <input type="number" id="user-referrals" class="admin-form-control" min="0" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="user-ip" class="admin-form-label">Last Known IP</label>
                        <input type="text" id="user-ip" class="admin-form-control" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="user-joined" class="admin-form-label">Join Date</label>
                        <input type="text" id="user-joined" class="admin-form-control" readonly>
                    </div>
                </form>
            </div>
            <div class="admin-modal-footer">
                <button class="admin-btn admin-btn-secondary" id="user-modal-cancel">Cancel</button>
                <button class="admin-btn admin-btn-primary" id="user-modal-save">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="admin-modal" id="admin-transaction-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 class="admin-modal-title" id="transaction-modal-title">Transaction Details</h3>
                <button class="admin-modal-close" id="transaction-modal-close">&times;</button>
            </div>
            <div class="admin-modal-body">
                <form id="admin-transaction-form">
                    <div class="admin-form-group">
                        <label for="transaction-id" class="admin-form-label">Transaction ID</label>
                        <input type="text" id="transaction-id" class="admin-form-control" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="transaction-user" class="admin-form-label">User</label>
                        <input type="text" id="transaction-user" class="admin-form-control" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="transaction-type" class="admin-form-label">Type</label>
                        <input type="text" id="transaction-type" class="admin-form-control" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="transaction-amount" class="admin-form-label">Amount (USD)</label>
                        <input type="number" id="transaction-amount" class="admin-form-control" step="0.01" min="0" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="transaction-fee" class="admin-form-label">Fee (USD)</label>
                        <input type="number" id="transaction-fee" class="admin-form-control" step="0.01" min="0">
                    </div>
                    <div class="admin-form-group">
                        <label for="transaction-status" class="admin-form-label">Status</label>
                        <select id="transaction-status" class="admin-form-control admin-form-select">
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                            <option value="failed">Failed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="admin-form-group">
                        <label for="transaction-method" class="admin-form-label">Payment Method</label>
                        <input type="text" id="transaction-method" class="admin-form-control" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="transaction-date" class="admin-form-label">Date</label>
                        <input type="text" id="transaction-date" class="admin-form-control" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="transaction-details" class="admin-form-label">Details</label>
                        <textarea id="transaction-details" class="admin-form-control admin-form-textarea" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="admin-modal-footer">
                <button class="admin-btn admin-btn-secondary" id="transaction-modal-cancel">Cancel</button>
                <button class="admin-btn admin-btn-primary" id="transaction-modal-save">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="admin-modal" id="admin-withdrawal-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 class="admin-modal-title" id="withdrawal-modal-title">Process Withdrawal</h3>
                <button class="admin-modal-close" id="withdrawal-modal-close">&times;</button>
            </div>
            <div class="admin-modal-body">
                <form id="admin-withdrawal-form">
                    <div class="admin-form-group">
                        <label for="withdrawal-id" class="admin-form-label">Withdrawal ID</label>
                        <input type="text" id="withdrawal-id" class="admin-form-control" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="withdrawal-user" class="admin-form-label">User</label>
                        <input type="text" id="withdrawal-user" class="admin-form-control" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="withdrawal-amount" class="admin-form-label">Amount (USD)</label>
                        <input type="number" id="withdrawal-amount" class="admin-form-control" step="0.01" min="0" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="withdrawal-fee" class="admin-form-label">Fee (USD)</label>
                        <input type="number" id="withdrawal-fee" class="admin-form-control" step="0.01" min="0">
                    </div>
                    <div class="admin-form-group">
                        <label for="withdrawal-wallet" class="admin-form-label">Wallet Address</label>
                        <input type="text" id="withdrawal-wallet" class="admin-form-control" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="withdrawal-status" class="admin-form-label">Status</label>
                        <select id="withdrawal-status" class="admin-form-control admin-form-select">
                            <option value="pending">Pending</option>
                            <option value="processing">Processing</option>
                            <option value="completed">Completed</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div class="admin-form-group">
                        <label for="withdrawal-date" class="admin-form-label">Request Date</label>
                        <input type="text" id="withdrawal-date" class="admin-form-control" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="withdrawal-notes" class="admin-form-label">Admin Notes</label>
                        <textarea id="withdrawal-notes" class="admin-form-control admin-form-textarea" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="admin-modal-footer">
                <button class="admin-btn admin-btn-danger" id="withdrawal-modal-reject">Reject</button>
                <button class="admin-btn admin-btn-success" id="withdrawal-modal-approve">Approve</button>
            </div>
        </div>
    </div>

    <div class="admin-modal" id="admin-plan-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 class="admin-modal-title" id="plan-modal-title">Investment Plan</h3>
                <button class="admin-modal-close" id="plan-modal-close">&times;</button>
            </div>
            <div class="admin-modal-body">
                <form id="admin-plan-form">
                    <div class="admin-form-group">
                        <label for="plan-id" class="admin-form-label">Plan ID</label>
                        <input type="text" id="plan-id" class="admin-form-control" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="plan-name" class="admin-form-label">Plan Name</label>
                        <input type="text" id="plan-name" class="admin-form-control" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="plan-min" class="admin-form-label">Minimum Amount (USD)</label>
                        <input type="number" id="plan-min" class="admin-form-control" step="0.01" min="0" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="plan-max" class="admin-form-label">Maximum Amount (USD)</label>
                        <input type="number" id="plan-max" class="admin-form-control" step="0.01" min="0">
                    </div>
                    <div class="admin-form-group">
                        <label for="plan-duration" class="admin-form-label">Duration (Days)</label>
                        <input type="number" id="plan-duration" class="admin-form-control" min="1" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="plan-profit" class="admin-form-label">Daily Profit (%)</label>
                        <input type="number" id="plan-profit" class="admin-form-control" step="0.01" min="0" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="plan-total" class="admin-form-label">Total Return (%)</label>
                        <input type="number" id="plan-total" class="admin-form-control" step="0.01" min="0" readonly>
                    </div>
                    <div class="admin-form-group">
                        <label for="plan-status" class="admin-form-label">Status</label>
                        <select id="plan-status" class="admin-form-control admin-form-select">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="admin-form-group">
                        <label for="plan-description" class="admin-form-label">Description</label>
                        <textarea id="plan-description" class="admin-form-control admin-form-textarea" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="admin-modal-footer">
                <button class="admin-btn admin-btn-secondary" id="plan-modal-cancel">Cancel</button>
                <button class="admin-btn admin-btn-primary" id="plan-modal-save">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="admin-modal" id="admin-notification-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 class="admin-modal-title" id="notification-modal-title">Send Notification</h3>
                <button class="admin-modal-close" id="notification-modal-close">&times;</button>
            </div>
            <div class="admin-modal-body">
                <form id="admin-notification-form">
                    <div class="admin-form-group">
                        <label for="notification-type" class="admin-form-label">Type</label>
                        <select id="notification-type" class="admin-form-control admin-form-select">
                            <option value="all">All Users</option>
                            <option value="active">Active Users</option>
                            <option value="investors">Investors Only</option>
                            <option value="non-investors">Non-Investors</option>
                            <option value="specific">Specific Users</option>
                        </select>
                    </div>
                    <div class="admin-form-group" id="notification-users-group" style="display: none;">
                        <label for="notification-users" class="admin-form-label">Select Users</label>
                        <select id="notification-users" class="admin-form-control admin-form-select" multiple>
                            <!-- Users will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="admin-form-group">
                        <label for="notification-subject" class="admin-form-label">Subject</label>
                        <input type="text" id="notification-subject" class="admin-form-control" required>
                    </div>
                    <div class="admin-form-group">
                        <label for="notification-message" class="admin-form-label">Message</label>
                        <textarea id="notification-message" class="admin-form-control admin-form-textarea" rows="5" required></textarea>
                    </div>
                    <div class="admin-form-group">
                        <label for="notification-email" class="admin-form-label">Also send as email</label>
                        <input type="checkbox" id="notification-email" checked>
                    </div>
                </form>
            </div>
            <div class="admin-modal-footer">
                <button class="admin-btn admin-btn-secondary" id="notification-modal-cancel">Cancel</button>
                <button class="admin-btn admin-btn-primary" id="notification-modal-send">Send Notification</button>
            </div>
        </div>
    </div>

    <div class="admin-modal" id="admin-2fa-modal" class="admin-2fa-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 class="admin-modal-title">Two-Factor Authentication</h3>
                <button class="admin-modal-close" id="2fa-modal-close">&times;</button>
            </div>
            <div class="admin-modal-body">
                <div class="admin-form-group">
                    <p>Please enter the 6-digit code from your authenticator app:</p>
                    <div class="admin-2fa-code">
                        <input type="text" maxlength="1" pattern="[0-9]">
                        <input type="text" maxlength="1" pattern="[0-9]">
                        <input type="text" maxlength="1" pattern="[0-9]">
                        <input type="text" maxlength="1" pattern="[0-9]">
                        <input type="text" maxlength="1" pattern="[0-9]">
                        <input type="text" maxlength="1" pattern="[0-9]">
                    </div>
                </div>
            </div>
            <div class="admin-modal-footer">
                <button class="admin-btn admin-btn-secondary" id="2fa-modal-cancel">Cancel</button>
                <button class="admin-btn admin-btn-primary" id="2fa-modal-verify">Verify</button>
            </div>
        </div>
    </div>

    <!-- Chat Widget -->
    <div class="admin-chat-widget" id="admin-chat-widget">
        <div class="admin-chat-header">
            <h3 class="admin-chat-title">Live Support</h3>
            <button class="admin-chat-toggle" id="admin-chat-toggle">
                <i class="fas fa-minus"></i>
            </button>
        </div>
        <div class="admin-chat-body" id="admin-chat-body">
            <!-- Chat messages will be loaded here -->
        </div>
        <div class="admin-chat-footer">
            <form class="admin-chat-form" id="admin-chat-form">
                <input type="text" class="admin-chat-input" id="admin-chat-input" placeholder="Type your message...">
                <button type="submit" class="admin-chat-submit">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>

    <script>
        // Global variables
        let adminAuthToken = localStorage.getItem('adminAuthToken');
        let adminRefreshToken = localStorage.getItem('adminRefreshToken');
        let adminData = {};
        let socket = null;
        
        // Initialize the application
        $(document).ready(function() {
            AOS.init();
            
            // Check authentication state
            checkAuthState();
            
            // Initialize event listeners
            initEventListeners();
        });
        
        // Check authentication state
        function checkAuthState() {
            if (adminAuthToken) {
                verifyAdminToken();
            } else {
                showLoginPage();
            }
        }
        
        // Verify admin token with backend
        function verifyAdminToken() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/verify',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        adminData = response.data;
                        showAdminDashboard();
                        loadDashboardContent();
                        connectWebSocket();
                    } else {
                        showLoginPage();
                    }
                },
                error: function(xhr, status, error) {
                    if (xhr.status === 401) {
                        // Token expired, try to refresh
                        refreshAdminToken();
                    } else {
                        showLoginPage();
                    }
                }
            });
        }
        
        // Refresh admin token
        function refreshAdminToken() {
            if (!adminRefreshToken) {
                showLoginPage();
                return;
            }
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/refresh',
                type: 'POST',
                data: {
                    refreshToken: adminRefreshToken
                },
                success: function(response) {
                    if (response.success) {
                        adminAuthToken = response.data.accessToken;
                        adminRefreshToken = response.data.refreshToken;
                        localStorage.setItem('adminAuthToken', adminAuthToken);
                        localStorage.setItem('adminRefreshToken', adminRefreshToken);
                        verifyAdminToken();
                    } else {
                        showLoginPage();
                    }
                },
                error: function() {
                    showLoginPage();
                }
            });
        }
        
        // Show login page
        function showLoginPage() {
            $('#admin-dashboard').hide();
            $('#admin-login-page').show();
            localStorage.removeItem('adminAuthToken');
            localStorage.removeItem('adminRefreshToken');
            adminAuthToken = null;
            adminRefreshToken = null;
            
            if (socket) {
                socket.disconnect();
                socket = null;
            }
        }
        
        // Show admin dashboard
        function showAdminDashboard() {
            $('#admin-login-page').hide();
            $('#admin-dashboard').show();
            $('#admin-profile-name').text(adminData.name || 'Admin');
            
            // Update profile image if available
            if (adminData.avatar) {
                $('#admin-profile-img').attr('src', adminData.avatar);
            }
        }
        
        // Initialize event listeners
        function initEventListeners() {
            // Login form submission
            $('#admin-login-form').on('submit', function(e) {
                e.preventDefault();
                adminLogin();
            });
            
            // Forgot password link
            $('#login-forgot').on('click', function(e) {
                e.preventDefault();
                showForgotPasswordModal();
            });
            
            // Logout link
            $('#admin-logout-link').on('click', function(e) {
                e.preventDefault();
                adminLogout();
            });
            
            // Menu toggle for mobile
            $('#admin-menu-toggle').on('click', function() {
                $('#admin-sidebar').toggleClass('active');
            });
            
            // Sidebar menu items
            $('.admin-sidebar-menu a[data-section]').on('click', function(e) {
                e.preventDefault();
                const section = $(this).data('section');
                loadSectionContent(section);
                
                // Update active state
                $('.admin-sidebar-menu a').removeClass('active');
                $(this).addClass('active');
                
                // Update page title
                $('#admin-page-title').text($(this).find('span').text());
                
                // Close sidebar on mobile
                if ($(window).width() < 992) {
                    $('#admin-sidebar').removeClass('active');
                }
            });
            
            // Submenu toggle
            $('.admin-sidebar-menu li.has-submenu > a').on('click', function(e) {
                e.preventDefault();
                $(this).parent().toggleClass('active');
            });
            
            // User modal
            $('#user-modal-close, #user-modal-cancel').on('click', function() {
                $('#admin-user-modal').removeClass('active');
            });
            
            $('#user-modal-save').on('click', function() {
                saveUserChanges();
            });
            
            // Transaction modal
            $('#transaction-modal-close, #transaction-modal-cancel').on('click', function() {
                $('#admin-transaction-modal').removeClass('active');
            });
            
            $('#transaction-modal-save').on('click', function() {
                saveTransactionChanges();
            });
            
            // Withdrawal modal
            $('#withdrawal-modal-close').on('click', function() {
                $('#admin-withdrawal-modal').removeClass('active');
            });
            
            $('#withdrawal-modal-reject').on('click', function() {
                updateWithdrawalStatus('rejected');
            });
            
            $('#withdrawal-modal-approve').on('click', function() {
                updateWithdrawalStatus('completed');
            });
            
            // Plan modal
            $('#plan-modal-close, #plan-modal-cancel').on('click', function() {
                $('#admin-plan-modal').removeClass('active');
            });
            
            $('#plan-modal-save').on('click', function() {
                savePlanChanges();
            });
            
            // Notification modal
            $('#notification-modal-close, #notification-modal-cancel').on('click', function() {
                $('#admin-notification-modal').removeClass('active');
            });
            
            $('#notification-modal-send').on('click', function() {
                sendNotification();
            });
            
            // Notification type change
            $('#notification-type').on('change', function() {
                if ($(this).val() === 'specific') {
                    $('#notification-users-group').show();
                    loadUsersForNotification();
                } else {
                    $('#notification-users-group').hide();
                }
            });
            
            // 2FA modal
            $('#2fa-modal-close, #2fa-modal-cancel').on('click', function() {
                $('#admin-2fa-modal').removeClass('active');
            });
            
            $('#2fa-modal-verify').on('click', function() {
                verify2FACode();
            });
            
            // 2FA code input auto-focus
            $('#admin-2fa-modal input').on('input', function() {
                const $inputs = $('#admin-2fa-modal input');
                const index = $inputs.index(this);
                
                if (this.value.length === 1 && index < $inputs.length - 1) {
                    $inputs.eq(index + 1).focus();
                }
            });
            
            // Chat widget toggle
            $('#admin-chat-toggle').on('click', function(e) {
                e.preventDefault();
                const $chatWidget = $('#admin-chat-widget');
                const $icon = $(this).find('i');
                
                if ($chatWidget.hasClass('active')) {
                    $chatWidget.removeClass('active');
                    $icon.removeClass('fa-times').addClass('fa-minus');
                } else {
                    $chatWidget.addClass('active');
                    $icon.removeClass('fa-minus').addClass('fa-times');
                }
            });
            
            // Chat form submission
            $('#admin-chat-form').on('submit', function(e) {
                e.preventDefault();
                sendChatMessage();
            });
            
            // Plan profit calculation
            $('#plan-profit, #plan-duration').on('input', function() {
                calculateTotalReturn();
            });
        }
        
       // Admin login function
function adminLogin() {
    try {
        const email = $('#login-email').val().trim();
        const password = $('#login-password').val();
        const remember = $('#login-remember').is(':checked');
        
        // Input validation
        if (!email || !password) {
            showToast('error', 'Please enter both email and password');
            return;
        }
        
        if (!isValidEmail(email)) {
            showToast('error', 'Please enter a valid email address');
            return;
        }
        
        // Disable submit button during request
        const $submitBtn = $('#login-submit');
        $submitBtn.prop('disabled', true);
        $('#login-submit-text').hide();
        $('#login-submit-spinner').show();
        
        // Secure request with anti-CSRF token if available
        const headers = {};
        const csrfToken = $('meta[name="csrf-token"]').attr('content');
        if (csrfToken) {
            headers['X-CSRF-Token'] = csrfToken;
        }
        
        $.ajax({
            url: 'https://website-backendd-1.onrender.com/api/admin/auth/login',
            type: 'POST',
            data: JSON.stringify({
                email: email,
                password: password
            }),
            contentType: 'application/json',
            headers: headers,
            timeout: 10000, // 10 seconds timeout
            success: function(response) {
                if (response && response.success) {
                    if (response.data.requires2FA) {
                        show2FAModal();
                    } else {
                        completeLogin(response.data);
                    }
                } else {
                    const errorMsg = (response && response.message) ? response.message : 'Login failed';
                    showToast('error', errorMsg);
                }
            },
            error: function(xhr) {
                let errorMessage = 'An error occurred during login';
                if (xhr.status === 0) {
                    errorMessage = 'Network error - please check your connection';
                } else if (xhr.status === 401) {
                    errorMessage = 'Invalid email or password';
                } else if (xhr.responseJSON && xhr.responseJSON.message) {
                    errorMessage = xhr.responseJSON.message;
                } else if (xhr.statusText) {
                    errorMessage = xhr.statusText;
                }
                showToast('error', errorMessage);
            },
            complete: function() {
                $submitBtn.prop('disabled', false);
                $('#login-submit-text').show();
                $('#login-submit-spinner').hide();
            }
        });
    } catch (error) {
        console.error('Login error:', error);
        showToast('error', 'An unexpected error occurred');
        $('#login-submit').prop('disabled', false);
        $('#login-submit-text').show();
        $('#login-submit-spinner').hide();
    }
}

// Complete login after successful authentication
function completeLogin(data) {
    try {
        if (!data || !data.accessToken || !data.refreshToken) {
            throw new Error('Invalid login response');
        }
        
        adminAuthToken = data.accessToken;
        adminRefreshToken = data.refreshToken;
        
        // Store tokens securely
        if ($('#login-remember').is(':checked')) {
            localStorage.setItem('adminAuthToken', adminAuthToken);
            localStorage.setItem('adminRefreshToken', adminRefreshToken);
        } else {
            sessionStorage.setItem('adminAuthToken', adminAuthToken);
            sessionStorage.setItem('adminRefreshToken', adminRefreshToken);
        }
        
        // Clear sensitive data from DOM
        $('#login-password').val('');
        
        verifyAdminToken();
    } catch (error) {
        console.error('Complete login error:', error);
        showToast('error', 'Failed to complete login');
    }
}

// Show 2FA modal
function show2FAModal() {
    try {
        $('#admin-2fa-modal').addClass('active');
        // Clear any existing codes
        $('#admin-2fa-modal input').val('');
        // Focus first input
        $('#admin-2fa-modal input').first().focus();
    } catch (error) {
        console.error('2FA modal error:', error);
        showToast('error', 'Failed to initialize 2FA verification');
    }
}

// Verify 2FA code
function verify2FACode() {
    try {
        const code = Array.from($('#admin-2fa-modal input')).map(input => input.value).join('');
        
        if (code.length !== 6 || !/^\d+$/.test(code)) {
            showToast('error', 'Please enter a valid 6-digit code');
            return;
        }
        
        const email = $('#login-email').val().trim();
        if (!email || !isValidEmail(email)) {
            showToast('error', 'Invalid email address');
            return;
        }
        
        const $verifyBtn = $('#verify-2fa-btn');
        $verifyBtn.prop('disabled', true);
        $('#verify-2fa-text').hide();
        $('#verify-2fa-spinner').show();
        
        $.ajax({
            url: 'https://website-backendd-1.onrender.com/api/admin/auth/verify-2fa',
            type: 'POST',
            data: JSON.stringify({
                email: email,
                code: code
            }),
            contentType: 'application/json',
            timeout: 10000, // 10 seconds timeout
            success: function(response) {
                if (response && response.success) {
                    completeLogin(response.data);
                    $('#admin-2fa-modal').removeClass('active');
                } else {
                    const errorMsg = (response && response.message) ? response.message : 'Invalid verification code';
                    showToast('error', errorMsg);
                }
            },
            error: function(xhr) {
                let errorMessage = 'An error occurred during verification';
                if (xhr.status === 0) {
                    errorMessage = 'Network error - please check your connection';
                } else if (xhr.responseJSON && xhr.responseJSON.message) {
                    errorMessage = xhr.responseJSON.message;
                } else if (xhr.statusText) {
                    errorMessage = xhr.statusText;
                }
                showToast('error', errorMessage);
            },
            complete: function() {
                $verifyBtn.prop('disabled', false);
                $('#verify-2fa-text').show();
                $('#verify-2fa-spinner').hide();
            }
        });
    } catch (error) {
        console.error('2FA verification error:', error);
        showToast('error', 'An unexpected error occurred during verification');
        $('#verify-2fa-btn').prop('disabled', false);
        $('#verify-2fa-text').show();
        $('#verify-2fa-spinner').hide();
    }
}

// Helper function to validate email format
function isValidEmail(email) {
    const re = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    return re.test(String(email).toLowerCase());
}
        // Admin logout function
        function adminLogout() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/logout',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: {
                    refreshToken: adminRefreshToken
                },
                success: function() {
                    showLoginPage();
                },
                error: function() {
                    showLoginPage();
                }
            });
        }
        
        // Connect to WebSocket for real-time updates
        function connectWebSocket() {
            if (socket) {
                socket.disconnect();
            }
            
            socket = io('https://website-backendd-1.onrender.com', {
                auth: {
                    token: adminAuthToken
                }
            });
            
            socket.on('connect', () => {
                console.log('Connected to WebSocket');
            });
            
            socket.on('disconnect', () => {
                console.log('Disconnected from WebSocket');
            });
            
            socket.on('error', (error) => {
                console.error('WebSocket error:', error);
            });
            
            socket.on('newDeposit', (data) => {
                showToast('info', `New deposit: $${data.amount} from ${data.userEmail}`);
                updateNotificationCount();
                
                if ($('#admin-content').data('section') === 'deposits') {
                    loadDeposits();
                }
            });
            
            socket.on('newWithdrawal', (data) => {
                showToast('info', `New withdrawal request: $${data.amount} from ${data.userEmail}`);
                updateNotificationCount();
                
                if ($('#admin-content').data('section') === 'withdrawals') {
                    loadWithdrawals();
                }
            });
            
            socket.on('newSupportTicket', (data) => {
                showToast('info', `New support ticket from ${data.userEmail}: ${data.subject}`);
                updateNotificationCount();
                
                if ($('#admin-content').data('section') === 'support') {
                    loadSupportTickets();
                }
            });
            
            socket.on('newChatMessage', (data) => {
                if (data.userId !== 'admin') {
                    addChatMessage(data);
                    updateNotificationCount();
                    
                    if (!$('#admin-chat-widget').hasClass('active')) {
                        // Flash chat icon or show indicator
                    }
                }
            });
            
            socket.on('notification', (data) => {
                showToast(data.type || 'info', data.message);
                updateNotificationCount();
            });
        }
        
        // Load dashboard content
        function loadDashboardContent() {
            loadSectionContent('dashboard');
        }
        
        // Load section content
        function loadSectionContent(section) {
            $('#admin-content').html('<div style="text-align: center; padding: 50px;"><div class="admin-loading"></div><p>Loading content...</p></div>');
            $('#admin-content').data('section', section);
            
            switch (section) {
                case 'dashboard':
                    loadDashboardStats();
                    loadRecentActivities();
                    break;
                case 'users-all':
                    loadAllUsers();
                    break;
                case 'users-active':
                    loadActiveUsers();
                    break;
                case 'users-suspended':
                    loadSuspendedUsers();
                    break;
                case 'users-kyc':
                    loadKYCUsers();
                    break;
                case 'transactions':
                    loadAllTransactions();
                    break;
                case 'deposits':
                    loadDeposits();
                    break;
                case 'withdrawals':
                    loadWithdrawals();
                    break;
                case 'balances':
                    loadUserBalances();
                    break;
                case 'investments-all':
                    loadAllInvestments();
                    break;
                case 'investments-active':
                    loadActiveInvestments();
                    break;
                case 'investments-plans':
                    loadInvestmentPlans();
                    break;
                case 'investments-profits':
                    loadProfitHistory();
                    break;
                case 'support':
                    loadSupportTickets();
                    break;
                case 'notifications':
                    loadNotifications();
                    break;
                case 'settings-general':
                    loadGeneralSettings();
                    break;
                case 'settings-security':
                    loadSecuritySettings();
                    break;
                case 'settings-email':
                    loadEmailSettings();
                    break;
                case 'settings-payment':
                    loadPaymentSettings();
                    break;
                case 'reports':
                    loadReports();
                    break;
                default:
                    $('#admin-content').html('<div class="admin-card"><h3>Section not implemented yet</h3></div>');
            }
        }
        
        // Load dashboard stats
        function loadDashboardStats() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/stats',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderDashboardStats(response.data);
                    } else {
                        showToast('error', response.message || 'Failed to load dashboard stats');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to load dashboard stats');
                }
            });
        }
        
        // Render dashboard stats
        function renderDashboardStats(data) {
            let html = `
                <div class="admin-stats-grid">
                    <div class="admin-stat-card">
                        <div class="admin-stat-card-header">
                            <h3 class="admin-stat-card-title">Total Users</h3>
                            <div class="admin-stat-card-icon users">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <h2 class="admin-stat-card-value">${data.totalUsers.toLocaleString()}</h2>
                        <p class="admin-stat-card-change ${data.usersChange >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-${data.usersChange >= 0 ? 'arrow-up' : 'arrow-down'}"></i>
                            ${Math.abs(data.usersChange)}% from last week
                        </p>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-card-header">
                            <h3 class="admin-stat-card-title">Total Deposits</h3>
                            <div class="admin-stat-card-icon deposits">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                        <h2 class="admin-stat-card-value">$${data.totalDeposits.toLocaleString()}</h2>
                        <p class="admin-stat-card-change ${data.depositsChange >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-${data.depositsChange >= 0 ? 'arrow-up' : 'arrow-down'}"></i>
                            ${Math.abs(data.depositsChange)}% from last week
                        </p>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-card-header">
                            <h3 class="admin-stat-card-title">Total Withdrawals</h3>
                            <div class="admin-stat-card-icon withdrawals">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                        <h2 class="admin-stat-card-value">$${data.totalWithdrawals.toLocaleString()}</h2>
                        <p class="admin-stat-card-change ${data.withdrawalsChange >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-${data.withdrawalsChange >= 0 ? 'arrow-up' : 'arrow-down'}"></i>
                            ${Math.abs(data.withdrawalsChange)}% from last week
                        </p>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-card-header">
                            <h3 class="admin-stat-card-title">Total Profit</h3>
                            <div class="admin-stat-card-icon profit">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <h2 class="admin-stat-card-value">$${data.totalProfit.toLocaleString()}</h2>
                        <p class="admin-stat-card-change ${data.profitChange >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-${data.profitChange >= 0 ? 'arrow-up' : 'arrow-down'}"></i>
                            ${Math.abs(data.profitChange)}% from last week
                        </p>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Load charts after stats are rendered
            loadDashboardCharts();
        }
        
        // Load dashboard charts
        function loadDashboardCharts() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/stats/charts',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderDashboardCharts(response.data);
                    }
                }
            });
        }
        
        // Render dashboard charts
        function renderDashboardCharts(data) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">User Growth</h3>
                    </div>
                    <canvas id="userGrowthChart" height="300"></canvas>
                </div>
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">Financial Overview</h3>
                    </div>
                    <canvas id="financialChart" height="300"></canvas>
                </div>
            `;
            
            $('#admin-content').append(html);
            
            // User Growth Chart
            const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
            new Chart(userGrowthCtx, {
                type: 'line',
                data: {
                    labels: data.userGrowth.labels,
                    datasets: [{
                        label: 'New Users',
                        data: data.userGrowth.data,
                        backgroundColor: 'rgba(0, 211, 149, 0.1)',
                        borderColor: 'rgba(0, 211, 149, 1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(142, 142, 142, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(142, 142, 142, 1)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(142, 142, 142, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(142, 142, 142, 1)'
                            }
                        }
                    }
                }
            });
            
            // Financial Overview Chart
            const financialCtx = document.getElementById('financialChart').getContext('2d');
            new Chart(financialCtx, {
                type: 'bar',
                data: {
                    labels: data.financialOverview.labels,
                    datasets: [
                        {
                            label: 'Deposits',
                            data: data.financialOverview.deposits,
                            backgroundColor: 'rgba(0, 211, 149, 0.7)',
                            borderColor: 'rgba(0, 211, 149, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Withdrawals',
                            data: data.financialOverview.withdrawals,
                            backgroundColor: 'rgba(255, 61, 87, 0.7)',
                            borderColor: 'rgba(255, 61, 87, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(142, 142, 142, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(142, 142, 142, 1)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(142, 142, 142, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(142, 142, 142, 1)'
                            }
                        }
                    }
                }
            });
            
            // Load recent activities after charts
            loadRecentActivities();
        }
        
        // Load recent activities
        function loadRecentActivities() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/activities',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderRecentActivities(response.data);
                    }
                }
            });
        }
        
        // Render recent activities
        function renderRecentActivities(activities) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">Recent Activities</h3>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="activitiesTable">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Activity</th>
                                    <th>Details</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            activities.forEach(activity => {
                html += `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${activity.userAvatar || 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1'}" 
                                     alt="${activity.userName}" 
                                     style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
                                <div>
                                    <div>${activity.userName}</div>
                                    <small class="text-muted">${activity.userEmail}</small>
                                </div>
                            </div>
                        </td>
                        <td>${activity.type}</td>
                        <td>${activity.details}</td>
                        <td>${new Date(activity.timestamp).toLocaleString()}</td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            $('#admin-content').append(html);
            
            // Initialize DataTable
            $('#activitiesTable').DataTable({
                responsive: true,
                order: [[3, 'desc']],
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search activities..."
                }
            });
        }
        
        // Load all users
        function loadAllUsers() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderUsersTable(response.data.users, 'All Users');
                    } else {
                        showToast('error', response.message || 'Failed to load users');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to load users');
                }
            });
        }
        
        // Load active users
        function loadActiveUsers() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users?status=active',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderUsersTable(response.data.users, 'Active Users');
                    }
                }
            });
        }
        
        // Load suspended users
        function loadSuspendedUsers() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users?status=suspended',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderUsersTable(response.data.users, 'Suspended Users');
                    }
                }
            });
        }
        
        // Load KYC users
        function loadKYCUsers() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users?kyc=pending',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderKYCUsersTable(response.data.users);
                    }
                }
            });
        }
        
        // Render users table
        function renderUsersTable(users, title) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">${title}</h3>
                        <div class="admin-card-actions">
                            <button class="admin-btn admin-btn-primary admin-btn-sm" id="addUserBtn">
                                <i class="fas fa-plus"></i> Add User
                            </button>
                            <button class="admin-btn admin-btn-secondary admin-btn-sm" id="exportUsersBtn">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="usersTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Email</th>
                                    <th>Balance</th>
                                    <th>Status</th>
                                    <th>KYC</th>
                                    <th>Joined</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            users.forEach(user => {
                let statusBadge = '';
                if (user.status === 'active') {
                    statusBadge = '<span class="admin-badge admin-badge-success">Active</span>';
                } else if (user.status === 'suspended') {
                    statusBadge = '<span class="admin-badge admin-badge-danger">Suspended</span>';
                } else if (user.status === 'pending') {
                    statusBadge = '<span class="admin-badge admin-badge-warning">Pending</span>';
                }
                
                let kycBadge = '';
                if (user.kycStatus === 'verified') {
                    kycBadge = '<span class="admin-badge admin-badge-success">Verified</span>';
                } else if (user.kycStatus === 'pending') {
                    kycBadge = '<span class="admin-badge admin-badge-warning">Pending</span>';
                } else if (user.kycStatus === 'rejected') {
                    kycBadge = '<span class="admin-badge admin-badge-danger">Rejected</span>';
                } else {
                    kycBadge = '<span class="admin-badge admin-badge-secondary">Not Submitted</span>';
                }
                
                html += `
                    <tr>
                        <td>${user.userId}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${user.avatar || 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1'}" 
                                     alt="${user.firstName} ${user.lastName}" 
                                     style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
                                <div>
                                    <div>${user.firstName} ${user.lastName}</div>
                                    <small class="text-muted">${user.country || 'N/A'}</small>
                                </div>
                            </div>
                        </td>
                        <td>${user.email}</td>
                        <td>$${user.balance.toFixed(2)}</td>
                        <td>${statusBadge}</td>
                        <td>${kycBadge}</td>
                        <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                        <td>
                            <button class="admin-btn admin-btn-primary admin-btn-sm edit-user" data-id="${user.userId}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="admin-btn admin-btn-${user.status === 'suspended' ? 'success' : 'danger'} admin-btn-sm toggle-user-status" data-id="${user.userId}" data-status="${user.status}">
                                <i class="fas fa-${user.status === 'suspended' ? 'check' : 'ban'}"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Initialize DataTable
            $('#usersTable').DataTable({
                responsive: true,
                dom: '<"top"fB>rt<"bottom"lip><"clear">',
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        className: 'admin-btn admin-btn-success admin-btn-sm'
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i> PDF',
                        className: 'admin-btn admin-btn-danger admin-btn-sm'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i> Print',
                        className: 'admin-btn admin-btn-secondary admin-btn-sm'
                    }
                ],
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search users..."
                }
            });
            
            // Add event listeners for user actions
            $('.edit-user').on('click', function() {
                const userId = $(this).data('id');
                showUserModal(userId);
            });
            
            $('.toggle-user-status').on('click', function() {
                const userId = $(this).data('id');
                const currentStatus = $(this).data('status');
                const newStatus = currentStatus === 'suspended' ? 'active' : 'suspended';
                
                toggleUserStatus(userId, newStatus);
            });
            
            // Add user button
            $('#addUserBtn').on('click', function() {
                showUserModal('new');
            });
            
            // Export users button
            $('#exportUsersBtn').on('click', function() {
                exportUsers();
            });
        }
        
        // Render KYC users table
        function renderKYCUsersTable(users) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">KYC Verification Requests</h3>
                        <div class="admin-card-actions">
                            <button class="admin-btn admin-btn-secondary admin-btn-sm" id="exportKYCBtn">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="kycTable">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Email</th>
                                    <th>Document Type</th>
                                    <th>Submitted</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            users.forEach(user => {
                html += `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${user.avatar || 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1'}" 
                                     alt="${user.firstName} ${user.lastName}" 
                                     style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
                                <div>
                                    <div>${user.firstName} ${user.lastName}</div>
                                    <small class="text-muted">${user.country || 'N/A'}</small>
                                </div>
                            </div>
                        </td>
                        <td>${user.email}</td>
                        <td>${user.kycDocumentType || 'N/A'}</td>
                        <td>${new Date(user.kycSubmittedAt).toLocaleDateString()}</td>
                        <td>
                            <span class="admin-badge admin-badge-warning">Pending</span>
                        </td>
                        <td>
                            <button class="admin-btn admin-btn-primary admin-btn-sm view-kyc" data-id="${user.userId}">
                                <i class="fas fa-eye"></i> Review
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Initialize DataTable
            $('#kycTable').DataTable({
                responsive: true,
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search KYC requests..."
                }
            });
            
            // Add event listeners for KYC actions
            $('.view-kyc').on('click', function() {
                const userId = $(this).data('id');
                reviewKYCDocument(userId);
            });
            
            // Export KYC button
            $('#exportKYCBtn').on('click', function() {
                exportKYCRequests();
            });
        }
        
        // Show user modal
        function showUserModal(userId) {
            if (userId === 'new') {
                // Prepare modal for new user
                $('#user-modal-title').text('Add New User');
                $('#admin-user-form')[0].reset();
                $('#user-id').val('Auto-generated');
                $('#user-status').val('active');
                $('#user-kyc').val('unverified');
                $('#admin-user-modal').addClass('active');
            } else {
                // Load user data
                $.ajax({
                    url: `https://website-backendd-1.onrender.com/api/admin/users/${userId}`,
                    type: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + adminAuthToken
                    },
                    success: function(response) {
                        if (response.success) {
                            const user = response.data;
                            $('#user-modal-title').text(`Edit User: ${user.firstName} ${user.lastName}`);
                            
                            // Fill form with user data
                            $('#user-id').val(user.userId);
                            $('#user-email').val(user.email);
                            $('#user-firstname').val(user.firstName);
                            $('#user-lastname').val(user.lastName);
                            $('#user-phone').val(user.phone || '');
                            $('#user-status').val(user.status);
                            $('#user-kyc').val(user.kycStatus);
                            $('#user-balance').val(user.balance.toFixed(2));
                            $('#user-invested').val(user.totalInvested.toFixed(2));
                            $('#user-earnings').val(user.totalEarnings.toFixed(2));
                            $('#user-referrals').val(user.referralCount || 0);
                            $('#user-ip').val(user.lastIp || 'N/A');
                            $('#user-joined').val(new Date(user.createdAt).toLocaleString());
                            
                            $('#admin-user-modal').addClass('active');
                        } else {
                            showToast('error', response.message || 'Failed to load user data');
                        }
                    },
                    error: function() {
                        showToast('error', 'Failed to load user data');
                    }
                });
            }
        }
        
        // Save user changes
        function saveUserChanges() {
            const userId = $('#user-id').val();
            const isNewUser = userId === 'Auto-generated';
            
            const userData = {
                email: $('#user-email').val().trim(),
                firstName: $('#user-firstname').val().trim(),
                lastName: $('#user-lastname').val().trim(),
                phone: $('#user-phone').val().trim(),
                status: $('#user-status').val(),
                kycStatus: $('#user-kyc').val(),
                balance: parseFloat($('#user-balance').val()) || 0
            };
            
            if (!userData.email || !userData.firstName || !userData.lastName) {
                showToast('error', 'Please fill in all required fields');
                return;
            }
            
            const url = isNewUser 
                ? 'https://website-backendd-1.onrender.com/api/admin/users'
                : `https://website-backendd-1.onrender.com/api/admin/users/${userId}`;
            
            const method = isNewUser ? 'POST' : 'PUT';
            
            $.ajax({
                url: url,
                type: method,
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: userData,
                success: function(response) {
                    if (response.success) {
                        showToast('success', isNewUser ? 'User created successfully' : 'User updated successfully');
                        $('#admin-user-modal').removeClass('active');
                        
                        // Reload the current section
                        const currentSection = $('#admin-content').data('section');
                        loadSectionContent(currentSection);
                    } else {
                        showToast('error', response.message || 'Failed to save user');
                    }
                },
                error: function(xhr) {
                    const errorMessage = xhr.responseJSON?.message || 'Failed to save user';
                    showToast('error', errorMessage);
                }
            });
        }
        
        // Toggle user status
        function toggleUserStatus(userId, newStatus) {
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/users/${userId}/status`,
                type: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: {
                    status: newStatus
                },
                success: function(response) {
                    if (response.success) {
                        showToast('success', `User status updated to ${newStatus}`);
                        
                        // Reload the current section
                        const currentSection = $('#admin-content').data('section');
                        loadSectionContent(currentSection);
                    } else {
                        showToast('error', response.message || 'Failed to update user status');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to update user status');
                }
            });
        }
        
        // Review KYC document
        function reviewKYCDocument(userId) {
            // In a real implementation, this would open a modal with the KYC documents
            // and options to approve or reject the KYC request
            showToast('info', `Reviewing KYC documents for user ${userId}`);
            
            // For demo purposes, we'll show a simple modal with approve/reject buttons
            const modalHtml = `
                <div class="admin-modal active" id="kyc-review-modal">
                    <div class="admin-modal-content" style="max-width: 800px;">
                        <div class="admin-modal-header">
                            <h3 class="admin-modal-title">Review KYC Documents</h3>
                            <button class="admin-modal-close" id="kyc-modal-close">&times;</button>
                        </div>
                        <div class="admin-modal-body">
                            <div style="text-align: center; margin-bottom: 20px;">
                                <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" 
                                     style="max-width: 100%; border: 1px solid var(--gray-light);">
                            </div>
                            <div class="admin-form-group">
                                <label for="kyc-notes" class="admin-form-label">Review Notes</label>
                                <textarea id="kyc-notes" class="admin-form-control admin-form-textarea" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="admin-modal-footer">
                            <button class="admin-btn admin-btn-danger" id="kyc-reject-btn">Reject</button>
                            <button class="admin-btn admin-btn-success" id="kyc-approve-btn">Approve</button>
                        </div>
                    </div>
                </div>
            `;
            
            $('body').append(modalHtml);
            
            // Add event listeners for the modal
            $('#kyc-modal-close').on('click', function() {
                $('#kyc-review-modal').remove();
            });
            
            $('#kyc-reject-btn').on('click', function() {
                updateKYCStatus(userId, 'rejected', $('#kyc-notes').val());
            });
            
            $('#kyc-approve-btn').on('click', function() {
                updateKYCStatus(userId, 'verified', $('#kyc-notes').val());
            });
        }
        
        // Update KYC status
        function updateKYCStatus(userId, status, notes) {
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/users/${userId}/kyc`,
                type: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: {
                    status: status,
                    notes: notes
                },
                success: function(response) {
                    if (response.success) {
                        showToast('success', `KYC status updated to ${status}`);
                        $('#kyc-review-modal').remove();
                        
                        // Reload the KYC section
                        loadSectionContent('users-kyc');
                    } else {
                        showToast('error', response.message || 'Failed to update KYC status');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to update KYC status');
                }
            });
        }
        
        // Export users
        function exportUsers() {
            // This would trigger the DataTable export functionality
            $('#usersTable').DataTable().button('.buttons-excel').trigger();
        }
        
        // Export KYC requests
        function exportKYCRequests() {
            // This would trigger the DataTable export functionality
            $('#kycTable').DataTable().button('.buttons-excel').trigger();
        }
        
        // Load all transactions
        function loadAllTransactions() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/transactions',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderTransactionsTable(response.data.transactions, 'All Transactions');
                    }
                }
            });
        }
        
        // Load deposits
        function loadDeposits() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/transactions?type=deposit',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderTransactionsTable(response.data.transactions, 'Deposit Transactions');
                    }
                }
            });
        }
        
        // Load withdrawals
        function loadWithdrawals() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/transactions?type=withdrawal',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderWithdrawalsTable(response.data.transactions);
                    }
                }
            });
        }
        
        // Render transactions table
        function renderTransactionsTable(transactions, title) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">${title}</h3>
                        <div class="admin-card-actions">
                            <button class="admin-btn admin-btn-secondary admin-btn-sm" id="exportTransactionsBtn">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="transactionsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Fee</th>
                                    <th>Method</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            transactions.forEach(tx => {
                let statusBadge = '';
                if (tx.status === 'completed') {
                    statusBadge = '<span class="admin-badge admin-badge-success">Completed</span>';
                } else if (tx.status === 'pending') {
                    statusBadge = '<span class="admin-badge admin-badge-warning">Pending</span>';
                } else if (tx.status === 'failed') {
                    statusBadge = '<span class="admin-badge admin-badge-danger">Failed</span>';
                } else if (tx.status === 'cancelled') {
                    statusBadge = '<span class="admin-badge admin-badge-secondary">Cancelled</span>';
                }
                
                let typeBadge = '';
                if (tx.type === 'deposit') {
                    typeBadge = '<span class="admin-badge admin-badge-success">Deposit</span>';
                } else if (tx.type === 'withdrawal') {
                    typeBadge = '<span class="admin-badge admin-badge-danger">Withdrawal</span>';
                } else if (tx.type === 'investment') {
                    typeBadge = '<span class="admin-badge admin-badge-info">Investment</span>';
                } else if (tx.type === 'profit') {
                    typeBadge = '<span class="admin-badge admin-badge-primary">Profit</span>';
                }
                
                html += `
                    <tr>
                        <td>${tx.transactionId}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${tx.userAvatar || 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1'}" 
                                     alt="${tx.userName}" 
                                     style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
                                <div>
                                    <div>${tx.userName}</div>
                                    <small class="text-muted">${tx.userEmail}</small>
                                </div>
                            </div>
                        </td>
                        <td>${typeBadge}</td>
                        <td>$${tx.amount.toFixed(2)}</td>
                        <td>$${tx.fee?.toFixed(2) || '0.00'}</td>
                        <td>${tx.method || 'N/A'}</td>
                        <td>${statusBadge}</td>
                        <td>${new Date(tx.createdAt).toLocaleString()}</td>
                        <td>
                            <button class="admin-btn admin-btn-primary admin-btn-sm view-transaction" data-id="${tx.transactionId}">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Initialize DataTable
            $('#transactionsTable').DataTable({
                responsive: true,
                dom: '<"top"fB>rt<"bottom"lip><"clear">',
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        className: 'admin-btn admin-btn-success admin-btn-sm'
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i> PDF',
                        className: 'admin-btn admin-btn-danger admin-btn-sm'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i> Print',
                        className: 'admin-btn admin-btn-secondary admin-btn-sm'
                    }
                ],
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search transactions..."
                }
            });
            
            // Add event listeners for transaction actions
            $('.view-transaction').on('click', function() {
                const txId = $(this).data('id');
                showTransactionModal(txId);
            });
            
            // Export transactions button
            $('#exportTransactionsBtn').on('click', function() {
                exportTransactions();
            });
        }
        
        // Render withdrawals table
        function renderWithdrawalsTable(withdrawals) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">Withdrawal Requests</h3>
                        <div class="admin-card-actions">
                            <button class="admin-btn admin-btn-secondary admin-btn-sm" id="exportWithdrawalsBtn">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="withdrawalsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Amount</th>
                                    <th>Fee</th>
                                    <th>Wallet</th>
                                    <th>Status</th>
                                    <th>Requested</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            withdrawals.forEach(wd => {
                let statusBadge = '';
                if (wd.status === 'completed') {
                    statusBadge = '<span class="admin-badge admin-badge-success">Completed</span>';
                } else if (wd.status === 'pending') {
                    statusBadge = '<span class="admin-badge admin-badge-warning">Pending</span>';
                } else if (wd.status === 'processing') {
                    statusBadge = '<span class="admin-badge admin-badge-info">Processing</span>';
                } else if (wd.status === 'rejected') {
                    statusBadge = '<span class="admin-badge admin-badge-danger">Rejected</span>';
                }
                
                html += `
                    <tr>
                        <td>${wd.withdrawalId}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${wd.userAvatar || 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1'}" 
                                     alt="${wd.userName}" 
                                     style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
                                <div>
                                    <div>${wd.userName}</div>
                                    <small class="text-muted">${wd.userEmail}</small>
                                </div>
                            </div>
                        </td>
                        <td>$${wd.amount.toFixed(2)}</td>
                        <td>$${wd.fee?.toFixed(2) || '0.00'}</td>
                        <td>
                            <small>${wd.walletAddress}</small>
                        </td>
                        <td>${statusBadge}</td>
                        <td>${new Date(wd.createdAt).toLocaleString()}</td>
                        <td>
                            <button class="admin-btn admin-btn-primary admin-btn-sm process-withdrawal" data-id="${wd.withdrawalId}">
                                <i class="fas fa-cog"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Initialize DataTable
            $('#withdrawalsTable').DataTable({
                responsive: true,
                dom: '<"top"fB>rt<"bottom"lip><"clear">',
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        className: 'admin-btn admin-btn-success admin-btn-sm'
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i> PDF',
                        className: 'admin-btn admin-btn-danger admin-btn-sm'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i> Print',
                        className: 'admin-btn admin-btn-secondary admin-btn-sm'
                    }
                ],
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search withdrawals..."
                }
            });
            
            // Add event listeners for withdrawal actions
            $('.process-withdrawal').on('click', function() {
                const wdId = $(this).data('id');
                showWithdrawalModal(wdId);
            });
            
            // Export withdrawals button
            $('#exportWithdrawalsBtn').on('click', function() {
                exportWithdrawals();
            });
        }
        
        // Show transaction modal
        function showTransactionModal(txId) {
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/transactions/${txId}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        const tx = response.data;
                        $('#transaction-modal-title').text(`Transaction: ${tx.transactionId}`);
                        
                        // Fill form with transaction data
                        $('#transaction-id').val(tx.transactionId);
                        $('#transaction-user').val(`${tx.userName} (${tx.userEmail})`);
                        $('#transaction-type').val(tx.type);
                        $('#transaction-amount').val(tx.amount.toFixed(2));
                        $('#transaction-fee').val(tx.fee?.toFixed(2) || '0.00');
                        $('#transaction-status').val(tx.status);
                        $('#transaction-method').val(tx.method || 'N/A');
                        $('#transaction-date').val(new Date(tx.createdAt).toLocaleString());
                        $('#transaction-details').val(tx.details || '');
                        
                        $('#admin-transaction-modal').addClass('active');
                    } else {
                        showToast('error', response.message || 'Failed to load transaction');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to load transaction');
                }
            });
        }
        
        // Save transaction changes
        function saveTransactionChanges() {
            const txId = $('#transaction-id').val();
            const txData = {
                fee: parseFloat($('#transaction-fee').val()) || 0,
                status: $('#transaction-status').val(),
                details: $('#transaction-details').val()
            };
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/transactions/${txId}`,
                type: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: txData,
                success: function(response) {
                    if (response.success) {
                        showToast('success', 'Transaction updated successfully');
                        $('#admin-transaction-modal').removeClass('active');
                        
                        // Reload the current section
                        const currentSection = $('#admin-content').data('section');
                        loadSectionContent(currentSection);
                    } else {
                        showToast('error', response.message || 'Failed to update transaction');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to update transaction');
                }
            });
        }
        
        // Show withdrawal modal
        function showWithdrawalModal(wdId) {
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/withdrawals/${wdId}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        const wd = response.data;
                        $('#withdrawal-modal-title').text(`Withdrawal: ${wd.withdrawalId}`);
                        
                        // Fill form with withdrawal data
                        $('#withdrawal-id').val(wd.withdrawalId);
                        $('#withdrawal-user').val(`${wd.userName} (${wd.userEmail})`);
                        $('#withdrawal-amount').val(wd.amount.toFixed(2));
                        $('#withdrawal-fee').val(wd.fee?.toFixed(2) || '0.00');
                        $('#withdrawal-wallet').val(wd.walletAddress);
                        $('#withdrawal-status').val(wd.status);
                        $('#withdrawal-date').val(new Date(wd.createdAt).toLocaleString());
                        $('#withdrawal-notes').val(wd.adminNotes || '');
                        
                        $('#admin-withdrawal-modal').addClass('active');
                    } else {
                        showToast('error', response.message || 'Failed to load withdrawal');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to load withdrawal');
                }
            });
        }
        
        // Update withdrawal status
        function updateWithdrawalStatus(status) {
            const wdId = $('#withdrawal-id').val();
            const notes = $('#withdrawal-notes').val();
            const fee = parseFloat($('#withdrawal-fee').val()) || 0;
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/withdrawals/${wdId}/status`,
                type: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: {
                    status: status,
                    adminNotes: notes,
                    fee: fee
                },
                success: function(response) {
                    if (response.success) {
                        showToast('success', `Withdrawal ${status} successfully`);
                        $('#admin-withdrawal-modal').removeClass('active');
                        
                        // Reload the withdrawals section
                        loadSectionContent('withdrawals');
                    } else {
                        showToast('error', response.message || `Failed to ${status} withdrawal`);
                    }
                },
                error: function() {
                    showToast('error', `Failed to ${status} withdrawal`);
                }
            });
        }
        
        // Export transactions
        function exportTransactions() {
            // This would trigger the DataTable export functionality
            $('#transactionsTable').DataTable().button('.buttons-excel').trigger();
        }
        
        // Export withdrawals
        function exportWithdrawals() {
            // This would trigger the DataTable export functionality
            $('#withdrawalsTable').DataTable().button('.buttons-excel').trigger();
        }
        
        // Load user balances
        function loadUserBalances() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users/balances',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderUserBalances(response.data.users);
                    }
                }
            });
        }
        
        // Render user balances
        function renderUserBalances(users) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">User Balances</h3>
                        <div class="admin-card-actions">
                            <button class="admin-btn admin-btn-primary admin-btn-sm" id="adjustBalanceBtn">
                                <i class="fas fa-plus"></i> Adjust Balance
                            </button>
                            <button class="admin-btn admin-btn-secondary admin-btn-sm" id="exportBalancesBtn">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="balancesTable">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Email</th>
                                    <th>Account Balance</th>
                                    <th>Invested</th>
                                    <th>Earnings</th>
                                    <th>Referral Bonus</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            users.forEach(user => {
                html += `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${user.avatar || 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1'}" 
                                     alt="${user.firstName} ${user.lastName}" 
                                     style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
                                <div>
                                    <div>${user.firstName} ${user.lastName}</div>
                                    <small class="text-muted">${user.country || 'N/A'}</small>
                                </div>
                            </div>
                        </td>
                        <td>${user.email}</td>
                        <td>$${user.balance.toFixed(2)}</td>
                        <td>$${user.totalInvested.toFixed(2)}</td>
                        <td>$${user.totalEarnings.toFixed(2)}</td>
                        <td>$${user.referralBonus?.toFixed(2) || '0.00'}</td>
                        <td>
                            <button class="admin-btn admin-btn-primary admin-btn-sm adjust-user-balance" data-id="${user.userId}">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Initialize DataTable
            $('#balancesTable').DataTable({
                responsive: true,
                dom: '<"top"fB>rt<"bottom"lip><"clear">',
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        className: 'admin-btn admin-btn-success admin-btn-sm'
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i> PDF',
                        className: 'admin-btn admin-btn-danger admin-btn-sm'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i> Print',
                        className: 'admin-btn admin-btn-secondary admin-btn-sm'
                    }
                ],
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search users..."
                }
            });
            
            // Add event listeners for balance actions
            $('.adjust-user-balance').on('click', function() {
                const userId = $(this).data('id');
                showUserModal(userId);
            });
            
            // Adjust balance button
            $('#adjustBalanceBtn').on('click', function() {
                showAdjustBalanceModal();
            });
            
            // Export balances button
            $('#exportBalancesBtn').on('click', function() {
                exportBalances();
            });
        }
        
        // Show adjust balance modal
        function showAdjustBalanceModal() {
            const modalHtml = `
                <div class="admin-modal active" id="adjust-balance-modal">
                    <div class="admin-modal-content">
                        <div class="admin-modal-header">
                            <h3 class="admin-modal-title">Adjust User Balance</h3>
                            <button class="admin-modal-close" id="balance-modal-close">&times;</button>
                        </div>
                        <div class="admin-modal-body">
                            <form id="adjust-balance-form">
                                <div class="admin-form-group">
                                    <label for="balance-user" class="admin-form-label">Select User</label>
                                    <select id="balance-user" class="admin-form-control admin-form-select">
                                        <option value="">Select a user</option>
                                        <!-- Users will be loaded dynamically -->
                                    </select>
                                </div>
                                <div class="admin-form-group">
                                    <label for="balance-type" class="admin-form-label">Adjustment Type</label>
                                    <select id="balance-type" class="admin-form-control admin-form-select">
                                        <option value="add">Add Funds</option>
                                        <option value="subtract">Subtract Funds</option>
                                        <option value="set">Set Exact Amount</option>
                                    </select>
                                </div>
                                <div class="admin-form-group">
                                    <label for="balance-amount" class="admin-form-label">Amount (USD)</label>
                                    <input type="number" id="balance-amount" class="admin-form-control" step="0.01" min="0" required>
                                </div>
                                <div class="admin-form-group">
                                    <label for="balance-reason" class="admin-form-label">Reason</label>
                                    <input type="text" id="balance-reason" class="admin-form-control" required>
                                </div>
                                <div class="admin-form-group">
                                    <label for="balance-notes" class="admin-form-label">Notes</label>
                                    <textarea id="balance-notes" class="admin-form-control admin-form-textarea" rows="3"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="admin-modal-footer">
                            <button class="admin-btn admin-btn-secondary" id="balance-modal-cancel">Cancel</button>
                            <button class="admin-btn admin-btn-primary" id="balance-modal-save">Save Changes</button>
                        </div>
                    </div>
                </div>
            `;
            
            $('body').append(modalHtml);
            
            // Load users for the select dropdown
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        const $select = $('#balance-user');
                        response.data.users.forEach(user => {
                            $select.append(`<option value="${user.userId}">${user.email} (${user.firstName} ${user.lastName})</option>`);
                        });
                        
                        // Initialize Select2
                        $select.select2({
                            dropdownParent: $('#adjust-balance-modal .admin-modal-content'),
                            width: '100%'
                        });
                    }
                }
            });
            
            // Add event listeners for the modal
            $('#balance-modal-close, #balance-modal-cancel').on('click', function() {
                $('#adjust-balance-modal').remove();
            });
            
            $('#balance-modal-save').on('click', function() {
                adjustUserBalance();
            });
        }
        
        // Adjust user balance
        function adjustUserBalance() {
            const userId = $('#balance-user').val();
            const type = $('#balance-type').val();
            const amount = parseFloat($('#balance-amount').val());
            const reason = $('#balance-reason').val().trim();
            const notes = $('#balance-notes').val().trim();
            
            if (!userId || !amount || !reason) {
                showToast('error', 'Please fill in all required fields');
                return;
            }
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/users/${userId}/balance`,
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: {
                    type: type,
                    amount: amount,
                    reason: reason,
                    notes: notes
                },
                success: function(response) {
                    if (response.success) {
                        showToast('success', 'User balance adjusted successfully');
                        $('#adjust-balance-modal').remove();
                        
                        // Reload the balances section
                        loadSectionContent('balances');
                    } else {
                        showToast('error', response.message || 'Failed to adjust balance');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to adjust balance');
                }
            });
        }
        
        // Export balances
        function exportBalances() {
            // This would trigger the DataTable export functionality
            $('#balancesTable').DataTable().button('.buttons-excel').trigger();
        }
        
        // Load all investments
        function loadAllInvestments() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/investments',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderInvestmentsTable(response.data.investments, 'All Investments');
                    }
                }
            });
        }
        
        // Load active investments
        function loadActiveInvestments() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/investments?status=active',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderInvestmentsTable(response.data.investments, 'Active Investments');
                    }
                }
            });
        }
        
        // Load investment plans
        function loadInvestmentPlans() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/investment/plans',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderInvestmentPlansTable(response.data.plans);
                    }
                }
            });
        }
        
        // Load profit history
        function loadProfitHistory() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/investments/profits',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderProfitHistory(response.data.profits);
                    }
                }
            });
        }
        
        // Render investments table
        function renderInvestmentsTable(investments, title) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">${title}</h3>
                        <div class="admin-card-actions">
                            <button class="admin-btn admin-btn-secondary admin-btn-sm" id="exportInvestmentsBtn">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="investmentsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Plan</th>
                                    <th>Amount</th>
                                    <th>Daily Profit</th>
                                    <th>Total Earned</th>
                                    <th>Status</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            investments.forEach(inv => {
                let statusBadge = '';
                if (inv.status === 'active') {
                    statusBadge = '<span class="admin-badge admin-badge-success">Active</span>';
                } else if (inv.status === 'completed') {
                    statusBadge = '<span class="admin-badge admin-badge-info">Completed</span>';
                } else if (inv.status === 'cancelled') {
                    statusBadge = '<span class="admin-badge admin-badge-danger">Cancelled</span>';
                }
                
                html += `
                    <tr>
                        <td>${inv.investmentId}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${inv.userAvatar || 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1'}" 
                                     alt="${inv.userName}" 
                                     style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
                                <div>
                                    <div>${inv.userName}</div>
                                    <small class="text-muted">${inv.userEmail}</small>
                                </div>
                            </div>
                        </td>
                        <td>${inv.planName}</td>
                        <td>$${inv.amount.toFixed(2)}</td>
                        <td>$${inv.dailyProfit.toFixed(2)} (${inv.dailyPercentage}%)</td>
                        <td>$${inv.totalEarned.toFixed(2)}</td>
                        <td>${statusBadge}</td>
                        <td>${new Date(inv.startDate).toLocaleDateString()}</td>
                        <td>${inv.endDate ? new Date(inv.endDate).toLocaleDateString() : 'N/A'}</td>
                        <td>
                            <button class="admin-btn admin-btn-primary admin-btn-sm view-investment" data-id="${inv.investmentId}">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Initialize DataTable
            $('#investmentsTable').DataTable({
                responsive: true,
                dom: '<"top"fB>rt<"bottom"lip><"clear">',
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        className: 'admin-btn admin-btn-success admin-btn-sm'
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i> PDF',
                        className: 'admin-btn admin-btn-danger admin-btn-sm'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i> Print',
                        className: 'admin-btn admin-btn-secondary admin-btn-sm'
                    }
                ],
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search investments..."
                }
            });
            
            // Add event listeners for investment actions
            $('.view-investment').on('click', function() {
                const invId = $(this).data('id');
                showInvestmentModal(invId);
            });
            
            // Export investments button
            $('#exportInvestmentsBtn').on('click', function() {
                exportInvestments();
            });
        }
        
        // Render investment plans table
        function renderInvestmentPlansTable(plans) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">Investment Plans</h3>
                        <div class="admin-card-actions">
                            <button class="admin-btn admin-btn-primary admin-btn-sm" id="addPlanBtn">
                                <i class="fas fa-plus"></i> Add Plan
                            </button>
                            <button class="admin-btn admin-btn-secondary admin-btn-sm" id="exportPlansBtn">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="plansTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Min Amount</th>
                                    <th>Max Amount</th>
                                    <th>Duration</th>
                                    <th>Daily Profit</th>
                                    <th>Total Return</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            plans.forEach(plan => {
                let statusBadge = '';
                if (plan.status === 'active') {
                    statusBadge = '<span class="admin-badge admin-badge-success">Active</span>';
                } else {
                    statusBadge = '<span class="admin-badge admin-badge-secondary">Inactive</span>';
                }
                
                html += `
                    <tr>
                        <td>${plan.planId}</td>
                        <td>${plan.name}</td>
                        <td>$${plan.minAmount.toFixed(2)}</td>
                        <td>${plan.maxAmount ? '$' + plan.maxAmount.toFixed(2) : 'Unlimited'}</td>
                        <td>${plan.duration} days</td>
                        <td>${plan.dailyProfit}%</td>
                        <td>${plan.totalReturn}%</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="admin-btn admin-btn-primary admin-btn-sm edit-plan" data-id="${plan.planId}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="admin-btn admin-btn-${plan.status === 'active' ? 'danger' : 'success'} admin-btn-sm toggle-plan-status" data-id="${plan.planId}" data-status="${plan.status}">
                                <i class="fas fa-${plan.status === 'active' ? 'times' : 'check'}"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Initialize DataTable
            $('#plansTable').DataTable({
                responsive: true,
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search plans..."
                }
            });
            
            // Add event listeners for plan actions
            $('.edit-plan').on('click', function() {
                const planId = $(this).data('id');
                showPlanModal(planId);
            });
            
            $('.toggle-plan-status').on('click', function() {
                const planId = $(this).data('id');
                const currentStatus = $(this).data('status');
                const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
                
                togglePlanStatus(planId, newStatus);
            });
            
            // Add plan button
            $('#addPlanBtn').on('click', function() {
                showPlanModal('new');
            });
            
            // Export plans button
            $('#exportPlansBtn').on('click', function() {
                exportPlans();
            });
        }
        
        // Show investment modal
        function showInvestmentModal(invId) {
            // In a real implementation, this would show detailed information about the investment
            showToast('info', `Showing details for investment ${invId}`);
        }
        
        // Show plan modal
        function showPlanModal(planId) {
            if (planId === 'new') {
                // Prepare modal for new plan
                $('#plan-modal-title').text('Add New Investment Plan');
                $('#admin-plan-form')[0].reset();
                $('#plan-id').val('Auto-generated');
                $('#plan-status').val('active');
                $('#plan-max').val('');
                $('#plan-description').val('');
                $('#admin-plan-modal').addClass('active');
            } else {
                // Load plan data
                $.ajax({
                    url: `https://website-backendd-1.onrender.com/api/admin/investment/plans/${planId}`,
                    type: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + adminAuthToken
                    },
                    success: function(response) {
                        if (response.success) {
                            const plan = response.data;
                            $('#plan-modal-title').text(`Edit Plan: ${plan.name}`);
                            
                            // Fill form with plan data
                            $('#plan-id').val(plan.planId);
                            $('#plan-name').val(plan.name);
                            $('#plan-min').val(plan.minAmount);
                            $('#plan-max').val(plan.maxAmount || '');
                            $('#plan-duration').val(plan.duration);
                            $('#plan-profit').val(plan.dailyProfit);
                            $('#plan-total').val(plan.totalReturn);
                            $('#plan-status').val(plan.status);
                            $('#plan-description').val(plan.description || '');
                            
                            $('#admin-plan-modal').addClass('active');
                        } else {
                            showToast('error', response.message || 'Failed to load plan');
                        }
                    },
                    error: function() {
                        showToast('error', 'Failed to load plan');
                    }
                });
            }
        }
        
        // Save plan changes
        function savePlanChanges() {
            const planId = $('#plan-id').val();
            const isNewPlan = planId === 'Auto-generated';
            
            const planData = {
                name: $('#plan-name').val().trim(),
                minAmount: parseFloat($('#plan-min').val()),
                maxAmount: $('#plan-max').val() ? parseFloat($('#plan-max').val()) : null,
                duration: parseInt($('#plan-duration').val()),
                dailyProfit: parseFloat($('#plan-profit').val()),
                status: $('#plan-status').val(),
                description: $('#plan-description').val().trim()
            };
            
            if (!planData.name || !planData.minAmount || !planData.duration || !planData.dailyProfit) {
                showToast('error', 'Please fill in all required fields');
                return;
            }
            
            // Calculate total return
            planData.totalReturn = planData.dailyProfit * planData.duration;
            $('#plan-total').val(planData.totalReturn);
            
            const url = isNewPlan 
                ? 'https://website-backendd-1.onrender.com/api/admin/investment/plans'
                : `https://website-backendd-1.onrender.com/api/admin/investment/plans/${planId}`;
            
            const method = isNewPlan ? 'POST' : 'PUT';
            
            $.ajax({
                url: url,
                type: method,
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: planData,
                success: function(response) {
                    if (response.success) {
                        showToast('success', isNewPlan ? 'Plan created successfully' : 'Plan updated successfully');
                        $('#admin-plan-modal').removeClass('active');
                        
                        // Reload the plans section
                        loadSectionContent('investments-plans');
                    } else {
                        showToast('error', response.message || 'Failed to save plan');
                    }
                },
                error: function(xhr) {
                    const errorMessage = xhr.responseJSON?.message || 'Failed to save plan';
                    showToast('error', errorMessage);
                }
            });
        }
        
        // Toggle plan status
        function togglePlanStatus(planId, newStatus) {
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/investment/plans/${planId}/status`,
                type: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: {
                    status: newStatus
                },
                success: function(response) {
                    if (response.success) {
                        showToast('success', `Plan status updated to ${newStatus}`);
                        
                        // Reload the plans section
                        loadSectionContent('investments-plans');
                    } else {
                        showToast('error', response.message || 'Failed to update plan status');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to update plan status');
                }
            });
        }
        
        // Calculate total return for investment plan
        function calculateTotalReturn() {
            const dailyProfit = parseFloat($('#plan-profit').val()) || 0;
            const duration = parseInt($('#plan-duration').val()) || 0;
            const totalReturn = dailyProfit * duration;
            
            $('#plan-total').val(totalReturn);
        }
        
        // Render profit history
        function renderProfitHistory(profits) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">Profit Distribution History</h3>
                        <div class="admin-card-actions">
                            <button class="admin-btn admin-btn-secondary admin-btn-sm" id="exportProfitsBtn">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="profitsTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Total Distributed</th>
                                    <th>Users Paid</th>
                                    <th>Average per User</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            profits.forEach(profit => {
                html += `
                    <tr>
                        <td>${new Date(profit.date).toLocaleDateString()}</td>
                        <td>$${profit.totalAmount.toFixed(2)}</td>
                        <td>${profit.userCount}</td>
                        <td>$${profit.averagePerUser.toFixed(2)}</td>
                        <td>
                            <button class="admin-btn admin-btn-primary admin-btn-sm view-profit-details" data-date="${profit.date}">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Initialize DataTable
            $('#profitsTable').DataTable({
                responsive: true,
                dom: '<"top"fB>rt<"bottom"lip><"clear">',
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        className: 'admin-btn admin-btn-success admin-btn-sm'
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i> PDF',
                        className: 'admin-btn admin-btn-danger admin-btn-sm'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i> Print',
                        className: 'admin-btn admin-btn-secondary admin-btn-sm'
                    }
                ],
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search profits..."
                }
            });
            
            // Add event listeners for profit actions
            $('.view-profit-details').on('click', function() {
                const date = $(this).data('date');
                showProfitDetails(date);
            });
            
            // Export profits button
            $('#exportProfitsBtn').on('click', function() {
                exportProfits();
            });
        }
        
        // Show profit details
        function showProfitDetails(date) {
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/investments/profits/${date}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderProfitDetailsModal(response.data);
                    }
                }
            });
        }
        
        // Render profit details modal
        function renderProfitDetailsModal(data) {
            const modalHtml = `
                <div class="admin-modal active" id="profit-details-modal">
                    <div class="admin-modal-content" style="max-width: 900px;">
                        <div class="admin-modal-header">
                            <h3 class="admin-modal-title">Profit Distribution Details - ${new Date(data.date).toLocaleDateString()}</h3>
                            <button class="admin-modal-close" id="profit-modal-close">&times;</button>
                        </div>
                        <div class="admin-modal-body">
                            <div class="admin-stats-grid" style="margin-bottom: 20px;">
                                <div class="admin-stat-card">
                                    <div class="admin-stat-card-header">
                                        <h3 class="admin-stat-card-title">Total Distributed</h3>
                                        <div class="admin-stat-card-icon profit">
                                            <i class="fas fa-money-bill-wave"></i>
                                        </div>
                                    </div>
                                    <h2 class="admin-stat-card-value">$${data.totalAmount.toFixed(2)}</h2>
                                </div>
                                <div class="admin-stat-card">
                                    <div class="admin-stat-card-header">
                                        <h3 class="admin-stat-card-title">Users Paid</h3>
                                        <div class="admin-stat-card-icon users">
                                            <i class="fas fa-users"></i>
                                        </div>
                                    </div>
                                    <h2 class="admin-stat-card-value">${data.userCount}</h2>
                                </div>
                                <div class="admin-stat-card">
                                    <div class="admin-stat-card-header">
                                        <h3 class="admin-stat-card-title">Average per User</h3>
                                        <div class="admin-stat-card-icon deposits">
                                            <i class="fas fa-chart-pie"></i>
                                        </div>
                                    </div>
                                    <h2 class="admin-stat-card-value">$${data.averagePerUser.toFixed(2)}</h2>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table" id="profitDetailsTable">
                                    <thead>
                                        <tr>
                                            <th>User</th>
                                            <th>Investment</th>
                                            <th>Plan</th>
                                            <th>Amount</th>
                                            <th>Date Credited</th>
                                        </tr>
                                    </thead>
                                    <tbody>
            `;
            
            data.details.forEach(detail => {
                modalHtml += `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${detail.userAvatar || 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1'}" 
                                     alt="${detail.userName}" 
                                     style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
                                <div>
                                    <div>${detail.userName}</div>
                                    <small class="text-muted">${detail.userEmail}</small>
                                </div>
                            </div>
                        </td>
                        <td>$${detail.investmentAmount.toFixed(2)}</td>
                        <td>${detail.planName}</td>
                        <td>$${detail.profitAmount.toFixed(2)}</td>
                        <td>${new Date(detail.creditedAt).toLocaleString()}</td>
                    </tr>
                `;
            });
            
            modalHtml += `
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="admin-modal-footer">
                            <button class="admin-btn admin-btn-secondary" id="profit-modal-close-btn">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            $('body').append(modalHtml);
            
            // Initialize DataTable
            $('#profitDetailsTable').DataTable({
                responsive: true,
                searching: false,
                paging: false,
                info: false
            });
            
            // Add event listeners for the modal
            $('#profit-modal-close, #profit-modal-close-btn').on('click', function() {
                $('#profit-details-modal').remove();
            });
        }
        
        // Export investments
        function exportInvestments() {
            // This would trigger the DataTable export functionality
            $('#investmentsTable').DataTable().button('.buttons-excel').trigger();
        }
        
        // Export plans
        function exportPlans() {
            // This would trigger the DataTable export functionality
            $('#plansTable').DataTable().button('.buttons-excel').trigger();
        }
        
        // Export profits
        function exportProfits() {
            // This would trigger the DataTable export functionality
            $('#profitsTable').DataTable().button('.buttons-excel').trigger();
        }
        
        // Load support tickets
        function loadSupportTickets() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/support/tickets',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderSupportTickets(response.data.tickets);
                    }
                }
            });
        }
        
        // Render support tickets
        function renderSupportTickets(tickets) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">Support Tickets</h3>
                        <div class="admin-card-actions">
                            <button class="admin-btn admin-btn-secondary admin-btn-sm" id="exportTicketsBtn">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="ticketsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Subject</th>
                                    <th>Category</th>
                                    <th>Status</th>
                                    <th>Priority</th>
                                    <th>Created</th>
                                    <th>Last Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            tickets.forEach(ticket => {
                let statusBadge = '';
                if (ticket.status === 'open') {
                    statusBadge = '<span class="admin-badge admin-badge-success">Open</span>';
                } else if (ticket.status === 'pending') {
                    statusBadge = '<span class="admin-badge admin-badge-warning">Pending</span>';
                } else if (ticket.status === 'resolved') {
                    statusBadge = '<span class="admin-badge admin-badge-info">Resolved</span>';
                } else if (ticket.status === 'closed') {
                    statusBadge = '<span class="admin-badge admin-badge-secondary">Closed</span>';
                }
                
                let priorityBadge = '';
                if (ticket.priority === 'low') {
                    priorityBadge = '<span class="admin-badge admin-badge-success">Low</span>';
                } else if (ticket.priority === 'medium') {
                    priorityBadge = '<span class="admin-badge admin-badge-warning">Medium</span>';
                } else if (ticket.priority === 'high') {
                    priorityBadge = '<span class="admin-badge admin-badge-danger">High</span>';
                } else if (ticket.priority === 'urgent') {
                    priorityBadge = '<span class="admin-badge" style="background-color: #ff00ff; color: white;">Urgent</span>';
                }
                
                html += `
                    <tr>
                        <td>${ticket.ticketId}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${ticket.userAvatar || 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1'}" 
                                     alt="${ticket.userName}" 
                                     style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
                                <div>
                                    <div>${ticket.userName}</div>
                                    <small class="text-muted">${ticket.userEmail}</small>
                                </div>
                            </div>
                        </td>
                        <td>${ticket.subject}</td>
                        <td>${ticket.category}</td>
                        <td>${statusBadge}</td>
                        <td>${priorityBadge}</td>
                        <td>${new Date(ticket.createdAt).toLocaleString()}</td>
                        <td>${new Date(ticket.updatedAt).toLocaleString()}</td>
                        <td>
                            <button class="admin-btn admin-btn-primary admin-btn-sm view-ticket" data-id="${ticket.ticketId}">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Initialize DataTable
            $('#ticketsTable').DataTable({
                responsive: true,
                dom: '<"top"fB>rt<"bottom"lip><"clear">',
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        className: 'admin-btn admin-btn-success admin-btn-sm'
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i> PDF',
                        className: 'admin-btn admin-btn-danger admin-btn-sm'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i> Print',
                        className: 'admin-btn admin-btn-secondary admin-btn-sm'
                    }
                ],
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search tickets..."
                }
            });
            
            // Add event listeners for ticket actions
            $('.view-ticket').on('click', function() {
                const ticketId = $(this).data('id');
                showTicketModal(ticketId);
            });
            
            // Export tickets button
            $('#exportTicketsBtn').on('click', function() {
                exportTickets();
            });
        }
        
        // Show ticket modal
        function showTicketModal(ticketId) {
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/support/tickets/${ticketId}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderTicketModal(response.data);
                    }
                }
            });
        }
        
        // Render ticket modal
        function renderTicketModal(ticket) {
            const modalHtml = `
                <div class="admin-modal active" id="ticket-modal">
                    <div class="admin-modal-content" style="max-width: 800px;">
                        <div class="admin-modal-header">
                            <h3 class="admin-modal-title">Ticket #${ticket.ticketId}: ${ticket.subject}</h3>
                            <button class="admin-modal-close" id="ticket-modal-close">&times;</button>
                        </div>
                        <div class="admin-modal-body">
                            <div class="admin-card" style="margin-bottom: 20px;">
                                <div class="admin-card-header">
                                    <h4 class="admin-card-title">Ticket Details</h4>
                                </div>
                                <div class="admin-card-body">
                                    <div class="row" style="margin-bottom: 15px;">
                                        <div class="col-md-6">
                                            <p><strong>User:</strong> ${ticket.userName} (${ticket.userEmail})</p>
                                            <p><strong>Status:</strong> <span class="admin-badge ${getStatusBadgeClass(ticket.status)}">${ticket.status}</span></p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Priority:</strong> <span class="admin-badge ${getPriorityBadgeClass(ticket.priority)}">${ticket.priority}</span></p>
                                            <p><strong>Category:</strong> ${ticket.category}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>Created:</strong> ${new Date(ticket.createdAt).toLocaleString()}</p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Last Updated:</strong> ${new Date(ticket.updatedAt).toLocaleString()}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="admin-card" style="margin-bottom: 20px;">
                                <div class="admin-card-header">
                                    <h4 class="admin-card-title">Message</h4>
                                </div>
                                <div class="admin-card-body">
                                    <p>${ticket.message}</p>
                                    ${ticket.attachments && ticket.attachments.length > 0 ? `
                                        <div style="margin-top: 15px;">
                                            <h5>Attachments:</h5>
                                            <div class="d-flex flex-wrap gap-2">
                                                ${ticket.attachments.map(attachment => `
                                                    <a href="${attachment.url}" target="_blank" class="admin-btn admin-btn-secondary admin-btn-sm">
                                                        <i class="fas fa-paperclip"></i> ${attachment.name}
                                                    </a>
                                                `).join('')}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h4 class="admin-card-title">Conversation</h4>
                                </div>
                                <div class="admin-card-body">
                                    <div id="ticket-conversation" style="max-height: 300px; overflow-y: auto; margin-bottom: 15px;">
                                        ${ticket.replies.map(reply => `
                                            <div class="ticket-reply ${reply.isAdmin ? 'admin-reply' : 'user-reply'}" style="margin-bottom: 15px; padding: 10px; border-radius: var(--border-radius); background-color: ${reply.isAdmin ? 'var(--gray-light)' : 'var(--lighter)'};">
                                                <div class="d-flex justify-content-between align-items-center" style="margin-bottom: 5px;">
                                                    <strong>${reply.isAdmin ? 'Admin' : ticket.userName}</strong>
                                                    <small>${new Date(reply.createdAt).toLocaleString()}</small>
                                                </div>
                                                <p style="margin-bottom: 0;">${reply.message}</p>
                                            </div>
                                        `).join('')}
                                    </div>
                                    
                                    <form id="ticket-reply-form">
                                        <div class="admin-form-group">
                                            <label for="ticket-reply-message" class="admin-form-label">Your Reply</label>
                                            <textarea id="ticket-reply-message" class="admin-form-control admin-form-textarea" rows="3" required></textarea>
                                        </div>
                                        <div class="admin-form-group">
                                            <label for="ticket-status" class="admin-form-label">Update Status</label>
                                            <select id="ticket-status" class="admin-form-control admin-form-select">
                                                <option value="open" ${ticket.status === 'open' ? 'selected' : ''}>Open</option>
                                                <option value="pending" ${ticket.status === 'pending' ? 'selected' : ''}>Pending</option>
                                                <option value="resolved" ${ticket.status === 'resolved' ? 'selected' : ''}>Resolved</option>
                                                <option value="closed" ${ticket.status === 'closed' ? 'selected' : ''}>Closed</option>
                                            </select>
                                        </div>
                                        <div class="admin-form-group">
                                            <label for="ticket-priority" class="admin-form-label">Update Priority</label>
                                            <select id="ticket-priority" class="admin-form-control admin-form-select">
                                                <option value="low" ${ticket.priority === 'low' ? 'selected' : ''}>Low</option>
                                                <option value="medium" ${ticket.priority === 'medium' ? 'selected' : ''}>Medium</option>
                                                <option value="high" ${ticket.priority === 'high' ? 'selected' : ''}>High</option>
                                                <option value="urgent" ${ticket.priority === 'urgent' ? 'selected' : ''}>Urgent</option>
                                            </select>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="admin-modal-footer">
                            <button class="admin-btn admin-btn-secondary" id="ticket-modal-close-btn">Close</button>
                            <button class="admin-btn admin-btn-primary" id="ticket-reply-submit">Submit Reply</button>
                        </div>
                    </div>
                </div>
            `;
            
            $('body').append(modalHtml);
            
            // Add event listeners for the modal
            $('#ticket-modal-close, #ticket-modal-close-btn').on('click', function() {
                $('#ticket-modal').remove();
            });
            
            $('#ticket-reply-submit').on('click', function() {
                submitTicketReply(ticket.ticketId);
            });
            
            // Scroll conversation to bottom
            $('#ticket-conversation').scrollTop($('#ticket-conversation')[0].scrollHeight);
        }
        
        // Get status badge class
        function getStatusBadgeClass(status) {
            switch (status) {
                case 'open': return 'admin-badge-success';
                case 'pending': return 'admin-badge-warning';
                case 'resolved': return 'admin-badge-info';
                case 'closed': return 'admin-badge-secondary';
                default: return '';
            }
        }
        
        // Get priority badge class
        function getPriorityBadgeClass(priority) {
            switch (priority) {
                case 'low': return 'admin-badge-success';
                case 'medium': return 'admin-badge-warning';
                case 'high': return 'admin-badge-danger';
                case 'urgent': return '';
                default: return '';
            }
        }
        
        // Submit ticket reply
        function submitTicketReply(ticketId) {
            const message = $('#ticket-reply-message').val().trim();
            const status = $('#ticket-status').val();
            const priority = $('#ticket-priority').val();
            
            if (!message) {
                showToast('error', 'Please enter a reply message');
                return;
            }
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/support/tickets/${ticketId}/reply`,
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: {
                    message: message,
                    status: status,
                    priority: priority
                },
                success: function(response) {
                    if (response.success) {
                        showToast('success', 'Reply submitted successfully');
                        $('#ticket-modal').remove();
                        
                        // Reload the tickets section
                        loadSectionContent('support');
                    } else {
                        showToast('error', response.message || 'Failed to submit reply');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to submit reply');
                }
            });
        }
        
        // Export tickets
        function exportTickets() {
            // This would trigger the DataTable export functionality
            $('#ticketsTable').DataTable().button('.buttons-excel').trigger();
        }
        
        // Load notifications
        function loadNotifications() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/notifications',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderNotifications(response.data.notifications);
                    }
                }
            });
        }
        
        // Render notifications
        function renderNotifications(notifications) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">Notifications</h3>
                        <div class="admin-card-actions">
                            <button class="admin-btn admin-btn-primary admin-btn-sm" id="sendNotificationBtn">
                                <i class="fas fa-bell"></i> Send Notification
                            </button>
                            <button class="admin-btn admin-btn-secondary admin-btn-sm" id="markAllReadBtn">
                                <i class="fas fa-check"></i> Mark All Read
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="notificationsTable">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Message</th>
                                    <th>Type</th>
                                    <th>Sent</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            notifications.forEach(notification => {
                let typeBadge = '';
                if (notification.type === 'all') {
                    typeBadge = '<span class="admin-badge admin-badge-primary">All Users</span>';
                } else if (notification.type === 'investors') {
                    typeBadge = '<span class="admin-badge admin-badge-success">Investors</span>';
                } else if (notification.type === 'specific') {
                    typeBadge = '<span class="admin-badge admin-badge-info">Specific Users</span>';
                }
                
                let statusBadge = '';
                if (notification.status === 'sent') {
                    statusBadge = '<span class="admin-badge admin-badge-success">Sent</span>';
                } else if (notification.status === 'pending') {
                    statusBadge = '<span class="admin-badge admin-badge-warning">Pending</span>';
                } else if (notification.status === 'failed') {
                    statusBadge = '<span class="admin-badge admin-badge-danger">Failed</span>';
                }
                
                html += `
                    <tr>
                        <td>${notification.title}</td>
                        <td>${notification.message.length > 50 ? notification.message.substring(0, 50) + '...' : notification.message}</td>
                        <td>${typeBadge}</td>
                        <td>${new Date(notification.createdAt).toLocaleString()}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="admin-btn admin-btn-primary admin-btn-sm view-notification" data-id="${notification.notificationId}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="admin-btn admin-btn-danger admin-btn-sm delete-notification" data-id="${notification.notificationId}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Initialize DataTable
            $('#notificationsTable').DataTable({
                responsive: true,
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search notifications..."
                }
            });
            
            // Add event listeners for notification actions
            $('.view-notification').on('click', function() {
                const notificationId = $(this).data('id');
                viewNotification(notificationId);
            });
            
            $('.delete-notification').on('click', function() {
                const notificationId = $(this).data('id');
                deleteNotification(notificationId);
            });
            
            // Send notification button
            $('#sendNotificationBtn').on('click', function() {
                $('#admin-notification-modal').addClass('active');
            });
            
            // Mark all as read button
            $('#markAllReadBtn').on('click', function() {
                markAllNotificationsRead();
            });
        }
        
        // View notification
        function viewNotification(notificationId) {
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/notifications/${notificationId}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderNotificationModal(response.data);
                    }
                }
            });
        }
        
        // Render notification modal
        function renderNotificationModal(notification) {
            let recipients = '';
            if (notification.type === 'specific' && notification.recipients && notification.recipients.length > 0) {
                recipients = `
                    <div class="admin-form-group">
                        <label class="admin-form-label">Recipients</label>
                        <div style="max-height: 150px; overflow-y: auto; border: 1px solid var(--gray-light); padding: 10px; border-radius: var(--border-radius);">
                            ${notification.recipients.map(user => `
                                <div class="d-flex align-items-center" style="margin-bottom: 5px;">
                                    <img src="${user.avatar || 'https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1'}" 
                                         style="width: 25px; height: 25px; border-radius: 50%; margin-right: 10px;">
                                    <div>
                                        <div>${user.name}</div>
                                        <small class="text-muted">${user.email}</small>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            const modalHtml = `
                <div class="admin-modal active" id="notification-view-modal">
                    <div class="admin-modal-content">
                        <div class="admin-modal-header">
                            <h3 class="admin-modal-title">Notification Details</h3>
                            <button class="admin-modal-close" id="notification-view-close">&times;</button>
                        </div>
                        <div class="admin-modal-body">
                            <div class="admin-form-group">
                                <label class="admin-form-label">Title</label>
                                <div class="admin-form-control" style="background-color: var(--lighter);">${notification.title}</div>
                            </div>
                            <div class="admin-form-group">
                                <label class="admin-form-label">Message</label>
                                <div class="admin-form-control admin-form-textarea" style="background-color: var(--lighter); height: auto; min-height: 100px;">${notification.message}</div>
                            </div>
                            <div class="admin-form-group">
                                <label class="admin-form-label">Type</label>
                                <div class="admin-form-control" style="background-color: var(--lighter);">
                                    ${notification.type === 'all' ? 'All Users' : 
                                      notification.type === 'investors' ? 'Investors Only' : 
                                      notification.type === 'specific' ? 'Specific Users' : ''}
                                </div>
                            </div>
                            ${recipients}
                            <div class="admin-form-group">
                                <label class="admin-form-label">Status</label>
                                <div class="admin-form-control" style="background-color: var(--lighter);">
                                    <span class="admin-badge ${notification.status === 'sent' ? 'admin-badge-success' : 
                                                             notification.status === 'pending' ? 'admin-badge-warning' : 
                                                             notification.status === 'failed' ? 'admin-badge-danger' : ''}">
                                        ${notification.status}
                                    </span>
                                </div>
                            </div>
                            <div class="admin-form-group">
                                <label class="admin-form-label">Sent Date</label>
                                <div class="admin-form-control" style="background-color: var(--lighter);">${new Date(notification.createdAt).toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="admin-modal-footer">
                            <button class="admin-btn admin-btn-secondary" id="notification-view-close-btn">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            $('body').append(modalHtml);
            
            // Add event listeners for the modal
            $('#notification-view-close, #notification-view-close-btn').on('click', function() {
                $('#notification-view-modal').remove();
            });
        }
        
        // Delete notification
        function deleteNotification(notificationId) {
            if (!confirm('Are you sure you want to delete this notification?')) {
                return;
            }
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/notifications/${notificationId}`,
                type: 'DELETE',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        showToast('success', 'Notification deleted successfully');
                        
                        // Reload the notifications section
                        loadSectionContent('notifications');
                    } else {
                        showToast('error', response.message || 'Failed to delete notification');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to delete notification');
                }
            });
        }
        
        // Load users for notification
        function loadUsersForNotification() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        const $select = $('#notification-users');
                        $select.empty();
                        
                        response.data.users.forEach(user => {
                            $select.append(`<option value="${user.userId}">${user.email} (${user.firstName} ${user.lastName})</option>`);
                        });
                        
                        // Initialize Select2
                        $select.select2({
                            dropdownParent: $('#admin-notification-modal .admin-modal-content'),
                            width: '100%',
                            placeholder: 'Select users'
                        });
                    }
                }
            });
        }
        
        // Send notification
        function sendNotification() {
            const type = $('#notification-type').val();
            const subject = $('#notification-subject').val().trim();
            const message = $('#notification-message').val().trim();
            const sendEmail = $('#notification-email').is(':checked');
            let userIds = [];
            
            if (type === 'specific') {
                userIds = $('#notification-users').val();
                if (!userIds || userIds.length === 0) {
                    showToast('error', 'Please select at least one user');
                    return;
                }
            }
            
            if (!subject || !message) {
                showToast('error', 'Please fill in all required fields');
                return;
            }
            
            const notificationData = {
                type: type,
                title: subject,
                message: message,
                sendEmail: sendEmail
            };
            
            if (type === 'specific') {
                notificationData.userIds = userIds;
            }
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/notifications',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: notificationData,
                success: function(response) {
                    if (response.success) {
                        showToast('success', 'Notification sent successfully');
                        $('#admin-notification-modal').removeClass('active');
                        $('#admin-notification-form')[0].reset();
                        
                        // Reload the notifications section
                        loadSectionContent('notifications');
                    } else {
                        showToast('error', response.message || 'Failed to send notification');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to send notification');
                }
            });
        }
        
        // Mark all notifications as read
        function markAllNotificationsRead() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/notifications/mark-read',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        showToast('success', 'All notifications marked as read');
                        updateNotificationCount();
                    } else {
                        showToast('error', response.message || 'Failed to mark notifications as read');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to mark notifications as read');
                }
            });
        }
        
        // Load general settings
        function loadGeneralSettings() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/settings/general',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderGeneralSettings(response.data.settings);
                    }
                }
            });
        }
        
        // Render general settings
        function renderGeneralSettings(settings) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">General Settings</h3>
                    </div>
                    <div class="admin-card-body">
                        <form id="general-settings-form">
                            <div class="admin-form-group">
                                <label for="site-name" class="admin-form-label">Site Name</label>
                                <input type="text" id="site-name" class="admin-form-control" value="${settings.siteName}">
                            </div>
                            <div class="admin-form-group">
                                <label for="site-url" class="admin-form-label">Site URL</label>
                                <input type="url" id="site-url" class="admin-form-control" value="${settings.siteUrl}">
                            </div>
                            <div class="admin-form-group">
                                <label for="site-email" class="admin-form-label">Contact Email</label>
                                <input type="email" id="site-email" class="admin-form-control" value="${settings.contactEmail}">
                            </div>
                            <div class="admin-form-group">
                                <label for="site-currency" class="admin-form-label">Default Currency</label>
                                <select id="site-currency" class="admin-form-control admin-form-select">
                                    <option value="USD" ${settings.defaultCurrency === 'USD' ? 'selected' : ''}>US Dollar (USD)</option>
                                    <option value="EUR" ${settings.defaultCurrency === 'EUR' ? 'selected' : ''}>Euro (EUR)</option>
                                    <option value="GBP" ${settings.defaultCurrency === 'GBP' ? 'selected' : ''}>British Pound (GBP)</option>
                                    <option value="BTC" ${settings.defaultCurrency === 'BTC' ? 'selected' : ''}>Bitcoin (BTC)</option>
                                    <option value="ETH" ${settings.defaultCurrency === 'ETH' ? 'selected' : ''}>Ethereum (ETH)</option>
                                </select>
                            </div>
                            <div class="admin-form-group">
                                <label for="site-timezone" class="admin-form-label">Timezone</label>
                                <select id="site-timezone" class="admin-form-control admin-form-select">
                                    <option value="UTC" ${settings.timezone === 'UTC' ? 'selected' : ''}>UTC</option>
                                    <option value="America/New_York" ${settings.timezone === 'America/New_York' ? 'selected' : ''}>Eastern Time (ET)</option>
                                    <option value="America/Chicago" ${settings.timezone === 'America/Chicago' ? 'selected' : ''}>Central Time (CT)</option>
                                    <option value="America/Los_Angeles" ${settings.timezone === 'America/Los_Angeles' ? 'selected' : ''}>Pacific Time (PT)</option>
                                    <option value="Europe/London" ${settings.timezone === 'Europe/London' ? 'selected' : ''}>London (GMT)</option>
                                </select>
                            </div>
                            <div class="admin-form-group">
                                <label for="site-description" class="admin-form-label">Site Description</label>
                                <textarea id="site-description" class="admin-form-control admin-form-textarea" rows="3">${settings.siteDescription}</textarea>
                            </div>
                            <div class="admin-form-group">
                                <label for="site-keywords" class="admin-form-label">Site Keywords</label>
                                <textarea id="site-keywords" class="admin-form-control admin-form-textarea" rows="2">${settings.siteKeywords}</textarea>
                            </div>
                            <div class="admin-form-group">
                                <label for="site-maintenance" class="admin-form-label">Maintenance Mode</label>
                                <select id="site-maintenance" class="admin-form-control admin-form-select">
                                    <option value="false" ${!settings.maintenanceMode ? 'selected' : ''}>Disabled</option>
                                    <option value="true" ${settings.maintenanceMode ? 'selected' : ''}>Enabled</option>
                                </select>
                            </div>
                            <div class="admin-form-group">
                                <label for="site-maintenance-message" class="admin-form-label">Maintenance Message</label>
                                <textarea id="site-maintenance-message" class="admin-form-control admin-form-textarea" rows="3">${settings.maintenanceMessage}</textarea>
                            </div>
                        </form>
                    </div>
                    <div class="admin-card-footer">
                        <button class="admin-btn admin-btn-secondary" id="general-settings-cancel">Cancel</button>
                        <button class="admin-btn admin-btn-primary" id="general-settings-save">Save Settings</button>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Add event listeners for settings actions
            $('#general-settings-cancel').on('click', function() {
                loadGeneralSettings(); // Reload to discard changes
            });
            
            $('#general-settings-save').on('click', function() {
                saveGeneralSettings();
            });
        }
        
        // Save general settings
        function saveGeneralSettings() {
            const settingsData = {
                siteName: $('#site-name').val().trim(),
                siteUrl: $('#site-url').val().trim(),
                contactEmail: $('#site-email').val().trim(),
                defaultCurrency: $('#site-currency').val(),
                timezone: $('#site-timezone').val(),
                siteDescription: $('#site-description').val().trim(),
                siteKeywords: $('#site-keywords').val().trim(),
                maintenanceMode: $('#site-maintenance').val() === 'true',
                maintenanceMessage: $('#site-maintenance-message').val().trim()
            };
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/settings/general',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: settingsData,
                success: function(response) {
                    if (response.success) {
                        showToast('success', 'General settings saved successfully');
                    } else {
                        showToast('error', response.message || 'Failed to save general settings');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to save general settings');
                }
            });
        }
        
        // Load security settings
        function loadSecuritySettings() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/settings/security',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderSecuritySettings(response.data.settings);
                    }
                }
            });
        }
        
        // Render security settings
        function renderSecuritySettings(settings) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">Security Settings</h3>
                    </div>
                    <div class="admin-card-body">
                        <form id="security-settings-form">
                            <div class="admin-form-group">
                                <label for="security-2fa" class="admin-form-label">Two-Factor Authentication</label>
                                <select id="security-2fa" class="admin-form-control admin-form-select">
                                    <option value="disabled" ${settings.twoFactorAuth === 'disabled' ? 'selected' : ''}>Disabled</option>
                                    <option value="optional" ${settings.twoFactorAuth === 'optional' ? 'selected' : ''}>Optional</option>
                                    <option value="required" ${settings.twoFactorAuth === 'required' ? 'selected' : ''}>Required for Admins</option>
                                    <option value="required-all" ${settings.twoFactorAuth === 'required-all' ? 'selected' : ''}>Required for All Users</option>
                                </select>
                            </div>
                            <div class="admin-form-group">
                                <label for="security-login-attempts" class="admin-form-label">Max Login Attempts</label>
                                <input type="number" id="security-login-attempts" class="admin-form-control" min="1" value="${settings.maxLoginAttempts}">
                            </div>
                            <div class="admin-form-group">
                                <label for="security-login-timeout" class="admin-form-label">Login Lockout Time (minutes)</label>
                                <input type="number" id="security-login-timeout" class="admin-form-control" min="1" value="${settings.loginLockoutTime}">
                            </div>
                            <div class="admin-form-group">
                                <label for="security-password-strength" class="admin-form-label">Password Strength</label>
                                <select id="security-password-strength" class="admin-form-control admin-form-select">
                                    <option value="low" ${settings.passwordStrength === 'low' ? 'selected' : ''}>Low (6+ characters)</option>
                                    <option value="medium" ${settings.passwordStrength === 'medium' ? 'selected' : ''}>Medium (8+ characters, 1 number)</option>
                                    <option value="high" ${settings.passwordStrength === 'high' ? 'selected' : ''}>High (10+ characters, 1 number, 1 special)</option>
                                </select>
                            </div>
                            <div class="admin-form-group">
                                <label for="security-session-timeout" class="admin-form-label">Session Timeout (minutes)</label>
                                <input type="number" id="security-session-timeout" class="admin-form-control" min="1" value="${settings.sessionTimeout}">
                            </div>
                            <div class="admin-form-group">
                                <label for="security-ip-restriction" class="admin-form-label">IP Restrictions</label>
                                <select id="security-ip-restriction" class="admin-form-control admin-form-select">
                                    <option value="disabled" ${settings.ipRestriction === 'disabled' ? 'selected' : ''}>Disabled</option>
                                    <option value="admin" ${settings.ipRestriction === 'admin' ? 'selected' : ''}>Admin Panel Only</option>
                                    <option value="all" ${settings.ipRestriction === 'all' ? 'selected' : ''}>All Areas</option>
                                </select>
                            </div>
                            <div class="admin-form-group" id="security-ip-whitelist-group" style="${settings.ipRestriction === 'disabled' ? 'display: none;' : ''}">
                                <label for="security-ip-whitelist" class="admin-form-label">IP Whitelist</label>
                                <textarea id="security-ip-whitelist" class="admin-form-control admin-form-textarea" rows="3" placeholder="Enter one IP per line">${settings.ipWhitelist.join('\n')}</textarea>
                            </div>
                            <div class="admin-form-group">
                                <label for="security-captcha" class="admin-form-label">Captcha Protection</label>
                                <select id="security-captcha" class="admin-form-control admin-form-select">
                                    <option value="disabled" ${settings.captcha === 'disabled' ? 'selected' : ''}>Disabled</option>
                                    <option value="login" ${settings.captcha === 'login' ? 'selected' : ''}>Login Only</option>
                                    <option value="registration" ${settings.captcha === 'registration' ? 'selected' : ''}>Registration Only</option>
                                    <option value="all" ${settings.captcha === 'all' ? 'selected' : ''}>All Forms</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="admin-card-footer">
                        <button class="admin-btn admin-btn-secondary" id="security-settings-cancel">Cancel</button>
                        <button class="admin-btn admin-btn-primary" id="security-settings-save">Save Settings</button>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Show/hide IP whitelist based on restriction setting
            $('#security-ip-restriction').on('change', function() {
                if ($(this).val() === 'disabled') {
                    $('#security-ip-whitelist-group').hide();
                } else {
                    $('#security-ip-whitelist-group').show();
                }
            });
            
            // Add event listeners for settings actions
            $('#security-settings-cancel').on('click', function() {
                loadSecuritySettings(); // Reload to discard changes
            });
            
            $('#security-settings-save').on('click', function() {
                saveSecuritySettings();
            });
        }
        
        // Save security settings
        function saveSecuritySettings() {
            const settingsData = {
                twoFactorAuth: $('#security-2fa').val(),
                maxLoginAttempts: parseInt($('#security-login-attempts').val()),
                loginLockoutTime: parseInt($('#security-login-timeout').val()),
                passwordStrength: $('#security-password-strength').val(),
                sessionTimeout: parseInt($('#security-session-timeout').val()),
                ipRestriction: $('#security-ip-restriction').val(),
                ipWhitelist: $('#security-ip-whitelist').val().split('\n').map(ip => ip.trim()).filter(ip => ip),
                captcha: $('#security-captcha').val()
            };
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/settings/security',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: settingsData,
                success: function(response) {
                    if (response.success) {
                        showToast('success', 'Security settings saved successfully');
                    } else {
                        showToast('error', response.message || 'Failed to save security settings');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to save security settings');
                }
            });
        }
        
        // Load email settings
        function loadEmailSettings() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/settings/email',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderEmailSettings(response.data.settings);
                    }
                }
            });
        }
        
        // Render email settings
        function renderEmailSettings(settings) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">Email Settings</h3>
                    </div>
                    <div class="admin-card-body">
                        <form id="email-settings-form">
                            <div class="admin-form-group">
                                <label for="email-protocol" class="admin-form-label">Email Protocol</label>
                                <select id="email-protocol" class="admin-form-control admin-form-select">
                                    <option value="smtp" ${settings.protocol === 'smtp' ? 'selected' : ''}>SMTP</option>
                                    <option value="sendmail" ${settings.protocol === 'sendmail' ? 'selected' : ''}>Sendmail</option>
                                    <option value="mail" ${settings.protocol === 'mail' ? 'selected' : ''}>PHP Mail</option>
                                </select>
                            </div>
                            <div class="admin-form-group">
                                <label for="email-from" class="admin-form-label">From Email</label>
                                <input type="email" id="email-from" class="admin-form-control" value="${settings.fromEmail}">
                            </div>
                            <div class="admin-form-group">
                                <label for="email-from-name" class="admin-form-label">From Name</label>
                                <input type="text" id="email-from-name" class="admin-form-control" value="${settings.fromName}">
                            </div>
                            <div class="admin-form-group">
                                <label for="email-smtp-host" class="admin-form-label">SMTP Host</label>
                                <input type="text" id="email-smtp-host" class="admin-form-control" value="${settings.smtpHost}">
                            </div>
                            <div class="admin-form-group">
                                <label for="email-smtp-port" class="admin-form-label">SMTP Port</label>
                                <input type="number" id="email-smtp-port" class="admin-form-control" value="${settings.smtpPort}">
                            </div>
                            <div class="admin-form-group">
                                <label for="email-smtp-encryption" class="admin-form-label">SMTP Encryption</label>
                                <select id="email-smtp-encryption" class="admin-form-control admin-form-select">
                                    <option value="none" ${settings.smtpEncryption === 'none' ? 'selected' : ''}>None</option>
                                    <option value="ssl" ${settings.smtpEncryption === 'ssl' ? 'selected' : ''}>SSL</option>
                                    <option value="tls" ${settings.smtpEncryption === 'tls' ? 'selected' : ''}>TLS</option>
                                </select>
                            </div>
                            <div class="admin-form-group">
                                <label for="email-smtp-username" class="admin-form-label">SMTP Username</label>
                                <input type="text" id="email-smtp-username" class="admin-form-control" value="${settings.smtpUsername}">
                            </div>
                            <div class="admin-form-group">
                                <label for="email-smtp-password" class="admin-form-label">SMTP Password</label>
                                <input type="password" id="email-smtp-password" class="admin-form-control" value="${settings.smtpPassword}">
                            </div>
                            <div class="admin-form-group">
                                <label for="email-test-email" class="admin-form-label">Test Email Address</label>
                                <input type="email" id="email-test-email" class="admin-form-control" placeholder="Enter email to test settings">
                            </div>
                        </form>
                    </div>
                    <div class="admin-card-footer">
                        <button class="admin-btn admin-btn-secondary" id="email-settings-cancel">Cancel</button>
                        <button class="admin-btn admin-btn-primary" id="email-settings-save">Save Settings</button>
                        <button class="admin-btn admin-btn-success" id="email-settings-test">Test Settings</button>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Add event listeners for settings actions
            $('#email-settings-cancel').on('click', function() {
                loadEmailSettings(); // Reload to discard changes
            });
            
            $('#email-settings-save').on('click', function() {
                saveEmailSettings();
            });
            
            $('#email-settings-test').on('click', function() {
                testEmailSettings();
            });
        }
        
        // Save email settings
        function saveEmailSettings() {
            const settingsData = {
                protocol: $('#email-protocol').val(),
                fromEmail: $('#email-from').val().trim(),
                fromName: $('#email-from-name').val().trim(),
                smtpHost: $('#email-smtp-host').val().trim(),
                smtpPort: parseInt($('#email-smtp-port').val()),
                smtpEncryption: $('#email-smtp-encryption').val(),
                smtpUsername: $('#email-smtp-username').val().trim(),
                smtpPassword: $('#email-smtp-password').val()
            };
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/settings/email',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: settingsData,
                success: function(response) {
                    if (response.success) {
                        showToast('success', 'Email settings saved successfully');
                    } else {
                        showToast('error', response.message || 'Failed to save email settings');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to save email settings');
                }
            });
        }
        
        // Test email settings
        function testEmailSettings() {
            const testEmail = $('#email-test-email').val().trim();
            
            if (!testEmail) {
                showToast('error', 'Please enter a test email address');
                return;
            }
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/settings/email/test',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: {
                    email: testEmail
                },
                success: function(response) {
                    if (response.success) {
                        showToast('success', 'Test email sent successfully');
                    } else {
                        showToast('error', response.message || 'Failed to send test email');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to send test email');
                }
            });
        }
        
        // Load payment settings
        function loadPaymentSettings() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/settings/payment',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        renderPaymentSettings(response.data.settings);
                    }
                }
            });
        }
        
        // Render payment settings
        function renderPaymentSettings(settings) {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">Payment Settings</h3>
                    </div>
                    <div class="admin-card-body">
                        <form id="payment-settings-form">
                            <div class="admin-tabs">
                                <div class="admin-tab active" data-tab="general">General</div>
                                <div class="admin-tab" data-tab="crypto">Cryptocurrency</div>
                                <div class="admin-tab" data-tab="bank">Bank Transfer</div>
                                <div class="admin-tab" data-tab="card">Credit Card</div>
                            </div>
                            
                            <div class="admin-tab-content active" id="general-tab">
                                <div class="admin-form-group">
                                    <label for="payment-currency" class="admin-form-label">Default Payment Currency</label>
                                    <select id="payment-currency" class="admin-form-control admin-form-select">
                                        <option value="USD" ${settings.defaultCurrency === 'USD' ? 'selected' : ''}>US Dollar (USD)</option>
                                        <option value="EUR" ${settings.defaultCurrency === 'EUR' ? 'selected' : ''}>Euro (EUR)</option>
                                        <option value="GBP" ${settings.defaultCurrency === 'GBP' ? 'selected' : ''}>British Pound (GBP)</option>
                                        <option value="BTC" ${settings.defaultCurrency === 'BTC' ? 'selected' : ''}>Bitcoin (BTC)</option>
                                        <option value="ETH" ${settings.defaultCurrency === 'ETH' ? 'selected' : ''}>Ethereum (ETH)</option>
                                    </select>
                                </div>
                                <div class="admin-form-group">
                                    <label for="payment-min-deposit" class="admin-form-label">Minimum Deposit Amount</label>
                                    <input type="number" id="payment-min-deposit" class="admin-form-control" min="0" step="0.01" value="${settings.minDeposit}">
                                </div>
                                <div class="admin-form-group">
                                    <label for="payment-max-deposit" class="admin-form-label">Maximum Deposit Amount</label>
                                    <input type="number" id="payment-max-deposit" class="admin-form-control" min="0" step="0.01" value="${settings.maxDeposit || ''}" placeholder="Leave empty for no limit">
                                </div>
                                <div class="admin-form-group">
                                    <label for="payment-deposit-fee" class="admin-form-label">Deposit Fee (%)</label>
                                    <input type="number" id="payment-deposit-fee" class="admin-form-control" min="0" max="100" step="0.01" value="${settings.depositFee}">
                                </div>
                                <div class="admin-form-group">
                                    <label for="payment-min-withdrawal" class="admin-form-label">Minimum Withdrawal Amount</label>
                                    <input type="number" id="payment-min-withdrawal" class="admin-form-control" min="0" step="0.01" value="${settings.minWithdrawal}">
                                </div>
                                <div class="admin-form-group">
                                    <label for="payment-max-withdrawal" class="admin-form-label">Maximum Withdrawal Amount</label>
                                    <input type="number" id="payment-max-withdrawal" class="admin-form-control" min="0" step="0.01" value="${settings.maxWithdrawal || ''}" placeholder="Leave empty for no limit">
                                </div>
                                <div class="admin-form-group">
                                    <label for="payment-withdrawal-fee" class="admin-form-label">Withdrawal Fee (%)</label>
                                    <input type="number" id="payment-withdrawal-fee" class="admin-form-control" min="0" max="100" step="0.01" value="${settings.withdrawalFee}">
                                </div>
                            </div>
                            
                            <div class="admin-tab-content" id="crypto-tab">
                                <div class="admin-form-group">
                                    <label for="crypto-enabled" class="admin-form-label">Enable Cryptocurrency Payments</label>
                                    <select id="crypto-enabled" class="admin-form-control admin-form-select">
                                        <option value="true" ${settings.crypto.enabled ? 'selected' : ''}>Enabled</option>
                                        <option value="false" ${!settings.crypto.enabled ? 'selected' : ''}>Disabled</option>
                                    </select>
                                </div>
                                <div class="admin-form-group">
                                    <label for="crypto-coins" class="admin-form-label">Accepted Cryptocurrencies</label>
                                    <select id="crypto-coins" class="admin-form-control admin-form-select" multiple>
                                        <option value="BTC" ${settings.crypto.coins.includes('BTC') ? 'selected' : ''}>Bitcoin (BTC)</option>
                                        <option value="ETH" ${settings.crypto.coins.includes('ETH') ? 'selected' : ''}>Ethereum (ETH)</option>
                                        <option value="USDT" ${settings.crypto.coins.includes('USDT') ? 'selected' : ''}>Tether (USDT)</option>
                                        <option value="USDC" ${settings.crypto.coins.includes('USDC') ? 'selected' : ''}>USD Coin (USDC)</option>
                                        <option value="LTC" ${settings.crypto.coins.includes('LTC') ? 'selected' : ''}>Litecoin (LTC)</option>
                                        <option value="XRP" ${settings.crypto.coins.includes('XRP') ? 'selected' : ''}>Ripple (XRP)</option>
                                        <option value="BCH" ${settings.crypto.coins.includes('BCH') ? 'selected' : ''}>Bitcoin Cash (BCH)</option>
                                    </select>
                                </div>
                                <div class="admin-form-group">
                                    <label for="crypto-confirmations" class="admin-form-label">Required Confirmations</label>
                                    <input type="number" id="crypto-confirmations" class="admin-form-control" min="1" value="${settings.crypto.confirmations}">
                                </div>
                                <div class="admin-form-group">
                                    <label class="admin-form-label">Wallet Addresses</label>
                                    ${Object.entries(settings.crypto.wallets).map(([coin, address]) => `
                                        <div class="input-group mb-2">
                                            <span class="input-group-text" style="width: 80px;">${coin}</span>
                                            <input type="text" class="admin-form-control" value="${address}" id="crypto-wallet-${coin.toLowerCase()}" placeholder="${coin} wallet address">
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="admin-tab-content" id="bank-tab">
                                <div class="admin-form-group">
                                    <label for="bank-enabled" class="admin-form-label">Enable Bank Transfers</label>
                                    <select id="bank-enabled" class="admin-form-control admin-form-select">
                                        <option value="true" ${settings.bank.enabled ? 'selected' : ''}>Enabled</option>
                                        <option value="false" ${!settings.bank.enabled ? 'selected' : ''}>Disabled</option>
                                    </select>
                                </div>
                                <div class="admin-form-group">
                                    <label for="bank-name" class="admin-form-label">Bank Name</label>
                                    <input type="text" id="bank-name" class="admin-form-control" value="${settings.bank.name}">
                                </div>
                                <div class="admin-form-group">
                                    <label for="bank-account-name" class="admin-form-label">Account Name</label>
                                    <input type="text" id="bank-account-name" class="admin-form-control" value="${settings.bank.accountName}">
                                </div>
                                <div class="admin-form-group">
                                    <label for="bank-account-number" class="admin-form-label">Account Number</label>
                                    <input type="text" id="bank-account-number" class="admin-form-control" value="${settings.bank.accountNumber}">
                                </div>
                                <div class="admin-form-group">
                                    <label for="bank-iban" class="admin-form-label">IBAN</label>
                                    <input type="text" id="bank-iban" class="admin-form-control" value="${settings.bank.iban}">
                                </div>
                                <div class="admin-form-group">
                                    <label for="bank-swift" class="admin-form-label">SWIFT/BIC Code</label>
                                    <input type="text" id="bank-swift" class="admin-form-control" value="${settings.bank.swift}">
                                </div>
                                <div class="admin-form-group">
                                    <label for="bank-address" class="admin-form-label">Bank Address</label>
                                    <textarea id="bank-address" class="admin-form-control admin-form-textarea" rows="3">${settings.bank.address}</textarea>
                                </div>
                                <div class="admin-form-group">
                                    <label for="bank-instructions" class="admin-form-label">Deposit Instructions</label>
                                    <textarea id="bank-instructions" class="admin-form-control admin-form-textarea" rows="3">${settings.bank.instructions}</textarea>
                                </div>
                            </div>
                            
                            <div class="admin-tab-content" id="card-tab">
                                <div class="admin-form-group">
                                    <label for="card-enabled" class="admin-form-label">Enable Credit Card Payments</label>
                                    <select id="card-enabled" class="admin-form-control admin-form-select">
                                        <option value="true" ${settings.card.enabled ? 'selected' : ''}>Enabled</option>
                                        <option value="false" ${!settings.card.enabled ? 'selected' : ''}>Disabled</option>
                                    </select>
                                </div>
                                <div class="admin-form-group">
                                    <label for="card-provider" class="admin-form-label">Payment Processor</label>
                                    <select id="card-provider" class="admin-form-control admin-form-select">
                                        <option value="stripe" ${settings.card.provider === 'stripe' ? 'selected' : ''}>Stripe</option>
                                        <option value="paypal" ${settings.card.provider === 'paypal' ? 'selected' : ''}>PayPal</option>
                                        <option value="other" ${settings.card.provider === 'other' ? 'selected' : ''}>Other</option>
                                    </select>
                                </div>
                                <div class="admin-form-group">
                                    <label for="card-api-key" class="admin-form-label">API Key</label>
                                    <input type="text" id="card-api-key" class="admin-form-control" value="${settings.card.apiKey}">
                                </div>
                                <div class="admin-form-group">
                                    <label for="card-api-secret" class="admin-form-label">API Secret</label>
                                    <input type="password" id="card-api-secret" class="admin-form-control" value="${settings.card.apiSecret}">
                                </div>
                                <div class="admin-form-group">
                                    <label for="card-test-mode" class="admin-form-label">Test Mode</label>
                                    <select id="card-test-mode" class="admin-form-control admin-form-select">
                                        <option value="true" ${settings.card.testMode ? 'selected' : ''}>Enabled</option>
                                        <option value="false" ${!settings.card.testMode ? 'selected' : ''}>Disabled</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="admin-card-footer">
                        <button class="admin-btn admin-btn-secondary" id="payment-settings-cancel">Cancel</button>
                        <button class="admin-btn admin-btn-primary" id="payment-settings-save">Save Settings</button>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Initialize Select2 for multiple select
            $('#crypto-coins').select2({
                width: '100%',
                placeholder: 'Select cryptocurrencies'
            });
            
            // Tab switching
            $('.admin-tab').on('click', function() {
                const tabId = $(this).data('tab');
                
                $('.admin-tab').removeClass('active');
                $(this).addClass('active');
                
                $('.admin-tab-content').removeClass('active');
                $(`#${tabId}-tab`).addClass('active');
            });
            
            // Add event listeners for settings actions
            $('#payment-settings-cancel').on('click', function() {
                loadPaymentSettings(); // Reload to discard changes
            });
            
            $('#payment-settings-save').on('click', function() {
                savePaymentSettings();
            });
        }
        
        // Save payment settings
        function savePaymentSettings() {
            const settingsData = {
                defaultCurrency: $('#payment-currency').val(),
                minDeposit: parseFloat($('#payment-min-deposit').val()),
                maxDeposit: $('#payment-max-deposit').val() ? parseFloat($('#payment-max-deposit').val()) : null,
                depositFee: parseFloat($('#payment-deposit-fee').val()),
                minWithdrawal: parseFloat($('#payment-min-withdrawal').val()),
                maxWithdrawal: $('#payment-max-withdrawal').val() ? parseFloat($('#payment-max-withdrawal').val()) : null,
                withdrawalFee: parseFloat($('#payment-withdrawal-fee').val()),
                crypto: {
                    enabled: $('#crypto-enabled').val() === 'true',
                    coins: $('#crypto-coins').val(),
                    confirmations: parseInt($('#crypto-confirmations').val()),
                    wallets: {
                        BTC: $('#crypto-wallet-btc').val(),
                        ETH: $('#crypto-wallet-eth').val(),
                        USDT: $('#crypto-wallet-usdt').val(),
                        USDC: $('#crypto-wallet-usdc').val(),
                        LTC: $('#crypto-wallet-ltc').val(),
                        XRP: $('#crypto-wallet-xrp').val(),
                        BCH: $('#crypto-wallet-bch').val()
                    }
                },
                bank: {
                    enabled: $('#bank-enabled').val() === 'true',
                    name: $('#bank-name').val().trim(),
                    accountName: $('#bank-account-name').val().trim(),
                    accountNumber: $('#bank-account-number').val().trim(),
                    iban: $('#bank-iban').val().trim(),
                    swift: $('#bank-swift').val().trim(),
                    address: $('#bank-address').val().trim(),
                    instructions: $('#bank-instructions').val().trim()
                },
                card: {
                    enabled: $('#card-enabled').val() === 'true',
                    provider: $('#card-provider').val(),
                    apiKey: $('#card-api-key').val().trim(),
                    apiSecret: $('#card-api-secret').val(),
                    testMode: $('#card-test-mode').val() === 'true'
                }
            };
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/settings/payment',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: settingsData,
                success: function(response) {
                    if (response.success) {
                        showToast('success', 'Payment settings saved successfully');
                    } else {
                        showToast('error', response.message || 'Failed to save payment settings');
                    }
                },
                error: function() {
                    showToast('error', 'Failed to save payment settings');
                }
            });
        }
        
        // Load reports
        function loadReports() {
            let html = `
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">Reports</h3>
                    </div>
                    <div class="admin-card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="admin-card" style="margin-bottom: 20px;">
                                    <div class="admin-card-header">
                                        <h4 class="admin-card-title">Financial Reports</h4>
                                    </div>
                                    <div class="admin-card-body">
                                        <form id="financial-report-form">
                                            <div class="admin-form-group">
                                                <label for="financial-report-type" class="admin-form-label">Report Type</label>
                                                <select id="financial-report-type" class="admin-form-control admin-form-select">
                                                    <option value="deposits">Deposits</option>
                                                    <option value="withdrawals">Withdrawals</option>
                                                    <option value="profits">Profits</option>
                                                    <option value="transactions">All Transactions</option>
                                                </select>
                                            </div>
                                            <div class="admin-form-group">
                                                <label for="financial-report-period" class="admin-form-label">Time Period</label>
                                                <select id="financial-report-period" class="admin-form-control admin-form-select">
                                                    <option value="today">Today</option>
                                                    <option value="yesterday">Yesterday</option>
                                                    <option value="week">This Week</option>
                                                    <option value="month">This Month</option>
                                                    <option value="year">This Year</option>
                                                    <option value="custom">Custom Range</option>
                                                </select>
                                            </div>
                                            <div class="admin-form-group" id="financial-report-custom" style="display: none;">
                                                <label class="admin-form-label">Custom Date Range</label>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <input type="date" id="financial-report-start" class="admin-form-control">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <input type="date" id="financial-report-end" class="admin-form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="admin-form-group">
                                                <label for="financial-report-format" class="admin-form-label">Format</label>
                                                <select id="financial-report-format" class="admin-form-control admin-form-select">
                                                    <option value="pdf">PDF</option>
                                                    <option value="excel">Excel</option>
                                                    <option value="csv">CSV</option>
                                                </select>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="admin-card-footer">
                                        <button class="admin-btn admin-btn-primary" id="generate-financial-report">Generate Report</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="admin-card">
                                    <div class="admin-card-header">
                                        <h4 class="admin-card-title">User Reports</h4>
                                    </div>
                                    <div class="admin-card-body">
                                        <form id="user-report-form">
                                            <div class="admin-form-group">
                                                <label for="user-report-type" class="admin-form-label">Report Type</label>
                                                <select id="user-report-type" class="admin-form-control admin-form-select">
                                                    <option value="all">All Users</option>
                                                    <option value="active">Active Users</option>
                                                    <option value="investors">Investors</option>
                                                    <option value="non-investors">Non-Investors</option>
                                                    <option value="kyc-pending">KYC Pending</option>
                                                </select>
                                            </div>
                                            <div class="admin-form-group">
                                                <label for="user-report-period" class="admin-form-label">Registration Period</label>
                                                <select id="user-report-period" class="admin-form-control admin-form-select">
                                                    <option value="all">All Time</option>
                                                    <option value="today">Today</option>
                                                    <option value="week">This Week</option>
                                                    <option value="month">This Month</option>
                                                    <option value="year">This Year</option>
                                                    <option value="custom">Custom Range</option>
                                                </select>
                                            </div>
                                            <div class="admin-form-group" id="user-report-custom" style="display: none;">
                                                <label class="admin-form-label">Custom Date Range</label>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <input type="date" id="user-report-start" class="admin-form-control">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <input type="date" id="user-report-end" class="admin-form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="admin-form-group">
                                                <label for="user-report-format" class="admin-form-label">Format</label>
                                                <select id="user-report-format" class="admin-form-control admin-form-select">
                                                    <option value="pdf">PDF</option>
                                                    <option value="excel">Excel</option>
                                                    <option value="csv">CSV</option>
                                                </select>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="admin-card-footer">
                                        <button class="admin-btn admin-btn-primary" id="generate-user-report">Generate Report</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            $('#admin-content').html(html);
            
            // Show/hide custom date range based on period selection
            $('#financial-report-period, #user-report-period').on('change', function() {
                const isCustom = $(this).val() === 'custom';
                const $customDiv = $(this).attr('id') === 'financial-report-period' 
                    ? $('#financial-report-custom') 
                    : $('#user-report-custom');
                
                if (isCustom) {
                    $customDiv.show();
                } else {
                    $customDiv.hide();
                }
            });
            
            // Generate financial report
            $('#generate-financial-report').on('click', function() {
                generateReport('financial');
            });
            
            // Generate user report
            $('#generate-user-report').on('click', function() {
                generateReport('user');
            });
        }
        
        // Generate report
        function generateReport(type) {
            let reportData = {};
            let endpoint = '';
            
            if (type === 'financial') {
                reportData = {
                    reportType: $('#financial-report-type').val(),
                    period: $('#financial-report-period').val(),
                    format: $('#financial-report-format').val()
                };
                
                if (reportData.period === 'custom') {
                    reportData.startDate = $('#financial-report-start').val();
                    reportData.endDate = $('#financial-report-end').val();
                    
                    if (!reportData.startDate || !reportData.endDate) {
                        showToast('error', 'Please select both start and end dates');
                        return;
                    }
                }
                
                endpoint = 'financial';
            } else {
                reportData = {
                    reportType: $('#user-report-type').val(),
                    period: $('#user-report-period').val(),
                    format: $('#user-report-format').val()
                };
                
                if (reportData.period === 'custom') {
                    reportData.startDate = $('#user-report-start').val();
                    reportData.endDate = $('#user-report-end').val();
                    
                    if (!reportData.startDate || !reportData.endDate) {
                        showToast('error', 'Please select both start and end dates');
                        return;
                    }
                }
                
                endpoint = 'user';
            }
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/reports/${endpoint}`,
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                data: reportData,
                xhrFields: {
                    responseType: 'blob'
                },
                success: function(response) {
                    // Create a blob from the response
                    const blob = new Blob([response], { type: response.type });
                    
                    // Create a link element
                    const link = document.createElement('a');
                    link.href = window.URL.createObjectURL(blob);
                    
                    // Determine the file extension based on format
                    const extension = reportData.format === 'pdf' ? 'pdf' : 
                                     reportData.format === 'excel' ? 'xlsx' : 'csv';
                    
                    // Set the download attribute with a filename
                    link.download = `${endpoint}-report-${new Date().toISOString().split('T')[0]}.${extension}`;
                    
                    // Append the link to the body and trigger the download
                    document.body.appendChild(link);
                    link.click();
                    
                    // Clean up
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(link.href);
                    
                    showToast('success', 'Report generated successfully');
                },
                error: function(xhr) {
                    if (xhr.status === 400) {
                        showToast('error', 'Invalid date range or parameters');
                    } else {
                        showToast('error', 'Failed to generate report');
                    }
                }
            });
        }
        
        // Update notification count
        function updateNotificationCount() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/notifications/count',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminAuthToken
                },
                success: function(response) {
                    if (response.success) {
                        const count = response.data.count;
                        $('#admin-notification-count').text(count);
                        
                        if (count > 0) {
                            $('#admin-notification-count').show();
                        } else {
                            $('#admin-notification-count').hide();
                        }
                    }
                }
            });
        }
        
        // Add chat message
        function addChatMessage(message) {
            const isAdmin = message.sender === 'admin';
            const timestamp = new Date(message.timestamp).toLocaleTimeString();
            
            const messageHtml = `
                <div class="admin-chat-message ${isAdmin ? 'admin' : 'user'}">
                    <div class="admin-chat-message-content">
                        ${message.text}
                    </div>
                    <div class="admin-chat-message-info">
                        ${isAdmin ? 'You' : message.senderName} â¢ ${timestamp}
                    </div>
                </div>
            `;
            
            $('#admin-chat-body').append(messageHtml);
            $('#admin-chat-body').scrollTop($('#admin-chat-body')[0].scrollHeight);
        }
        
        // Send chat message
        function sendChatMessage() {
            const message = $('#admin-chat-input').val().trim();
            
            if (!message) {
                return;
            }
            
            // Add the message to the chat immediately
            addChatMessage({
                sender: 'admin',
                senderName: 'You',
                text: message,
                timestamp: new Date().toISOString()
            });
            
            // Clear the input
            $('#admin-chat-input').val('');
            
            // In a real implementation, you would send the message to the server
            // and broadcast it to the appropriate user(s)
            if (socket) {
                socket.emit('adminChatMessage', {
                    message: message,
                    timestamp: new Date().toISOString()
                });
            }
        }
        
        // Show toast notification
        function showToast(type, message) {
            toastr[type](message);
        }
        
        // Initialize toastr
        toastr.options = {
            closeButton: true,
            progressBar: true,
            positionClass: 'toast-top-right',
            timeOut: 5000,
            extendedTimeOut: 1000,
            showEasing: 'swing',
            hideEasing: 'linear',
            showMethod: 'fadeIn',
            hideMethod: 'fadeOut'
        };
    </script>
</body>
</html>
