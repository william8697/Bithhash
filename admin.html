<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Dashboard | BitHash LLC</title>
    <meta name="description" content="BitHash LLC Admin Dashboard for managing institutional Bitcoin mining operations">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" type="image/png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Toastr -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    
    <style>
        :root {
            --primary: #00D395;
            --primary-dark: #00B783;
            --secondary: #1E1E1E;
            --secondary-dark: #121212;
            --light: #F5F5F5;
            --lighter: #FFFFFF;
            --gray: #8E8E8E;
            --gray-light: #E0E0E0;
            --success: #00D395;
            --warning: #FFB800;
            --error: #FF3D57;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F9FAFB;
            color: #1F2937;
            margin: 0;
            padding: 0;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background-color: var(--secondary);
            color: white;
            transition: all 0.3s;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 20px;
            background-color: var(--secondary-dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .sidebar-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .sidebar-menu li {
            position: relative;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--gray-light);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-menu a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .sidebar-menu .badge {
            position: absolute;
            right: 20px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }
        
        .main-content {
            flex: 1;
            margin-left: 280px;
            transition: all 0.3s;
        }
        
        .navbar {
            background-color: white;
            padding: 15px 25px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .navbar-left {
            display: flex;
            align-items: center;
        }
        
        .navbar-right {
            display: flex;
            align-items: center;
        }
        
        .navbar-toggle {
            display: none;
            margin-right: 15px;
            cursor: pointer;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            cursor: pointer;
            position: relative;
        }
        
        .user-profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: var(--border-radius);
            padding: 10px 0;
            min-width: 200px;
            display: none;
            z-index: 1000;
        }
        
        .dropdown-menu.show {
            display: block;
        }
        
        .dropdown-menu a {
            display: block;
            padding: 8px 20px;
            color: #4B5563;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .dropdown-menu a:hover {
            background-color: #F3F4F6;
            color: #111827;
        }
        
        .content-wrapper {
            padding: 25px;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 25px;
            overflow: hidden;
        }
        
        .card-header {
            padding: 15px 20px;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .card-footer {
            padding: 15px 20px;
            border-top: 1px solid #E5E7EB;
            background-color: #F9FAFB;
        }
        
        .stats-card {
            text-align: center;
            padding: 20px;
        }
        
        .stats-card .value {
            font-size: 32px;
            font-weight: 700;
            margin: 10px 0;
            color: var(--primary);
        }
        
        .stats-card .label {
            color: var(--gray);
            font-size: 14px;
        }
        
        .stats-card .change {
            font-size: 12px;
            margin-top: 5px;
        }
        
        .stats-card .change.positive {
            color: var(--success);
        }
        
        .stats-card .change.negative {
            color: var(--error);
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #E5E7EB;
        }
        
        .table th {
            background-color: #F9FAFB;
            font-weight: 600;
            color: #4B5563;
        }
        
        .table tr:hover {
            background-color: #F9FAFB;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success {
            background-color: #D1FAE5;
            color: #065F46;
        }
        
        .badge-warning {
            background-color: #FEF3C7;
            color: #92400E;
        }
        
        .badge-danger {
            background-color: #FEE2E2;
            color: #991B1B;
        }
        
        .badge-info {
            background-color: #DBEAFE;
            color: #1E40AF;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-size: 14px;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-outline-primary {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--error);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #E02424;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #00B783;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #D1D5DB;
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 211, 149, 0.1);
        }
        
        .select2-container {
            width: 100% !important;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1050;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-dialog {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            margin: 0 20px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #E5E7EB;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            opacity: 0.5;
            transition: all 0.3s;
        }
        
        .close:hover {
            opacity: 1;
        }
        
        .login-container {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            background-color: #F3F4F6;
        }
        
        .login-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 100%;
            max-width: 450px;
            padding: 40px;
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo img {
            height: 50px;
        }
        
        .login-title {
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--secondary);
        }
        
        .login-subtitle {
            text-align: center;
            color: var(--gray);
            margin-bottom: 30px;
        }
        
        .login-form .form-group {
            margin-bottom: 20px;
        }
        
        .login-form .btn {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            margin-top: 10px;
        }
        
        .login-footer {
            text-align: center;
            margin-top: 20px;
            color: var(--gray);
        }
        
        .login-footer a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .alert-danger {
            background-color: #FEE2E2;
            color: #991B1B;
            border: 1px solid #FECACA;
        }
        
        .alert-success {
            background-color: #D1FAE5;
            color: #065F46;
            border: 1px solid #A7F3D0;
        }
        
        .tab-content {
            padding: 20px 0;
        }
        
        .nav-tabs {
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            flex-wrap: wrap;
            padding-left: 0;
            margin-bottom: 0;
            list-style: none;
        }
        
        .nav-tabs .nav-item {
            margin-bottom: -1px;
        }
        
        .nav-tabs .nav-link {
            border: 1px solid transparent;
            border-top-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
            padding: 10px 20px;
            color: #4B5563;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .nav-tabs .nav-link:hover {
            border-color: #E5E7EB;
            color: #111827;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary);
            background-color: white;
            border-color: #E5E7EB #E5E7EB white;
            font-weight: 500;
        }
        
        .chat-container {
            display: flex;
            height: 500px;
            border: 1px solid #E5E7EB;
            border-radius: var(--border-radius);
            overflow: hidden;
        }
        
        .chat-sidebar {
            width: 300px;
            border-right: 1px solid #E5E7EB;
            background-color: #F9FAFB;
            overflow-y: auto;
        }
        
        .chat-search {
            padding: 15px;
            border-bottom: 1px solid #E5E7EB;
        }
        
        .chat-users {
            padding: 0;
            margin: 0;
            list-style: none;
        }
        
        .chat-user {
            padding: 15px;
            border-bottom: 1px solid #E5E7EB;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        
        .chat-user:hover {
            background-color: #E5E7EB;
        }
        
        .chat-user.active {
            background-color: var(--primary);
            color: white;
        }
        
        .chat-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            background-color: #E5E7EB;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chat-user-name {
            font-weight: 500;
        }
        
        .chat-user-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: auto;
        }
        
        .chat-user-status.online {
            background-color: var(--success);
        }
        
        .chat-user-status.offline {
            background-color: var(--gray);
        }
        
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            padding: 15px;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            align-items: center;
        }
        
        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: white;
        }
        
        .chat-message {
            margin-bottom: 15px;
            max-width: 70%;
        }
        
        .chat-message-incoming {
            margin-right: auto;
        }
        
        .chat-message-outgoing {
            margin-left: auto;
            text-align: right;
        }
        
        .chat-message-content {
            display: inline-block;
            padding: 10px 15px;
            border-radius: 18px;
            background-color: #F3F4F6;
            color: #111827;
        }
        
        .chat-message-outgoing .chat-message-content {
            background-color: var(--primary);
            color: white;
        }
        
        .chat-message-time {
            font-size: 12px;
            color: var(--gray);
            margin-top: 5px;
        }
        
        .chat-input {
            padding: 15px;
            border-top: 1px solid #E5E7EB;
            background-color: #F9FAFB;
        }
        
        .chat-input-form {
            display: flex;
            gap: 10px;
        }
        
        .chat-input-field {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #E5E7EB;
            border-radius: 20px;
            outline: none;
        }
        
        .chat-input-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 1001;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .navbar-toggle {
                display: block;
            }
        }
        
        @media (max-width: 768px) {
            .content-wrapper {
                padding: 15px;
            }
            
            .stats-card .value {
                font-size: 24px;
            }
            
            .modal-dialog {
                margin: 0 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen (shown when not authenticated) -->
    <div id="login-screen" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash LLC">
            </div>
            <h1 class="login-title">Admin Portal</h1>
            <p class="login-subtitle">Sign in to access the dashboard</p>
            
            <div id="login-error" class="alert alert-danger" style="display: none;"></div>
            
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" id="email" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" class="form-control" required>
                </div>
                
                <div class="form-group" id="two-factor-group" style="display: none;">
                    <label for="two-factor-code" class="form-label">Two-Factor Code</label>
                    <input type="text" id="two-factor-code" class="form-control" placeholder="Enter 6-digit code">
                </div>
                
                <button type="submit" class="btn btn-primary" id="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
            </form>
            
            <div class="login-footer">
                <a href="#" id="forgot-password-link">Forgot password?</a>
            </div>
        </div>
    </div>
    
    <!-- Admin Dashboard (shown when authenticated) -->
    <div id="admin-dashboard" style="display: none;">
        <div class="admin-container">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h3>BitHash LLC</h3>
                    <button class="close text-white" id="sidebar-close">&times;</button>
                </div>
                
                <div class="sidebar-menu">
                    <ul>
                        <li>
                            <a href="#" class="active" data-section="dashboard">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li>
                            <a href="#" data-section="users">
                                <i class="fas fa-users"></i> Users
                                <span class="badge" id="users-badge">0</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" data-section="deposits">
                                <i class="fas fa-money-bill-wave"></i> Deposits
                                <span class="badge" id="deposits-badge">0</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" data-section="withdrawals">
                                <i class="fas fa-wallet"></i> Withdrawals
                                <span class="badge" id="withdrawals-badge">0</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" data-section="transactions">
                                <i class="fas fa-exchange-alt"></i> Transactions
                            </a>
                        </li>
                        <li>
                            <a href="#" data-section="investments">
                                <i class="fas fa-chart-line"></i> Investments
                            </a>
                        </li>
                        <li>
                            <a href="#" data-section="support">
                                <i class="fas fa-headset"></i> Support
                                <span class="badge" id="support-badge">0</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" data-section="settings">
                                <i class="fas fa-cog"></i> Settings
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <!-- Navbar -->
                <div class="navbar">
                    <div class="navbar-left">
                        <button class="navbar-toggle" id="sidebar-toggle">
                            <i class="fas fa-bars"></i>
                        </button>
                        <h4 id="current-section">Dashboard</h4>
                    </div>
                    
                    <div class="navbar-right">
                        <div class="user-profile" id="user-profile">
                            <img src="https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y" alt="Admin" id="admin-avatar">
                            <span id="admin-name">Admin</span>
                            <i class="fas fa-chevron-down ml-2"></i>
                            
                            <div class="dropdown-menu" id="dropdown-menu">
                                <a href="#" id="profile-link"><i class="fas fa-user"></i> Profile</a>
                                <a href="#" id="settings-link"><i class="fas fa-cog"></i> Settings</a>
                                <a href="#" id="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Content Wrapper -->
                <div class="content-wrapper">
                    <!-- Dashboard Section -->
                    <div id="dashboard-section">
                        <div class="page-header">
                            <h2 class="page-title">Dashboard Overview</h2>
                            <div>
                                <button class="btn btn-primary" id="refresh-btn">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-3">
                                <div class="card stats-card">
                                    <div class="card-body">
                                        <div class="label">Total Users</div>
                                        <div class="value" id="total-users">0</div>
                                        <div class="change positive" id="users-change">
                                            <i class="fas fa-arrow-up"></i> 0% from last week
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3">
                                <div class="card stats-card">
                                    <div class="card-body">
                                        <div class="label">Active Deposits</div>
                                        <div class="value" id="total-deposits">$0</div>
                                        <div class="change positive" id="deposits-change">
                                            <i class="fas fa-arrow-up"></i> 0% from last week
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3">
                                <div class="card stats-card">
                                    <div class="card-body">
                                        <div class="label">Pending Withdrawals</div>
                                        <div class="value" id="total-withdrawals">$0</div>
                                        <div class="change negative" id="withdrawals-change">
                                            <i class="fas fa-arrow-down"></i> 0% from last week
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3">
                                <div class="card stats-card">
                                    <div class="card-body">
                                        <div class="label">Support Tickets</div>
                                        <div class="value" id="total-tickets">0</div>
                                        <div class="change positive" id="tickets-change">
                                            <i class="fas fa-arrow-up"></i> 0% from last week
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Recent Activity</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table" id="activity-table">
                                                <thead>
                                                    <tr>
                                                        <th>Time</th>
                                                        <th>User</th>
                                                        <th>Activity</th>
                                                        <th>Details</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Will be populated by JavaScript -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">System Status</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label class="form-label">API Status</label>
                                            <div class="alert alert-success" id="api-status">
                                                <i class="fas fa-check-circle"></i> Operational
                                            </div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Database Status</label>
                                            <div class="alert alert-success" id="db-status">
                                                <i class="fas fa-check-circle"></i> Connected
                                            </div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Server Load</label>
                                            <div class="progress">
                                                <div class="progress-bar bg-success" id="server-load" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Last Backup</label>
                                            <div id="last-backup">Today, 03:00 AM</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Users Section -->
                    <div id="users-section" style="display: none;">
                        <div class="page-header">
                            <h2 class="page-title">User Management</h2>
                            <div>
                                <button class="btn btn-primary" id="add-user-btn">
                                    <i class="fas fa-plus"></i> Add User
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">All Users</h3>
                                <div class="card-tools">
                                    <div class="input-group input-group-sm" style="width: 150px;">
                                        <input type="text" name="table_search" class="form-control float-right" placeholder="Search">
                                        <div class="input-group-append">
                                            <button type="submit" class="btn btn-default">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover" id="users-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Balance</th>
                                                <th>Status</th>
                                                <th>Joined</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Deposits Section -->
                    <div id="deposits-section" style="display: none;">
                        <div class="page-header">
                            <h2 class="page-title">Deposit Requests</h2>
                            <div>
                                <button class="btn btn-primary" id="export-deposits-btn">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Pending Deposits</h3>
                                <ul class="nav nav-tabs card-header-tabs">
                                    <li class="nav-item">
                                        <a class="nav-link active" href="#" data-type="card">Card</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#" data-type="btc">Bitcoin</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#" data-type="bank">Bank Transfer</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover" id="deposits-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>User</th>
                                                <th>Amount</th>
                                                <th>Method</th>
                                                <th>Details</th>
                                                <th>Date</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Withdrawals Section -->
                    <div id="withdrawals-section" style="display: none;">
                        <div class="page-header">
                            <h2 class="page-title">Withdrawal Requests</h2>
                            <div>
                                <button class="btn btn-primary" id="export-withdrawals-btn">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Pending Withdrawals</h3>
                                <ul class="nav nav-tabs card-header-tabs">
                                    <li class="nav-item">
                                        <a class="nav-link active" href="#" data-status="pending">Pending</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#" data-status="completed">Completed</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#" data-status="rejected">Rejected</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover" id="withdrawals-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>User</th>
                                                <th>Amount</th>
                                                <th>Method</th>
                                                <th>Wallet/Account</th>
                                                <th>Date</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Transactions Section -->
                    <div id="transactions-section" style="display: none;">
                        <div class="page-header">
                            <h2 class="page-title">Transaction History</h2>
                            <div>
                                <div class="btn-group">
                                    <button class="btn btn-outline-primary" id="filter-today">Today</button>
                                    <button class="btn btn-outline-primary" id="filter-week">This Week</button>
                                    <button class="btn btn-outline-primary" id="filter-month">This Month</button>
                                    <button class="btn btn-outline-primary" id="filter-all">All Time</button>
                                </div>
                                <button class="btn btn-primary ml-2" id="export-transactions-btn">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">All Transactions</h3>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover" id="transactions-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>User</th>
                                                <th>Type</th>
                                                <th>Amount</th>
                                                <th>Fee</th>
                                                <th>Net Amount</th>
                                                <th>Status</th>
                                                <th>Date</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Investments Section -->
                    <div id="investments-section" style="display: none;">
                        <div class="page-header">
                            <h2 class="page-title">Investment Management</h2>
                            <div>
                                <button class="btn btn-primary" id="add-investment-btn">
                                    <i class="fas fa-plus"></i> Add Plan
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Active Investments</h3>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover" id="investments-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>User</th>
                                                <th>Plan</th>
                                                <th>Amount</th>
                                                <th>Profit</th>
                                                <th>Start Date</th>
                                                <th>End Date</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-header">
                                <h3 class="card-title">Investment Plans</h3>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover" id="plans-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Min Amount</th>
                                                <th>Max Amount</th>
                                                <th>Duration</th>
                                                <th>Daily Profit</th>
                                                <th>Total Profit</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Support Section -->
                    <div id="support-section" style="display: none;">
                        <div class="page-header">
                            <h2 class="page-title">Support Center</h2>
                            <div>
                                <button class="btn btn-primary" id="refresh-tickets-btn">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Open Tickets</h3>
                                    </div>
                                    <div class="card-body" style="padding: 0;">
                                        <div class="list-group list-group-flush" id="tickets-list">
                                            <!-- Will be populated by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title" id="ticket-subject">Select a ticket to view</h3>
                                    </div>
                                    <div class="card-body">
                                        <div id="ticket-details" style="display: none;">
                                            <div class="ticket-meta mb-4">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <strong>User:</strong> <span id="ticket-user"></span>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <strong>Status:</strong> <span id="ticket-status" class="badge badge-warning">Open</span>
                                                    </div>
                                                </div>
                                                <div class="row mt-2">
                                                    <div class="col-md-6">
                                                        <strong>Created:</strong> <span id="ticket-created"></span>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <strong>Last Updated:</strong> <span id="ticket-updated"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="ticket-messages mb-4" id="ticket-messages">
                                                <!-- Messages will be populated here -->
                                            </div>
                                            
                                            <div class="ticket-reply">
                                                <form id="reply-form">
                                                    <div class="form-group">
                                                        <label for="reply-message" class="form-label">Your Reply</label>
                                                        <textarea class="form-control" id="reply-message" rows="3" required></textarea>
                                                    </div>
                                                    <div class="form-group">
                                                        <button type="submit" class="btn btn-primary">Send Reply</button>
                                                        <button type="button" class="btn btn-success ml-2" id="close-ticket-btn">Close Ticket</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        
                                        <div id="no-ticket-selected">
                                            <div class="alert alert-info">
                                                Please select a ticket from the list to view its details.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Settings Section -->
                    <div id="settings-section" style="display: none;">
                        <div class="page-header">
                            <h2 class="page-title">System Settings</h2>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <ul class="nav nav-tabs card-header-tabs">
                                    <li class="nav-item">
                                        <a class="nav-link active" href="#" data-tab="general">General</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#" data-tab="security">Security</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#" data-tab="email">Email</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#" data-tab="payment">Payment</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-body">
                                <div id="general-settings">
                                    <form id="general-settings-form">
                                        <div class="form-group">
                                            <label for="site-name" class="form-label">Site Name</label>
                                            <input type="text" class="form-control" id="site-name" required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="site-url" class="form-label">Site URL</label>
                                            <input type="url" class="form-control" id="site-url" required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="site-email" class="form-label">Contact Email</label>
                                            <input type="email" class="form-control" id="site-email" required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="site-currency" class="form-label">Default Currency</label>
                                            <select class="form-control" id="site-currency" required>
                                                <option value="USD">US Dollar (USD)</option>
                                                <option value="EUR">Euro (EUR)</option>
                                                <option value="GBP">British Pound (GBP)</option>
                                                <option value="BTC">Bitcoin (BTC)</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="maintenance-mode" class="form-label">Maintenance Mode</label>
                                            <select class="form-control" id="maintenance-mode" required>
                                                <option value="0">Disabled</option>
                                                <option value="1">Enabled</option>
                                            </select>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary">Save Settings</button>
                                    </form>
                                </div>
                                
                                <div id="security-settings" style="display: none;">
                                    <form id="security-settings-form">
                                        <div class="form-group">
                                            <label for="login-attempts" class="form-label">Max Login Attempts</label>
                                            <input type="number" class="form-control" id="login-attempts" min="1" max="10" required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="login-timeout" class="form-label">Login Timeout (minutes)</label>
                                            <input type="number" class="form-control" id="login-timeout" min="1" max="60" required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="2fa-enforcement" class="form-label">2FA Enforcement</label>
                                            <select class="form-control" id="2fa-enforcement" required>
                                                <option value="0">Optional</option>
                                                <option value="1">Required for Admins</option>
                                                <option value="2">Required for All Users</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="password-strength" class="form-label">Minimum Password Strength</label>
                                            <select class="form-control" id="password-strength" required>
                                                <option value="1">Weak</option>
                                                <option value="2">Medium</option>
                                                <option value="3">Strong</option>
                                                <option value="4">Very Strong</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="ip-restriction">
                                                <label class="form-check-label" for="ip-restriction">Enable IP Restriction</label>
                                            </div>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary">Save Settings</button>
                                    </form>
                                </div>
                                
                                <div id="email-settings" style="display: none;">
                                    <form id="email-settings-form">
                                        <div class="form-group">
                                            <label for="mail-driver" class="form-label">Mail Driver</label>
                                            <select class="form-control" id="mail-driver" required>
                                                <option value="smtp">SMTP</option>
                                                <option value="mailgun">Mailgun</option>
                                                <option value="sendgrid">SendGrid</option>
                                                <option value="ses">Amazon SES</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="mail-host" class="form-label">SMTP Host</label>
                                            <input type="text" class="form-control" id="mail-host">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="mail-port" class="form-label">SMTP Port</label>
                                            <input type="number" class="form-control" id="mail-port">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="mail-username" class="form-label">SMTP Username</label>
                                            <input type="text" class="form-control" id="mail-username">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="mail-password" class="form-label">SMTP Password</label>
                                            <input type="password" class="form-control" id="mail-password">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="mail-encryption" class="form-label">Encryption</label>
                                            <select class="form-control" id="mail-encryption">
                                                <option value="tls">TLS</option>
                                                <option value="ssl">SSL</option>
                                                <option value="">None</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="mail-from-address" class="form-label">From Address</label>
                                            <input type="email" class="form-control" id="mail-from-address" required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="mail-from-name" class="form-label">From Name</label>
                                            <input type="text" class="form-control" id="mail-from-name" required>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary">Save Settings</button>
                                        <button type="button" class="btn btn-success ml-2" id="test-email-btn">Test Email</button>
                                    </form>
                                </div>
                                
                                <div id="payment-settings" style="display: none;">
                                    <form id="payment-settings-form">
                                        <div class="form-group">
                                            <label for="payment-mode" class="form-label">Payment Mode</label>
                                            <select class="form-control" id="payment-mode" required>
                                                <option value="sandbox">Sandbox</option>
                                                <option value="live">Live</option>
                                            </select>
                                        </div>
                                        
                                        <h5 class="mt-4">Card Payments</h5>
                                        <div class="form-group">
                                            <label for="stripe-public-key" class="form-label">Stripe Public Key</label>
                                            <input type="text" class="form-control" id="stripe-public-key">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="stripe-secret-key" class="form-label">Stripe Secret Key</label>
                                            <input type="password" class="form-control" id="stripe-secret-key">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="card-processing-fee" class="form-label">Card Processing Fee (%)</label>
                                            <input type="number" step="0.01" class="form-control" id="card-processing-fee" min="0" max="10">
                                        </div>
                                        
                                        <h5 class="mt-4">Bitcoin Payments</h5>
                                        <div class="form-group">
                                            <label for="btc-wallet" class="form-label">Bitcoin Wallet Address</label>
                                            <input type="text" class="form-control" id="btc-wallet">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="btc-confirmations" class="form-label">Required Confirmations</label>
                                            <input type="number" class="form-control" id="btc-confirmations" min="1" max="6">
                                        </div>
                                        
                                        <h5 class="mt-4">Bank Transfer</h5>
                                        <div class="form-group">
                                            <label for="bank-name" class="form-label">Bank Name</label>
                                            <input type="text" class="form-control" id="bank-name">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="account-name" class="form-label">Account Name</label>
                                            <input type="text" class="form-control" id="account-name">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="account-number" class="form-label">Account Number</label>
                                            <input type="text" class="form-control" id="account-number">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="iban" class="form-label">IBAN</label>
                                            <input type="text" class="form-control" id="iban">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="swift-code" class="form-label">SWIFT Code</label>
                                            <input type="text" class="form-control" id="swift-code">
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary">Save Settings</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <!-- Add User Modal -->
    <div class="modal" id="add-user-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Add New User</h3>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-user-form">
                    <div class="form-group">
                        <label for="new-user-name" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="new-user-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="new-user-email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="new-user-email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="new-user-password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="new-user-password" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="new-user-balance" class="form-label">Initial Balance</label>
                        <input type="number" step="0.01" class="form-control" id="new-user-balance" value="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label for="new-user-status" class="form-label">Status</label>
                        <select class="form-control" id="new-user-status" required>
                            <option value="active">Active</option>
                            <option value="pending">Pending</option>
                            <option value="suspended">Suspended</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="new-user-verified">
                            <label class="form-check-label" for="new-user-verified">Email Verified</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="new-user-2fa">
                            <label class="form-check-label" for="new-user-2fa">Enable 2FA</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-add-user">Cancel</button>
                <button class="btn btn-primary" id="submit-add-user">Add User</button>
            </div>
        </div>
    </div>
    
    <!-- Edit User Modal -->
    <div class="modal" id="edit-user-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Edit User</h3>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-user-form">
                    <input type="hidden" id="edit-user-id">
                    
                    <div class="form-group">
                        <label for="edit-user-name" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="edit-user-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-user-email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="edit-user-email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-user-balance" class="form-label">Balance</label>
                        <input type="number" step="0.01" class="form-control" id="edit-user-balance" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-user-status" class="form-label">Status</label>
                        <select class="form-control" id="edit-user-status" required>
                            <option value="active">Active</option>
                            <option value="pending">Pending</option>
                            <option value="suspended">Suspended</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="edit-user-verified">
                            <label class="form-check-label" for="edit-user-verified">Email Verified</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="edit-user-2fa">
                            <label class="form-check-label" for="edit-user-2fa">2FA Enabled</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Joined Date</label>
                        <div id="edit-user-joined" class="form-control-plaintext"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Last Login</label>
                        <div id="edit-user-last-login" class="form-control-plaintext"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-edit-user">Cancel</button>
                <button class="btn btn-primary" id="submit-edit-user">Save Changes</button>
                <button class="btn btn-danger" id="reset-password-user">Reset Password</button>
            </div>
        </div>
    </div>
    
    <!-- View Deposit Modal -->
    <div class="modal" id="view-deposit-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Deposit Details</h3>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">User</label>
                            <div id="deposit-user" class="form-control-plaintext"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Amount</label>
                            <div id="deposit-amount" class="form-control-plaintext"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Method</label>
                            <div id="deposit-method" class="form-control-plaintext"></div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Date</label>
                            <div id="deposit-date" class="form-control-plaintext"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <div id="deposit-status" class="form-control-plaintext"></div>
                        </div>
                        
                        <div class="form-group" id="deposit-details-group">
                            <label class="form-label" id="deposit-details-label">Card Details</label>
                            <div id="deposit-details" class="form-control-plaintext"></div>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4" id="deposit-proof-card">
                    <div class="card-header">
                        <h4 class="card-title">Payment Proof</h4>
                    </div>
                    <div class="card-body">
                        <div id="deposit-proof-container">
                            <img id="deposit-proof-image" src="" alt="Payment Proof" style="max-width: 100%; display: none;">
                            <div id="deposit-proof-none" class="alert alert-info">No payment proof provided</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-view-deposit">Close</button>
                <button class="btn btn-success" id="approve-deposit">Approve</button>
                <button class="btn btn-danger" id="reject-deposit">Reject</button>
            </div>
        </div>
    </div>
    
    <!-- View Withdrawal Modal -->
    <div class="modal" id="view-withdrawal-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Withdrawal Details</h3>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">User</label>
                            <div id="withdrawal-user" class="form-control-plaintext"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Amount</label>
                            <div id="withdrawal-amount" class="form-control-plaintext"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Fee</label>
                            <div id="withdrawal-fee" class="form-control-plaintext"></div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Net Amount</label>
                            <div id="withdrawal-net-amount" class="form-control-plaintext"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Method</label>
                            <div id="withdrawal-method" class="form-control-plaintext"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Wallet/Account</label>
                            <div id="withdrawal-wallet" class="form-control-plaintext"></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group mt-3">
                    <label for="withdrawal-notes" class="form-label">Admin Notes</label>
                    <textarea class="form-control" id="withdrawal-notes" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-view-withdrawal">Close</button>
                <button class="btn btn-success" id="approve-withdrawal">Approve</button>
                <button class="btn btn-danger" id="reject-withdrawal">Reject</button>
            </div>
        </div>
    </div>
    
    <!-- Add Investment Plan Modal -->
    <div class="modal" id="add-plan-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Add Investment Plan</h3>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-plan-form">
                    <div class="form-group">
                        <label for="plan-name" class="form-label">Plan Name</label>
                        <input type="text" class="form-control" id="plan-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="plan-min-amount" class="form-label">Minimum Amount</label>
                        <input type="number" step="0.01" class="form-control" id="plan-min-amount" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="plan-max-amount" class="form-label">Maximum Amount</label>
                        <input type="number" step="0.01" class="form-control" id="plan-max-amount">
                        <small class="text-muted">Leave empty for no maximum</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="plan-duration" class="form-label">Duration (days)</label>
                        <input type="number" class="form-control" id="plan-duration" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="plan-daily-profit" class="form-label">Daily Profit (%)</label>
                        <input type="number" step="0.01" class="form-control" id="plan-daily-profit" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="plan-total-profit" class="form-label">Total Profit (%)</label>
                        <input type="number" step="0.01" class="form-control" id="plan-total-profit" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="plan-status" class="form-label">Status</label>
                        <select class="form-control" id="plan-status" required>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="plan-description" class="form-label">Description</label>
                        <textarea class="form-control" id="plan-description" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-add-plan">Cancel</button>
                <button class="btn btn-primary" id="submit-add-plan">Add Plan</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Investment Plan Modal -->
    <div class="modal" id="edit-plan-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Edit Investment Plan</h3>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-plan-form">
                    <input type="hidden" id="edit-plan-id">
                    
                    <div class="form-group">
                        <label for="edit-plan-name" class="form-label">Plan Name</label>
                        <input type="text" class="form-control" id="edit-plan-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-plan-min-amount" class="form-label">Minimum Amount</label>
                        <input type="number" step="0.01" class="form-control" id="edit-plan-min-amount" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-plan-max-amount" class="form-label">Maximum Amount</label>
                        <input type="number" step="0.01" class="form-control" id="edit-plan-max-amount">
                        <small class="text-muted">Leave empty for no maximum</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-plan-duration" class="form-label">Duration (days)</label>
                        <input type="number" class="form-control" id="edit-plan-duration" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-plan-daily-profit" class="form-label">Daily Profit (%)</label>
                        <input type="number" step="0.01" class="form-control" id="edit-plan-daily-profit" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-plan-total-profit" class="form-label">Total Profit (%)</label>
                        <input type="number" step="0.01" class="form-control" id="edit-plan-total-profit" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-plan-status" class="form-label">Status</label>
                        <select class="form-control" id="edit-plan-status" required>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-plan-description" class="form-label">Description</label>
                        <textarea class="form-control" id="edit-plan-description" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-edit-plan">Cancel</button>
                <button class="btn btn-primary" id="submit-edit-plan">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- View User Investment Modal -->
    <div class="modal" id="view-investment-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Investment Details</h3>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">User</label>
                            <div id="investment-user" class="form-control-plaintext"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Plan</label>
                            <div id="investment-plan" class="form-control-plaintext"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Amount</label>
                            <div id="investment-amount" class="form-control-plaintext"></div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Daily Profit</label>
                            <div id="investment-daily-profit" class="form-control-plaintext"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Start Date</label>
                            <div id="investment-start-date" class="form-control-plaintext"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">End Date</label>
                            <div id="investment-end-date" class="form-control-plaintext"></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group mt-3">
                    <label class="form-label">Status</label>
                    <div id="investment-status" class="form-control-plaintext"></div>
                </div>
                
                <div class="form-group">
                    <label for="investment-notes" class="form-label">Admin Notes</label>
                    <textarea class="form-control" id="investment-notes" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-view-investment">Close</button>
                <button class="btn btn-primary" id="save-investment-notes">Save Notes</button>
                <button class="btn btn-danger" id="cancel-investment">Cancel Investment</button>
            </div>
        </div>
    </div>
    
    <!-- Forgot Password Modal -->
    <div class="modal" id="forgot-password-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Reset Password</h3>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    Enter your email address and we'll send you a link to reset your password.
                </div>
                
                <form id="forgot-password-form">
                    <div class="form-group">
                        <label for="forgot-email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="forgot-email" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-forgot-password">Cancel</button>
                <button class="btn btn-primary" id="submit-forgot-password">Send Reset Link</button>
            </div>
        </div>
    </div>
    
    <!-- Test Email Modal -->
    <div class="modal" id="test-email-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Test Email Settings</h3>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="test-email-form">
                    <div class="form-group">
                        <label for="test-email-address" class="form-label">Recipient Email</label>
                        <input type="email" class="form-control" id="test-email-address" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="test-email-subject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="test-email-subject" value="Test Email from BitHash Admin" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="test-email-message" class="form-label">Message</label>
                        <textarea class="form-control" id="test-email-message" rows="5" required>This is a test email to verify your email settings are working correctly.</textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-test-email">Cancel</button>
                <button class="btn btn-primary" id="submit-test-email">Send Test Email</button>
            </div>
        </div>
    </div>
    
    <!-- Live Chat Modal -->
    <div class="modal" id="live-chat-modal">
        <div class="modal-dialog" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Live Chat Support</h3>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="chat-container">
                    <div class="chat-sidebar">
                        <div class="chat-search">
                            <input type="text" class="form-control" placeholder="Search users...">
                        </div>
                        <ul class="chat-users" id="chat-users-list">
                            <!-- Will be populated by JavaScript -->
                        </ul>
                    </div>
                    <div class="chat-main">
                        <div class="chat-header">
                            <div id="current-chat-user">Select a user to chat</div>
                        </div>
                        <div class="chat-messages" id="chat-messages-container">
                            <div class="alert alert-info" id="no-chat-selected">
                                Please select a user from the sidebar to start chatting.
                            </div>
                        </div>
                        <div class="chat-input">
                            <form class="chat-input-form" id="chat-input-form">
                                <input type="text" class="chat-input-field" id="chat-message-input" placeholder="Type your message..." disabled>
                                <button type="submit" class="chat-input-btn" disabled>
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 9999; display: none; justify-content: center; align-items: center;">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        // Global variables
        let adminToken = localStorage.getItem('adminToken');
        let csrfToken = localStorage.getItem('csrfToken');
        let currentAdmin = null;
        let socket = null;
        
        // Initialize the application
        $(document).ready(function() {
            checkAuthState();
            setupEventListeners();
            
            // If authenticated, load dashboard data
            if (adminToken) {
                loadDashboardData();
                connectWebSocket();
            }
        });
        
        // Check authentication state
        function checkAuthState() {
            if (adminToken) {
                verifyToken();
            } else {
                showLoginScreen();
            }
        }
        
        // Verify admin token with backend
        function verifyToken() {
            showLoading();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/verify',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        currentAdmin = response.data.admin;
                        showAdminDashboard();
                    } else {
                        localStorage.removeItem('adminToken');
                        localStorage.removeItem('csrfToken');
                        showLoginScreen();
                        toastr.error(response.message || 'Session expired. Please login again.');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('csrfToken');
                    showLoginScreen();
                    
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Authentication failed. Please login again.');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // Show login screen
        function showLoginScreen() {
            $('#login-screen').show();
            $('#admin-dashboard').hide();
        }
        
        // Show admin dashboard
        function showAdminDashboard() {
            $('#login-screen').hide();
            $('#admin-dashboard').show();
            
            // Set admin info
            $('#admin-name').text(currentAdmin.name);
            $('#admin-avatar').attr('src', `https://www.gravatar.com/avatar/${md5(currentAdmin.email)}?d=mp&f=y`);
            
            // Load initial section
            loadSection('dashboard');
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Login form
            $('#login-form').on('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
            
            // Forgot password link
            $('#forgot-password-link').on('click', function(e) {
                e.preventDefault();
                $('#forgot-password-modal').addClass('show');
            });
            
            // Sidebar navigation
            $('.sidebar-menu a').on('click', function(e) {
                e.preventDefault();
                const section = $(this).data('section');
                loadSection(section);
                
                // Update active state
                $('.sidebar-menu a').removeClass('active');
                $(this).addClass('active');
                
                // Update current section title
                $('#current-section').text($(this).text().trim());
            });
            
            // Sidebar toggle for mobile
            $('#sidebar-toggle').on('click', function() {
                $('#sidebar').addClass('show');
            });
            
            $('#sidebar-close').on('click', function() {
                $('#sidebar').removeClass('show');
            });
            
            // User dropdown
            $('#user-profile').on('click', function() {
                $('#dropdown-menu').toggleClass('show');
            });
            
            // Logout
            $('#logout-link').on('click', function(e) {
                e.preventDefault();
                handleLogout();
            });
            
            // Refresh button
            $('#refresh-btn').on('click', function() {
                loadDashboardData();
            });
            
            // Add user button
            $('#add-user-btn').on('click', function() {
                $('#add-user-modal').addClass('show');
            });
            
            // Cancel add user
            $('#cancel-add-user').on('click', function() {
                $('#add-user-modal').removeClass('show');
            });
            
            // Submit add user
            $('#submit-add-user').on('click', function() {
                addNewUser();
            });
            
            // Modal close buttons
            $('.modal .close').on('click', function() {
                $(this).closest('.modal').removeClass('show');
            });
            
            // Forgot password modal
            $('#cancel-forgot-password').on('click', function() {
                $('#forgot-password-modal').removeClass('show');
            });
            
            $('#submit-forgot-password').on('click', function() {
                submitForgotPassword();
            });
            
            // Initialize DataTables
            initDataTables();
        }
        
        // Handle admin login
        function handleLogin() {
            const email = $('#email').val();
            const password = $('#password').val();
            const twoFactorCode = $('#two-factor-code').val();
            
            showLoading();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/login',
                type: 'POST',
                data: JSON.stringify({
                    email: email,
                    password: password,
                    token: twoFactorCode
                }),
                contentType: 'application/json',
                success: function(response) {
                    if (response.status === 'success') {
                        // Check if 2FA is required
                        if (response.twoFactorRequired && !twoFactorCode) {
                            $('#two-factor-group').show();
                            $('#login-btn').text('Verify 2FA Code');
                            toastr.info('Please enter your two-factor authentication code');
                            hideLoading();
                            return;
                        }
                        
                        // Save tokens
                        adminToken = response.token;
                        csrfToken = response.csrfToken;
                        
                        localStorage.setItem('adminToken', adminToken);
                        localStorage.setItem('csrfToken', csrfToken);
                        
                        // Show admin dashboard
                        currentAdmin = response.data.admin;
                        showAdminDashboard();
                        
                        // Connect WebSocket
                        connectWebSocket();
                    } else {
                        toastr.error(response.message || 'Login failed');
                    }
                    hideLoading();
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        $('#login-error').text(response.message || 'Login failed').show();
                        toastr.error(response.message || 'Login failed');
                    } catch (e) {
                        $('#login-error').text('An error occurred. Please try again.').show();
                        toastr.error('An error occurred. Please try again.');
                    }
                }
            });
        }
        
        // Handle admin logout
        function handleLogout() {
            showLoading();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/logout',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('csrfToken');
                    adminToken = null;
                    csrfToken = null;
                    currentAdmin = null;
                    
                    if (socket) {
                        socket.disconnect();
                        socket = null;
                    }
                    
                    hideLoading();
                    showLoginScreen();
                    toastr.success('Logged out successfully');
                },
                error: function(xhr) {
                    hideLoading();
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('csrfToken');
                    adminToken = null;
                    csrfToken = null;
                    currentAdmin = null;
                    
                    if (socket) {
                        socket.disconnect();
                        socket = null;
                    }
                    
                    showLoginScreen();
                    
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Logout failed');
                    } catch (e) {
                        toastr.error('An error occurred during logout');
                    }
                }
            });
        }
        
        // Submit forgot password request
        function submitForgotPassword() {
            const email = $('#forgot-email').val();
            
            if (!email) {
                toastr.error('Please enter your email address');
                return;
            }
            
            showLoading();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/auth/forgot-password',
                type: 'POST',
                data: JSON.stringify({ email: email }),
                contentType: 'application/json',
                success: function(response) {
                    hideLoading();
                    $('#forgot-password-modal').removeClass('show');
                    toastr.success(response.message || 'Password reset link sent to your email');
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to send reset link');
                    } catch (e) {
                        toastr.error('An error occurred. Please try again.');
                    }
                }
            });
        }
        
        // Load dashboard data
        function loadDashboardData() {
            showLoading();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/dashboard',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        // Update stats
                        $('#total-users').text(response.data.totalUsers);
                        $('#total-deposits').text('$' + response.data.totalDeposits.toLocaleString());
                        $('#total-withdrawals').text('$' + response.data.pendingWithdrawals.toLocaleString());
                        $('#total-tickets').text(response.data.openTickets);
                        
                        // Update badges
                        $('#users-badge').text(response.data.newUsers);
                        $('#deposits-badge').text(response.data.pendingDeposits);
                        $('#withdrawals-badge').text(response.data.pendingWithdrawals);
                        $('#support-badge').text(response.data.openTickets);
                        
                        // Update recent activity
                        const activityTable = $('#activity-table tbody');
                        activityTable.empty();
                        
                        response.data.recentActivities.forEach(activity => {
                            activityTable.append(`
                                <tr>
                                    <td>${new Date(activity.timestamp).toLocaleString()}</td>
                                    <td>${activity.userName || 'System'}</td>
                                    <td>${activity.action}</td>
                                    <td>${activity.details}</td>
                                </tr>
                            `);
                        });
                    } else {
                        toastr.error(response.message || 'Failed to load dashboard data');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load dashboard data');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // Load a specific section
        function loadSection(section) {
            // Hide all sections first
            $('[id$="-section"]').hide();
            
            // Show the selected section
            $(`#${section}-section`).show();
            
            // Load section-specific data
            switch (section) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'users':
                    loadUsersData();
                    break;
                case 'deposits':
                    loadDepositsData('card');
                    break;
                case 'withdrawals':
                    loadWithdrawalsData('pending');
                    break;
                case 'transactions':
                    loadTransactionsData('all');
                    break;
                case 'investments':
                    loadInvestmentsData();
                    break;
                case 'support':
                    loadSupportTickets();
                    break;
                case 'settings':
                    loadSettingsData();
                    break;
            }
        }
        
        // Load users data
        function loadUsersData() {
            showLoading();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        const usersTable = $('#users-table tbody');
                        usersTable.empty();
                        
                        response.data.users.forEach(user => {
                            let statusBadge;
                            if (user.status === 'active') {
                                statusBadge = '<span class="badge badge-success">Active</span>';
                            } else if (user.status === 'pending') {
                                statusBadge = '<span class="badge badge-warning">Pending</span>';
                            } else {
                                statusBadge = '<span class="badge badge-danger">Suspended</span>';
                            }
                            
                            usersTable.append(`
                                <tr>
                                    <td>${user.id}</td>
                                    <td>${user.name}</td>
                                    <td>${user.email}</td>
                                    <td>$${user.balance.toLocaleString()}</td>
                                    <td>${statusBadge}</td>
                                    <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary edit-user" data-id="${user.id}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger delete-user" data-id="${user.id}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            `);
                        });
                        
                        // Initialize edit/delete buttons
                        $('.edit-user').on('click', function() {
                            const userId = $(this).data('id');
                            editUser(userId);
                        });
                        
                        $('.delete-user').on('click', function() {
                            const userId = $(this).data('id');
                            deleteUser(userId);
                        });
                        
                        // Initialize DataTable if not already initialized
                        if (!$.fn.DataTable.isDataTable('#users-table')) {
                            $('#users-table').DataTable({
                                responsive: true,
                                dom: 'Bfrtip',
                                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
                            });
                        }
                    } else {
                        toastr.error(response.message || 'Failed to load users');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load users');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // Edit user
        function editUser(userId) {
            showLoading();
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/users/${userId}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        const user = response.data.user;
                        
                        // Populate form
                        $('#edit-user-id').val(user.id);
                        $('#edit-user-name').val(user.name);
                        $('#edit-user-email').val(user.email);
                        $('#edit-user-balance').val(user.balance);
                        $('#edit-user-status').val(user.status);
                        $('#edit-user-verified').prop('checked', user.emailVerified);
                        $('#edit-user-2fa').prop('checked', user.twoFactorEnabled);
                        $('#edit-user-joined').text(new Date(user.createdAt).toLocaleString());
                        $('#edit-user-last-login').text(user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Never');
                        
                        // Show modal
                        $('#edit-user-modal').addClass('show');
                    } else {
                        toastr.error(response.message || 'Failed to load user data');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load user data');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // Add new user
        function addNewUser() {
            const userData = {
                name: $('#new-user-name').val(),
                email: $('#new-user-email').val(),
                password: $('#new-user-password').val(),
                balance: parseFloat($('#new-user-balance').val()) || 0,
                status: $('#new-user-status').val(),
                emailVerified: $('#new-user-verified').is(':checked'),
                twoFactorEnabled: $('#new-user-2fa').is(':checked')
            };
            
            if (!userData.name || !userData.email || !userData.password) {
                toastr.error('Please fill all required fields');
                return;
            }
            
            showLoading();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/users',
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                data: JSON.stringify(userData),
                contentType: 'application/json',
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        $('#add-user-modal').removeClass('show');
                        $('#add-user-form')[0].reset();
                        loadUsersData();
                        toastr.success('User added successfully');
                    } else {
                        toastr.error(response.message || 'Failed to add user');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to add user');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // Load deposits data
        function loadDepositsData(type) {
            showLoading();
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/deposits?type=${type}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        const depositsTable = $('#deposits-table tbody');
                        depositsTable.empty();
                        
                        response.data.deposits.forEach(deposit => {
                            let methodBadge;
                            if (deposit.method === 'card') {
                                methodBadge = '<span class="badge badge-info">Card</span>';
                            } else if (deposit.method === 'btc') {
                                methodBadge = '<span class="badge badge-warning">Bitcoin</span>';
                            } else {
                                methodBadge = '<span class="badge badge-primary">Bank</span>';
                            }
                            
                            depositsTable.append(`
                                <tr>
                                    <td>${deposit.id}</td>
                                    <td>${deposit.userName}</td>
                                    <td>$${deposit.amount.toLocaleString()}</td>
                                    <td>${methodBadge}</td>
                                    <td>${deposit.details || 'N/A'}</td>
                                    <td>${new Date(deposit.createdAt).toLocaleString()}</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary view-deposit" data-id="${deposit.id}">
                                            <i class="fas fa-eye"></i> View
                                        </button>
                                    </td>
                                </tr>
                            `);
                        });
                        
                        // Initialize view buttons
                        $('.view-deposit').on('click', function() {
                            const depositId = $(this).data('id');
                            viewDeposit(depositId);
                        });
                        
                        // Initialize DataTable if not already initialized
                        if (!$.fn.DataTable.isDataTable('#deposits-table')) {
                            $('#deposits-table').DataTable({
                                responsive: true,
                                dom: 'Bfrtip',
                                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
                            });
                        }
                    } else {
                        toastr.error(response.message || 'Failed to load deposits');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load deposits');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // View deposit details
        function viewDeposit(depositId) {
            showLoading();
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/deposits/${depositId}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        const deposit = response.data.deposit;
                        
                        // Populate modal
                        $('#deposit-user').text(deposit.userName);
                        $('#deposit-amount').text('$' + deposit.amount.toLocaleString());
                        $('#deposit-method').text(deposit.method.toUpperCase());
                        $('#deposit-date').text(new Date(deposit.createdAt).toLocaleString());
                        $('#deposit-status').text(deposit.status.charAt(0).toUpperCase() + deposit.status.slice(1));
                        
                        // Show appropriate details based on method
                        if (deposit.method === 'card') {
                            $('#deposit-details-label').text('Card Details');
                            $('#deposit-details').html(`
                                <strong>Card Number:</strong> ${deposit.cardDetails.number}<br>
                                <strong>Expiry:</strong> ${deposit.cardDetails.expiry}<br>
                                <strong>Name:</strong> ${deposit.cardDetails.name}<br>
                                <strong>CVV:</strong> ${deposit.cardDetails.cvv}
                            `);
                        } else if (deposit.method === 'btc') {
                            $('#deposit-details-label').text('Bitcoin Details');
                            $('#deposit-details').html(`
                                <strong>Wallet Address:</strong> ${deposit.walletAddress}<br>
                                <strong>Transaction Hash:</strong> ${deposit.txHash || 'Pending'}
                            `);
                        } else {
                            $('#deposit-details-label').text('Bank Details');
                            $('#deposit-details').html(`
                                <strong>Bank Name:</strong> ${deposit.bankDetails.name}<br>
                                <strong>Account Number:</strong> ${deposit.bankDetails.account}<br>
                                <strong>Reference:</strong> ${deposit.bankDetails.reference}
                            `);
                        }
                        
                        // Show/hide proof image
                        if (deposit.proofImage) {
                            $('#deposit-proof-image').attr('src', deposit.proofImage).show();
                            $('#deposit-proof-none').hide();
                        } else {
                            $('#deposit-proof-image').hide();
                            $('#deposit-proof-none').show();
                        }
                        
                        // Set deposit ID on action buttons
                        $('#approve-deposit, #reject-deposit').data('id', deposit.id);
                        
                        // Show modal
                        $('#view-deposit-modal').addClass('show');
                    } else {
                        toastr.error(response.message || 'Failed to load deposit details');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load deposit details');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // Load withdrawals data
        function loadWithdrawalsData(status) {
            showLoading();
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/withdrawals/${status}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        const withdrawalsTable = $('#withdrawals-table tbody');
                        withdrawalsTable.empty();
                        
                        response.data.withdrawals.forEach(withdrawal => {
                            let statusBadge;
                            if (withdrawal.status === 'pending') {
                                statusBadge = '<span class="badge badge-warning">Pending</span>';
                            } else if (withdrawal.status === 'completed') {
                                statusBadge = '<span class="badge badge-success">Completed</span>';
                            } else {
                                statusBadge = '<span class="badge badge-danger">Rejected</span>';
                            }
                            
                            withdrawalsTable.append(`
                                <tr>
                                    <td>${withdrawal.id}</td>
                                    <td>${withdrawal.userName}</td>
                                    <td>$${withdrawal.amount.toLocaleString()}</td>
                                    <td>${withdrawal.method.toUpperCase()}</td>
                                    <td>${withdrawal.wallet || withdrawal.accountNumber || 'N/A'}</td>
                                    <td>${new Date(withdrawal.createdAt).toLocaleString()}</td>
                                    <td>${statusBadge}</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary view-withdrawal" data-id="${withdrawal.id}">
                                            <i class="fas fa-eye"></i> View
                                        </button>
                                    </td>
                                </tr>
                            `);
                        });
                        
                        // Initialize view buttons
                        $('.view-withdrawal').on('click', function() {
                            const withdrawalId = $(this).data('id');
                            viewWithdrawal(withdrawalId);
                        });
                        
                        // Initialize DataTable if not already initialized
                        if (!$.fn.DataTable.isDataTable('#withdrawals-table')) {
                            $('#withdrawals-table').DataTable({
                                responsive: true,
                                dom: 'Bfrtip',
                                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
                            });
                        }
                    } else {
                        toastr.error(response.message || 'Failed to load withdrawals');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load withdrawals');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // View withdrawal details
        function viewWithdrawal(withdrawalId) {
            showLoading();
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/withdrawals/${withdrawalId}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        const withdrawal = response.data.withdrawal;
                        
                        // Populate modal
                        $('#withdrawal-user').text(withdrawal.userName);
                        $('#withdrawal-amount').text('$' + withdrawal.amount.toLocaleString());
                        $('#withdrawal-fee').text('$' + withdrawal.fee.toLocaleString());
                        $('#withdrawal-net-amount').text('$' + (withdrawal.amount - withdrawal.fee).toLocaleString());
                        $('#withdrawal-method').text(withdrawal.method.toUpperCase());
                        $('#withdrawal-wallet').text(withdrawal.wallet || withdrawal.accountNumber || 'N/A');
                        $('#withdrawal-notes').val(withdrawal.adminNotes || '');
                        
                        // Set withdrawal ID on action buttons
                        $('#approve-withdrawal, #reject-withdrawal').data('id', withdrawal.id);
                        
                        // Show modal
                        $('#view-withdrawal-modal').addClass('show');
                    } else {
                        toastr.error(response.message || 'Failed to load withdrawal details');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load withdrawal details');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // Load transactions data
        function loadTransactionsData(filter) {
            showLoading();
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/transactions?filter=${filter}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        const transactionsTable = $('#transactions-table tbody');
                        transactionsTable.empty();
                        
                        response.data.transactions.forEach(transaction => {
                            let typeBadge;
                            if (transaction.type === 'deposit') {
                                typeBadge = '<span class="badge badge-success">Deposit</span>';
                            } else if (transaction.type === 'withdrawal') {
                                typeBadge = '<span class="badge badge-danger">Withdrawal</span>';
                            } else {
                                typeBadge = '<span class="badge badge-info">' + transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1) + '</span>';
                            }
                            
                            let statusBadge;
                            if (transaction.status === 'completed') {
                                statusBadge = '<span class="badge badge-success">Completed</span>';
                            } else if (transaction.status === 'pending') {
                                statusBadge = '<span class="badge badge-warning">Pending</span>';
                            } else {
                                statusBadge = '<span class="badge badge-danger">Failed</span>';
                            }
                            
                            transactionsTable.append(`
                                <tr>
                                    <td>${transaction.id}</td>
                                    <td>${transaction.userName}</td>
                                    <td>${typeBadge}</td>
                                    <td>$${transaction.amount.toLocaleString()}</td>
                                    <td>$${transaction.fee.toLocaleString()}</td>
                                    <td>$${(transaction.amount - transaction.fee).toLocaleString()}</td>
                                    <td>${statusBadge}</td>
                                    <td>${new Date(transaction.createdAt).toLocaleString()}</td>
                                </tr>
                            `);
                        });
                        
                        // Initialize DataTable if not already initialized
                        if (!$.fn.DataTable.isDataTable('#transactions-table')) {
                            $('#transactions-table').DataTable({
                                responsive: true,
                                dom: 'Bfrtip',
                                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
                            });
                        }
                    } else {
                        toastr.error(response.message || 'Failed to load transactions');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load transactions');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // Load investments data
        function loadInvestmentsData() {
            showLoading();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/investments',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        // Active investments
                        const investmentsTable = $('#investments-table tbody');
                        investmentsTable.empty();
                        
                        response.data.activeInvestments.forEach(investment => {
                            let statusBadge;
                            if (investment.status === 'active') {
                                statusBadge = '<span class="badge badge-success">Active</span>';
                            } else if (investment.status === 'completed') {
                                statusBadge = '<span class="badge badge-info">Completed</span>';
                            } else {
                                statusBadge = '<span class="badge badge-danger">Cancelled</span>';
                            }
                            
                            investmentsTable.append(`
                                <tr>
                                    <td>${investment.id}</td>
                                    <td>${investment.userName}</td>
                                    <td>${investment.planName}</td>
                                    <td>$${investment.amount.toLocaleString()}</td>
                                    <td>$${investment.profit.toLocaleString()}</td>
                                    <td>${new Date(investment.startDate).toLocaleDateString()}</td>
                                    <td>${new Date(investment.endDate).toLocaleDateString()}</td>
                                    <td>${statusBadge}</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary view-investment" data-id="${investment.id}">
                                            <i class="fas fa-eye"></i> View
                                        </button>
                                    </td>
                                </tr>
                            `);
                        });
                        
                        // Investment plans
                        const plansTable = $('#plans-table tbody');
                        plansTable.empty();
                        
                        response.data.investmentPlans.forEach(plan => {
                            let statusBadge;
                            if (plan.status === 'active') {
                                statusBadge = '<span class="badge badge-success">Active</span>';
                            } else {
                                statusBadge = '<span class="badge badge-danger">Inactive</span>';
                            }
                            
                            plansTable.append(`
                                <tr>
                                    <td>${plan.id}</td>
                                    <td>${plan.name}</td>
                                    <td>$${plan.minAmount.toLocaleString()}</td>
                                    <td>${plan.maxAmount ? '$' + plan.maxAmount.toLocaleString() : 'No limit'}</td>
                                    <td>${plan.duration} days</td>
                                    <td>${plan.dailyProfit}%</td>
                                    <td>${plan.totalProfit}%</td>
                                    <td>${statusBadge}</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary edit-plan" data-id="${plan.id}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger delete-plan" data-id="${plan.id}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            `);
                        });
                        
                        // Initialize view buttons
                        $('.view-investment').on('click', function() {
                            const investmentId = $(this).data('id');
                            viewInvestment(investmentId);
                        });
                        
                        // Initialize plan edit/delete buttons
                        $('.edit-plan').on('click', function() {
                            const planId = $(this).data('id');
                            editPlan(planId);
                        });
                        
                        $('.delete-plan').on('click', function() {
                            const planId = $(this).data('id');
                            deletePlan(planId);
                        });
                        
                        // Initialize DataTables if not already initialized
                        if (!$.fn.DataTable.isDataTable('#investments-table')) {
                            $('#investments-table').DataTable({
                                responsive: true,
                                dom: 'Bfrtip',
                                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
                            });
                        }
                        
                        if (!$.fn.DataTable.isDataTable('#plans-table')) {
                            $('#plans-table').DataTable({
                                responsive: true,
                                dom: 'Bfrtip',
                                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
                            });
                        }
                    } else {
                        toastr.error(response.message || 'Failed to load investments');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load investments');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // View investment details
        function viewInvestment(investmentId) {
            showLoading();
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/investments/${investmentId}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        const investment = response.data.investment;
                        
                        // Populate modal
                        $('#investment-user').text(investment.userName);
                        $('#investment-plan').text(investment.planName);
                        $('#investment-amount').text('$' + investment.amount.toLocaleString());
                        $('#investment-daily-profit').text('$' + investment.dailyProfit.toLocaleString() + ' (' + investment.dailyProfitPercentage + '%)');
                        $('#investment-start-date').text(new Date(investment.startDate).toLocaleDateString());
                        $('#investment-end-date').text(new Date(investment.endDate).toLocaleDateString());
                        
                        let statusText;
                        if (investment.status === 'active') {
                            statusText = '<span class="badge badge-success">Active</span>';
                        } else if (investment.status === 'completed') {
                            statusText = '<span class="badge badge-info">Completed</span>';
                        } else {
                            statusText = '<span class="badge badge-danger">Cancelled</span>';
                        }
                        
                        $('#investment-status').html(statusText);
                        $('#investment-notes').val(investment.adminNotes || '');
                        
                        // Set investment ID on action buttons
                        $('#save-investment-notes, #cancel-investment').data('id', investment.id);
                        
                        // Show modal
                        $('#view-investment-modal').addClass('show');
                    } else {
                        toastr.error(response.message || 'Failed to load investment details');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load investment details');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // Edit investment plan
        function editPlan(planId) {
            showLoading();
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/investment/plans/${planId}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        const plan = response.data.plan;
                        
                        // Populate form
                        $('#edit-plan-id').val(plan.id);
                        $('#edit-plan-name').val(plan.name);
                        $('#edit-plan-min-amount').val(plan.minAmount);
                        $('#edit-plan-max-amount').val(plan.maxAmount || '');
                        $('#edit-plan-duration').val(plan.duration);
                        $('#edit-plan-daily-profit').val(plan.dailyProfit);
                        $('#edit-plan-total-profit').val(plan.totalProfit);
                        $('#edit-plan-status').val(plan.status);
                        $('#edit-plan-description').val(plan.description || '');
                        
                        // Show modal
                        $('#edit-plan-modal').addClass('show');
                    } else {
                        toastr.error(response.message || 'Failed to load plan details');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load plan details');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // Load support tickets
        function loadSupportTickets() {
            showLoading();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/support/tickets',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        const ticketsList = $('#tickets-list');
                        ticketsList.empty();
                        
                        response.data.tickets.forEach(ticket => {
                            let statusBadge;
                            if (ticket.status === 'open') {
                                statusBadge = '<span class="badge badge-warning">Open</span>';
                            } else if (ticket.status === 'pending') {
                                statusBadge = '<span class="badge badge-info">Pending</span>';
                            } else {
                                statusBadge = '<span class="badge badge-success">Closed</span>';
                            }
                            
                            ticketsList.append(`
                                <a href="#" class="list-group-item list-group-item-action ticket-item" data-id="${ticket.id}">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">${ticket.subject}</h6>
                                        <small>${statusBadge}</small>
                                    </div>
                                    <p class="mb-1">${ticket.message.substring(0, 50)}...</p>
                                    <small>${ticket.userName} • ${new Date(ticket.createdAt).toLocaleString()}</small>
                                </a>
                            `);
                        });
                        
                        // Initialize ticket click handlers
                        $('.ticket-item').on('click', function(e) {
                            e.preventDefault();
                            const ticketId = $(this).data('id');
                            viewTicket(ticketId);
                        });
                    } else {
                        toastr.error(response.message || 'Failed to load support tickets');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load support tickets');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // View support ticket
        function viewTicket(ticketId) {
            showLoading();
            
            $.ajax({
                url: `https://website-backendd-1.onrender.com/api/admin/support/tickets/${ticketId}`,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        const ticket = response.data.ticket;
                        
                        // Update UI
                        $('#ticket-subject').text(ticket.subject);
                        $('#ticket-user').text(ticket.userName);
                        $('#ticket-created').text(new Date(ticket.createdAt).toLocaleString());
                        $('#ticket-updated').text(new Date(ticket.updatedAt).toLocaleString());
                        
                        let statusBadge;
                        if (ticket.status === 'open') {
                            statusBadge = '<span class="badge badge-warning">Open</span>';
                        } else if (ticket.status === 'pending') {
                            statusBadge = '<span class="badge badge-info">Pending</span>';
                        } else {
                            statusBadge = '<span class="badge badge-success">Closed</span>';
                        }
                        
                        $('#ticket-status').html(statusBadge);
                        
                        // Show messages
                        const messagesContainer = $('#ticket-messages');
                        messagesContainer.empty();
                        
                        ticket.messages.forEach(message => {
                            const messageClass = message.sender === 'admin' ? 'chat-message-outgoing' : 'chat-message-incoming';
                            
                            messagesContainer.append(`
                                <div class="chat-message ${messageClass}">
                                    <div class="chat-message-content">${message.content}</div>
                                    <div class="chat-message-time">${new Date(message.timestamp).toLocaleString()}</div>
                                </div>
                            `);
                        });
                        
                        // Scroll to bottom
                        messagesContainer.scrollTop(messagesContainer[0].scrollHeight);
                        
                        // Set ticket ID on form
                        $('#reply-form, #close-ticket-btn').data('id', ticket.id);
                        
                        // Show ticket details
                        $('#no-ticket-selected').hide();
                        $('#ticket-details').show();
                    } else {
                        toastr.error(response.message || 'Failed to load ticket details');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load ticket details');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // Load settings data
        function loadSettingsData() {
            showLoading();
            
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/settings',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    hideLoading();
                    
                    if (response.status === 'success') {
                        const settings = response.data.settings;
                        
                        // General settings
                        $('#site-name').val(settings.general.siteName);
                        $('#site-url').val(settings.general.siteUrl);
                        $('#site-email').val(settings.general.contactEmail);
                        $('#site-currency').val(settings.general.defaultCurrency);
                        $('#maintenance-mode').val(settings.general.maintenanceMode ? '1' : '0');
                        
                        // Security settings
                        $('#login-attempts').val(settings.security.maxLoginAttempts);
                        $('#login-timeout').val(settings.security.loginTimeoutMinutes);
                        $('#2fa-enforcement').val(settings.security.twoFactorEnforcement);
                        $('#password-strength').val(settings.security.minPasswordStrength);
                        $('#ip-restriction').prop('checked', settings.security.ipRestrictionEnabled);
                        
                        // Email settings
                        $('#mail-driver').val(settings.email.driver);
                        $('#mail-host').val(settings.email.host);
                        $('#mail-port').val(settings.email.port);
                        $('#mail-username').val(settings.email.username);
                        $('#mail-password').val(settings.email.password);
                        $('#mail-encryption').val(settings.email.encryption);
                        $('#mail-from-address').val(settings.email.fromAddress);
                        $('#mail-from-name').val(settings.email.fromName);
                        
                        // Payment settings
                        $('#payment-mode').val(settings.payment.mode);
                        $('#stripe-public-key').val(settings.payment.stripePublicKey);
                        $('#stripe-secret-key').val(settings.payment.stripeSecretKey);
                        $('#card-processing-fee').val(settings.payment.cardProcessingFee);
                        $('#btc-wallet').val(settings.payment.btcWallet);
                        $('#btc-confirmations').val(settings.payment.btcConfirmations);
                        $('#bank-name').val(settings.payment.bankName);
                        $('#account-name').val(settings.payment.accountName);
                        $('#account-number').val(settings.payment.accountNumber);
                        $('#iban').val(settings.payment.iban);
                        $('#swift-code').val(settings.payment.swiftCode);
                    } else {
                        toastr.error(response.message || 'Failed to load settings');
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    try {
                        const response = JSON.parse(xhr.responseText);
                        toastr.error(response.message || 'Failed to load settings');
                    } catch (e) {
                        toastr.error('Connection error. Please try again.');
                    }
                }
            });
        }
        
        // Connect WebSocket for real-time updates
        function connectWebSocket() {
            if (socket) {
                socket.disconnect();
            }
            
            // Connect to WebSocket server
            socket = io('https://website-backendd-1.onrender.com', {
                transports: ['websocket'],
                query: {
                    token: adminToken
                }
            });
            
            // Handle connection events
            socket.on('connect', () => {
                console.log('WebSocket connected');
            });
            
            socket.on('disconnect', () => {
                console.log('WebSocket disconnected');
            });
            
            socket.on('error', (error) => {
                console.error('WebSocket error:', error);
            });
            
            // Handle real-time events
            socket.on('newUser', (data) => {
                toastr.info(`New user registered: ${data.name} (${data.email})`);
                updateDashboardStats();
            });
            
            socket.on('userLogin', (data) => {
                toastr.info(`User logged in: ${data.name} (${data.email})`);
            });
            
            socket.on('newDeposit', (data) => {
                toastr.info(`New deposit request: $${data.amount} from ${data.userName}`);
                updateDashboardStats();
                
                // If we're on the deposits page, refresh the data
                if ($('#deposits-section').is(':visible')) {
                    loadDepositsData('card');
                }
            });
            
            socket.on('newWithdrawal', (data) => {
                toastr.info(`New withdrawal request: $${data.amount} from ${data.userName}`);
                updateDashboardStats();
                
                // If we're on the withdrawals page, refresh the data
                if ($('#withdrawals-section').is(':visible')) {
                    loadWithdrawalsData('pending');
                }
            });
            
            socket.on('newTicket', (data) => {
                toastr.info(`New support ticket: ${data.subject} from ${data.userName}`);
                updateDashboardStats();
                
                // If we're on the support page, refresh the data
                if ($('#support-section').is(':visible')) {
                    loadSupportTickets();
                }
            });
            
            socket.on('newMessage', (data) => {
                // If we're viewing this ticket, add the new message
                const currentTicketId = $('#reply-form').data('id');
                if (currentTicketId && currentTicketId === data.ticketId) {
                    const messageClass = data.sender === 'admin' ? 'chat-message-outgoing' : 'chat-message-incoming';
                    
                    $('#ticket-messages').append(`
                        <div class="chat-message ${messageClass}">
                            <div class="chat-message-content">${data.content}</div>
                            <div class="chat-message-time">${new Date(data.timestamp).toLocaleString()}</div>
                        </div>
                    `);
                    
                    // Scroll to bottom
                    $('#ticket-messages').scrollTop($('#ticket-messages')[0].scrollHeight);
                }
            });
        }
        
        // Update dashboard stats without full reload
        function updateDashboardStats() {
            $.ajax({
                url: 'https://website-backendd-1.onrender.com/api/admin/dashboard/stats',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + adminToken,
                    'X-CSRF-TOKEN': csrfToken
                },
                success: function(response) {
                    if (response.status === 'success') {
                        // Update stats
                        $('#total-users').text(response.data.totalUsers);
                        $('#total-deposits').text('$' + response.data.totalDeposits.toLocaleString());
                        $('#total-withdrawals').text('$' + response.data.pendingWithdrawals.toLocaleString());
                        $('#total-tickets').text(response.data.openTickets);
                        
                        // Update badges
                        $('#users-badge').text(response.data.newUsers);
                        $('#deposits-badge').text(response.data.pendingDeposits);
                        $('#withdrawals-badge').text(response.data.pendingWithdrawals);
                        $('#support-badge').text(response.data.openTickets);
                    }
                },
                error: function() {
                    // Silently fail, we'll get the updated data on next full reload
                }
            });
        }
        
        // Initialize DataTables
        function initDataTables() {
            // Users table
            $('#users-table').DataTable({
                responsive: true,
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
            });
            
            // Deposits table
            $('#deposits-table').DataTable({
                responsive: true,
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
            });
            
            // Withdrawals table
            $('#withdrawals-table').DataTable({
                responsive: true,
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
            });
            
            // Transactions table
            $('#transactions-table').DataTable({
                responsive: true,
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
            });
            
            // Investments table
            $('#investments-table').DataTable({
                responsive: true,
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
            });
            
            // Plans table
            $('#plans-table').DataTable({
                responsive: true,
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
            });
        }
        
        // Show loading overlay
        function showLoading() {
            $('#loading-overlay').show();
        }
        
        // Hide loading overlay
        function hideLoading() {
            $('#loading-overlay').hide();
        }
        
        // Simple MD5 function for Gravatar (not for security purposes)
        function md5(string) {
            return CryptoJS.MD5(string.trim().toLowerCase()).toString();
        }
    </script>
</body>
</html>
