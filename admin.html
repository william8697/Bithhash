<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Dashboard | BitHash LLC - Institutional Bitcoin Mining</title>
    <meta name="description" content="BitHash LLC Admin Dashboard for managing institutional-grade Bitcoin mining operations with enterprise security standards.">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rowdies:wght@300;400;700&family=Inter:wght@300;400;500;600;700&family=Manrope:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" type="image/png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">
    
    <!-- Chart.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css">
    
    <!-- Select2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css">
    
    <!-- Toastr -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    
    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <style>
        :root {
            --primary: #00D395;
            --primary-dark: #00B783;
            --primary-light: #00E5A1;
            --secondary: #1E1E1E;
            --secondary-dark: #121212;
            --dark: #E5E5E5;
            --darker: #0A0A0A;
            --light: #121212;
            --lighter: #1E1E1E;
            --gray: #8E8E8E;
            --gray-light: #2E2E2E;
            --gray-lighter: #252525;
            --success: #00D395;
            --warning: #FFB800;
            --error: #FF3D57;
            --gold: #D4AF37;
            --gold-light: #FFD700;
            --gold-dark: #996515;
            --blue: #003366;
            --blue-dark: #002244;
            --blue-light: #004488;
            --purple: #784FED;
            --pink: #EC4899;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            --gold-gradient: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            --blue-gradient: linear-gradient(135deg, var(--blue) 0%, var(--blue-dark) 100%);
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --box-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --visa-blue: #1A1F71;
            --visa-gold: #F7B600;
            --security-blue: #1A73E8;
            --security-green: #34A853;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--secondary-dark);
            color: var(--dark);
            overflow-x: hidden;
        }

        .sidebar {
            background-color: var(--secondary);
            height: 100vh;
            position: fixed;
            width: 280px;
            transition: var(--transition);
            z-index: 1000;
            border-right: 1px solid var(--gray-light);
        }

        .sidebar-collapsed {
            width: 80px;
        }

        .sidebar-collapsed .sidebar-text {
            display: none;
        }

        .sidebar-collapsed .nav-link {
            justify-content: center;
        }

        .main-content {
            margin-left: 280px;
            transition: var(--transition);
            min-height: 100vh;
        }

        .main-content-expanded {
            margin-left: 80px;
        }

        .navbar {
            background-color: var(--secondary);
            border-bottom: 1px solid var(--gray-light);
            height: 70px;
        }

        .card {
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--box-shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            background-color: var(--lighter);
            border-bottom: 1px solid var(--gray-light);
            padding: 1rem 1.5rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        .nav-link {
            color: var(--gray);
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            margin: 0.25rem 1rem;
            display: flex;
            align-items: center;
            transition: var(--transition);
        }

        .nav-link:hover {
            color: var(--dark);
            background-color: var(--gray-light);
        }

        .nav-link.active {
            color: var(--primary);
            background-color: var(--gray-light);
        }

        .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .badge {
            font-weight: 500;
            padding: 0.35em 0.65em;
            font-size: 0.75em;
        }

        .table {
            color: var(--dark);
            background-color: var(--secondary);
        }

        .table th {
            border-top: none;
            border-bottom: 1px solid var(--gray-light);
            font-weight: 600;
        }

        .table td {
            border-top: 1px solid var(--gray-light);
            vertical-align: middle;
        }

        .dataTables_wrapper .dataTables_filter input {
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
            color: var(--dark);
        }

        .dataTables_wrapper .dataTables_length select {
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
            color: var(--dark);
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            color: var(--dark) !important;
            border: 1px solid var(--gray-light) !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background: var(--primary) !important;
            color: white !important;
            border: 1px solid var(--primary) !important;
        }

        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        .btn-outline-primary {
            color: var(--primary);
            border-color: var(--primary);
        }

        .btn-outline-primary:hover {
            background-color: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .text-primary {
            color: var(--primary) !important;
        }

        .bg-primary {
            background-color: var(--primary) !important;
        }

        .border-primary {
            border-color: var(--primary) !important;
        }

        .modal-content {
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
        }

        .modal-header {
            border-bottom: 1px solid var(--gray-light);
        }

        .modal-footer {
            border-top: 1px solid var(--gray-light);
        }

        .form-control, .form-select {
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
            color: var(--dark);
        }

        .form-control:focus, .form-select:focus {
            background-color: var(--secondary);
            border-color: var(--primary);
            color: var(--dark);
            box-shadow: 0 0 0 0.25rem rgba(0, 211, 149, 0.25);
        }

        .dropdown-menu {
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
        }

        .dropdown-item {
            color: var(--dark);
        }

        .dropdown-item:hover {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        .dropdown-divider {
            border-top: 1px solid var(--gray-light);
        }

        .toast {
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
        }

        .apexcharts-menu {
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
        }

        .apexcharts-menu-item:hover {
            background-color: var(--gray-light);
        }

        .apexcharts-tooltip {
            background-color: var(--secondary) !important;
            border: 1px solid var(--gray-light) !important;
            color: var(--dark) !important;
        }

        .apexcharts-tooltip-title {
            background-color: var(--lighter) !important;
            border-bottom: 1px solid var(--gray-light) !important;
        }

        .apexcharts-xaxistooltip, .apexcharts-yaxistooltip {
            background-color: var(--secondary) !important;
            border: 1px solid var(--gray-light) !important;
            color: var(--dark) !important;
        }

        .apexcharts-xaxistooltip:after, .apexcharts-xaxistooltip:before, 
        .apexcharts-yaxistooltip:after, .apexcharts-yaxistooltip:before {
            border-bottom-color: var(--secondary) !important;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 0.6rem;
            padding: 0.25em 0.4em;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            z-index: 1050;
            background-color: var(--secondary);
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow-lg);
            display: none;
        }

        .chat-header {
            background-color: var(--lighter);
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--gray-light);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            cursor: pointer;
        }

        .chat-body {
            height: 300px;
            overflow-y: auto;
            padding: 1rem;
        }

        .chat-footer {
            padding: 0.75rem 1rem;
            border-top: 1px solid var(--gray-light);
        }

        .message {
            margin-bottom: 0.75rem;
            max-width: 80%;
        }

        .message-admin {
            margin-left: auto;
            background-color: var(--primary);
            color: white;
            border-radius: 12px 12px 0 12px;
            padding: 0.5rem 0.75rem;
        }

        .message-user {
            margin-right: auto;
            background-color: var(--gray-light);
            color: var(--dark);
            border-radius: 12px 12px 12px 0;
            padding: 0.5rem 0.75rem;
        }

        .message-time {
            font-size: 0.7rem;
            color: var(--gray);
            margin-top: 0.25rem;
        }

        .chat-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1050;
            box-shadow: var(--box-shadow-lg);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding-left: 2.5rem;
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .status-badge {
            display: inline-block;
            padding: 0.35em 0.65em;
            font-size: 0.75em;
            font-weight: 600;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.25rem;
        }

        .status-active {
            background-color: rgba(0, 211, 149, 0.1);
            color: var(--success);
        }

        .status-suspended {
            background-color: rgba(255, 61, 87, 0.1);
            color: var(--error);
        }

        .status-pending {
            background-color: rgba(255, 184, 0, 0.1);
            color: var(--warning);
        }

        .status-completed {
            background-color: rgba(0, 123, 255, 0.1);
            color: #007BFF;
        }

        .tabs-container {
            border-bottom: 1px solid var(--gray-light);
        }

        .nav-tabs .nav-link {
            color: var(--gray);
            border: none;
            padding: 0.75rem 1.5rem;
            margin-bottom: -1px;
            background: none;
        }

        .nav-tabs .nav-link.active {
            color: var(--primary);
            background: none;
            border-bottom: 2px solid var(--primary);
        }

        .nav-tabs .nav-link:hover {
            border-color: transparent;
            color: var(--primary);
        }

        .tab-content {
            padding: 1.5rem 0;
        }

        .user-details-card {
            border-left: 4px solid var(--primary);
        }

        .activity-item {
            position: relative;
            padding-left: 2rem;
            margin-bottom: 1.5rem;
        }

        .activity-item:before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 0;
            bottom: -1.5rem;
            width: 2px;
            background-color: var(--gray-light);
        }

        .activity-item:last-child:before {
            display: none;
        }

        .activity-dot {
            position: absolute;
            left: 0;
            top: 0;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            background-color: var(--primary);
            z-index: 1;
        }

        .activity-date {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .custom-file-upload {
            border: 1px dashed var(--gray-light);
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
            border-radius: var(--border-radius);
            width: 100%;
            text-align: center;
            transition: var(--transition);
        }

        .custom-file-upload:hover {
            border-color: var(--primary);
            background-color: var(--gray-light);
        }

        .file-input {
            display: none;
        }

        .settings-card {
            border-left: 4px solid var(--gold);
        }

        .security-card {
            border-left: 4px solid var(--error);
        }

        .notification-card {
            border-left: 4px solid var(--purple);
        }

        .plan-card {
            border-left: 4px solid var(--blue);
        }

        .quick-stats {
            display: flex;
            flex-wrap: wrap;
            margin: -0.5rem;
        }

        .quick-stat {
            flex: 1 0 200px;
            margin: 0.5rem;
            padding: 1rem;
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary);
        }

        .quick-stat i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .quick-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .quick-stat-label {
            font-size: 0.875rem;
            color: var(--gray);
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .sidebar-collapsed {
                width: 280px;
                transform: translateX(-100%);
            }
            
            .sidebar-collapsed.show {
                transform: translateX(0);
            }
            
            .sidebar-collapsed .sidebar-text {
                display: inline;
            }
            
            .sidebar-collapsed .nav-link {
                justify-content: flex-start;
            }
            
            .main-content-expanded {
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            .quick-stat {
                flex: 1 0 100%;
            }
            
            .chat-widget {
                width: 100%;
                bottom: 0;
                right: 0;
                border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="d-flex flex-column h-100">
            <!-- Sidebar Header -->
            <div class="p-3 border-bottom border-gray-light d-flex align-items-center justify-content-between">
                <a href="#" class="text-decoration-none d-flex align-items-center">
                    <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="Logo" height="30" class="me-2">
                    <span class="sidebar-text fs-5 fw-bold text-white">BitHash Admin</span>
                </a>
                <button class="btn btn-link text-gray d-lg-none" id="sidebarToggle">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Sidebar Menu -->
            <div class="flex-grow-1 overflow-auto">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span class="sidebar-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="users">
                            <i class="fas fa-users"></i>
                            <span class="sidebar-text">User Management</span>
                            <span class="badge bg-primary rounded-pill ms-auto sidebar-text" id="usersBadge">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="transactions">
                            <i class="fas fa-exchange-alt"></i>
                            <span class="sidebar-text">Transactions</span>
                            <span class="badge bg-primary rounded-pill ms-auto sidebar-text" id="transactionsBadge">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="investments">
                            <i class="fas fa-chart-line"></i>
                            <span class="sidebar-text">Investments</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="withdrawals">
                            <i class="fas fa-money-bill-wave"></i>
                            <span class="sidebar-text">Withdrawals</span>
                            <span class="badge bg-warning rounded-pill ms-auto sidebar-text" id="withdrawalsBadge">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="plans">
                            <i class="fas fa-boxes"></i>
                            <span class="sidebar-text">Investment Plans</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="support">
                            <i class="fas fa-headset"></i>
                            <span class="sidebar-text">Support Tickets</span>
                            <span class="badge bg-danger rounded-pill ms-auto sidebar-text" id="ticketsBadge">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="notifications">
                            <i class="fas fa-bell"></i>
                            <span class="sidebar-text">Notifications</span>
                            <span class="badge bg-primary rounded-pill ms-auto sidebar-text" id="notificationsBadge">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="reports">
                            <i class="fas fa-file-alt"></i>
                            <span class="sidebar-text">Reports</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="settings">
                            <i class="fas fa-cog"></i>
                            <span class="sidebar-text">Settings</span>
                        </a>
                    </li>
                </ul>
            </div>
            
            <!-- Sidebar Footer -->
            <div class="p-3 border-top border-gray-light">
                <div class="d-flex align-items-center">
                    <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="Admin" class="user-avatar me-2">
                    <div class="sidebar-text">
                        <div class="fw-bold" id="adminName">Loading...</div>
                        <div class="text-gray small" id="adminRole">Administrator</div>
                    </div>
                </div>
                <div class="mt-2">
                    <a href="#" class="btn btn-sm btn-outline-primary w-100" id="logoutBtn">
                        <i class="fas fa-sign-out-alt me-1"></i>
                        <span class="sidebar-text">Logout</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <button class="btn btn-link text-gray me-2 d-none d-lg-inline-block" id="sidebarCollapse">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="d-flex align-items-center">
                    <div class="search-box me-3">
                        <i class="fas fa-search"></i>
                        <input type="text" class="form-control ps-4" placeholder="Search..." id="globalSearch">
                    </div>
                    
                    <div class="dropdown">
                        <a href="#" class="text-gray ms-2" id="notificationsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-bell"></i>
                            <span class="position-absolute notification-badge badge bg-danger rounded-pill" id="notificationCount">0</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end p-0" aria-labelledby="notificationsDropdown" style="width: 350px;">
                            <li class="dropdown-header bg-light-dark p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">Notifications</h6>
                                    <a href="#" class="small">Clear All</a>
                                </div>
                            </li>
                            <li class="dropdown-divider m-0"></li>
                            <div class="notification-list" id="notificationList" style="max-height: 300px; overflow-y: auto;">
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                            <li class="dropdown-divider m-0"></li>
                            <li class="dropdown-footer p-2 text-center">
                                <a href="#" class="small">View All Notifications</a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="dropdown ms-3">
                        <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="Admin" class="user-avatar me-2">
                            <span class="d-none d-lg-inline-block" id="adminNameShort">Loading...</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i> Profile</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i> Settings</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-list me-2"></i> Activity Log</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="logoutBtnMobile"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Page Content -->
        <div class="container-fluid py-4">
            <!-- Dashboard Section -->
            <div class="section-content" id="dashboardSection">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Dashboard Overview</h4>
                    <div class="d-flex">
                        <div class="me-2">
                            <select class="form-select form-select-sm" id="dashboardTimeRange">
                                <option value="7">Last 7 Days</option>
                                <option value="30" selected>Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                                <option value="365">Last Year</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                        <button class="btn btn-sm btn-primary" id="refreshDashboard">
                            <i class="fas fa-sync-alt me-1"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="text-gray mb-2">Total Users</h6>
                                        <h3 class="mb-0" id="totalUsers">0</h3>
                                    </div>
                                    <div class="bg-primary-light rounded-circle p-3">
                                        <i class="fas fa-users text-primary"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="text-success small" id="usersChange">
                                        <i class="fas fa-arrow-up me-1"></i> 0%
                                    </span>
                                    <span class="text-gray small ms-2">vs previous period</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="text-gray mb-2">Active Investments</h6>
                                        <h3 class="mb-0" id="activeInvestments">0</h3>
                                    </div>
                                    <div class="bg-primary-light rounded-circle p-3">
                                        <i class="fas fa-chart-line text-primary"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="text-success small" id="investmentsChange">
                                        <i class="fas fa-arrow-up me-1"></i> 0%
                                    </span>
                                    <span class="text-gray small ms-2">vs previous period</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="text-gray mb-2">Total Deposits</h6>
                                        <h3 class="mb-0" id="totalDeposits">$0</h3>
                                    </div>
                                    <div class="bg-primary-light rounded-circle p-3">
                                        <i class="fas fa-dollar-sign text-primary"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="text-success small" id="depositsChange">
                                        <i class="fas fa-arrow-up me-1"></i> 0%
                                    </span>
                                    <span class="text-gray small ms-2">vs previous period</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="text-gray mb-2">Pending Withdrawals</h6>
                                        <h3 class="mb-0" id="pendingWithdrawals">0</h3>
                                    </div>
                                    <div class="bg-primary-light rounded-circle p-3">
                                        <i class="fas fa-money-bill-wave text-primary"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="text-danger small" id="withdrawalsChange">
                                        <i class="fas fa-arrow-down me-1"></i> 0%
                                    </span>
                                    <span class="text-gray small ms-2">vs previous period</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Charts Row -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">User Activity</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" style="height: 300px;">
                                    <canvas id="userActivityChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">User Distribution</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" style="height: 300px;">
                                    <canvas id="userDistributionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">Recent Transactions</h6>
                                <a href="#" class="small" data-section="transactions">View All</a>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0" id="recentTransactionsTable">
                                        <thead>
                                            <tr>
                                                <th>User</th>
                                                <th>Amount</th>
                                                <th>Type</th>
                                                <th>Status</th>
                                                <th>Date</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="5" class="text-center py-4">
                                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                                        <span class="visually-hidden">Loading...</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">Recent Support Tickets</h6>
                                <a href="#" class="small" data-section="support">View All</a>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0" id="recentTicketsTable">
                                        <thead>
                                            <tr>
                                                <th>Ticket ID</th>
                                                <th>Subject</th>
                                                <th>User</th>
                                                <th>Status</th>
                                                <th>Date</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="5" class="text-center py-4">
                                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                                        <span class="visually-hidden">Loading...</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- User Management Section -->
            <div class="section-content d-none" id="usersSection">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">User Management</h4>
                    <div class="d-flex">
                        <div class="me-2">
                            <select class="form-select form-select-sm" id="usersFilter">
                                <option value="">All Users</option>
                                <option value="active">Active</option>
                                <option value="suspended">Suspended</option>
                                <option value="unverified">Unverified</option>
                                <option value="kyc_pending">KYC Pending</option>
                                <option value="kyc_approved">KYC Approved</option>
                            </select>
                        </div>
                        <button class="btn btn-sm btn-primary me-2" id="exportUsersBtn">
                            <i class="fas fa-file-export me-1"></i> Export
                        </button>
                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                            <i class="fas fa-plus me-1"></i> Add User
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0" id="usersTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>User</th>
                                        <th>Email</th>
                                        <th>Balance</th>
                                        <th>Status</th>
                                        <th>KYC</th>
                                        <th>Joined</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="8" class="text-center py-4">
                                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Transactions Section -->
            <div class="section-content d-none" id="transactionsSection">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Transaction History</h4>
                    <div class="d-flex">
                        <div class="me-2">
                            <select class="form-select form-select-sm" id="transactionsTypeFilter">
                                <option value="">All Types</option>
                                <option value="deposit">Deposits</option>
                                <option value="withdrawal">Withdrawals</option>
                                <option value="transfer">Transfers</option>
                                <option value="investment">Investments</option>
                                <option value="earning">Earnings</option>
                            </select>
                        </div>
                        <div class="me-2">
                            <select class="form-select form-select-sm" id="transactionsStatusFilter">
                                <option value="">All Statuses</option>
                                <option value="pending">Pending</option>
                                <option value="completed">Completed</option>
                                <option value="failed">Failed</option>
                                <option value="reversed">Reversed</option>
                            </select>
                        </div>
                        <button class="btn btn-sm btn-primary" id="exportTransactionsBtn">
                            <i class="fas fa-file-export me-1"></i> Export
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0" id="transactionsTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>User</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Fee</th>
                                        <th>Method</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="9" class="text-center py-4">
                                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Investments Section -->
            <div class="section-content d-none" id="investmentsSection">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Investment Management</h4>
                    <div class="d-flex">
                        <div class="me-2">
                            <select class="form-select form-select-sm" id="investmentsStatusFilter">
                                <option value="">All Statuses</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="me-2">
                            <select class="form-select form-select-sm" id="investmentsPlanFilter">
                                <option value="">All Plans</option>
                                <!-- Will be populated dynamically -->
                            </select>
                        </div>
                        <button class="btn btn-sm btn-primary" id="exportInvestmentsBtn">
                            <i class="fas fa-file-export me-1"></i> Export
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0" id="investmentsTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>User</th>
                                        <th>Plan</th>
                                        <th>Amount</th>
                                        <th>Profit</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="9" class="text-center py-4">
                                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Withdrawals Section -->
            <div class="section-content d-none" id="withdrawalsSection">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Withdrawal Requests</h4>
                    <div class="d-flex">
                        <div class="me-2">
                            <select class="form-select form-select-sm" id="withdrawalsStatusFilter">
                                <option value="pending" selected>Pending</option>
                                <option value="">All Statuses</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                                <option value="processing">Processing</option>
                            </select>
                        </div>
                        <div class="me-2">
                            <select class="form-select form-select-sm" id="withdrawalsMethodFilter">
                                <option value="">All Methods</option>
                                <option value="bank">Bank Transfer</option>
                                <option value="crypto">Cryptocurrency</option>
                                <option value="paypal">PayPal</option>
                                <option value="skrill">Skrill</option>
                            </select>
                        </div>
                        <button class="btn btn-sm btn-primary" id="exportWithdrawalsBtn">
                            <i class="fas fa-file-export me-1"></i> Export
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0" id="withdrawalsTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Fee</th>
                                        <th>Method</th>
                                        <th>Wallet/Bank</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="9" class="text-center py-4">
                                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Plans Section -->
            <div class="section-content d-none" id="plansSection">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Investment Plans</h4>
                    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addPlanModal">
                        <i class="fas fa-plus me-1"></i> Add Plan
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0" id="plansTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Min Amount</th>
                                        <th>Max Amount</th>
                                        <th>Duration</th>
                                        <th>Daily Profit</th>
                                        <th>Total Return</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="9" class="text-center py-4">
                                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Support Section -->
            <div class="section-content d-none" id="supportSection">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Support Tickets</h4>
                    <div class="d-flex">
                        <div class="me-2">
                            <select class="form-select form-select-sm" id="supportStatusFilter">
                                <option value="">All Statuses</option>
                                <option value="open">Open</option>
                                <option value="pending">Pending</option>
                                <option value="resolved">Resolved</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                        <div class="me-2">
                            <select class="form-select form-select-sm" id="supportPriorityFilter">
                                <option value="">All Priorities</option>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        <button class="btn btn-sm btn-primary" id="exportSupportBtn">
                            <i class="fas fa-file-export me-1"></i> Export
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0" id="supportTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Subject</th>
                                        <th>User</th>
                                        <th>Priority</th>
                                        <th>Status</th>
                                        <th>Last Reply</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="8" class="text-center py-4">
                                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Notifications Section -->
            <div class="section-content d-none" id="notificationsSection">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Notifications</h4>
                    <div class="d-flex">
                        <button class="btn btn-sm btn-primary me-2" id="markAllReadBtn">
                            <i class="fas fa-check-circle me-1"></i> Mark All as Read
                        </button>
                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#sendNotificationModal">
                            <i class="fas fa-paper-plane me-1"></i> Send Notification
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0" id="notificationsTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Title</th>
                                        <th>Message</th>
                                        <th>Type</th>
                                        <th>Recipients</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="8" class="text-center py-4">
                                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Reports Section -->
            <div class="section-content d-none" id="reportsSection">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Reports</h4>
                    <div class="d-flex">
                        <div class="me-2">
                            <select class="form-select form-select-sm" id="reportType">
                                <option value="">Select Report Type</option>
                                <option value="users">User Registration</option>
                                <option value="transactions">Transactions</option>
                                <option value="investments">Investments</option>
                                <option value="withdrawals">Withdrawals</option>
                                <option value="profits">Profits</option>
                                <option value="support">Support Tickets</option>
                            </select>
                        </div>
                        <div class="me-2">
                            <select class="form-select form-select-sm" id="reportFormat">
                                <option value="pdf">PDF</option>
                                <option value="csv">CSV</option>
                                <option value="excel">Excel</option>
                            </select>
                        </div>
                        <button class="btn btn-sm btn-primary" id="generateReportBtn">
                            <i class="fas fa-file-export me-1"></i> Generate Report
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">Report Preview</h6>
                    </div>
                    <div class="card-body">
                        <div class="text-center py-5" id="reportPreview">
                            <i class="fas fa-file-alt fa-4x text-gray mb-3"></i>
                            <h5>No report generated yet</h5>
                            <p class="text-gray">Select a report type and click "Generate Report" to create a new report</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Section -->
            <div class="section-content d-none" id="settingsSection">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body p-0">
                                <div class="list-group list-group-flush">
                                    <a href="#" class="list-group-item list-group-item-action active" data-settings-tab="general">
                                        <i class="fas fa-cog me-2"></i> General Settings
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" data-settings-tab="security">
                                        <i class="fas fa-shield-alt me-2"></i> Security
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" data-settings-tab="email">
                                        <i class="fas fa-envelope me-2"></i> Email Settings
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" data-settings-tab="payment">
                                        <i class="fas fa-credit-card me-2"></i> Payment Methods
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" data-settings-tab="seo">
                                        <i class="fas fa-search me-2"></i> SEO Settings
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" data-settings-tab="maintenance">
                                        <i class="fas fa-tools me-2"></i> Maintenance
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <!-- General Settings Tab -->
                        <div class="settings-tab-content" id="generalSettingsTab">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">General Settings</h6>
                                </div>
                                <div class="card-body">
                                    <form id="generalSettingsForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="siteName" class="form-label">Site Name</label>
                                                <input type="text" class="form-control" id="siteName" name="siteName">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="siteUrl" class="form-label">Site URL</label>
                                                <input type="url" class="form-control" id="siteUrl" name="siteUrl">
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="siteEmail" class="form-label">Contact Email</label>
                                                <input type="email" class="form-control" id="siteEmail" name="siteEmail">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="sitePhone" class="form-label">Contact Phone</label>
                                                <input type="tel" class="form-control" id="sitePhone" name="sitePhone">
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="siteCurrency" class="form-label">Default Currency</label>
                                                <select class="form-select" id="siteCurrency" name="siteCurrency">
                                                    <option value="USD">US Dollar (USD)</option>
                                                    <option value="EUR">Euro (EUR)</option>
                                                    <option value="GBP">British Pound (GBP)</option>
                                                    <option value="BTC">Bitcoin (BTC)</option>
                                                    <option value="ETH">Ethereum (ETH)</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="timezone" class="form-label">Timezone</label>
                                                <select class="form-select" id="timezone" name="timezone">
                                                    <option value="UTC">UTC</option>
                                                    <option value="America/New_York">Eastern Time (ET)</option>
                                                    <option value="America/Chicago">Central Time (CT)</option>
                                                    <option value="America/Denver">Mountain Time (MT)</option>
                                                    <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                                    <option value="Europe/London">London (GMT/BST)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="siteLogo" class="form-label">Site Logo</label>
                                            <label for="siteLogoUpload" class="custom-file-upload w-100">
                                                <i class="fas fa-upload me-2"></i> Choose Logo
                                                <input id="siteLogoUpload" type="file" class="file-input" accept="image/*">
                                            </label>
                                            <div class="mt-2" id="logoPreviewContainer" style="display: none;">
                                                <img src="" alt="Logo Preview" id="logoPreview" class="img-thumbnail" style="max-height: 100px;">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="siteFavicon" class="form-label">Favicon</label>
                                            <label for="faviconUpload" class="custom-file-upload w-100">
                                                <i class="fas fa-upload me-2"></i> Choose Favicon
                                                <input id="faviconUpload" type="file" class="file-input" accept="image/x-icon,image/png">
                                            </label>
                                            <div class="mt-2" id="faviconPreviewContainer" style="display: none;">
                                                <img src="" alt="Favicon Preview" id="faviconPreview" class="img-thumbnail" style="max-height: 32px;">
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-1"></i> Save Changes
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Security Settings Tab -->
                        <div class="settings-tab-content d-none" id="securitySettingsTab">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Security Settings</h6>
                                </div>
                                <div class="card-body">
                                    <form id="securitySettingsForm">
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="enable2FA" name="enable2FA">
                                                <label class="form-check-label" for="enable2FA">Enable Two-Factor Authentication for Admin</label>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="forceSSL" name="forceSSL">
                                                <label class="form-check-label" for="forceSSL">Force SSL (HTTPS)</label>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="enableCaptcha" name="enableCaptcha">
                                                <label class="form-check-label" for="enableCaptcha">Enable reCAPTCHA on Login</label>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="enableLoginAlerts" name="enableLoginAlerts">
                                                <label class="form-check-label" for="enableLoginAlerts">Enable Email Alerts for Admin Logins</label>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="enableIpWhitelist" name="enableIpWhitelist">
                                                <label class="form-check-label" for="enableIpWhitelist">Enable IP Whitelist for Admin Panel</label>
                                            </div>
                                        </div>
                                        <div class="mb-3" id="ipWhitelistContainer" style="display: none;">
                                            <label for="ipWhitelist" class="form-label">Allowed IP Addresses (one per line)</label>
                                            <textarea class="form-control" id="ipWhitelist" name="ipWhitelist" rows="5"></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="sessionTimeout" class="form-label">Admin Session Timeout (minutes)</label>
                                            <input type="number" class="form-control" id="sessionTimeout" name="sessionTimeout" min="5" max="1440">
                                        </div>
                                        <div class="mb-3">
                                            <label for="failedLoginAttempts" class="form-label">Max Failed Login Attempts Before Lockout</label>
                                            <input type="number" class="form-control" id="failedLoginAttempts" name="failedLoginAttempts" min="1" max="10">
                                        </div>
                                        <div class="text-end">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-1"></i> Save Changes
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Email Settings Tab -->
                        <div class="settings-tab-content d-none" id="emailSettingsTab">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Email Settings</h6>
                                </div>
                                <div class="card-body">
                                    <form id="emailSettingsForm">
                                        <div class="mb-3">
                                            <label for="mailDriver" class="form-label">Mail Driver</label>
                                            <select class="form-select" id="mailDriver" name="mailDriver">
                                                <option value="smtp">SMTP</option>
                                                <option value="mailgun">Mailgun</option>
                                                <option value="ses">Amazon SES</option>
                                                <option value="sendgrid">SendGrid</option>
                                            </select>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="mailHost" class="form-label">SMTP Host</label>
                                                <input type="text" class="form-control" id="mailHost" name="mailHost">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="mailPort" class="form-label">SMTP Port</label>
                                                <input type="number" class="form-control" id="mailPort" name="mailPort">
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="mailUsername" class="form-label">SMTP Username</label>
                                                <input type="text" class="form-control" id="mailUsername" name="mailUsername">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="mailPassword" class="form-label">SMTP Password</label>
                                                <input type="password" class="form-control" id="mailPassword" name="mailPassword">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="mailEncryption" class="form-label">Encryption</label>
                                            <select class="form-select" id="mailEncryption" name="mailEncryption">
                                                <option value="tls">TLS</option>
                                                <option value="ssl">SSL</option>
                                                <option value="">None</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="mailFromAddress" class="form-label">From Address</label>
                                            <input type="email" class="form-control" id="mailFromAddress" name="mailFromAddress">
                                        </div>
                                        <div class="mb-3">
                                            <label for="mailFromName" class="form-label">From Name</label>
                                            <input type="text" class="form-control" id="mailFromName" name="mailFromName">
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="testEmailEnabled" name="testEmailEnabled">
                                                <label class="form-check-label" for="testEmailEnabled">Enable Test Email</label>
                                            </div>
                                        </div>
                                        <div class="mb-3" id="testEmailContainer" style="display: none;">
                                            <label for="testEmailAddress" class="form-label">Test Email Address</label>
                                            <div class="input-group">
                                                <input type="email" class="form-control" id="testEmailAddress" name="testEmailAddress">
                                                <button class="btn btn-outline-primary" type="button" id="sendTestEmailBtn">
                                                    <i class="fas fa-paper-plane me-1"></i> Send Test
                                                </button>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-1"></i> Save Changes
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Payment Settings Tab -->
                        <div class="settings-tab-content d-none" id="paymentSettingsTab">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Payment Methods</h6>
                                </div>
                                <div class="card-body">
                                    <ul class="nav nav-tabs mb-4" id="paymentTabs" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active" id="bank-tab" data-bs-toggle="tab" data-bs-target="#bank" type="button" role="tab">Bank Transfer</button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="paypal-tab" data-bs-toggle="tab" data-bs-target="#paypal" type="button" role="tab">PayPal</button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="stripe-tab" data-bs-toggle="tab" data-bs-target="#stripe" type="button" role="tab">Stripe</button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="crypto-tab" data-bs-toggle="tab" data-bs-target="#crypto" type="button" role="tab">Cryptocurrency</button>
                                        </li>
                                    </ul>
                                    <div class="tab-content" id="paymentTabContent">
                                        <div class="tab-pane fade show active" id="bank" role="tabpanel">
                                            <form id="bankSettingsForm">
                                                <div class="mb-3">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="bankTransferEnabled" name="enabled">
                                                        <label class="form-check-label" for="bankTransferEnabled">Enable Bank Transfer</label>
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="bankName" class="form-label">Bank Name</label>
                                                    <input type="text" class="form-control" id="bankName" name="bankName">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="accountName" class="form-label">Account Name</label>
                                                    <input type="text" class="form-control" id="accountName" name="accountName">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="accountNumber" class="form-label">Account Number</label>
                                                    <input type="text" class="form-control" id="accountNumber" name="accountNumber">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="iban" class="form-label">IBAN</label>
                                                    <input type="text" class="form-control" id="iban" name="iban">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="swiftCode" class="form-label">SWIFT/BIC Code</label>
                                                    <input type="text" class="form-control" id="swiftCode" name="swiftCode">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="bankAddress" class="form-label">Bank Address</label>
                                                    <textarea class="form-control" id="bankAddress" name="bankAddress" rows="3"></textarea>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="bankInstructions" class="form-label">Deposit Instructions</label>
                                                    <textarea class="form-control" id="bankInstructions" name="instructions" rows="5"></textarea>
                                                </div>
                                                <div class="text-end">
                                                    <button type="submit" class="btn btn-primary">
                                                        <i class="fas fa-save me-1"></i> Save Changes
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="tab-pane fade" id="paypal" role="tabpanel">
                                            <form id="paypalSettingsForm">
                                                <div class="mb-3">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="paypalEnabled" name="enabled">
                                                        <label class="form-check-label" for="paypalEnabled">Enable PayPal</label>
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="paypalEmail" class="form-label">PayPal Email</label>
                                                    <input type="email" class="form-control" id="paypalEmail" name="email">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="paypalClientId" class="form-label">Client ID</label>
                                                    <input type="text" class="form-control" id="paypalClientId" name="clientId">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="paypalSecret" class="form-label">Secret Key</label>
                                                    <input type="password" class="form-control" id="paypalSecret" name="secret">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="paypalMode" class="form-label">Mode</label>
                                                    <select class="form-select" id="paypalMode" name="mode">
                                                        <option value="sandbox">Sandbox</option>
                                                        <option value="live">Live</option>
                                                    </select>
                                                </div>
                                                <div class="text-end">
                                                    <button type="submit" class="btn btn-primary">
                                                        <i class="fas fa-save me-1"></i> Save Changes
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="tab-pane fade" id="stripe" role="tabpanel">
                                            <form id="stripeSettingsForm">
                                                <div class="mb-3">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="stripeEnabled" name="enabled">
                                                        <label class="form-check-label" for="stripeEnabled">Enable Stripe</label>
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="stripePublishableKey" class="form-label">Publishable Key</label>
                                                    <input type="text" class="form-control" id="stripePublishableKey" name="publishableKey">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="stripeSecretKey" class="form-label">Secret Key</label>
                                                    <input type="password" class="form-control" id="stripeSecretKey" name="secretKey">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="stripeWebhookSecret" class="form-label">Webhook Secret</label>
                                                    <input type="password" class="form-control" id="stripeWebhookSecret" name="webhookSecret">
                                                </div>
                                                <div class="text-end">
                                                    <button type="submit" class="btn btn-primary">
                                                        <i class="fas fa-save me-1"></i> Save Changes
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="tab-pane fade" id="crypto" role="tabpanel">
                                            <form id="cryptoSettingsForm">
                                                <div class="mb-3">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="cryptoEnabled" name="enabled">
                                                        <label class="form-check-label" for="cryptoEnabled">Enable Cryptocurrency Payments</label>
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="btcAddress" class="form-label">Bitcoin (BTC) Address</label>
                                                    <input type="text" class="form-control" id="btcAddress" name="btcAddress">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="ethAddress" class="form-label">Ethereum (ETH) Address</label>
                                                    <input type="text" class="form-control" id="ethAddress" name="ethAddress">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="ltcAddress" class="form-label">Litecoin (LTC) Address</label>
                                                    <input type="text" class="form-control" id="ltcAddress" name="ltcAddress">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="usdtAddress" class="form-label">USDT (ERC20) Address</label>
                                                    <input type="text" class="form-control" id="usdtAddress" name="usdtAddress">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="cryptoConfirmations" class="form-label">Required Confirmations</label>
                                                    <input type="number" class="form-control" id="cryptoConfirmations" name="confirmations" min="1" max="10">
                                                </div>
                                                <div class="text-end">
                                                    <button type="submit" class="btn btn-primary">
                                                        <i class="fas fa-save me-1"></i> Save Changes
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- SEO Settings Tab -->
                        <div class="settings-tab-content d-none" id="seoSettingsTab">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">SEO Settings</h6>
                                </div>
                                <div class="card-body">
                                    <form id="seoSettingsForm">
                                        <div class="mb-3">
                                            <label for="metaTitle" class="form-label">Meta Title</label>
                                            <input type="text" class="form-control" id="metaTitle" name="metaTitle">
                                            <div class="form-text">Typically around 50-60 characters</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="metaDescription" class="form-label">Meta Description</label>
                                            <textarea class="form-control" id="metaDescription" name="metaDescription" rows="3"></textarea>
                                            <div class="form-text">Typically around 150-160 characters</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="metaKeywords" class="form-label">Meta Keywords</label>
                                            <textarea class="form-control" id="metaKeywords" name="metaKeywords" rows="3"></textarea>
                                            <div class="form-text">Comma separated keywords</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="googleAnalytics" class="form-label">Google Analytics Tracking ID</label>
                                            <input type="text" class="form-control" id="googleAnalytics" name="googleAnalytics">
                                        </div>
                                        <div class="mb-3">
                                            <label for="facebookPixel" class="form-label">Facebook Pixel ID</label>
                                            <input type="text" class="form-control" id="facebookPixel" name="facebookPixel">
                                        </div>
                                        <div class="mb-3">
                                            <label for="sitemapUrl" class="form-label">Sitemap URL</label>
                                            <input type="url" class="form-control" id="sitemapUrl" name="sitemapUrl">
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="enableSitemap" name="enableSitemap">
                                                <label class="form-check-label" for="enableSitemap">Enable Automatic Sitemap Generation</label>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="enableRobots" name="enableRobots">
                                                <label class="form-check-label" for="enableRobots">Enable Robots.txt</label>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-1"></i> Save Changes
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Maintenance Settings Tab -->
                        <div class="settings-tab-content d-none" id="maintenanceSettingsTab">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Maintenance Mode</h6>
                                </div>
                                <div class="card-body">
                                    <form id="maintenanceSettingsForm">
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="maintenanceMode" name="maintenanceMode">
                                                <label class="form-check-label" for="maintenanceMode">Enable Maintenance Mode</label>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="maintenanceMessage" class="form-label">Maintenance Message</label>
                                            <textarea class="form-control" id="maintenanceMessage" name="maintenanceMessage" rows="5"></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="maintenanceAllowedIps" class="form-label">Allowed IP Addresses (one per line)</label>
                                            <textarea class="form-control" id="maintenanceAllowedIps" name="allowedIps" rows="5"></textarea>
                                            <div class="form-text">These IPs will still be able to access the site during maintenance</div>
                                        </div>
                                        <div class="text-end">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-1"></i> Save Changes
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    <h6 class="mb-0">System Information</h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <tbody>
                                                <tr>
                                                    <th width="30%">PHP Version</th>
                                                    <td id="phpVersion">Loading...</td>
                                                </tr>
                                                <tr>
                                                    <th>Laravel Version</th>
                                                    <td id="laravelVersion">Loading...</td>
                                                </tr>
                                                <tr>
                                                    <th>Server Software</th>
                                                    <td id="serverSoftware">Loading...</td>
                                                </tr>
                                                <tr>
                                                    <th>Database Version</th>
                                                    <td id="databaseVersion">Loading...</td>
                                                </tr>
                                                <tr>
                                                    <th>Last Cron Run</th>
                                                    <td id="lastCronRun">Loading...</td>
                                                </tr>
                                                <tr>
                                                    <th>Queue Worker</th>
                                                    <td id="queueWorkerStatus">Loading...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="text-end mt-3">
                                        <button class="btn btn-primary" id="clearCacheBtn">
                                            <i class="fas fa-broom me-1"></i> Clear Cache
                                        </button>
                                        <button class="btn btn-danger ms-2" id="restartQueueBtn">
                                            <i class="fas fa-sync-alt me-1"></i> Restart Queue Worker
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="addUserForm">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="firstName" class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="firstName" name="firstName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="lastName" class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="lastName" name="lastName" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="password" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="password" name="password" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="confirmPassword" class="form-label">Confirm Password</label>
                                    <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="phone" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="phone" name="phone">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="country" class="form-label">Country</label>
                                    <select class="form-select" id="country" name="country">
                                        <option value="">Select Country</option>
                                        <!-- Will be populated dynamically -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="address" class="form-label">Address</label>
                            <input type="text" class="form-control" id="address" name="address">
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="city" class="form-label">City</label>
                                    <input type="text" class="form-control" id="city" name="city">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="state" class="form-label">State/Province</label>
                                    <input type="text" class="form-control" id="state" name="state">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="zip" class="form-label">ZIP/Postal Code</label>
                                    <input type="text" class="form-control" id="zip" name="zip">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="referral" class="form-label">Referral Code (Optional)</label>
                            <input type="text" class="form-control" id="referral" name="referral">
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="balance" class="form-label">Initial Balance</label>
                                    <input type="number" class="form-control" id="balance" name="balance" min="0" step="0.01" value="0">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="status" class="form-label">Account Status</label>
                                    <select class="form-select" id="status" name="status">
                                        <option value="active">Active</option>
                                        <option value="pending">Pending Verification</option>
                                        <option value="suspended">Suspended</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sendWelcomeEmail" name="sendWelcomeEmail" checked>
                                <label class="form-check-label" for="sendWelcomeEmail">Send welcome email with login details</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add User</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal fade" id="editUserModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="editUserForm">
                    <input type="hidden" id="editUserId" name="id">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editFirstName" class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="editFirstName" name="firstName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editLastName" class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="editLastName" name="lastName" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editEmail" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="editEmail" name="email" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editPhone" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="editPhone" name="phone">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editCountry" class="form-label">Country</label>
                                    <select class="form-select" id="editCountry" name="country">
                                        <option value="">Select Country</option>
                                        <!-- Will be populated dynamically -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editAddress" class="form-label">Address</label>
                            <input type="text" class="form-control" id="editAddress" name="address">
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="editCity" class="form-label">City</label>
                                    <input type="text" class="form-control" id="editCity" name="city">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="editState" class="form-label">State/Province</label>
                                    <input type="text" class="form-control" id="editState" name="state">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="editZip" class="form-label">ZIP/Postal Code</label>
                                    <input type="text" class="form-control" id="editZip" name="zip">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editBalance" class="form-label">Account Balance</label>
                                    <input type="number" class="form-control" id="editBalance" name="balance" min="0" step="0.01">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editStatus" class="form-label">Account Status</label>
                                    <select class="form-select" id="editStatus" name="status">
                                        <option value="active">Active</option>
                                        <option value="pending">Pending Verification</option>
                                        <option value="suspended">Suspended</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editKycStatus" class="form-label">KYC Status</label>
                            <select class="form-select" id="editKycStatus" name="kycStatus">
                                <option value="not_submitted">Not Submitted</option>
                                <option value="pending">Pending Review</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editEmailVerified" name="emailVerified">
                                <label class="form-check-label" for="editEmailVerified">Email Verified</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPhoneVerified" name="phoneVerified">
                                <label class="form-check-label" for="editPhoneVerified">Phone Verified</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editNotes" class="form-label">Admin Notes</label>
                            <textarea class="form-control" id="editNotes" name="notes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View User Modal -->
    <div class="modal fade" id="viewUserModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">User Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card user-details-card mb-4">
                                <div class="card-body text-center">
                                    <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="User" class="rounded-circle mb-3" width="120" id="userAvatar">
                                    <h4 id="userFullName">Loading...</h4>
                                    <p class="text-gray mb-1" id="userEmail">user@example.com</p>
                                    <p class="text-gray mb-3" id="userJoinDate">Joined: Jan 1, 2023</p>
                                    <span class="badge bg-primary mb-3" id="userStatusBadge">Active</span>
                                    <div class="d-flex justify-content-center mb-3">
                                        <div class="px-3 text-center">
                                            <h5 class="mb-0" id="userBalance">$0.00</h5>
                                            <small class="text-gray">Balance</small>
                                        </div>
                                        <div class="px-3 text-center">
                                            <h5 class="mb-0" id="userInvested">$0.00</h5>
                                            <small class="text-gray">Invested</small>
                                        </div>
                                        <div class="px-3 text-center">
                                            <h5 class="mb-0" id="userEarnings">$0.00</h5>
                                            <small class="text-gray">Earnings</small>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-center">
                                        <button class="btn btn-sm btn-outline-primary me-2" id="editUserBtn">
                                            <i class="fas fa-edit me-1"></i> Edit
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" id="messageUserBtn">
                                            <i class="fas fa-envelope me-1"></i> Message
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0">KYC Information</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">KYC Status</label>
                                        <div id="kycStatus">Not Submitted</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">ID Type</label>
                                        <div id="kycIdType">-</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">ID Number</label>
                                        <div id="kycIdNumber">-</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Submitted Date</label>
                                        <div id="kycSubmittedDate">-</div>
                                    </div>
                                    <div class="text-center">
                                        <button class="btn btn-sm btn-primary" id="viewKycDocsBtn">
                                            <i class="fas fa-eye me-1"></i> View Documents
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0">Personal Information</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">First Name</label>
                                            <div id="viewFirstName">Loading...</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Last Name</label>
                                            <div id="viewLastName">Loading...</div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Email</label>
                                            <div id="viewEmail">Loading...</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Phone</label>
                                            <div id="viewPhone">-</div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Country</label>
                                            <div id="viewCountry">-</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Date of Birth</label>
                                            <div id="viewDob">-</div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Address</label>
                                        <div id="viewAddress">-</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <label class="form-label">City</label>
                                            <div id="viewCity">-</div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">State</label>
                                            <div id="viewState">-</div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">ZIP Code</label>
                                            <div id="viewZip">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0">Account Information</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Account Status</label>
                                            <div id="viewAccountStatus">Loading...</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Last Login</label>
                                            <div id="viewLastLogin">-</div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Email Verified</label>
                                            <div id="viewEmailVerified">No</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Phone Verified</label>
                                            <div id="viewPhoneVerified">No</div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">2FA Enabled</label>
                                            <div id="view2faEnabled">No</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">IP Address</label>
                                            <div id="viewIpAddress">-</div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Referral Code</label>
                                        <div id="viewReferralCode">-</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Referred By</label>
                                        <div id="viewReferredBy">-</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Recent Activity</h6>
                                </div>
                                <div class="card-body">
                                    <div class="activity-feed" id="userActivityFeed">
                                        <div class="activity-item">
                                            <div class="activity-dot"></div>
                                            <div class="activity-content">
                                                <p class="mb-1">Account created</p>
                                                <p class="text-gray small mb-0 activity-date">Just now</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View KYC Documents Modal -->
    <div class="modal fade" id="kycDocumentsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">KYC Documents</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0">ID Document (Front)</h6>
                                </div>
                                <div class="card-body text-center">
                                    <img src="" alt="ID Front" class="img-fluid mb-3" id="kycIdFront">
                                    <div class="d-flex justify-content-center">
                                        <button class="btn btn-sm btn-outline-primary me-2" id="approveKycBtn">
                                            <i class="fas fa-check me-1"></i> Approve
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" id="rejectKycBtn">
                                            <i class="fas fa-times me-1"></i> Reject
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0">ID Document (Back)</h6>
                                </div>
                                <div class="card-body text-center">
                                    <img src="" alt="ID Back" class="img-fluid mb-3" id="kycIdBack">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0">Proof of Address</h6>
                                </div>
                                <div class="card-body text-center">
                                    <img src="" alt="Proof of Address" class="img-fluid mb-3" id="kycProofOfAddress">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0">Selfie with ID</h6>
                                </div>
                                <div class="card-body text-center">
                                    <img src="" alt="Selfie with ID" class="img-fluid mb-3" id="kycSelfie">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Plan Modal -->
    <div class="modal fade" id="addPlanModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Investment Plan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="addPlanForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="planName" class="form-label">Plan Name</label>
                            <input type="text" class="form-control" id="planName" name="name" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="minAmount" class="form-label">Minimum Amount</label>
                                    <input type="number" class="form-control" id="minAmount" name="minAmount" min="0" step="0.01" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="maxAmount" class="form-label">Maximum Amount</label>
                                    <input type="number" class="form-control" id="maxAmount" name="maxAmount" min="0" step="0.01">
                                    <div class="form-text">Leave empty for no maximum</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="duration" class="form-label">Duration (days)</label>
                                    <input type="number" class="form-control" id="duration" name="duration" min="1" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="profitReturn" class="form-label">Daily Profit (%)</label>
                                    <input type="number" class="form-control" id="profitReturn" name="profitReturn" min="0" step="0.01" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="totalReturn" class="form-label">Total Return (%)</label>
                            <input type="number" class="form-control" id="totalReturn" name="totalReturn" min="0" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label for="planDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="planDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="planStatus" name="status" checked>
                                <label class="form-check-label" for="planStatus">Active</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Plan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Plan Modal -->
    <div class="modal fade" id="editPlanModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Investment Plan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="editPlanForm">
                    <input type="hidden" id="editPlanId" name="id">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="editPlanName" class="form-label">Plan Name</label>
                            <input type="text" class="form-control" id="editPlanName" name="name" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editMinAmount" class="form-label">Minimum Amount</label>
                                    <input type="number" class="form-control" id="editMinAmount" name="minAmount" min="0" step="0.01" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editMaxAmount" class="form-label">Maximum Amount</label>
                                    <input type="number" class="form-control" id="editMaxAmount" name="maxAmount" min="0" step="0.01">
                                    <div class="form-text">Leave empty for no maximum</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editDuration" class="form-label">Duration (days)</label>
                                    <input type="number" class="form-control" id="editDuration" name="duration" min="1" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editProfitReturn" class="form-label">Daily Profit (%)</label>
                                    <input type="number" class="form-control" id="editProfitReturn" name="profitReturn" min="0" step="0.01" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editTotalReturn" class="form-label">Total Return (%)</label>
                            <input type="number" class="form-control" id="editTotalReturn" name="totalReturn" min="0" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label for="editPlanDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editPlanDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="editPlanStatus" name="status">
                                <label class="form-check-label" for="editPlanStatus">Active</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Process Withdrawal Modal -->
    <div class="modal fade" id="processWithdrawalModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Process Withdrawal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="processWithdrawalForm">
                    <input type="hidden" id="withdrawalId" name="id">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">User</label>
                            <div id="withdrawalUser">Loading...</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Amount</label>
                            <div id="withdrawalAmount">Loading...</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Fee</label>
                            <div id="withdrawalFee">Loading...</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Method</label>
                            <div id="withdrawalMethod">Loading...</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Wallet/Bank Details</label>
                            <div id="withdrawalDetails">Loading...</div>
                        </div>
                        <div class="mb-3">
                            <label for="withdrawalAction" class="form-label">Action</label>
                            <select class="form-select" id="withdrawalAction" name="action" required>
                                <option value="approve">Approve</option>
                                <option value="reject">Reject</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="withdrawalNotes" class="form-label">Notes (Optional)</label>
                            <textarea class="form-control" id="withdrawalNotes" name="notes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Transaction Modal -->
    <div class="modal fade" id="viewTransactionModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Transaction Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Transaction ID</label>
                        <div id="transactionId">Loading...</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">User</label>
                        <div id="transactionUser">Loading...</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Type</label>
                        <div id="transactionType">Loading...</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Amount</label>
                        <div id="transactionAmount">Loading...</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Fee</label>
                        <div id="transactionFee">Loading...</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Net Amount</label>
                        <div id="transactionNetAmount">Loading...</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Method</label>
                        <div id="transactionMethod">Loading...</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Status</label>
                        <div id="transactionStatus">Loading...</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Date</label>
                        <div id="transactionDate">Loading...</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Details</label>
                        <div id="transactionDetails">Loading...</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Ticket Modal -->
    <div class="modal fade" id="viewTicketModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Support Ticket #<span id="ticketId">0</span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0" id="ticketSubject">Loading...</h6>
                                <span class="badge" id="ticketStatusBadge">Loading...</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <div>
                                    <span class="text-gray">Created by:</span>
                                    <span id="ticketUser">Loading...</span>
                                </div>
                                <div>
                                    <span class="text-gray">Priority:</span>
                                    <span id="ticketPriority">Loading...</span>
                                </div>
                                <div>
                                    <span class="text-gray">Date:</span>
                                    <span id="ticketDate">Loading...</span>
                                </div>
                            </div>
                            <div class="ticket-message bg-light-dark p-3 rounded" id="ticketMessage">
                                Loading...
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">Attachments</h6>
                        </div>
                        <div class="card-body">
                            <div class="attachments" id="ticketAttachments">
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">Conversation</h6>
                        </div>
                        <div class="card-body">
                            <div class="conversation" id="ticketConversation">
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                            <form id="replyTicketForm" class="mt-3">
                                <input type="hidden" id="replyTicketId" name="ticketId">
                                <div class="mb-3">
                                    <label for="replyMessage" class="form-label">Your Reply</label>
                                    <textarea class="form-control" id="replyMessage" name="message" rows="3" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="replyAttachments" class="form-label">Attachments (Optional)</label>
                                    <input type="file" class="form-control" id="replyAttachments" name="attachments[]" multiple>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="closeTicket" name="closeTicket">
                                        <label class="form-check-label" for="closeTicket">Close ticket after reply</label>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-paper-plane me-1"></i> Send Reply
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Send Notification Modal -->
    <div class="modal fade" id="sendNotificationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Send Notification</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="sendNotificationForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="notificationType" class="form-label">Notification Type</label>
                            <select class="form-select" id="notificationType" name="type" required>
                                <option value="info">Information</option>
                                <option value="success">Success</option>
                                <option value="warning">Warning</option>
                                <option value="error">Error</option>
                                <option value="promotion">Promotion</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="notificationRecipients" class="form-label">Recipients</label>
                            <select class="form-select" id="notificationRecipients" name="recipients" required>
                                <option value="all">All Users</option>
                                <option value="active">Active Users</option>
                                <option value="investors">Investors</option>
                                <option value="non_investors">Non-Investors</option>
                                <option value="selected">Selected Users</option>
                            </select>
                        </div>
                        <div class="mb-3" id="selectedUsersContainer" style="display: none;">
                            <label for="selectedUsers" class="form-label">Select Users</label>
                            <select class="form-select select2" id="selectedUsers" name="selectedUsers[]" multiple="multiple">
                                <!-- Will be populated dynamically -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="notificationSubject" class="form-label">Subject</label>
                            <input type="text" class="form-control" id="notificationSubject" name="subject" required>
                        </div>
                        <div class="mb-3">
                            <label for="notificationMessage" class="form-label">Message</label>
                            <textarea class="form-control" id="notificationMessage" name="message" rows="5" required></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sendEmail" name="sendEmail">
                                <label class="form-check-label" for="sendEmail">Also send as email</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Send Notification</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Chat Widget -->
    <div class="chat-toggle" id="chatToggle">
        <i class="fas fa-comments"></i>
    </div>
    
    <div class="chat-widget" id="chatWidget">
        <div class="chat-header d-flex justify-content-between align-items-center" id="chatHeader">
            <h6 class="mb-0">Live Chat Support</h6>
            <button class="btn btn-link text-gray p-0" id="minimizeChat">
                <i class="fas fa-minus"></i>
            </button>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="text-center py-5">
                <div class="spinner-border spinner-border-sm text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
        <div class="chat-footer">
            <form id="chatForm">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Type your message..." id="chatMessage" required>
                    <button class="btn btn-primary" type="submit">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Required Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <!-- Custom Script -->
    <script>
        // Initialize AOS animation
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true
        });

        // Global variables
        let adminData = {};
        let socket = null;
        const API_BASE_URL = 'https://website-backendd-1.onrender.com/api/admin';
        let userActivityChart = null;
        let userDistributionChart = null;
        let usersTable = null;
        let transactionsTable = null;
        let investmentsTable = null;
        let withdrawalsTable = null;
        let plansTable = null;
        let supportTable = null;
        let notificationsTable = null;

        // Document ready
        $(document).ready(function() {
            // Check admin authentication
            checkAdminAuth();

            // Initialize sidebar toggle
            initSidebar();

            // Initialize section navigation
            initSections();

            // Initialize modals
            initModals();

            // Initialize form submissions
            initForms();

            // Initialize data tables
            initDataTables();

            // Initialize charts
            initCharts();

            // Initialize chat
            initChat();

            // Load notifications
            loadNotifications();

            // Load admin profile
            loadAdminProfile();

            // Connect to WebSocket
            connectWebSocket();
        });

        // Check admin authentication
        function checkAdminAuth() {
            const token = localStorage.getItem('adminToken');
            if (!token) {
                window.location.href = 'admin-login.html';
                return;
            }

            $.ajax({
                url: `${API_BASE_URL}/auth/verify`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                success: function(response) {
                    if (!response.authenticated) {
                        window.location.href = 'admin-login.html';
                    }
                },
                error: function() {
                    window.location.href = 'admin-login.html';
                }
            });
        }

        // Initialize sidebar toggle
        function initSidebar() {
            $('#sidebarToggle').click(function() {
                $('#sidebar').toggleClass('show');
            });

            $('#sidebarCollapse').click(function() {
                $('#sidebar').toggleClass('sidebar-collapsed');
                $('#mainContent').toggleClass('main-content-expanded');
            });

            // Close sidebar when clicking outside on mobile
            $(document).click(function(event) {
                if ($(window).width() <= 992) {
                    if (!$(event.target).closest('#sidebar').length && !$(event.target).is('#sidebarToggle') && $('#sidebar').hasClass('show')) {
                        $('#sidebar').removeClass('show');
                    }
                }
            });
        }

        // Initialize section navigation
        function initSections() {
            $('[data-section]').click(function(e) {
                e.preventDefault();
                const section = $(this).data('section');
                
                // Hide all sections
                $('.section-content').addClass('d-none');
                
                // Show selected section
                $(`#${section}Section`).removeClass('d-none');
                
                // Update active nav link
                $('.nav-link').removeClass('active');
                $(this).addClass('active');
                
                // Load section data
                loadSectionData(section);
                
                // Scroll to top
                window.scrollTo(0, 0);
            });

            // Settings tabs
            $('[data-settings-tab]').click(function(e) {
                e.preventDefault();
                const tab = $(this).data('settings-tab');
                
                // Update active tab
                $('[data-settings-tab]').removeClass('active');
                $(this).addClass('active');
                
                // Hide all tab content
                $('.settings-tab-content').addClass('d-none');
                
                // Show selected tab content
                $(`#${tab}SettingsTab`).removeClass('d-none');
            });
        }

        // Load section data
        function loadSectionData(section) {
            switch(section) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'users':
                    loadUsersData();
                    break;
                case 'transactions':
                    loadTransactionsData();
                    break;
                case 'investments':
                    loadInvestmentsData();
                    break;
                case 'withdrawals':
                    loadWithdrawalsData();
                    break;
                case 'plans':
                    loadPlansData();
                    break;
                case 'support':
                    loadSupportData();
                    break;
                case 'notifications':
                    loadNotificationsData();
                    break;
                case 'reports':
                    loadReportsData();
                    break;
                case 'settings':
                    loadSettingsData();
                    break;
            }
        }

        // Initialize modals
        function initModals() {
            // Add User Modal
            $('#addUserModal').on('show.bs.modal', function() {
                // Load countries for select
                loadCountries('#country');
            });

            // Edit User Modal
            $('#editUserModal').on('show.bs.modal', function(event) {
                const button = $(event.relatedTarget);
                const userId = button.data('user-id');
                
                // Load user data
                loadUserData(userId);
                
                // Load countries for select
                loadCountries('#editCountry');
            });

            // View User Modal
            $('#viewUserModal').on('show.bs.modal', function(event) {
                const button = $(event.relatedTarget);
                const userId = button.data('user-id');
                
                // Load user details
                loadUserDetails(userId);
            });

            // KYC Documents Modal
            $('#kycDocumentsModal').on('show.bs.modal', function(event) {
                const button = $(event.relatedTarget);
                const userId = button.data('user-id');
                
                // Load KYC documents
                loadKYCDocuments(userId);
            });

            // Edit Plan Modal
            $('#editPlanModal').on('show.bs.modal', function(event) {
                const button = $(event.relatedTarget);
                const planId = button.data('plan-id');
                
                // Load plan data
                loadPlanData(planId);
            });

            // Process Withdrawal Modal
            $('#processWithdrawalModal').on('show.bs.modal', function(event) {
                const button = $(event.relatedTarget);
                const withdrawalId = button.data('withdrawal-id');
                
                // Load withdrawal data
                loadWithdrawalData(withdrawalId);
            });

            // View Transaction Modal
            $('#viewTransactionModal').on('show.bs.modal', function(event) {
                const button = $(event.relatedTarget);
                const transactionId = button.data('transaction-id');
                
                // Load transaction data
                loadTransactionData(transactionId);
            });

            // View Ticket Modal
            $('#viewTicketModal').on('show.bs.modal', function(event) {
                const button = $(event.relatedTarget);
                const ticketId = button.data('ticket-id');
                
                // Load ticket data
                loadTicketData(ticketId);
            });

            // Send Notification Modal
            $('#sendNotificationModal').on('show.bs.modal', function() {
                // Initialize Select2 for user selection
                $('#selectedUsers').select2({
                    theme: 'bootstrap-5',
                    placeholder: 'Select users',
                    allowClear: true,
                    ajax: {
                        url: `${API_BASE_URL}/users/search`,
                        type: 'GET',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        dataType: 'json',
                        delay: 250,
                        data: function(params) {
                            return {
                                query: params.term
                            };
                        },
                        processResults: function(data) {
                            return {
                                results: data.users.map(user => ({
                                    id: user.id,
                                    text: `${user.first_name} ${user.last_name} (${user.email})`
                                }))
                            };
                        },
                        cache: true
                    }
                });

                // Show/hide user selection based on recipients
                $('#notificationRecipients').change(function() {
                    if ($(this).val() === 'selected') {
                        $('#selectedUsersContainer').show();
                    } else {
                        $('#selectedUsersContainer').hide();
                    }
                });
            });
        }

        // Initialize form submissions
        function initForms() {
            // Add User Form
            $('#addUserForm').submit(function(e) {
                e.preventDefault();
                addUser();
            });

            // Edit User Form
            $('#editUserForm').submit(function(e) {
                e.preventDefault();
                updateUser();
            });

            // Add Plan Form
            $('#addPlanForm').submit(function(e) {
                e.preventDefault();
                addPlan();
            });

            // Edit Plan Form
            $('#editPlanForm').submit(function(e) {
                e.preventDefault();
                updatePlan();
            });

            // Process Withdrawal Form
            $('#processWithdrawalForm').submit(function(e) {
                e.preventDefault();
                processWithdrawal();
            });

            // Reply Ticket Form
            $('#replyTicketForm').submit(function(e) {
                e.preventDefault();
                replyTicket();
            });

            // Send Notification Form
            $('#sendNotificationForm').submit(function(e) {
                e.preventDefault();
                sendNotification();
            });

            // General Settings Form
            $('#generalSettingsForm').submit(function(e) {
                e.preventDefault();
                saveGeneralSettings();
            });

            // Security Settings Form
            $('#securitySettingsForm').submit(function(e) {
                e.preventDefault();
                saveSecuritySettings();
            });

            // Email Settings Form
            $('#emailSettingsForm').submit(function(e) {
                e.preventDefault();
                saveEmailSettings();
            });

            // Bank Settings Form
            $('#bankSettingsForm').submit(function(e) {
                e.preventDefault();
                saveBankSettings();
            });

            // PayPal Settings Form
            $('#paypalSettingsForm').submit(function(e) {
                e.preventDefault();
                savePayPalSettings();
            });

            // Stripe Settings Form
            $('#stripeSettingsForm').submit(function(e) {
                e.preventDefault();
                saveStripeSettings();
            });

            // CryptoSettings Form
            $('#cryptoSettingsForm').submit(function(e) {
                e.preventDefault();
                saveCryptoSettings();
            });

            // SEO Settings Form
            $('#seoSettingsForm').submit(function(e) {
                e.preventDefault();
                saveSEOSettings();
            });

            // Maintenance Settings Form
            $('#maintenanceSettingsForm').submit(function(e) {
                e.preventDefault();
                saveMaintenanceSettings();
            });

            // Logout buttons
            $('#logoutBtn, #logoutBtnMobile').click(function(e) {
                e.preventDefault();
                logoutAdmin();
            });

            // Refresh Dashboard
            $('#refreshDashboard').click(function() {
                loadDashboardData();
            });

            // Mark All Notifications as Read
            $('#markAllReadBtn').click(function() {
                markAllNotificationsAsRead();
            });

            // Send Test Email
            $('#sendTestEmailBtn').click(function() {
                sendTestEmail();
            });

            // Clear Cache
            $('#clearCacheBtn').click(function() {
                clearCache();
            });

            // Restart Queue Worker
            $('#restartQueueBtn').click(function() {
                restartQueueWorker();
            });

            // Enable IP Whitelist toggle
            $('#enableIpWhitelist').change(function() {
                if ($(this).is(':checked')) {
                    $('#ipWhitelistContainer').show();
                } else {
                    $('#ipWhitelistContainer').hide();
                }
            });

            // Enable Test Email toggle
            $('#testEmailEnabled').change(function() {
                if ($(this).is(':checked')) {
                    $('#testEmailContainer').show();
                } else {
                    $('#testEmailContainer').hide();
                }
            });

            // File upload preview
            $('#siteLogoUpload').change(function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        $('#logoPreview').attr('src', e.target.result);
                        $('#logoPreviewContainer').show();
                    }
                    reader.readAsDataURL(file);
                }
            });

            $('#faviconUpload').change(function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        $('#faviconPreview').attr('src', e.target.result);
                        $('#faviconPreviewContainer').show();
                    }
                    reader.readAsDataURL(file);
                }
            });
        }

        // Initialize data tables
        function initDataTables() {
            // Users Table
            usersTable = $('#usersTable').DataTable({
                responsive: true,
                serverSide: true,
                ajax: {
                    url: `${API_BASE_URL}/users`,
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    data: function(d) {
                        const filter = $('#usersFilter').val();
                        if (filter) {
                            d.status = filter;
                        }
                    }
                },
                columns: [
                    { data: 'id' },
                    { 
                        data: null,
                        render: function(data) {
                            return `${data.first_name} ${data.last_name}`;
                        }
                    },
                    { data: 'email' },
                    { 
                        data: 'balance',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-active';
                            if (data === 'suspended') {
                                badgeClass = 'status-suspended';
                            } else if (data === 'pending') {
                                badgeClass = 'status-pending';
                            }
                            return `<span class="status-badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    { 
                        data: 'kyc_status',
                        render: function(data) {
                            if (!data) return '-';
                            let badgeClass = 'status-pending';
                            if (data === 'approved') {
                                badgeClass = 'status-active';
                            } else if (data === 'rejected') {
                                badgeClass = 'status-suspended';
                            }
                            return `<span class="status-badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    { 
                        data: 'created_at',
                        render: function(data) {
                            return new Date(data).toLocaleDateString();
                        }
                    },
                    {
                        data: null,
                        orderable: false,
                        render: function(data) {
                            return `
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#viewUserModal" data-user-id="${data.id}">
                                                <i class="fas fa-eye me-2"></i> View
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editUserModal" data-user-id="${data.id}">
                                                <i class="fas fa-edit me-2"></i> Edit
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="suspendUser(${data.id}, '${data.status}')">
                                                <i class="fas fa-user-slash me-2"></i> ${data.status === 'suspended' ? 'Unsuspend' : 'Suspend'}
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="deleteUser(${data.id})">
                                                <i class="fas fa-trash me-2"></i> Delete
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="impersonateUser(${data.id})">
                                                <i class="fas fa-user-secret me-2"></i> Impersonate
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            `;
                        }
                    }
                ],
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                language: {
                    search: '',
                    searchPlaceholder: 'Search users...'
                }
            });

            // Transactions Table
            transactionsTable = $('#transactionsTable').DataTable({
                responsive: true,
                serverSide: true,
                ajax: {
                    url: `${API_BASE_URL}/transactions`,
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    data: function(d) {
                        const typeFilter = $('#transactionsTypeFilter').val();
                        const statusFilter = $('#transactionsStatusFilter').val();
                        
                        if (typeFilter) {
                            d.type = typeFilter;
                        }
                        
                        if (statusFilter) {
                            d.status = statusFilter;
                        }
                    }
                },
                columns: [
                    { data: 'id' },
                    { 
                        data: 'user',
                        render: function(data) {
                            return `${data.first_name} ${data.last_name}`;
                        }
                    },
                    { 
                        data: 'type',
                        render: function(data) {
                            return data.charAt(0).toUpperCase() + data.slice(1);
                        }
                    },
                    { 
                        data: 'amount',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'fee',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'method',
                        render: function(data) {
                            if (!data) return '-';
                            return data.charAt(0).toUpperCase() + data.slice(1);
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-active';
                            if (data === 'pending') {
                                badgeClass = 'status-pending';
                            } else if (data === 'failed' || data === 'reversed') {
                                badgeClass = 'status-suspended';
                            }
                            return `<span class="status-badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    { 
                        data: 'created_at',
                        render: function(data) {
                            return new Date(data).toLocaleString();
                        }
                    },
                    {
                        data: null,
                        orderable: false,
                        render: function(data) {
                            return `
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#viewTransactionModal" data-transaction-id="${data.id}">
                                                <i class="fas fa-eye me-2"></i> View
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="reverseTransaction(${data.id})">
                                                <i class="fas fa-undo me-2"></i> Reverse
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            `;
                        }
                    }
                ],
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                language: {
                    search: '',
                    searchPlaceholder: 'Search transactions...'
                }
            });

            // Investments Table
            investmentsTable = $('#investmentsTable').DataTable({
                responsive: true,
                serverSide: true,
                ajax: {
                    url: `${API_BASE_URL}/investments`,
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    data: function(d) {
                        const statusFilter = $('#investmentsStatusFilter').val();
                        const planFilter = $('#investmentsPlanFilter').val();
                        
                        if (statusFilter) {
                            d.status = statusFilter;
                        }
                        
                        if (planFilter) {
                            d.plan_id = planFilter;
                        }
                    }
                },
                columns: [
                    { data: 'id' },
                    { 
                        data: 'user',
                        render: function(data) {
                            return `${data.first_name} ${data.last_name}`;
                        }
                    },
                    { 
                        data: 'plan',
                        render: function(data) {
                            return data.name;
                        }
                    },
                    { 
                        data: 'amount',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'total_profit',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'start_date',
                        render: function(data) {
                            return new Date(data).toLocaleDateString();
                        }
                    },
                    { 
                        data: 'end_date',
                        render: function(data) {
                            return new Date(data).toLocaleDateString();
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-active';
                            if (data === 'completed') {
                                badgeClass = 'status-completed';
                            } else if (data === 'cancelled') {
                                badgeClass = 'status-suspended';
                            }
                            return `<span class="status-badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    {
                        data: null,
                        orderable: false,
                        render: function(data) {
                            return `
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="cancelInvestment(${data.id})">
                                                <i class="fas fa-times me-2"></i> Cancel
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="completeInvestment(${data.id})">
                                                <i class="fas fa-check me-2"></i> Complete
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            `;
                        }
                    }
                ],
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                language: {
                    search: '',
                    searchPlaceholder: 'Search investments...'
                }
            });

            // Withdrawals Table
            withdrawalsTable = $('#withdrawalsTable').DataTable({
                responsive: true,
                serverSide: true,
                ajax: {
                    url: `${API_BASE_URL}/withdrawals`,
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    data: function(d) {
                        const statusFilter = $('#withdrawalsStatusFilter').val();
                        const methodFilter = $('#withdrawalsMethodFilter').val();
                        
                        if (statusFilter) {
                            d.status = statusFilter;
                        }
                        
                        if (methodFilter) {
                            d.method = methodFilter;
                        }
                    }
                },
                columns: [
                    { data: 'id' },
                    { 
                        data: 'user',
                        render: function(data) {
                            return `${data.first_name} ${data.last_name}`;
                        }
                    },
                    { 
                        data: 'amount',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'fee',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'method',
                        render: function(data) {
                            if (!data) return '-';
                            return data.charAt(0).toUpperCase() + data.slice(1);
                        }
                    },
                    { 
                        data: 'details',
                        render: function(data) {
                            if (!data) return '-';
                            return data.length > 20 ? data.substring(0, 20) + '...' : data;
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-active';
                            if (data === 'pending') {
                                badgeClass = 'status-pending';
                            } else if (data === 'rejected') {
                                badgeClass = 'status-suspended';
                            } else if (data === 'processing') {
                                badgeClass = 'status-completed';
                            }
                            return `<span class="status-badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    { 
                        data: 'created_at',
                        render: function(data) {
                            return new Date(data).toLocaleString();
                        }
                    },
                    {
                        data: null,
                        orderable: false,
                        render: function(data) {
                            let actionBtn = '';
                            if (data.status === 'pending') {
                                actionBtn = `
                                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#processWithdrawalModal" data-withdrawal-id="${data.id}">
                                        <i class="fas fa-check me-2"></i> Process
                                    </a>
                                `;
                            }
                            
                            return `
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        ${actionBtn}
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="cancelWithdrawal(${data.id})">
                                                <i class="fas fa-times me-2"></i> Cancel
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            `;
                        }
                    }
                ],
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                language: {
                    search: '',
                    searchPlaceholder: 'Search withdrawals...'
                }
            });

            // Plans Table
            plansTable = $('#plansTable').DataTable({
                responsive: true,
                serverSide: true,
                ajax: {
                    url: `${API_BASE_URL}/investment/plans`,
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    }
                },
                columns: [
                    { data: 'id' },
                    { data: 'name' },
                    { 
                        data: 'min_amount',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'max_amount',
                        render: function(data) {
                            return data ? `$${parseFloat(data).toFixed(2)}` : 'Unlimited';
                        }
                    },
                    { 
                        data: 'duration',
                        render: function(data) {
                            return `${data} days`;
                        }
                    },
                    { 
                        data: 'daily_profit',
                        render: function(data) {
                            return `${data}%`;
                        }
                    },
                    { 
                        data: 'total_return',
                        render: function(data) {
                            return `${data}%`;
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-active';
                            if (data === 'inactive') {
                                badgeClass = 'status-suspended';
                            }
                            return `<span class="status-badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    {
                        data: null,
                        orderable: false,
                        render: function(data) {
                            return `
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editPlanModal" data-plan-id="${data.id}">
                                                <i class="fas fa-edit me-2"></i> Edit
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="togglePlanStatus(${data.id}, '${data.status}')">
                                                <i class="fas fa-power-off me-2"></i> ${data.status === 'active' ? 'Deactivate' : 'Activate'}
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="deletePlan(${data.id})">
                                                <i class="fas fa-trash me-2"></i> Delete
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            `;
                        }
                    }
                ],
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                language: {
                    search: '',
                    searchPlaceholder: 'Search plans...'
                }
            });

            // Support Table
            supportTable = $('#supportTable').DataTable({
                responsive: true,
                serverSide: true,
                ajax: {
                    url: `${API_BASE_URL}/support/tickets`,
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    data: function(d) {
                        const statusFilter = $('#supportStatusFilter').val();
                        const priorityFilter = $('#supportPriorityFilter').val();
                        
                        if (statusFilter) {
                            d.status = statusFilter;
                        }
                        
                        if (priorityFilter) {
                            d.priority = priorityFilter;
                        }
                    }
                },
                columns: [
                    { data: 'id' },
                    { data: 'subject' },
                    { 
                        data: 'user',
                        render: function(data) {
                            return `${data.first_name} ${data.last_name}`;
                        }
                    },
                    { 
                        data: 'priority',
                        render: function(data) {
                            let badgeClass = 'status-active';
                            if (data === 'low') {
                                badgeClass = 'status-completed';
                            } else if (data === 'high') {
                                badgeClass = 'status-suspended';
                            } else if (data === 'urgent') {
                                badgeClass = 'status-pending';
                            }
                            return `<span class="status-badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-active';
                            if (data === 'open') {
                                badgeClass = 'status-pending';
                            } else if (data === 'closed') {
                                badgeClass = 'status-completed';
                            }
                            return `<span class="status-badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    { 
                        data: 'last_reply',
                        render: function(data) {
                            if (!data) return '-';
                            return new Date(data).toLocaleString();
                        }
                    },
                    { 
                        data: 'created_at',
                        render: function(data) {
                            return new Date(data).toLocaleString();
                        }
                    },
                    {
                        data: null,
                        orderable: false,
                        render: function(data) {
                            return `
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#viewTicketModal" data-ticket-id="${data.id}">
                                                <i class="fas fa-eye me-2"></i> View
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="closeTicket(${data.id})">
                                                <i class="fas fa-times me-2"></i> Close
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            `;
                        }
                    }
                ],
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                language: {
                    search: '',
                    searchPlaceholder: 'Search tickets...'
                }
            });

            // Notifications Table
            notificationsTable = $('#notificationsTable').DataTable({
                responsive: true,
                serverSide: true,
                ajax: {
                    url: `${API_BASE_URL}/notifications`,
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    }
                },
                columns: [
                    { data: 'id' },
                    { data: 'title' },
                    { 
                        data: 'message',
                        render: function(data) {
                            return data.length > 50 ? data.substring(0, 50) + '...' : data;
                        }
                    },
                    { 
                        data: 'type',
                        render: function(data) {
                            let badgeClass = 'status-active';
                            if (data === 'info') {
                                badgeClass = 'status-completed';
                            } else if (data === 'warning') {
                                badgeClass = 'status-pending';
                            } else if (data === 'error') {
                                badgeClass = 'status-suspended';
                            }
                            return `<span class="status-badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    { 
                        data: 'recipients',
                        render: function(data) {
                            if (data === 'all') {
                                return 'All Users';
                            } else if (data === 'selected') {
                                return 'Selected Users';
                            } else {
                                return data.charAt(0).toUpperCase() + data.slice(1);
                            }
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-active';
                            if (data === 'sent') {
                                badgeClass = 'status-completed';
                            } else if (data === 'pending') {
                                badgeClass = 'status-pending';
                            }
                            return `<span class="status-badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    { 
                        data: 'created_at',
                        render: function(data) {
                            return new Date(data).toLocaleString();
                        }
                    },
                    {
                        data: null,
                        orderable: false,
                        render: function(data) {
                            return `
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="resendNotification(${data.id})">
                                                <i class="fas fa-paper-plane me-2"></i> Resend
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="deleteNotification(${data.id})">
                                                <i class="fas fa-trash me-2"></i> Delete
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            `;
                        }
                    }
                ],
                dom: '<"top"f>rt<"bottom"lip><"clear">',
                language: {
                    search: '',
                    searchPlaceholder: 'Search notifications...'
                }
            });

            // Recent Transactions Table
            $('#recentTransactionsTable').DataTable({
                responsive: true,
                ajax: {
                    url: `${API_BASE_URL}/transactions/recent`,
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    dataSrc: ''
                },
                columns: [
                    { 
                        data: 'user',
                        render: function(data) {
                            return `${data.first_name} ${data.last_name}`;
                        }
                    },
                    { 
                        data: 'amount',
                        render: function(data) {
                            return `$${parseFloat(data).toFixed(2)}`;
                        }
                    },
                    { 
                        data: 'type',
                        render: function(data) {
                            return data.charAt(0).toUpperCase() + data.slice(1);
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-active';
                            if (data === 'pending') {
                                badgeClass = 'status-pending';
                            } else if (data === 'failed' || data === 'reversed') {
                                badgeClass = 'status-suspended';
                            }
                            return `<span class="status-badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    { 
                        data: 'created_at',
                        render: function(data) {
                            return new Date(data).toLocaleString();
                        }
                    }
                ],
                order: [[4, 'desc']],
                pageLength: 5,
                lengthChange: false,
                searching: false,
                info: false,
                paging: false
            });

            // Recent Tickets Table
            $('#recentTicketsTable').DataTable({
                responsive: true,
                ajax: {
                    url: `${API_BASE_URL}/support/tickets/recent`,
                    type: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    dataSrc: ''
                },
                columns: [
                    { data: 'id' },
                    { data: 'subject' },
                    { 
                        data: 'user',
                        render: function(data) {
                            return `${data.first_name} ${data.last_name}`;
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let badgeClass = 'status-active';
                            if (data === 'open') {
                                badgeClass = 'status-pending';
                            } else if (data === 'closed') {
                                badgeClass = 'status-completed';
                            }
                            return `<span class="status-badge ${badgeClass}">${data.charAt(0).toUpperCase() + data.slice(1)}</span>`;
                        }
                    },
                    { 
                        data: 'created_at',
                        render: function(data) {
                            return new Date(data).toLocaleString();
                        }
                    }
                ],
                order: [[4, 'desc']],
                pageLength: 5,
                lengthChange: false,
                searching: false,
                info: false,
                paging: false
            });

            // Initialize table filters
            $('#usersFilter').change(function() {
                usersTable.ajax.reload();
            });

            $('#transactionsTypeFilter').change(function() {
                transactionsTable.ajax.reload();
            });

            $('#transactionsStatusFilter').change(function() {
                transactionsTable.ajax.reload();
            });

            $('#investmentsStatusFilter').change(function() {
                investmentsTable.ajax.reload();
            });

            $('#investmentsPlanFilter').change(function() {
                investmentsTable.ajax.reload();
            });

            $('#withdrawalsStatusFilter').change(function() {
                withdrawalsTable.ajax.reload();
            });

            $('#withdrawalsMethodFilter').change(function() {
                withdrawalsTable.ajax.reload();
            });

            $('#supportStatusFilter').change(function() {
                supportTable.ajax.reload();
            });

            $('#supportPriorityFilter').change(function() {
                supportTable.ajax.reload();
            });

            // Initialize export buttons
            $('#exportUsersBtn').click(function() {
                const filter = $('#usersFilter').val();
                let url = `${API_BASE_URL}/users/export`;
                
                if (filter) {
                    url += `?status=${filter}`;
                }
                
                window.open(url, '_blank');
            });

            $('#exportTransactionsBtn').click(function() {
                const typeFilter = $('#transactionsTypeFilter').val();
                const statusFilter = $('#transactionsStatusFilter').val();
                let params = [];
                
                if (typeFilter) {
                    params.push(`type=${typeFilter}`);
                }
                
                if (statusFilter) {
                    params.push(`status=${statusFilter}`);
                }
                
                const queryString = params.length ? `?${params.join('&')}` : '';
                window.open(`${API_BASE_URL}/transactions/export${queryString}`, '_blank');
            });

            $('#exportInvestmentsBtn').click(function() {
                const statusFilter = $('#investmentsStatusFilter').val();
                const planFilter = $('#investmentsPlanFilter').val();
                let params = [];
                
                if (statusFilter) {
                    params.push(`status=${statusFilter}`);
                }
                
                if (planFilter) {
                    params.push(`plan_id=${planFilter}`);
                }
                
                const queryString = params.length ? `?${params.join('&')}` : '';
                window.open(`${API_BASE_URL}/investments/export${queryString}`, '_blank');
            });

            $('#exportWithdrawalsBtn').click(function() {
                const statusFilter = $('#withdrawalsStatusFilter').val();
                const methodFilter = $('#withdrawalsMethodFilter').val();
                let params = [];
                
                if (statusFilter) {
                    params.push(`status=${statusFilter}`);
                }
                
                if (methodFilter) {
                    params.push(`method=${methodFilter}`);
                }
                
                const queryString = params.length ? `?${params.join('&')}` : '';
                window.open(`${API_BASE_URL}/withdrawals/export${queryString}`, '_blank');
            });

            $('#exportSupportBtn').click(function() {
                const statusFilter = $('#supportStatusFilter').val();
                const priorityFilter = $('#supportPriorityFilter').val();
                let params = [];
                
                if (statusFilter) {
                    params.push(`status=${statusFilter}`);
                }
                
                if (priorityFilter) {
                    params.push(`priority=${priorityFilter}`);
                }
                
                const queryString = params.length ? `?${params.join('&')}` : '';
                window.open(`${API_BASE_URL}/support/tickets/export${queryString}`, '_blank');
            });

            // Generate Report
            $('#generateReportBtn').click(function() {
                const reportType = $('#reportType').val();
                const reportFormat = $('#reportFormat').val();
                
                if (!reportType) {
                    toastr.error('Please select a report type');
                    return;
                }
                
                let url = `${API_BASE_URL}/reports/generate?type=${reportType}&format=${reportFormat}`;
                window.open(url, '_blank');
                
                // Show preview message
                $('#reportPreview').html(`
                    <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                    <h5>Report Generated Successfully</h5>
                    <p class="text-gray">Your ${reportType} report has been generated in ${reportFormat.toUpperCase()} format</p>
                `);
            });
        }

        // Initialize charts
        function initCharts() {
            // User Activity Chart
            const userActivityCtx = document.getElementById('userActivityChart').getContext('2d');
            userActivityChart = new Chart(userActivityCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'New Users',
                            data: [],
                            borderColor: 'rgba(0, 211, 149, 1)',
                            backgroundColor: 'rgba(0, 211, 149, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Active Users',
                            data: [],
                            borderColor: 'rgba(0, 123, 255, 1)',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });

            // User Distribution Chart
            const userDistributionCtx = document.getElementById('userDistributionChart').getContext('2d');
            userDistributionChart = new Chart(userDistributionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Active', 'Pending', 'Suspended'],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            'rgba(0, 211, 149, 0.8)',
                            'rgba(255, 184, 0, 0.8)',
                            'rgba(255, 61, 87, 0.8)'
                        ],
                        borderColor: [
                            'rgba(0, 211, 149, 1)',
                            'rgba(255, 184, 0, 1)',
                            'rgba(255, 61, 87, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
        }

        // Initialize chat
        function initChat() {
            // Toggle chat widget
            $('#chatToggle').click(function() {
                $('#chatWidget').toggle();
                if ($('#chatWidget').is(':visible')) {
                    loadChatMessages();
                }
            });

            $('#minimizeChat').click(function() {
                $('#chatWidget').hide();
            });

            // Chat form submission
            $('#chatForm').submit(function(e) {
                e.preventDefault();
                const message = $('#chatMessage').val().trim();
                
                if (message) {
                    sendChatMessage(message);
                    $('#chatMessage').val('');
                }
            });
        }

        // Load dashboard data
        function loadDashboardData() {
            showLoading();
            
            // Load dashboard stats
            $.ajax({
                url: `${API_BASE_URL}/dashboard`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#totalUsers').text(response.total_users.toLocaleString());
                    $('#activeInvestments').text(response.active_investments.toLocaleString());
                    $('#totalDeposits').text(`$${response.total_deposits.toLocaleString()}`);
                    $('#pendingWithdrawals').text(response.pending_withdrawals.toLocaleString());
                    
                    // Update change percentages
                    $('#usersChange').html(`
                        <i class="fas fa-arrow-${response.users_change >= 0 ? 'up' : 'down'} me-1"></i> 
                        ${Math.abs(response.users_change)}%
                    `).toggleClass('text-success', response.users_change >= 0).toggleClass('text-danger', response.users_change < 0);
                    
                    $('#investmentsChange').html(`
                        <i class="fas fa-arrow-${response.investments_change >= 0 ? 'up' : 'down'} me-1"></i> 
                        ${Math.abs(response.investments_change)}%
                    `).toggleClass('text-success', response.investments_change >= 0).toggleClass('text-danger', response.investments_change < 0);
                    
                    $('#depositsChange').html(`
                        <i class="fas fa-arrow-${response.deposits_change >= 0 ? 'up' : 'down'} me-1"></i> 
                        ${Math.abs(response.deposits_change)}%
                    `).toggleClass('text-success', response.deposits_change >= 0).toggleClass('text-danger', response.deposits_change < 0);
                    
                    $('#withdrawalsChange').html(`
                        <i class="fas fa-arrow-${response.withdrawals_change >= 0 ? 'up' : 'down'} me-1"></i> 
                        ${Math.abs(response.withdrawals_change)}%
                    `).toggleClass('text-success', response.withdrawals_change >= 0).toggleClass('text-danger', response.withdrawals_change < 0);
                    
                    // Update badges
                    $('#usersBadge').text(response.total_users.toLocaleString());
                    $('#transactionsBadge').text(response.total_transactions.toLocaleString());
                    $('#withdrawalsBadge').text(response.pending_withdrawals.toLocaleString());
                    $('#ticketsBadge').text(response.open_tickets.toLocaleString());
                    $('#notificationsBadge').text(response.unread_notifications.toLocaleString());
                    
                    // Update charts
                    updateCharts(response.chart_data);
                    
                    hideLoading();
                },
                error: function() {
                    toastr.error('Failed to load dashboard data');
                    hideLoading();
                }
            });
        }

        // Update charts with new data
        function updateCharts(chartData) {
            // User Activity Chart
            userActivityChart.data.labels = chartData.user_activity.labels;
            userActivityChart.data.datasets[0].data = chartData.user_activity.new_users;
            userActivityChart.data.datasets[1].data = chartData.user_activity.active_users;
            userActivityChart.update();
            
            // User Distribution Chart
            userDistributionChart.data.datasets[0].data = [
                chartData.user_distribution.active,
                chartData.user_distribution.pending,
                chartData.user_distribution.suspended
            ];
            userDistributionChart.update();
        }

        // Load users data
        function loadUsersData() {
            showLoading();
            
            // Users table is already initialized, just reload data
            usersTable.ajax.reload(function() {
                hideLoading();
            });
        }

        // Load transactions data
        function loadTransactionsData() {
            showLoading();
            
            // Transactions table is already initialized, just reload data
            transactionsTable.ajax.reload(function() {
                hideLoading();
            });
        }

        // Load investments data
        function loadInvestmentsData() {
            showLoading();
            
            // First load investment plans for filter
            $.ajax({
                url: `${API_BASE_URL}/investment/plans`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    const planFilter = $('#investmentsPlanFilter');
                    planFilter.empty();
                    planFilter.append('<option value="">All Plans</option>');
                    
                    response.data.forEach(plan => {
                        planFilter.append(`<option value="${plan.id}">${plan.name}</option>`);
                    });
                    
                    // Now reload investments table
                    investmentsTable.ajax.reload(function() {
                        hideLoading();
                    });
                },
                error: function() {
                    toastr.error('Failed to load investment plans');
                    hideLoading();
                }
            });
        }

        // Load withdrawals data
        function loadWithdrawalsData() {
            showLoading();
            
            // Withdrawals table is already initialized, just reload data
            withdrawalsTable.ajax.reload(function() {
                hideLoading();
            });
        }

        // Load plans data
        function loadPlansData() {
            showLoading();
            
            // Plans table is already initialized, just reload data
            plansTable.ajax.reload(function() {
                hideLoading();
            });
        }

        // Load support data
        function loadSupportData() {
            showLoading();
            
            // Support table is already initialized, just reload data
            supportTable.ajax.reload(function() {
                hideLoading();
            });
        }

        // Load notifications data
        function loadNotificationsData() {
            showLoading();
            
            // Notifications table is already initialized, just reload data
            notificationsTable.ajax.reload(function() {
                hideLoading();
            });
        }

        // Load reports data
        function loadReportsData() {
            showLoading();
            
            // For now just hide loading, actual report generation happens on button click
            hideLoading();
        }

        // Load settings data
        function loadSettingsData() {
            showLoading();
            
            // Load general settings
            $.ajax({
                url: `${API_BASE_URL}/settings/general`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#siteName').val(response.site_name);
                    $('#siteUrl').val(response.site_url);
                    $('#siteEmail').val(response.site_email);
                    $('#sitePhone').val(response.site_phone);
                    $('#siteCurrency').val(response.site_currency);
                    $('#timezone').val(response.timezone);
                    
                    if (response.site_logo) {
                        $('#logoPreview').attr('src', response.site_logo);
                        $('#logoPreviewContainer').show();
                    }
                    
                    if (response.site_favicon) {
                        $('#faviconPreview').attr('src', response.site_favicon);
                        $('#faviconPreviewContainer').show();
                    }
                    
                    // Load security settings
                    loadSecuritySettings();
                },
                error: function() {
                    toastr.error('Failed to load general settings');
                    hideLoading();
                }
            });
        }

        // Load security settings
        function loadSecuritySettings() {
            $.ajax({
                url: `${API_BASE_URL}/settings/security`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#enable2FA').prop('checked', response.enable_2fa);
                    $('#forceSSL').prop('checked', response.force_ssl);
                    $('#enableCaptcha').prop('checked', response.enable_captcha);
                    $('#enableLoginAlerts').prop('checked', response.enable_login_alerts);
                    $('#enableIpWhitelist').prop('checked', response.enable_ip_whitelist);
                    $('#ipWhitelist').val(response.ip_whitelist.join('\n'));
                    $('#sessionTimeout').val(response.session_timeout);
                    $('#failedLoginAttempts').val(response.failed_login_attempts);
                    
                    if (response.enable_ip_whitelist) {
                        $('#ipWhitelistContainer').show();
                    }
                    
                    // Load email settings
                    loadEmailSettings();
                },
                error: function() {
                    toastr.error('Failed to load security settings');
                    hideLoading();
                }
            });
        }

        // Load email settings
        function loadEmailSettings() {
            $.ajax({
                url: `${API_BASE_URL}/settings/email`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#mailDriver').val(response.mail_driver);
                    $('#mailHost').val(response.mail_host);
                    $('#mailPort').val(response.mail_port);
                    $('#mailUsername').val(response.mail_username);
                    $('#mailPassword').val(response.mail_password);
                    $('#mailEncryption').val(response.mail_encryption);
                    $('#mailFromAddress').val(response.mail_from_address);
                    $('#mailFromName').val(response.mail_from_name);
                    $('#testEmailEnabled').prop('checked', response.test_email_enabled);
                    $('#testEmailAddress').val(response.test_email_address);
                    
                    if (response.test_email_enabled) {
                        $('#testEmailContainer').show();
                    }
                    
                    // Load payment settings
                    loadPaymentSettings();
                },
                error: function() {
                    toastr.error('Failed to load email settings');
                    hideLoading();
                }
            });
        }

        // Load payment settings
        function loadPaymentSettings() {
            // Load bank settings
            $.ajax({
                url: `${API_BASE_URL}/settings/payment/bank`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#bankTransferEnabled').prop('checked', response.enabled);
                    $('#bankName').val(response.bank_name);
                    $('#accountName').val(response.account_name);
                    $('#accountNumber').val(response.account_number);
                    $('#iban').val(response.iban);
                    $('#swiftCode').val(response.swift_code);
                    $('#bankAddress').val(response.bank_address);
                    $('#bankInstructions').val(response.instructions);
                    
                    // Load PayPal settings
                    loadPayPalSettings();
                },
                error: function() {
                    toastr.error('Failed to load bank settings');
                    hideLoading();
                }
            });
        }

        // Load PayPal settings
        function loadPayPalSettings() {
            $.ajax({
                url: `${API_BASE_URL}/settings/payment/paypal`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#paypalEnabled').prop('checked', response.enabled);
                    $('#paypalEmail').val(response.email);
                    $('#paypalClientId').val(response.client_id);
                    $('#paypalSecret').val(response.secret);
                    $('#paypalMode').val(response.mode);
                    
                    // Load Stripe settings
                    loadStripeSettings();
                },
                error: function() {
                    toastr.error('Failed to load PayPal settings');
                    hideLoading();
                }
            });
        }

        // Load Stripe settings
        function loadStripeSettings() {
            $.ajax({
                url: `${API_BASE_URL}/settings/payment/stripe`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#stripeEnabled').prop('checked', response.enabled);
                    $('#stripePublishableKey').val(response.publishable_key);
                    $('#stripeSecretKey').val(response.secret_key);
                    $('#stripeWebhookSecret').val(response.webhook_secret);
                    
                    // Load crypto settings
                    loadCryptoSettings();
                },
                error: function() {
                    toastr.error('Failed to load Stripe settings');
                    hideLoading();
                }
            });
        }

        // Load crypto settings
        function loadCryptoSettings() {
            $.ajax({
                url: `${API_BASE_URL}/settings/payment/crypto`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#cryptoEnabled').prop('checked', response.enabled);
                    $('#btcAddress').val(response.btc_address);
                    $('#ethAddress').val(response.eth_address);
                    $('#ltcAddress').val(response.ltc_address);
                    $('#usdtAddress').val(response.usdt_address);
                    $('#cryptoConfirmations').val(response.confirmations);
                    
                    // Load SEO settings
                    loadSEOSettings();
                },
                error: function() {
                    toastr.error('Failed to load crypto settings');
                    hideLoading();
                }
            });
        }

        // Load SEO settings
        function loadSEOSettings() {
            $.ajax({
                url: `${API_BASE_URL}/settings/seo`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#metaTitle').val(response.meta_title);
                    $('#metaDescription').val(response.meta_description);
                    $('#metaKeywords').val(response.meta_keywords);
                    $('#googleAnalytics').val(response.google_analytics);
                    $('#facebookPixel').val(response.facebook_pixel);
                    $('#sitemapUrl').val(response.sitemap_url);
                    $('#enableSitemap').prop('checked', response.enable_sitemap);
                    $('#enableRobots').prop('checked', response.enable_robots);
                    
                    // Load maintenance settings
                    loadMaintenanceSettings();
                },
                error: function() {
                    toastr.error('Failed to load SEO settings');
                    hideLoading();
                }
            });
        }

        // Load maintenance settings
        function loadMaintenanceSettings() {
            $.ajax({
                url: `${API_BASE_URL}/settings/maintenance`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#maintenanceMode').prop('checked', response.maintenance_mode);
                    $('#maintenanceMessage').val(response.maintenance_message);
                    $('#maintenanceAllowedIps').val(response.allowed_ips.join('\n'));
                    
                    // Load system info
                    loadSystemInfo();
                },
                error: function() {
                    toastr.error('Failed to load maintenance settings');
                    hideLoading();
                }
            });
        }

        // Load system info
        function loadSystemInfo() {
            $.ajax({
                url: `${API_BASE_URL}/system/info`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#phpVersion').text(response.php_version);
                    $('#laravelVersion').text(response.laravel_version);
                    $('#serverSoftware').text(response.server_software);
                    $('#databaseVersion').text(response.database_version);
                    $('#lastCronRun').text(response.last_cron_run ? new Date(response.last_cron_run).toLocaleString() : 'Never');
                    $('#queueWorkerStatus').html(`
                        ${response.queue_worker_status ? 
                            '<span class="text-success">Running</span>' : 
                            '<span class="text-danger">Stopped</span>'}
                        (PID: ${response.queue_worker_pid || 'N/A'})
                    `);
                    
                    hideLoading();
                },
                error: function() {
                    toastr.error('Failed to load system information');
                    hideLoading();
                }
            });
        }

        // Load countries for select
        function loadCountries(selector) {
            $.ajax({
                url: 'https://restcountries.com/v3.1/all',
                type: 'GET',
                success: function(response) {
                    const select = $(selector);
                    select.empty();
                    select.append('<option value="">Select Country</option>');
                    
                    // Sort countries by name
                    response.sort((a, b) => {
                        if (a.name.common < b.name.common) return -1;
                        if (a.name.common > b.name.common) return 1;
                        return 0;
                    });
                    
                    response.forEach(country => {
                        select.append(`<option value="${country.name.common}">${country.name.common}</option>`);
                    });
                },
                error: function() {
                    toastr.error('Failed to load countries');
                }
            });
        }

        // Load user data for edit
        function loadUserData(userId) {
            showLoading();
            
            $.ajax({
                url: `${API_BASE_URL}/users/${userId}`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#editUserId').val(response.id);
                    $('#editFirstName').val(response.first_name);
                    $('#editLastName').val(response.last_name);
                    $('#editEmail').val(response.email);
                    $('#editPhone').val(response.phone);
                    $('#editCountry').val(response.country).trigger('change');
                    $('#editAddress').val(response.address);
                    $('#editCity').val(response.city);
                    $('#editState').val(response.state);
                    $('#editZip').val(response.zip);
                    $('#editBalance').val(response.balance);
                    $('#editStatus').val(response.status);
                    $('#editKycStatus').val(response.kyc_status || 'not_submitted');
                    $('#editEmailVerified').prop('checked', response.email_verified);
                    $('#editPhoneVerified').prop('checked', response.phone_verified);
                    $('#editNotes').val(response.admin_notes || '');
                    
                    hideLoading();
                },
                error: function() {
                    toastr.error('Failed to load user data');
                    $('#editUserModal').modal('hide');
                    hideLoading();
                }
            });
        }

        // Load user details for view
        function loadUserDetails(userId) {
            showLoading();
            
            $.ajax({
                url: `${API_BASE_URL}/users/${userId}`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    // Basic info
                    $('#userFullName').text(`${response.first_name} ${response.last_name}`);
                    $('#userEmail').text(response.email);
                    $('#userJoinDate').text(`Joined: ${new Date(response.created_at).toLocaleDateString()}`);
                    
                    // Status badge
                    const statusBadge = $('#userStatusBadge');
                    statusBadge.text(response.status.charAt(0).toUpperCase() + response.status.slice(1));
                    statusBadge.removeClass('bg-primary bg-warning bg-danger');
                    
                    if (response.status === 'active') {
                        statusBadge.addClass('bg-primary');
                    } else if (response.status === 'pending') {
                        statusBadge.addClass('bg-warning');
                    } else {
                        statusBadge.addClass('bg-danger');
                    }
                    
                    // Financial info
                    $('#userBalance').text(`$${parseFloat(response.balance).toFixed(2)}`);
                    $('#userInvested').text(`$${parseFloat(response.total_invested).toFixed(2)}`);
                    $('#userEarnings').text(`$${parseFloat(response.total_earnings).toFixed(2)}`);
                    
                    // Personal info
                    $('#viewFirstName').text(response.first_name);
                    $('#viewLastName').text(response.last_name);
                    $('#viewEmail').text(response.email);
                    $('#viewPhone').text(response.phone || '-');
                    $('#viewCountry').text(response.country || '-');
                    $('#viewDob').text(response.date_of_birth || '-');
                    $('#viewAddress').text(response.address || '-');
                    $('#viewCity').text(response.city || '-');
                    $('#viewState').text(response.state || '-');
                    $('#viewZip').text(response.zip || '-');
                    
                    // Account info
                    $('#viewAccountStatus').text(response.status.charAt(0).toUpperCase() + response.status.slice(1));
                    $('#viewLastLogin').text(response.last_login ? new Date(response.last_login).toLocaleString() : '-');
                    $('#viewEmailVerified').text(response.email_verified ? 'Yes' : 'No');
                    $('#viewPhoneVerified').text(response.phone_verified ? 'Yes' : 'No');
                    $('#view2faEnabled').text(response.two_factor_enabled ? 'Yes' : 'No');
                    $('#viewIpAddress').text(response.ip_address || '-');
                    $('#viewReferralCode').text(response.referral_code || '-');
                    $('#viewReferredBy').text(response.referred_by ? response.referred_by.email : '-');
                    
                    // KYC info
                    $('#kycStatus').text(response.kyc_status ? response.kyc_status.charAt(0).toUpperCase() + response.kyc_status.slice(1) : 'Not Submitted');
                    $('#kycIdType').text(response.kyc_id_type || '-');
                    $('#kycIdNumber').text(response.kyc_id_number || '-');
                    $('#kycSubmittedDate').text(response.kyc_submitted_at ? new Date(response.kyc_submitted_at).toLocaleString() : '-');
                    
                    // Set edit button data
                    $('#editUserBtn').attr('data-user-id', response.id);
                    
                    // Load user activity
                    loadUserActivity(response.id);
                    
                    hideLoading();
                },
                error: function() {
                    toastr.error('Failed to load user details');
                    $('#viewUserModal').modal('hide');
                    hideLoading();
                }
            });
        }

        // Load user activity
        function loadUserActivity(userId) {
            $.ajax({
                url: `${API_BASE_URL}/users/${userId}/activity`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    const activityFeed = $('#userActivityFeed');
                    activityFeed.empty();
                    
                    if (response.length === 0) {
                        activityFeed.append(`
                            <div class="text-center py-3 text-gray">
                                No activity found
                            </div>
                        `);
                        return;
                    }
                    
                    response.forEach(activity => {
                        activityFeed.append(`
                            <div class="activity-item">
                                <div class="activity-dot"></div>
                                <div class="activity-content">
                                    <p class="mb-1">${activity.description}</p>
                                    <p class="text-gray small mb-0 activity-date">
                                        ${new Date(activity.created_at).toLocaleString()}
                                    </p>
                                </div>
                            </div>
                        `);
                    });
                },
                error: function() {
                    toastr.error('Failed to load user activity');
                }
            });
        }

        // Load KYC documents
        function loadKYCDocuments(userId) {
            showLoading();
            
            $.ajax({
                url: `${API_BASE_URL}/users/${userId}/kyc`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    if (response.id_front) {
                        $('#kycIdFront').attr('src', response.id_front);
                    } else {
                        $('#kycIdFront').attr('src', 'https://via.placeholder.com/400x250?text=No+ID+Front');
                    }
                    
                    if (response.id_back) {
                        $('#kycIdBack').attr('src', response.id_back);
                    } else {
                        $('#kycIdBack').attr('src', 'https://via.placeholder.com/400x250?text=No+ID+Back');
                    }
                    
                    if (response.proof_of_address) {
                        $('#kycProofOfAddress').attr('src', response.proof_of_address);
                    } else {
                        $('#kycProofOfAddress').attr('src', 'https://via.placeholder.com/400x250?text=No+Proof+of+Address');
                    }
                    
                    if (response.selfie) {
                        $('#kycSelfie').attr('src', response.selfie);
                    } else {
                        $('#kycSelfie').attr('src', 'https://via.placeholder.com/400x250?text=No+Selfie');
                    }
                    
                    // Set approve/reject buttons
                    $('#approveKycBtn').attr('onclick', `approveKYC(${userId})`);
                    $('#rejectKycBtn').attr('onclick', `rejectKYC(${userId})`);
                    
                    hideLoading();
                },
                error: function() {
                    toastr.error('Failed to load KYC documents');
                    $('#kycDocumentsModal').modal('hide');
                    hideLoading();
                }
            });
        }

        // Load plan data for edit
        function loadPlanData(planId) {
            showLoading();
            
            $.ajax({
                url: `${API_BASE_URL}/investment/plans/${planId}`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#editPlanId').val(response.id);
                    $('#editPlanName').val(response.name);
                    $('#editMinAmount').val(response.min_amount);
                    $('#editMaxAmount').val(response.max_amount || '');
                    $('#editDuration').val(response.duration);
                    $('#editProfitReturn').val(response.daily_profit);
                    $('#editTotalReturn').val(response.total_return);
                    $('#editPlanDescription').val(response.description);
                    $('#editPlanStatus').prop('checked', response.status === 'active');
                    
                    hideLoading();
                },
                error: function() {
                    toastr.error('Failed to load plan data');
                    $('#editPlanModal').modal('hide');
                    hideLoading();
                }
            });
        }

        // Load withdrawal data for processing
        function loadWithdrawalData(withdrawalId) {
            showLoading();
            
            $.ajax({
                url: `${API_BASE_URL}/withdrawals/${withdrawalId}`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#withdrawalId').val(response.id);
                    $('#withdrawalUser').text(`${response.user.first_name} ${response.user.last_name}`);
                    $('#withdrawalAmount').text(`$${parseFloat(response.amount).toFixed(2)}`);
                    $('#withdrawalFee').text(`$${parseFloat(response.fee).toFixed(2)}`);
                    $('#withdrawalMethod').text(response.method.charAt(0).toUpperCase() + response.method.slice(1));
                    $('#withdrawalDetails').text(response.details);
                    
                    hideLoading();
                },
                error: function() {
                    toastr.error('Failed to load withdrawal data');
                    $('#processWithdrawalModal').modal('hide');
                    hideLoading();
                }
            });
        }

        // Load transaction data for view
        function loadTransactionData(transactionId) {
            showLoading();
            
            $.ajax({
                url: `${API_BASE_URL}/transactions/${transactionId}`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#transactionId').text(response.id);
                    $('#transactionUser').text(`${response.user.first_name} ${response.user.last_name}`);
                    $('#transactionType').text(response.type.charAt(0).toUpperCase() + response.type.slice(1));
                    $('#transactionAmount').text(`$${parseFloat(response.amount).toFixed(2)}`);
                    $('#transactionFee').text(`$${parseFloat(response.fee).toFixed(2)}`);
                    $('#transactionNetAmount').text(`$${parseFloat(response.net_amount).toFixed(2)}`);
                    $('#transactionMethod').text(response.method ? response.method.charAt(0).toUpperCase() + response.method.slice(1) : '-');
                    
                    // Status
                    const status = $('#transactionStatus');
                    status.text(response.status.charAt(0).toUpperCase() + response.status.slice(1));
                    status.removeClass('text-success text-warning text-danger');
                    
                    if (response.status === 'completed') {
                        status.addClass('text-success');
                    } else if (response.status === 'pending') {
                        status.addClass('text-warning');
                    } else {
                        status.addClass('text-danger');
                    }
                    
                    $('#transactionDate').text(new Date(response.created_at).toLocaleString());
                    $('#transactionDetails').text(response.details || '-');
                    
                    hideLoading();
                },
                error: function() {
                    toastr.error('Failed to load transaction data');
                    $('#viewTransactionModal').modal('hide');
                    hideLoading();
                }
            });
        }

        // Load ticket data for view
        function loadTicketData(ticketId) {
            showLoading();
            
            $.ajax({
                url: `${API_BASE_URL}/support/tickets/${ticketId}`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    $('#ticketId').text(response.id);
                    $('#ticketSubject').text(response.subject);
                    
                    // Status badge
                    const statusBadge = $('#ticketStatusBadge');
                    statusBadge.text(response.status.charAt(0).toUpperCase() + response.status.slice(1));
                    statusBadge.removeClass('bg-primary bg-success bg-danger');
                    
                    if (response.status === 'open') {
                        statusBadge.addClass('bg-primary');
                    } else if (response.status === 'pending') {
                        statusBadge.addClass('bg-warning');
                    } else {
                        statusBadge.addClass('bg-success');
                    }
                    
                    $('#ticketUser').text(`${response.user.first_name} ${response.user.last_name}`);
                    
                    // Priority
                    const priority = $('#ticketPriority');
                    priority.text(response.priority.charAt(0).toUpperCase() + response.priority.slice(1));
                    priority.removeClass('text-success text-warning text-danger');
                    
                    if (response.priority === 'low') {
                        priority.addClass('text-success');
                    } else if (response.priority === 'medium') {
                        priority.addClass('text-warning');
                    } else {
                        priority.addClass('text-danger');
                    }
                    
                    $('#ticketDate').text(new Date(response.created_at).toLocaleString());
                    $('#ticketMessage').text(response.message);
                    
                    // Attachments
                    const attachments = $('#ticketAttachments');
                    attachments.empty();
                    
                    if (response.attachments.length === 0) {
                        attachments.append(`
                            <div class="text-center text-gray py-2">
                                No attachments
                            </div>
                        `);
                    } else {
                        response.attachments.forEach(attachment => {
                            const fileType = attachment.split('.').pop().toLowerCase();
                            let icon = 'fa-file';
                            
                            if (['jpg', 'jpeg', 'png', 'gif'].includes(fileType)) {
                                icon = 'fa-file-image';
                            } else if (['pdf'].includes(fileType)) {
                                icon = 'fa-file-pdf';
                            } else if (['doc', 'docx'].includes(fileType)) {
                                icon = 'fa-file-word';
                            } else if (['xls', 'xlsx'].includes(fileType)) {
                                icon = 'fa-file-excel';
                            }
                            
                            attachments.append(`
                                <div class="d-flex align-items-center mb-2">
                                    <i class="fas ${icon} me-2"></i>
                                    <a href="${attachment}" target="_blank" class="text-decoration-none">
                                        ${attachment.split('/').pop()}
                                    </a>
                                </div>
                            `);
                        });
                    }
                    
                    // Conversation
                    const conversation = $('#ticketConversation');
                    conversation.empty();
                    
                    if (response.replies.length === 0) {
                        conversation.append(`
                            <div class="text-center text-gray py-2">
                                No replies yet
                            </div>
                        `);
                    } else {
                        response.replies.forEach(reply => {
                            const isAdmin = reply.user.role === 'admin';
                            
                            conversation.append(`
                                <div class="message ${isAdmin ? 'message-admin' : 'message-user'} mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <strong>${isAdmin ? 'Admin' : `${reply.user.first_name} ${reply.user.last_name}`}</strong>
                                        <small class="message-time">${new Date(reply.created_at).toLocaleString()}</small>
                                    </div>
                                    <p class="mb-0">${reply.message}</p>
                                </div>
                            `);
                        });
                    }
                    
                    // Set reply form
                    $('#replyTicketId').val(response.id);
                    
                    hideLoading();
                },
                error: function() {
                    toastr.error('Failed to load ticket data');
                    $('#viewTicketModal').modal('hide');
                    hideLoading();
                }
            });
        }

        // Load notifications
        function loadNotifications() {
            $.ajax({
                url: `${API_BASE_URL}/notifications/recent`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    const notificationList = $('#notificationList');
                    notificationList.empty();
                    
                    if (response.length === 0) {
                        notificationList.append(`
                            <div class="text-center py-3 text-gray">
                                No notifications
                            </div>
                        `);
                        return;
                    }
                    
                    response.forEach(notification => {
                        let icon = 'fa-info-circle';
                        let iconColor = 'text-primary';
                        
                        if (notification.type === 'success') {
                            icon = 'fa-check-circle';
                            iconColor = 'text-success';
                        } else if (notification.type === 'warning') {
                            icon = 'fa-exclamation-circle';
                            iconColor = 'text-warning';
                        } else if (notification.type === 'error') {
                            icon = 'fa-times-circle';
                            iconColor = 'text-danger';
                        }
                        
                        notificationList.append(`
                            <li class="dropdown-item">
                                <div class="d-flex align-items-start">
                                    <i class="fas ${icon} ${iconColor} me-2 mt-1"></i>
                                    <div>
                                        <div class="small">${notification.title}</div>
                                        <div class="text-gray small">${notification.message}</div>
                                        <div class="text-gray small">${new Date(notification.created_at).toLocaleString()}</div>
                                    </div>
                                </div>
                            </li>
                            <li class="dropdown-divider m-0"></li>
                        `);
                    });
                    
                    // Update notification count
                    $('#notificationCount').text(response.unread_count);
                },
                error: function() {
                    toastr.error('Failed to load notifications');
                }
            });
        }

        // Load admin profile
        function loadAdminProfile() {
            $.ajax({
                url: `${API_BASE_URL}/auth/me`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    adminData = response;
                    
                    $('#adminName').text(`${response.first_name} ${response.last_name}`);
                    $('#adminNameShort').text(`${response.first_name} ${response.last_name}`);
                    $('#adminRole').text(response.role.charAt(0).toUpperCase() + response.role.slice(1));
                },
                error: function() {
                    toastr.error('Failed to load admin profile');
                }
            });
        }

        // Load chat messages
        function loadChatMessages() {
            const chatBody = $('#chatBody');
            chatBody.empty();
            chatBody.append(`
                <div class="text-center py-5">
                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            `);
            
            $.ajax({
                url: `${API_BASE_URL}/chat`,
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    chatBody.empty();
                    
                    if (response.length === 0) {
                        chatBody.append(`
                            <div class="text-center py-5 text-gray">
                                No messages yet
                            </div>
                        `);
                        return;
                    }
                    
                    response.forEach(message => {
                        const isAdmin = message.user.role === 'admin';
                        
                        chatBody.append(`
                            <div class="message ${isAdmin ? 'message-admin' : 'message-user'} mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <strong>${isAdmin ? 'You' : `${message.user.first_name} ${message.user.last_name}`}</strong>
                                    <small class="message-time">${new Date(message.created_at).toLocaleString()}</small>
                                </div>
                                <p class="mb-0">${message.message}</p>
                            </div>
                        `);
                    });
                    
                    // Scroll to bottom
                    chatBody.scrollTop(chatBody[0].scrollHeight);
                },
                error: function() {
                    chatBody.empty();
                    chatBody.append(`
                        <div class="text-center py-5 text-danger">
                            Failed to load messages
                        </div>
                    `);
                }
            });
        }

        // Add new user
        function addUser() {
            showLoading();
            
            const formData = new FormData($('#addUserForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/users`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('User added successfully');
                    $('#addUserModal').modal('hide');
                    $('#addUserForm')[0].reset();
                    usersTable.ajax.reload();
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to add user';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Update user
        function updateUser() {
            showLoading();
            
            const userId = $('#editUserId').val();
            const formData = new FormData($('#editUserForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/users/${userId}`,
                type: 'PUT',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('User updated successfully');
                    $('#editUserModal').modal('hide');
                    usersTable.ajax.reload();
                    
                    // If we're viewing this user, reload their details
                    if ($('#viewUserModal').is(':visible')) {
                        loadUserDetails(userId);
                    }
                    
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to update user';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Suspend/unsuspend user
        function suspendUser(userId, currentStatus) {
            const action = currentStatus === 'suspended' ? 'unsuspend' : 'suspend';
            
            Swal.fire({
                title: `${action.charAt(0).toUpperCase() + action.slice(1)} User?`,
                text: `Are you sure you want to ${action} this user?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: `Yes, ${action}`,
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/users/${userId}/${action}`,
                        type: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success(`User ${action}ed successfully`);
                            usersTable.ajax.reload();
                            
                            // If we're viewing this user, reload their details
                            if ($('#viewUserModal').is(':visible')) {
                                loadUserDetails(userId);
                            }
                            
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : `Failed to ${action} user`;
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Delete user
        function deleteUser(userId) {
            Swal.fire({
                title: 'Delete User?',
                text: 'Are you sure you want to delete this user? This action cannot be undone.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, delete',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#dc3545'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/users/${userId}`,
                        type: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success('User deleted successfully');
                            usersTable.ajax.reload();
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to delete user';
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Impersonate user
        function impersonateUser(userId) {
            Swal.fire({
                title: 'Impersonate User?',
                text: 'You will be logged in as this user. Are you sure?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, impersonate',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/users/${userId}/impersonate`,
                        type: 'POST',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            // Store the admin token to return later
                            localStorage.setItem('originalAdminToken', localStorage.getItem('adminToken'));
                            
                            // Set the user token and redirect to dashboard
                            localStorage.setItem('token', response.token);
                            window.location.href = 'dashboard.html';
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to impersonate user';
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Approve KYC
        function approveKYC(userId) {
            Swal.fire({
                title: 'Approve KYC?',
                text: 'Are you sure you want to approve this user\'s KYC submission?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes, approve',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/users/${userId}/kyc/approve`,
                        type: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success('KYC approved successfully');
                            $('#kycDocumentsModal').modal('hide');
                            usersTable.ajax.reload();
                            
                            // If we're viewing this user, reload their details
                            if ($('#viewUserModal').is(':visible')) {
                                loadUserDetails(userId);
                            }
                            
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to approve KYC';
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Reject KYC
        function rejectKYC(userId) {
            Swal.fire({
                title: 'Reject KYC?',
                text: 'Are you sure you want to reject this user\'s KYC submission?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes, reject',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/users/${userId}/kyc/reject`,
                        type: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success('KYC rejected successfully');
                            $('#kycDocumentsModal').modal('hide');
                            usersTable.ajax.reload();
                            
                            // If we're viewing this user, reload their details
                            if ($('#viewUserModal').is(':visible')) {
                                loadUserDetails(userId);
                            }
                            
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to reject KYC';
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Reverse transaction
        function reverseTransaction(transactionId) {
            Swal.fire({
                title: 'Reverse Transaction?',
                text: 'Are you sure you want to reverse this transaction? This action cannot be undone.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, reverse',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#dc3545'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/transactions/${transactionId}/reverse`,
                        type: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success('Transaction reversed successfully');
                            transactionsTable.ajax.reload();
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to reverse transaction';
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Cancel investment
        function cancelInvestment(investmentId) {
            Swal.fire({
                title: 'Cancel Investment?',
                text: 'Are you sure you want to cancel this investment? The invested amount will be returned to the user.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, cancel',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#dc3545'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/investments/${investmentId}/cancel`,
                        type: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success('Investment cancelled successfully');
                            investmentsTable.ajax.reload();
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to cancel investment';
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Complete investment
        function completeInvestment(investmentId) {
            Swal.fire({
                title: 'Complete Investment?',
                text: 'Are you sure you want to mark this investment as completed? The user will receive their final payout.',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes, complete',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/investments/${investmentId}/complete`,
                        type: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success('Investment completed successfully');
                            investmentsTable.ajax.reload();
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to complete investment';
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Process withdrawal
        function processWithdrawal() {
            showLoading();
            
            const withdrawalId = $('#withdrawalId').val();
            const action = $('#withdrawalAction').val();
            const notes = $('#withdrawalNotes').val();
            
            $.ajax({
                url: `${API_BASE_URL}/withdrawals/${withdrawalId}/${action}`,
                type: 'PUT',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: {
                    notes: notes
                },
                success: function(response) {
                    toastr.success(`Withdrawal ${action}d successfully`);
                    $('#processWithdrawalModal').modal('hide');
                    withdrawalsTable.ajax.reload();
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : `Failed to ${action} withdrawal`;
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Cancel withdrawal
        function cancelWithdrawal(withdrawalId) {
            Swal.fire({
                title: 'Cancel Withdrawal?',
                text: 'Are you sure you want to cancel this withdrawal? The amount will be returned to the user\'s balance.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, cancel',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#dc3545'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/withdrawals/${withdrawalId}/cancel`,
                        type: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success('Withdrawal cancelled successfully');
                            withdrawalsTable.ajax.reload();
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to cancel withdrawal';
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Add new plan
        function addPlan() {
            showLoading();
            
            const formData = new FormData($('#addPlanForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/investment/plans`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('Plan added successfully');
                    $('#addPlanModal').modal('hide');
                    $('#addPlanForm')[0].reset();
                    plansTable.ajax.reload();
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to add plan';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Update plan
        function updatePlan() {
            showLoading();
            
            const planId = $('#editPlanId').val();
            const formData = new FormData($('#editPlanForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/investment/plans/${planId}`,
                type: 'PUT',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('Plan updated successfully');
                    $('#editPlanModal').modal('hide');
                    plansTable.ajax.reload();
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to update plan';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Toggle plan status
        function togglePlanStatus(planId, currentStatus) {
            const action = currentStatus === 'active' ? 'deactivate' : 'activate';
            
            Swal.fire({
                title: `${action.charAt(0).toUpperCase() + action.slice(1)} Plan?`,
                text: `Are you sure you want to ${action} this plan?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: `Yes, ${action}`,
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/investment/plans/${planId}/${action}`,
                        type: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success(`Plan ${action}d successfully`);
                            plansTable.ajax.reload();
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : `Failed to ${action} plan`;
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Delete plan
        function deletePlan(planId) {
            Swal.fire({
                title: 'Delete Plan?',
                text: 'Are you sure you want to delete this plan? This action cannot be undone.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, delete',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#dc3545'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/investment/plans/${planId}`,
                        type: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success('Plan deleted successfully');
                            plansTable.ajax.reload();
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to delete plan';
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Close ticket
        function closeTicket(ticketId) {
            Swal.fire({
                title: 'Close Ticket?',
                text: 'Are you sure you want to close this support ticket?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes, close',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/support/tickets/${ticketId}/close`,
                        type: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success('Ticket closed successfully');
                            supportTable.ajax.reload();
                            
                            // If we're viewing this ticket, reload it
                            if ($('#viewTicketModal').is(':visible')) {
                                loadTicketData(ticketId);
                            }
                            
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to close ticket';
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Reply to ticket
        function replyTicket() {
            showLoading();
            
            const formData = new FormData($('#replyTicketForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/support/tickets/reply`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('Reply sent successfully');
                    $('#replyMessage').val('');
                    $('#replyAttachments').val('');
                    supportTable.ajax.reload();
                    loadTicketData(response.ticket_id);
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to send reply';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Send notification
        function sendNotification() {
            showLoading();
            
            const formData = new FormData($('#sendNotificationForm')[0]);
            
            // Add selected users if recipients is 'selected'
            if ($('#notificationRecipients').val() === 'selected') {
                const selectedUsers = $('#selectedUsers').val();
                if (selectedUsers && selectedUsers.length > 0) {
                    selectedUsers.forEach(userId => {
                        formData.append('selected_users[]', userId);
                    });
                }
            }
            
            $.ajax({
                url: `${API_BASE_URL}/notifications`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('Notification sent successfully');
                    $('#sendNotificationModal').modal('hide');
                    $('#sendNotificationForm')[0].reset();
                    notificationsTable.ajax.reload();
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to send notification';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Resend notification
        function resendNotification(notificationId) {
            Swal.fire({
                title: 'Resend Notification?',
                text: 'Are you sure you want to resend this notification?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes, resend',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/notifications/${notificationId}/resend`,
                        type: 'POST',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success('Notification resent successfully');
                            notificationsTable.ajax.reload();
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to resend notification';
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Delete notification
        function deleteNotification(notificationId) {
            Swal.fire({
                title: 'Delete Notification?',
                text: 'Are you sure you want to delete this notification? This action cannot be undone.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, delete',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#dc3545'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/notifications/${notificationId}`,
                        type: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function(response) {
                            toastr.success('Notification deleted successfully');
                            notificationsTable.ajax.reload();
                            hideLoading();
                        },
                        error: function(xhr) {
                            const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to delete notification';
                            toastr.error(error);
                            hideLoading();
                        }
                    });
                }
            });
        }

        // Mark all notifications as read
        function markAllNotificationsAsRead() {
            showLoading();
            
            $.ajax({
                url: `${API_BASE_URL}/notifications/mark-all-read`,
                type: 'PUT',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    toastr.success('All notifications marked as read');
                    loadNotifications();
                    notificationsTable.ajax.reload();
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to mark notifications as read';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Save general settings
        function saveGeneralSettings() {
            showLoading();
            
            const formData = new FormData($('#generalSettingsForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/settings/general`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('General settings saved successfully');
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to save general settings';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Save security settings
        function saveSecuritySettings() {
            showLoading();
            
            const formData = new FormData($('#securitySettingsForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/settings/security`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('Security settings saved successfully');
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to save security settings';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Save email settings
        function saveEmailSettings() {
            showLoading();
            
            const formData = new FormData($('#emailSettingsForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/settings/email`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('Email settings saved successfully');
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to save email settings';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Save bank settings
        function saveBankSettings() {
            showLoading();
            
            const formData = new FormData($('#bankSettingsForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/settings/payment/bank`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('Bank settings saved successfully');
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to save bank settings';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Save PayPal settings
        function savePayPalSettings() {
            showLoading();
            
            const formData = new FormData($('#paypalSettingsForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/settings/payment/paypal`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('PayPal settings saved successfully');
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to save PayPal settings';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Save Stripe settings
        function saveStripeSettings() {
            showLoading();
            
            const formData = new FormData($('#stripeSettingsForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/settings/payment/stripe`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('Stripe settings saved successfully');
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to save Stripe settings';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Save crypto settings
        function saveCryptoSettings() {
            showLoading();
            
            const formData = new FormData($('#cryptoSettingsForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/settings/payment/crypto`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('Crypto settings saved successfully');
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to save crypto settings';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Save SEO settings
        function saveSEOSettings() {
            showLoading();
            
            const formData = new FormData($('#seoSettingsForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/settings/seo`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('SEO settings saved successfully');
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to save SEO settings';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Save maintenance settings
        function saveMaintenanceSettings() {
            showLoading();
            
            const formData = new FormData($('#maintenanceSettingsForm')[0]);
            
            $.ajax({
                url: `${API_BASE_URL}/settings/maintenance`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success('Maintenance settings saved successfully');
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to save maintenance settings';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Send test email
        function sendTestEmail() {
            const email = $('#testEmailAddress').val().trim();
            
            if (!email) {
                toastr.error('Please enter a test email address');
                return;
            }
            
            showLoading();
            
            $.ajax({
                url: `${API_BASE_URL}/settings/email/test`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: {
                    email: email
                },
                success: function(response) {
                    toastr.success('Test email sent successfully');
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to send test email';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Clear cache
        function clearCache() {
            showLoading();
            
            $.ajax({
                url: `${API_BASE_URL}/system/cache/clear`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    toastr.success('Cache cleared successfully');
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to clear cache';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Restart queue worker
        function restartQueueWorker() {
            showLoading();
            
            $.ajax({
                url: `${API_BASE_URL}/system/queue/restart`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                success: function(response) {
                    toastr.success('Queue worker restarted successfully');
                    loadSystemInfo();
                    hideLoading();
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to restart queue worker';
                    toastr.error(error);
                    hideLoading();
                }
            });
        }

        // Send chat message
        function sendChatMessage(message) {
            const chatBody = $('#chatBody');
            
            // Add message to chat immediately
            chatBody.append(`
                <div class="message message-admin mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <strong>You</strong>
                        <small class="message-time">Just now</small>
                    </div>
                    <p class="mb-0">${message}</p>
                </div>
            `);
            
            // Scroll to bottom
            chatBody.scrollTop(chatBody[0].scrollHeight);
            
            // Send to server
            $.ajax({
                url: `${API_BASE_URL}/chat`,
                type: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                },
                data: {
                    message: message
                },
                success: function(response) {
                    // Update timestamp
                    chatBody.find('.message-time').last().text(new Date(response.created_at).toLocaleString());
                },
                error: function(xhr) {
                    const error = xhr.responseJSON ? xhr.responseJSON.message : 'Failed to send message';
                    toastr.error(error);
                }
            });
        }

        // Connect to WebSocket
        function connectWebSocket() {
            // Connect to Socket.io server
            socket = io('https://website-backendd-1.onrender.com', {
                auth: {
                    token: localStorage.getItem('adminToken')
                }
            });
            
            // Handle connection
            socket.on('connect', function() {
                console.log('Connected to WebSocket server');
            });
            
            // Handle disconnection
            socket.on('disconnect', function() {
                console.log('Disconnected from WebSocket server');
            });
            
            // Handle new chat message
            socket.on('chat_message', function(data) {
                // Only show if chat widget is open
                if ($('#chatWidget').is(':visible')) {
                    const chatBody = $('#chatBody');
                    
                    chatBody.append(`
                        <div class="message message-user mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <strong>${data.user.first_name} ${data.user.last_name}</strong>
                                <small class="message-time">${new Date(data.created_at).toLocaleString()}</small>
                            </div>
                            <p class="mb-0">${data.message}</p>
                        </div>
                    `);
                    
                    // Scroll to bottom
                    chatBody.scrollTop(chatBody[0].scrollHeight);
                } else {
                    // Show notification
                    toastr.info(`New message from ${data.user.first_name}: ${data.message.substring(0, 30)}...`);
                }
            });
            
            // Handle new notification
            socket.on('new_notification', function(data) {
                // Show notification
                toastr.info(data.title, data.message);
                
                // Update notification count
                const currentCount = parseInt($('#notificationCount').text()) || 0;
                $('#notificationCount').text(currentCount + 1);
                
                // Reload notifications if dropdown is open
                if ($('#notificationsDropdown').hasClass('show')) {
                    loadNotifications();
                }
            });
            
            // Handle new ticket
            socket.on('new_ticket', function(data) {
                // Show notification
                toastr.warning(`New support ticket from ${data.user.first_name}: ${data.subject}`);
                
                // Update tickets badge
                const currentCount = parseInt($('#ticketsBadge').text().replace(/,/g, '')) || 0;
                $('#ticketsBadge').text((currentCount + 1).toLocaleString());
                
                // Reload support table if on support page
                if ($('#supportSection').is(':visible')) {
                    supportTable.ajax.reload();
                }
            });
            
            // Handle new withdrawal
            socket.on('new_withdrawal', function(data) {
                // Show notification
                toastr.warning(`New withdrawal request from ${data.user.first_name}: $${data.amount}`);
                
                // Update withdrawals badge
                const currentCount = parseInt($('#withdrawalsBadge').text().replace(/,/g, '')) || 0;
                $('#withdrawalsBadge').text((currentCount + 1).toLocaleString());
                
                // Reload withdrawals table if on withdrawals page
                if ($('#withdrawalsSection').is(':visible')) {
                    withdrawalsTable.ajax.reload();
                }
            });
        }

        // Logout admin
        function logoutAdmin() {
            Swal.fire({
                title: 'Logout?',
                text: 'Are you sure you want to logout?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes, logout',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    $.ajax({
                        url: `${API_BASE_URL}/auth/logout`,
                        type: 'POST',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                        },
                        success: function() {
                            localStorage.removeItem('adminToken');
                            window.location.href = 'admin-login.html';
                        },
                        error: function() {
                            localStorage.removeItem('adminToken');
                            window.location.href = 'admin-login.html';
                        }
                    });
                }
            });
        }

        // Show loading overlay
        function showLoading() {
            $('#loadingOverlay').show();
        }

        // Hide loading overlay
        function hideLoading() {
            $('#loadingOverlay').hide();
        }
    </script>
</body>
</html>
