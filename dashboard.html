<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BitHash | Professional Trading Dashboard</title>
    <meta name="description" content="Advanced cryptocurrency trading and cloud mining platform with real-time market data.">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="https://52ffud2ka0hl9tqv.public.blob.vercel-storage.com/circular_dark_background.png" type="image/png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- TradingView Library -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

    <style>
        /* ============================================= */
        /* PROFESSIONAL TRADING DASHBOARD - BINANCE INSPIRED */
        /* ============================================= */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0A0E17;
            --bg-secondary: #111827;
            --bg-tertiary: #1F2937;
            --text-primary: #FFFFFF;
            --text-secondary: #8E9BAE;
            --text-tertiary: #5A6879;
            --accent-primary: #00D8FF;
            --accent-secondary: #00A3CC;
            --green: #00FF00;
            --red: #FF0000;
            --yellow: #FFB800;
            --border-color: #2A3A4A;
            --card-bg: #0F141E;
            --hover-bg: #1A2533;
        }

        html {
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo {
            width: 60px;
            height: 60px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
        }

        /* Header */
        header {
            background-color: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            height: 64px;
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .logo img {
            height: 32px;
            width: auto;
        }

        .logo-text {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--accent-primary);
        }

        /* Desktop Navigation */
        .desktop-nav {
            display: flex;
            align-items: center;
            gap: 32px;
        }

        .desktop-nav a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            transition: color 0.2s;
        }

        .desktop-nav a:hover,
        .desktop-nav a.active {
            color: var(--accent-primary);
        }

        /* Auth Buttons */
        .auth-buttons {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-outline {
            background: transparent;
            color: var(--accent-primary);
            border: 1px solid var(--accent-primary);
        }

        .btn-outline:hover {
            background: rgba(0, 216, 255, 0.1);
        }

        .btn-primary {
            background: var(--accent-primary);
            color: var(--bg-primary);
        }

        .btn-primary:hover {
            background: var(--accent-secondary);
        }

        .logout-btn {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            border-color: var(--red);
            color: var(--red);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
        }

        /* Mobile Navigation */
        .mobile-nav {
            position: fixed;
            top: 64px;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 24px;
            transform: translateY(-100%);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
            max-height: calc(100vh - 64px);
            overflow-y: auto;
        }

        .mobile-nav.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .mobile-nav a {
            display: block;
            padding: 16px 0;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            border-bottom: 1px solid var(--border-color);
        }

        .mobile-nav a:last-child {
            border-bottom: none;
        }

        .mobile-nav a i {
            width: 24px;
            margin-right: 12px;
        }

        .mobile-logout-btn {
            color: var(--red) !important;
        }

        /* Main Dashboard Container */
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 84px 24px 40px;
        }

        /* Welcome Section */
        .welcome-section {
            margin-bottom: 24px;
        }

        .welcome-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .welcome-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Balance Cards - Binance Style */
        .balance-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .balance-card {
            background: transparent;
            padding: 16px 0;
            transition: all 0.2s;
        }

        .balance-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .balance-title {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .balance-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .balance-icon.main { background: rgba(0, 216, 255, 0.1); color: var(--accent-primary); }
        .balance-icon.active { background: rgba(52, 168, 83, 0.1); color: #34A853; }
        .balance-icon.matured { background: rgba(255, 184, 0, 0.1); color: #FFB800; }

        .balance-main {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 6px;
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .balance-secondary-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 32px;
        }

        .balance-secondary {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .asset-logo-small {
            width: 18px;
            height: 18px;
            border-radius: 50%;
        }

        .asset-selector {
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--bg-secondary);
            padding: 4px 10px;
            border-radius: 30px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .asset-selector:hover {
            border-color: var(--accent-primary);
        }

        .asset-selector img {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .asset-selector span {
            font-size: 0.8rem;
            font-weight: 500;
        }

        .balance-change {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 6px;
        }

        .balance-change.positive { color: var(--green); }
        .balance-change.negative { color: var(--red); }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .section-actions {
            display: flex;
            gap: 8px;
        }

        /* Crypto Table - Binance Style */
        .table-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 32px;
            border: 1px solid var(--border-color);
        }

        .crypto-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        .crypto-table th {
            text-align: left;
            padding: 16px 20px;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }

        .crypto-table td {
            padding: 14px 20px;
            color: var(--text-primary);
            font-size: 0.9rem;
            border-bottom: 1px solid var(--border-color);
            font-family: 'JetBrains Mono', monospace;
        }

        .crypto-table tbody tr {
            cursor: pointer;
            transition: background 0.15s;
        }

        .crypto-table tbody tr:hover {
            background: var(--hover-bg);
        }

        .coin-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .coin-logo {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .coin-name {
            font-weight: 500;
            font-family: 'Inter', sans-serif;
        }

        .coin-symbol {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-left: 4px;
            font-family: 'Inter', sans-serif;
        }

        .price-positive { color: var(--green); }
        .price-negative { color: var(--red); }

        .trend-chart {
            width: 100px;
            height: 30px;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pagination-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-color: var(--accent-primary);
        }

        .pagination-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .pagination-info {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Convert Section */
        .convert-section {
            margin-bottom: 32px;
        }

        .convert-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
        }

        .convert-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .convert-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .convert-header h3 {
            font-size: 1rem;
            font-weight: 500;
        }

        .convert-balance {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .asset-search {
            margin-bottom: 12px;
        }

        .search-input {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .asset-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .asset-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.15s;
        }

        .asset-item:last-child {
            border-bottom: none;
        }

        .asset-item:hover {
            background: var(--hover-bg);
        }

        .asset-item.selected {
            background: rgba(0, 216, 255, 0.1);
            border-left: 3px solid var(--accent-primary);
        }

        .asset-item-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .asset-item-left img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .asset-item-info {
            display: flex;
            flex-direction: column;
        }

        .asset-item-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .asset-item-balance {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .asset-item-price {
            font-weight: 500;
            font-size: 0.9rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .convert-arrow {
            font-size: 2rem;
            color: var(--text-secondary);
        }

        .amount-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 12px;
        }

        .amount-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .convert-rate {
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 16px;
            text-align: center;
        }

        .convert-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent-primary);
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .convert-btn:hover:not(:disabled) {
            opacity: 0.9;
        }

        .convert-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Loan Section */
        .loan-section {
            background: linear-gradient(135deg, #003366, #002244);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .loan-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .loan-terms-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .loan-term-item {
            background: rgba(255,255,255,0.1);
            padding: 16px;
            border-radius: 8px;
        }

        .loan-term-label {
            color: rgba(255,255,255,0.7);
            font-size: 0.8rem;
            margin-bottom: 4px;
        }

        .loan-term-value {
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .loan-application-btn {
            background: #FFB800;
            color: #002244;
            border: none;
            border-radius: 8px;
            padding: 14px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: opacity 0.2s;
        }

        .loan-application-btn:hover:not(:disabled) {
            opacity: 0.9;
        }

        .loan-application-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Referral Section */
        .referral-section {
            margin-bottom: 32px;
        }

        .referral-code {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 14px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            margin-bottom: 16px;
        }

        .copy-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .copy-btn:hover {
            border-color: var(--accent-primary);
        }

        .referral-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .stat-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 4px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        /* Investments Section */
        .investments-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 32px;
        }

        .investments-table {
            width: 100%;
            border-collapse: collapse;
        }

        .investments-table th {
            text-align: left;
            padding: 12px 16px;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.8rem;
            border-bottom: 1px solid var(--border-color);
        }

        .investments-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .mining-stats {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
        }

        .mining-stat-item {
            margin-bottom: 16px;
        }

        .mining-stat-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 4px;
        }

        .mining-stat-value {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .progress-container {
            margin-top: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 0.8rem;
        }

        .progress-bar {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFB800, #FFD700);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* Transactions Section */
        .transactions-table {
            width: 100%;
            border-collapse: collapse;
        }

        .transactions-table th {
            text-align: left;
            padding: 12px 16px;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.8rem;
            border-bottom: 1px solid var(--border-color);
        }

        .transactions-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .transactions-table tbody tr {
            cursor: pointer;
            transition: background 0.15s;
        }

        .transactions-table tbody tr:hover {
            background: var(--hover-bg);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-badge.success {
            background: rgba(0, 255, 0, 0.1);
            color: var(--green);
        }

        .status-badge.pending {
            background: rgba(255, 184, 0, 0.1);
            color: var(--yellow);
        }

        .status-badge.failed {
            background: rgba(255, 0, 0, 0.1);
            color: var(--red);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-tertiary);
        }

        .modal-header h3 {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.2rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
        }

        .chart-container {
            height: 300px;
            margin-bottom: 24px;
        }

        .asset-details-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .detail-item {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 8px;
        }

        .detail-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-convert {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 8px;
        }

        .convert-select {
            width: 100%;
            padding: 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            margin: 10px 0;
        }

        /* Notification System */
        .notification-center {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .notification {
            background: var(--bg-secondary);
            border-left: 4px solid;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: flex;
            align-items: start;
            gap: 12px;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification.success { border-left-color: var(--green); }
        .notification.error { border-left-color: var(--red); }
        .notification.info { border-left-color: var(--accent-primary); }

        .notification-icon {
            font-size: 1.2rem;
        }

        .notification.success .notification-icon { color: var(--green); }
        .notification.error .notification-icon { color: var(--red); }
        .notification.info .notification-icon { color: var(--accent-primary); }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
        }

        /* Footer */
        footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 40px 0 20px;
            margin-top: 40px;
        }

        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .footer-logo img {
            height: 28px;
        }

        .footer-social {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .social-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: transform 0.2s;
        }

        .social-icon:hover {
            transform: translateY(-2px);
        }

        .social-icon.twitter { background: #1DA1F2; }
        .social-icon.linkedin { background: #0077B5; }
        .social-icon.facebook { background: #1877F2; }
        .social-icon.instagram { background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D); }

        .footer-title {
            font-weight: 600;
            margin-bottom: 16px;
        }

        .footer-links ul {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-links a:hover {
            color: var(--accent-primary);
        }

        .footer-contact p {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            margin-top: 20px;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .balance-grid {
                gap: 12px;
            }
            
            .balance-main {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 992px) {
            .balance-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .investments-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .desktop-nav {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .auth-buttons {
                display: none;
            }
            
            .balance-grid {
                grid-template-columns: 1fr;
            }
            
            .balance-main {
                font-size: 1.3rem;
            }
            
            .convert-grid {
                grid-template-columns: 1fr;
            }
            
            .convert-arrow {
                display: none;
            }
            
            .loan-content {
                grid-template-columns: 1fr;
            }
            
            .referral-stats {
                grid-template-columns: 1fr;
            }
            
            .asset-details-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-container {
                grid-template-columns: 1fr;
            }
            
            .dashboard-container {
                padding: 74px 16px 30px;
            }
            
            .header-container {
                padding: 0 16px;
            }
            
            .section-title {
                font-size: 1.1rem;
            }
        }

        @media (max-width: 480px) {
            .balance-secondary-container {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .table-container {
                border-radius: 8px;
            }
            
            .pagination-controls {
                gap: 6px;
            }
            
            .pagination-btn {
                width: 32px;
                height: 32px;
            }
            
            .modal-content {
                max-height: 95vh;
            }
            
            .modal-body {
                padding: 16px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <img src="https://52ffud2ka0hl9tqv.public.blob.vercel-storage.com/circular_dark_background.png" alt="BitHash" class="loading-logo">
    </div>

    <!-- Notification Center -->
    <div class="notification-center" id="notification-center"></div>

    <!-- Header -->
    <header>
        <div class="header-container">
            <div class="logo" onclick="window.location.href='index.html'">
                <img src="https://52ffud2ka0hl9tqv.public.blob.vercel-storage.com/circular_dark_background.png" alt="BitHash">
                <span class="logo-text">BitHash</span>
            </div>

            <!-- Desktop Navigation -->
            <nav class="desktop-nav">
                <a href="index.html">Home</a>
                <a href="index.html#plans">Plans</a>
                <a href="dashboard.html" class="active">Dashboard</a>
                <a href="accountsetting.html">Settings</a>
            </nav>

            <!-- Auth Buttons -->
            <div class="auth-buttons" id="auth-buttons" style="display: none;">
                <button class="btn btn-outline" onclick="window.location.href='login.html'">Login</button>
                <button class="btn btn-primary" onclick="window.location.href='signup.html'">Sign Up</button>
            </div>

            <!-- User Balance / Logout -->
            <div class="auth-buttons" id="user-balance" style="display: none;">
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="logout-text">Logout</span>
                </button>
            </div>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- Mobile Navigation -->
        <div class="mobile-nav" id="mobile-nav">
            <a href="index.html"><i class="fas fa-home"></i> Home</a>
            <a href="index.html#plans"><i class="fas fa-chart-line"></i> Plans</a>
            <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="accountsetting.html"><i class="fas fa-cog"></i> Settings</a>
            <a href="#" class="mobile-logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </header>

    <!-- Main Dashboard -->
    <div class="dashboard-container">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 class="welcome-title">Welcome back, <span id="username">Miner</span></h1>
            <p class="welcome-subtitle">Track your portfolio and manage your assets in real-time</p>
        </div>

        <!-- Balance Cards -->
        <div class="balance-grid">
            <!-- Main Balance -->
            <div class="balance-card">
                <div class="balance-header">
                    <span class="balance-title">Main Balance</span>
                    <div class="balance-icon main">
                        <i class="fas fa-wallet"></i>
                    </div>
                </div>
                <div class="balance-main" id="main-balance">$0.00</div>
                <div class="balance-secondary-container">
                    <div class="balance-secondary" id="main-balance-secondary">
                        <img src="https://assets.coingecko.com/coins/images/1/large/bitcoin.png" class="asset-logo-small" alt="BTC">
                        <span id="main-balance-btc">0.000000 BTC</span>
                    </div>
                    <div class="asset-selector" onclick="openAssetSelector('main')">
                        <img src="https://assets.coingecko.com/coins/images/1/large/bitcoin.png" alt="BTC" id="main-asset-logo">
                        <span id="main-asset-symbol">BTC</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="balance-change positive" id="main-balance-change">
                    <i class="fas fa-arrow-up"></i> <span id="main-change">+2.34% (24h)</span>
                </div>
            </div>

            <!-- Active Cloud Mining -->
            <div class="balance-card">
                <div class="balance-header">
                    <span class="balance-title">Active Mining</span>
                    <div class="balance-icon active">
                        <i class="fas fa-cloud"></i>
                    </div>
                </div>
                <div class="balance-main" id="active-balance">$0.00</div>
                <div class="balance-secondary-container">
                    <div class="balance-secondary" id="active-balance-secondary">
                        <img src="https://assets.coingecko.com/coins/images/1/large/bitcoin.png" class="asset-logo-small" alt="BTC">
                        <span id="active-balance-btc">0.000000 BTC</span>
                    </div>
                    <div class="asset-selector" onclick="openAssetSelector('active')">
                        <img src="https://assets.coingecko.com/coins/images/1/large/bitcoin.png" alt="BTC" id="active-asset-logo">
                        <span id="active-asset-symbol">BTC</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="balance-change positive" id="active-balance-change">
                    <i class="fas fa-arrow-up"></i> <span id="active-change">+1.87% (24h)</span>
                </div>
            </div>

            <!-- Matured Returns -->
            <div class="balance-card">
                <div class="balance-header">
                    <span class="balance-title">Matured Returns</span>
                    <div class="balance-icon matured">
                        <i class="fas fa-coins"></i>
                    </div>
                </div>
                <div class="balance-main" id="matured-balance">$0.00</div>
                <div class="balance-secondary-container">
                    <div class="balance-secondary" id="matured-balance-secondary">
                        <img src="https://assets.coingecko.com/coins/images/1/large/bitcoin.png" class="asset-logo-small" alt="BTC">
                        <span id="matured-balance-btc">0.000000 BTC</span>
                    </div>
                    <div class="asset-selector" onclick="openAssetSelector('matured')">
                        <img src="https://assets.coingecko.com/coins/images/1/large/bitcoin.png" alt="BTC" id="matured-asset-logo">
                        <span id="matured-asset-symbol">BTC</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="balance-change positive" id="matured-balance-change">
                    <i class="fas fa-arrow-up"></i> <span id="matured-change">+0.00% (24h)</span>
                </div>
            </div>
        </div>

        <!-- Cryptocurrency Prices by Market Cap -->
        <div class="section-header">
            <h2 class="section-title">Cryptocurrency Prices by Market Cap</h2>
            <div class="pagination-controls" id="crypto-pagination">
                <button class="pagination-btn" id="crypto-prev" disabled><i class="fas fa-chevron-left"></i></button>
                <span class="pagination-info" id="crypto-page-info">1/6</span>
                <button class="pagination-btn" id="crypto-next"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>

        <div class="table-container">
            <table class="crypto-table" id="crypto-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Coin</th>
                        <th>Price</th>
                        <th>1h</th>
                        <th>24h</th>
                        <th>7d</th>
                        <th>24h Volume</th>
                        <th>Market Cap</th>
                        <th>Last 7 Days</th>
                    </tr>
                </thead>
                <tbody id="crypto-table-body">
                    <!-- Populated dynamically -->
                </tbody>
            </table>
        </div>

        <!-- Convert Section -->
        <div class="convert-section">
            <div class="section-header">
                <h2 class="section-title">Convert Assets</h2>
            </div>

            <div class="convert-grid">
                <!-- From Card -->
                <div class="convert-card">
                    <div class="convert-header">
                        <h3>From</h3>
                        <span class="convert-balance" id="from-balance-info">Balance: $0.00</span>
                    </div>
                    
                    <div class="asset-search">
                        <input type="text" class="search-input" id="from-asset-search" placeholder="Search asset...">
                    </div>
                    
                    <div class="asset-list" id="from-asset-list"></div>
                    
                    <input type="number" class="amount-input" id="from-amount" placeholder="0.00" value="0" step="any">
                    
                    <div class="convert-rate" id="conversion-rate">
                        1 BTC = $43,000.00
                    </div>
                </div>

                <!-- Arrow -->
                <div class="convert-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>

                <!-- To Card -->
                <div class="convert-card">
                    <div class="convert-header">
                        <h3>To</h3>
                        <span class="convert-balance" id="to-balance-info">Balance: $0.00</span>
                    </div>
                    
                    <div class="asset-search">
                        <input type="text" class="search-input" id="to-asset-search" placeholder="Search asset...">
                    </div>
                    
                    <div class="asset-list" id="to-asset-list"></div>
                    
                    <input type="number" class="amount-input" id="to-amount" placeholder="0.00" value="0" step="any" readonly>
                    
                    <button class="convert-btn" id="convert-btn" disabled>Convert</button>
                </div>
            </div>
        </div>

        <!-- Loan Section -->
        <div class="loan-section">
            <div class="section-header">
                <h2 class="section-title">BitHash Loan Program</h2>
                <button class="btn btn-outline" onclick="checkLoanEligibility()">
                    <i class="fas fa-redo"></i> Refresh
                </button>
            </div>

            <div class="loan-content">
                <div>
                    <h3 style="margin-bottom: 16px; color: white;">Your Loan Terms</h3>
                    <div class="loan-terms-grid" id="loan-terms-display"></div>
                    
                    <button class="loan-application-btn" id="loan-application-btn" onclick="openLoanApplication()" disabled>
                        Apply for Loan
                    </button>
                </div>

                <div>
                    <h3 style="margin-bottom: 16px; color: white;">How It Works</h3>
                    <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 20px;">
                        <p style="margin-bottom: 12px; color: rgba(255,255,255,0.9);">
                            <i class="fas fa-check-circle" style="color: #FFB800; margin-right: 8px;"></i>
                            Instant eligibility check
                        </p>
                        <p style="margin-bottom: 12px; color: rgba(255,255,255,0.9);">
                            <i class="fas fa-check-circle" style="color: #FFB800; margin-right: 8px;"></i>
                            Competitive interest rates
                        </p>
                        <p style="margin-bottom: 12px; color: rgba(255,255,255,0.9);">
                            <i class="fas fa-check-circle" style="color: #FFB800; margin-right: 8px;"></i>
                            Funds disbursed instantly
                        </p>
                        <p style="color: rgba(255,255,255,0.9);">
                            <i class="fas fa-check-circle" style="color: #FFB800; margin-right: 8px;"></i>
                            No credit check required
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Referral Program -->
        <div class="referral-section">
            <div class="section-header">
                <h2 class="section-title">Referral Program</h2>
                <button class="btn btn-outline" onclick="copyReferralLink()">
                    <i class="fas fa-copy"></i> Copy Link
                </button>
            </div>

            <div class="referral-code" id="referral-code">
                <span id="referral-link">Loading...</span>
                <button class="copy-btn" onclick="copyReferralLink()">
                    <i class="fas fa-copy"></i> Copy
                </button>
            </div>

            <div class="referral-stats">
                <div class="stat-item">
                    <div class="stat-value" id="referral-count">0</div>
                    <div class="stat-label">Total Referrals</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="referral-earnings">$0</div>
                    <div class="stat-label">Earnings</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="referral-pending">$0</div>
                    <div class="stat-label">Pending</div>
                </div>
            </div>
        </div>

        <!-- Active Mining Contracts -->
        <div class="investments-grid">
            <div>
                <div class="section-header">
                    <h2 class="section-title">Active Mining Contracts</h2>
                    <button class="btn btn-outline" onclick="window.location.href='index.html#plans'">
                        <i class="fas fa-plus"></i> New
                    </button>
                </div>

                <div class="table-container">
                    <table class="investments-table">
                        <thead>
                            <tr>
                                <th>Plan</th>
                                <th>Amount</th>
                                <th>Duration</th>
                                <th>Maturity</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="investments-table"></tbody>
                    </table>
                </div>
            </div>

            <!-- Mining Statistics -->
            <div class="mining-stats">
                <h3 style="margin-bottom: 16px;">Mining Statistics</h3>
                
                <div class="mining-stat-item">
                    <div class="mining-stat-label">Hash Rate</div>
                    <div class="mining-stat-value" id="hash-rate">0 TH/s</div>
                </div>
                
                <div class="mining-stat-item">
                    <div class="mining-stat-label">BTC Mined (24h)</div>
                    <div class="mining-stat-value" id="btc-mined">0 BTC</div>
                </div>
                
                <div class="mining-stat-item">
                    <div class="mining-stat-label">Mining Power</div>
                    <div class="mining-stat-value" id="mining-power">0%</div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Daily Progress</span>
                        <span id="mining-progress-text">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="mining-progress-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="section-header">
            <h2 class="section-title">Recent Transactions</h2>
            <button class="btn btn-outline" onclick="refreshTransactions()">
                <i class="fas fa-sync-alt"></i> Refresh
            </button>
        </div>

        <div class="table-container">
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody id="transactions-table"></tbody>
            </table>
        </div>
    </div>

    <!-- Asset Selector Modal -->
    <div class="modal" id="asset-selector-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Display Asset</h3>
                <button class="modal-close" onclick="closeAssetSelector()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="asset-search">
                    <input type="text" class="search-input" id="selector-asset-search" placeholder="Search asset...">
                </div>
                <div class="asset-list" id="selector-asset-list" style="max-height: 400px;"></div>
            </div>
        </div>
    </div>

    <!-- Asset Details Modal -->
    <div class="modal" id="asset-details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-asset-name">Bitcoin (BTC)</h3>
                <button class="modal-close" onclick="closeAssetDetails()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="chart-container" id="tradingview-chart"></div>
                
                <div class="asset-details-grid" id="asset-details-grid"></div>
                
                <div class="modal-convert">
                    <h4 style="margin-bottom: 16px;">Convert from this asset</h4>
                    <input type="number" class="amount-input" id="modal-convert-amount" placeholder="Amount">
                    
                    <select class="convert-select" id="modal-convert-to">
                        <option value="">Select asset</option>
                    </select>
                    
                    <button class="convert-btn" id="modal-convert-btn" onclick="modalConvert()">Convert</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Details Modal -->
    <div class="modal" id="transaction-details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Transaction Details</h3>
                <button class="modal-close" onclick="closeTransactionDetails()">&times;</button>
            </div>
            <div class="modal-body" id="transaction-details-body"></div>
        </div>
    </div>

    <!-- Loan Application Modal -->
    <div class="modal" id="loan-application-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Loan Application</h3>
                <button class="modal-close" onclick="closeLoanApplicationModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="loan-terms-grid" id="modal-loan-terms"></div>
                
                <div style="background: rgba(255,184,0,0.1); border-left: 4px solid #FFB800; padding: 16px; margin: 20px 0;">
                    <p style="color: #FFB800;"><i class="fas fa-info-circle"></i> A 0.99% disbursement fee applies</p>
                </div>
                
                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Loan Amount ($)</label>
                    <input type="number" class="amount-input" id="loan-request-amount" readonly>
                </div>
                
                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Purpose</label>
                    <select class="convert-select" id="loan-purpose">
                        <option value="mining">Mining Expansion</option>
                        <option value="equipment">Equipment</option>
                        <option value="diversification">Diversification</option>
                    </select>
                </div>
                
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Term</label>
                    <select class="convert-select" id="loan-term">
                        <option value="3">3 Months</option>
                        <option value="6">6 Months</option>
                        <option value="12" selected>12 Months</option>
                        <option value="24">24 Months</option>
                    </select>
                </div>
                
                <button class="convert-btn" id="submit-loan-application" onclick="submitLoanApplication()">
                    Submit Application
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div>
                <div class="footer-logo">
                    <img src="https://52ffud2ka0hl9tqv.public.blob.vercel-storage.com/circular_dark_background.png" alt="BitHash">
                    <span style="font-weight: 700; color: #00D8FF;">BitHash</span>
                </div>
                <p style="color: var(--text-secondary); line-height: 1.6;">
                    Professional cryptocurrency trading and cloud mining platform.
                </p>
                <div class="footer-social">
                    <a href="#" class="social-icon twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-icon linkedin"><i class="fab fa-linkedin-in"></i></a>
                    <a href="#" class="social-icon facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-icon instagram"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            
            <div class="footer-links">
                <h3 class="footer-title">Platform</h3>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="index.html#plans">Plans</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="accountsetting.html">Settings</a></li>
                </ul>
            </div>
            
            <div class="footer-links">
                <h3 class="footer-title">Company</h3>
                <ul>
                    <li><a href="about.html">About</a></li>
                    <li><a href="careers.html">Careers</a></li>
                    <li><a href="press.html">Press</a></li>
                    <li><a href="blog.html">Blog</a></li>
                </ul>
            </div>
            
            <div class="footer-contact">
                <h3 class="footer-title">Contact</h3>
                <p><i class="fas fa-envelope"></i> support@bithash.com</p>
                <p><i class="fas fa-phone"></i> +1 606-363-2032</p>
                <p><i class="fas fa-map-marker"></i> Wilmington, DE, USA</p>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; <span id="current-year"></span> BitHash LLC. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // =============================================
        // PROFESSIONAL DASHBOARD - PRODUCTION READY
        // =============================================

        // Global State
        const AppState = {
            user: null,
            balances: { main: 0, active: 0, matured: 0 },
            assetBalances: {},
            preferences: { mainAsset: 'btc', activeAsset: 'btc', maturedAsset: 'btc' },
            prices: {},
            allAssets: [],
            selectedFromAsset: null,
            selectedToAsset: null,
            cryptoPage: 1,
            assetsPerPage: 5,
            currentBalanceType: null,
            loanEligibility: null
        };

        // Top 30 Assets by Market Cap
        const topAssets = [
            { id: 'bitcoin', symbol: 'btc', name: 'Bitcoin', logo: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png' },
            { id: 'ethereum', symbol: 'eth', name: 'Ethereum', logo: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png' },
            { id: 'tether', symbol: 'usdt', name: 'Tether', logo: 'https://assets.coingecko.com/coins/images/325/large/Tether.png' },
            { id: 'binancecoin', symbol: 'bnb', name: 'BNB', logo: 'https://assets.coingecko.com/coins/images/825/large/bnb-icon2_2x.png' },
            { id: 'solana', symbol: 'sol', name: 'Solana', logo: 'https://assets.coingecko.com/coins/images/4128/large/solana.png' },
            { id: 'usd-coin', symbol: 'usdc', name: 'USDC', logo: 'https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png' },
            { id: 'xrp', symbol: 'xrp', name: 'XRP', logo: 'https://assets.coingecko.com/coins/images/44/large/xrp-symbol-white-128.png' },
            { id: 'dogecoin', symbol: 'doge', name: 'Dogecoin', logo: 'https://assets.coingecko.com/coins/images/5/large/dogecoin.png' },
            { id: 'cardano', symbol: 'ada', name: 'Cardano', logo: 'https://assets.coingecko.com/coins/images/975/large/cardano.png' },
            { id: 'shiba-inu', symbol: 'shib', name: 'Shiba Inu', logo: 'https://assets.coingecko.com/coins/images/11939/large/shiba.png' },
            { id: 'avalanche-2', symbol: 'avax', name: 'Avalanche', logo: 'https://assets.coingecko.com/coins/images/12559/large/Avalanche_Circle_RedWhite.png' },
            { id: 'polkadot', symbol: 'dot', name: 'Polkadot', logo: 'https://assets.coingecko.com/coins/images/12171/large/polkadot.png' },
            { id: 'tron', symbol: 'trx', name: 'TRON', logo: 'https://assets.coingecko.com/coins/images/1094/large/tron-logo.png' },
            { id: 'chainlink', symbol: 'link', name: 'Chainlink', logo: 'https://assets.coingecko.com/coins/images/877/large/chainlink-new-logo.png' },
            { id: 'polygon', symbol: 'matic', name: 'Polygon', logo: 'https://assets.coingecko.com/coins/images/4713/large/matic-token-icon.png' },
            { id: 'wrapped-bitcoin', symbol: 'wbtc', name: 'Wrapped Bitcoin', logo: 'https://assets.coingecko.com/coins/images/7598/large/wrapped_bitcoin_wbtc.png' },
            { id: 'litecoin', symbol: 'ltc', name: 'Litecoin', logo: 'https://assets.coingecko.com/coins/images/2/large/litecoin.png' },
            { id: 'near', symbol: 'near', name: 'NEAR Protocol', logo: 'https://assets.coingecko.com/coins/images/10365/large/near_icon.png' },
            { id: 'uniswap', symbol: 'uni', name: 'Uniswap', logo: 'https://assets.coingecko.com/coins/images/12504/large/uni.jpg' },
            { id: 'bitcoin-cash', symbol: 'bch', name: 'Bitcoin Cash', logo: 'https://assets.coingecko.com/coins/images/780/large/bitcoin-cash-circle.png' },
            { id: 'stellar', symbol: 'xlm', name: 'Stellar', logo: 'https://assets.coingecko.com/coins/images/100/large/Stellar_symbol_black_RGB.png' },
            { id: 'cosmos', symbol: 'atom', name: 'Cosmos Hub', logo: 'https://assets.coingecko.com/coins/images/1481/large/cosmos_hub.png' },
            { id: 'monero', symbol: 'xmr', name: 'Monero', logo: 'https://assets.coingecko.com/coins/images/69/large/monero_logo.png' },
            { id: 'flow', symbol: 'flow', name: 'Flow', logo: 'https://assets.coingecko.com/coins/images/13446/large/5f6294c0c7a8cda55cb1.png' },
            { id: 'vechain', symbol: 'vet', name: 'VeChain', logo: 'https://assets.coingecko.com/coins/images/1167/large/VET_Token_Icon.png' },
            { id: 'filecoin', symbol: 'fil', name: 'Filecoin', logo: 'https://assets.coingecko.com/coins/images/12817/large/filecoin.png' },
            { id: 'theta-token', symbol: 'theta', name: 'Theta Network', logo: 'https://assets.coingecko.com/coins/images/2538/large/theta-token-logo.png' },
            { id: 'hedera-hashgraph', symbol: 'hbar', name: 'Hedera', logo: 'https://assets.coingecko.com/coins/images/3688/large/hbar.png' },
            { id: 'fantom', symbol: 'ftm', name: 'Fantom', logo: 'https://assets.coingecko.com/coins/images/4001/large/Fantom_round.png' },
            { id: 'tezos', symbol: 'xtz', name: 'Tezos', logo: 'https://assets.coingecko.com/coins/images/976/large/Tezos-logo.png' }
        ];

        // =============================================
        // INITIALIZATION
        // =============================================

        document.addEventListener('DOMContentLoaded', function() {
            initMobileMenu();
            initEventListeners();
            loadInitialData();
            setCurrentYear();
        });

        function initMobileMenu() {
            const toggle = document.getElementById('mobile-menu-toggle');
            const mobileNav = document.getElementById('mobile-nav');
            
            toggle.addEventListener('click', function() {
                mobileNav.classList.toggle('active');
                toggle.innerHTML = mobileNav.classList.contains('active') ? 
                    '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
            });
            
            // Close mobile nav when clicking a link
            mobileNav.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    mobileNav.classList.remove('active');
                    toggle.innerHTML = '<i class="fas fa-bars"></i>';
                });
            });
        }

        function initEventListeners() {
            // Crypto pagination
            document.getElementById('crypto-prev').addEventListener('click', () => {
                if (AppState.cryptoPage > 1) {
                    AppState.cryptoPage--;
                    renderCryptoTable();
                }
            });
            
            document.getElementById('crypto-next').addEventListener('click', () => {
                const totalPages = Math.ceil(topAssets.length / AppState.assetsPerPage);
                if (AppState.cryptoPage < totalPages) {
                    AppState.cryptoPage++;
                    renderCryptoTable();
                }
            });
            
            // Convert section
            document.getElementById('from-asset-search').addEventListener('input', () => renderFromAssetList());
            document.getElementById('to-asset-search').addEventListener('input', () => renderToAssetList());
            document.getElementById('from-amount').addEventListener('input', updateToAmount);
            document.getElementById('convert-btn').addEventListener('click', performConversion);
        }

        // =============================================
        // DATA LOADING
        // =============================================

        async function loadInitialData() {
            try {
                await checkAuth();
                await Promise.all([
                    fetchPrices(),
                    loadUserData(),
                    loadBalances(),
                    loadAssetBalances(),
                    loadPreferences(),
                    loadInvestments(),
                    loadTransactions(),
                    loadMiningStats(),
                    loadReferralData(),
                    checkLoanEligibility()
                ]);
                
                renderCryptoTable();
                renderFromAssetList();
                renderToAssetList();
                
                setTimeout(() => {
                    document.getElementById('loading-overlay').classList.add('hidden');
                }, 500);
                
                // Start price updates every 30 seconds
                setInterval(fetchPrices, 30000);
                setInterval(loadBalances, 60000);
                
            } catch (error) {
                console.error('Initialization error:', error);
                showNotification('error', 'Error', 'Failed to load dashboard data');
            }
        }

        async function checkAuth() {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            try {
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/users/me', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    AppState.user = data.data?.user || data.user;
                    document.getElementById('auth-buttons').style.display = 'none';
                    document.getElementById('user-balance').style.display = 'flex';
                    document.getElementById('username').textContent = 
                        AppState.user?.firstName || AppState.user?.email?.split('@')[0] || 'Miner';
                } else {
                    localStorage.removeItem('jwtToken');
                    window.location.href = 'login.html';
                }
            } catch (error) {
                console.error('Auth check error:', error);
                window.location.href = 'login.html';
            }
        }

        async function fetchPrices() {
            try {
                const ids = topAssets.map(a => a.id).join(',');
                const response = await fetch(
                    `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true&include_7d_change=true&include_24hr_vol=true&include_market_cap=true`
                );
                
                if (response.ok) {
                    AppState.prices = await response.json();
                    AppState.allAssets = topAssets.map(asset => ({
                        ...asset,
                        price: AppState.prices[asset.id]?.usd || 0,
                        change24h: AppState.prices[asset.id]?.usd_24h_change || 0,
                        volume: AppState.prices[asset.id]?.usd_24h_vol || 0,
                        marketCap: AppState.prices[asset.id]?.usd_market_cap || 0
                    }));
                    
                    renderCryptoTable();
                    updateAllBalances();
                    updateConvertRates();
                }
            } catch (error) {
                console.error('Price fetch error:', error);
            }
        }

        async function loadUserData() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/users/me', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    AppState.user = data.data?.user || data.user;
                }
            } catch (error) {
                console.error('User data error:', error);
            }
        }

        async function loadBalances() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/users/balances', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const balances = data.data?.balances || data.balances || {};
                    
                    AppState.balances = {
                        main: balances.main || 0,
                        active: balances.active || 0,
                        matured: balances.matured || 0
                    };
                    
                    updateBalanceDisplays();
                }
            } catch (error) {
                console.error('Balance load error:', error);
            }
        }

        async function loadAssetBalances() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/users/asset-balances', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    AppState.assetBalances = data.data || data || {};
                }
            } catch (error) {
                console.error('Asset balances error:', error);
            }
        }

        async function loadPreferences() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/users/preferences', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    AppState.preferences = { ...AppState.preferences, ...(data.data || data) };
                    updatePreferenceDisplays();
                }
            } catch (error) {
                console.error('Preferences error:', error);
            }
        }

        async function savePreference(key, value) {
            try {
                const token = localStorage.getItem('jwtToken');
                await fetch('https://website-backendd-tzep.onrender.com/api/users/preferences', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ [key]: value })
                });
            } catch (error) {
                console.error('Save preference error:', error);
            }
        }

        // =============================================
        // DISPLAY UPDATES
        // =============================================

        function updateBalanceDisplays() {
            document.getElementById('main-balance').textContent = 
                formatCurrency(AppState.balances.main);
            document.getElementById('active-balance').textContent = 
                formatCurrency(AppState.balances.active);
            document.getElementById('matured-balance').textContent = 
                formatCurrency(AppState.balances.matured);
            
            updateAllBalances();
        }

        function updateAllBalances() {
            updateBalanceForType('main');
            updateBalanceForType('active');
            updateBalanceForType('matured');
        }

        function updateBalanceForType(type) {
            const assetSymbol = AppState.preferences[`${type}Asset`] || 'btc';
            const asset = topAssets.find(a => a.symbol === assetSymbol) || topAssets[0];
            const price = AppState.prices[asset.id]?.usd || 43000;
            const usdAmount = AppState.balances[type] || 0;
            const cryptoAmount = usdAmount / price;
            
            document.getElementById(`${type}-balance-secondary`).innerHTML = `
                <img src="${asset.logo}" class="asset-logo-small" alt="${assetSymbol}">
                <span>${cryptoAmount.toFixed(6)} ${assetSymbol.toUpperCase()}</span>
            `;
            
            document.getElementById(`${type}-asset-logo`).src = asset.logo;
            document.getElementById(`${type}-asset-symbol`).textContent = assetSymbol.toUpperCase();
            
            // Update 24h change (mock for now)
            const change = (Math.random() * 5 - 2.5).toFixed(2);
            const changeElement = document.getElementById(`${type}-balance-change`);
            const changeSpan = document.getElementById(`${type}-change`);
            changeSpan.textContent = `${change >= 0 ? '+' : ''}${change}% (24h)`;
            changeElement.className = `balance-change ${change >= 0 ? 'positive' : 'negative'}`;
            changeElement.innerHTML = change >= 0 ? 
                `<i class="fas fa-arrow-up"></i> ${changeSpan.outerHTML}` : 
                `<i class="fas fa-arrow-down"></i> ${changeSpan.outerHTML}`;
        }

        function updatePreferenceDisplays() {
            updateBalanceForType('main');
            updateBalanceForType('active');
            updateBalanceForType('matured');
        }

        // =============================================
        // CRYPTO TABLE
        // =============================================

        function renderCryptoTable() {
            const start = (AppState.cryptoPage - 1) * AppState.assetsPerPage;
            const end = start + AppState.assetsPerPage;
            const pageAssets = topAssets.slice(start, end);
            const tbody = document.getElementById('crypto-table-body');
            
            tbody.innerHTML = '';
            
            pageAssets.forEach((asset, index) => {
                const globalIndex = start + index + 1;
                const priceData = AppState.prices[asset.id] || {};
                
                const price = priceData.usd || 0;
                const change1h = (Math.random() * 6 - 3).toFixed(2); // Mock 1h
                const change24h = priceData.usd_24h_change || 0;
                const change7d = priceData.usd_7d_change || 0;
                const volume = priceData.usd_24h_vol || 0;
                const marketCap = priceData.usd_market_cap || 0;
                
                const row = document.createElement('tr');
                row.onclick = () => openAssetDetails(asset);
                
                row.innerHTML = `
                    <td>${globalIndex}</td>
                    <td>
                        <div class="coin-cell">
                            <img src="${asset.logo}" class="coin-logo" alt="${asset.symbol}">
                            <span class="coin-name">${asset.name}</span>
                            <span class="coin-symbol">${asset.symbol.toUpperCase()}</span>
                        </div>
                    </td>
                    <td>$${formatNumber(price)}</td>
                    <td class="${parseFloat(change1h) >= 0 ? 'price-positive' : 'price-negative'}">
                        ${parseFloat(change1h) >= 0 ? '+' : ''}${change1h}%
                    </td>
                    <td class="${change24h >= 0 ? 'price-positive' : 'price-negative'}">
                        ${change24h >= 0 ? '+' : ''}${change24h.toFixed(2)}%
                    </td>
                    <td class="${change7d >= 0 ? 'price-positive' : 'price-negative'}">
                        ${change7d >= 0 ? '+' : ''}${change7d.toFixed(2)}%
                    </td>
                    <td>$${formatNumber(volume)}</td>
                    <td>$${formatNumber(marketCap)}</td>
                    <td><div class="trend-chart" id="chart-${asset.id}"></div></td>
                `;
                
                tbody.appendChild(row);
                
                // Create mini chart
                setTimeout(() => {
                    createMiniChart(`chart-${asset.id}`, change24h >= 0);
                }, 50);
            });
            
            // Update pagination
            const totalPages = Math.ceil(topAssets.length / AppState.assetsPerPage);
            document.getElementById('crypto-page-info').textContent = 
                `${AppState.cryptoPage}/${totalPages}`;
            document.getElementById('crypto-prev').disabled = AppState.cryptoPage === 1;
            document.getElementById('crypto-next').disabled = AppState.cryptoPage === totalPages;
        }

        function createMiniChart(containerId, isPositive) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            
            const chart = LightweightCharts.createChart(container, {
                width: 100,
                height: 30,
                layout: { backgroundColor: 'transparent', textColor: 'transparent' },
                rightPriceScale: { visible: false },
                timeScale: { visible: false },
                grid: { vertLines: { visible: false }, horzLines: { visible: false } }
            });
            
            const lineSeries = chart.addLineSeries({
                color: isPositive ? '#00FF00' : '#FF0000',
                lineWidth: 2,
                crosshairMarkerVisible: false,
                lastValueVisible: false,
                priceLineVisible: false
            });
            
            // Generate random walk
            const data = [];
            let value = 100;
            for (let i = 0; i < 7; i++) {
                value += (Math.random() - 0.5) * 10;
                data.push({ time: i, value });
            }
            lineSeries.setData(data);
        }

        function formatNumber(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toFixed(2);
        }

        function formatCurrency(num) {
            return '$' + num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // =============================================
        // CONVERT SECTION
        // =============================================

        function renderFromAssetList() {
            const searchTerm = document.getElementById('from-asset-search').value.toLowerCase();
            const filtered = topAssets.filter(a => 
                a.name.toLowerCase().includes(searchTerm) || 
                a.symbol.toLowerCase().includes(searchTerm)
            );
            
            const list = document.getElementById('from-asset-list');
            list.innerHTML = '';
            
            filtered.forEach(asset => {
                const price = AppState.prices[asset.id]?.usd || 0;
                const balance = AppState.assetBalances[asset.symbol] || 0;
                const usdBalance = balance * price;
                
                const item = document.createElement('div');
                item.className = `asset-item ${AppState.selectedFromAsset?.id === asset.id ? 'selected' : ''}`;
                item.onclick = () => selectFromAsset(asset);
                
                item.innerHTML = `
                    <div class="asset-item-left">
                        <img src="${asset.logo}" alt="${asset.symbol}">
                        <div class="asset-item-info">
                            <span class="asset-item-name">${asset.name}</span>
                            <span class="asset-item-balance">${balance.toFixed(6)} ${asset.symbol.toUpperCase()}</span>
                        </div>
                    </div>
                    <span class="asset-item-price">$${formatCurrency(usdBalance)}</span>
                `;
                
                list.appendChild(item);
            });
            
            updateFromBalanceInfo();
        }

        function renderToAssetList() {
            const searchTerm = document.getElementById('to-asset-search').value.toLowerCase();
            const filtered = topAssets.filter(a => 
                a.name.toLowerCase().includes(searchTerm) || 
                a.symbol.toLowerCase().includes(searchTerm)
            );
            
            const list = document.getElementById('to-asset-list');
            list.innerHTML = '';
            
            filtered.forEach(asset => {
                const price = AppState.prices[asset.id]?.usd || 0;
                const balance = AppState.assetBalances[asset.symbol] || 0;
                const usdBalance = balance * price;
                
                const item = document.createElement('div');
                item.className = `asset-item ${AppState.selectedToAsset?.id === asset.id ? 'selected' : ''}`;
                item.onclick = () => selectToAsset(asset);
                
                item.innerHTML = `
                    <div class="asset-item-left">
                        <img src="${asset.logo}" alt="${asset.symbol}">
                        <div class="asset-item-info">
                            <span class="asset-item-name">${asset.name}</span>
                            <span class="asset-item-balance">${balance.toFixed(6)} ${asset.symbol.toUpperCase()}</span>
                        </div>
                    </div>
                    <span class="asset-item-price">$${formatCurrency(usdBalance)}</span>
                `;
                
                list.appendChild(item);
            });
            
            updateToBalanceInfo();
        }

        function selectFromAsset(asset) {
            AppState.selectedFromAsset = asset;
            renderFromAssetList();
            updateConversionRate();
            updateToAmount();
            document.getElementById('convert-btn').disabled = 
                !AppState.selectedFromAsset || !AppState.selectedToAsset;
        }

        function selectToAsset(asset) {
            AppState.selectedToAsset = asset;
            renderToAssetList();
            updateConversionRate();
            updateToAmount();
            document.getElementById('convert-btn').disabled = 
                !AppState.selectedFromAsset || !AppState.selectedToAsset;
        }

        function updateConversionRate() {
            if (!AppState.selectedFromAsset || !AppState.selectedToAsset) return;
            
            const fromPrice = AppState.prices[AppState.selectedFromAsset.id]?.usd || 0;
            const toPrice = AppState.prices[AppState.selectedToAsset.id]?.usd || 0;
            
            if (fromPrice && toPrice) {
                const rate = fromPrice / toPrice;
                document.getElementById('conversion-rate').innerHTML = `
                    1 ${AppState.selectedFromAsset.symbol.toUpperCase()} = ${rate.toFixed(6)} ${AppState.selectedToAsset.symbol.toUpperCase()}<br>
                    <small>$${fromPrice.toFixed(2)}  $${toPrice.toFixed(2)}</small>
                `;
            }
        }

        function updateToAmount() {
            if (!AppState.selectedFromAsset || !AppState.selectedToAsset) return;
            
            const fromAmount = parseFloat(document.getElementById('from-amount').value) || 0;
            const fromPrice = AppState.prices[AppState.selectedFromAsset.id]?.usd || 0;
            const toPrice = AppState.prices[AppState.selectedToAsset.id]?.usd || 0;
            
            if (fromPrice && toPrice) {
                const usdValue = fromAmount * fromPrice;
                const toAmount = usdValue / toPrice;
                document.getElementById('to-amount').value = toAmount.toFixed(6);
            }
        }

        function updateFromBalanceInfo() {
            if (AppState.selectedFromAsset) {
                const balance = AppState.assetBalances[AppState.selectedFromAsset.symbol] || 0;
                const price = AppState.prices[AppState.selectedFromAsset.id]?.usd || 0;
                document.getElementById('from-balance-info').textContent = 
                    `Balance: $${formatCurrency(balance * price)}`;
            }
        }

        function updateToBalanceInfo() {
            if (AppState.selectedToAsset) {
                const balance = AppState.assetBalances[AppState.selectedToAsset.symbol] || 0;
                const price = AppState.prices[AppState.selectedToAsset.id]?.usd || 0;
                document.getElementById('to-balance-info').textContent = 
                    `Balance: $${formatCurrency(balance * price)}`;
            }
        }

        function updateConvertRates() {
            if (AppState.selectedFromAsset && AppState.selectedToAsset) {
                updateConversionRate();
                updateToAmount();
            }
        }

        async function performConversion() {
            if (!AppState.selectedFromAsset || !AppState.selectedToAsset) return;
            
            const fromAmount = parseFloat(document.getElementById('from-amount').value) || 0;
            if (fromAmount <= 0) {
                showNotification('error', 'Invalid Amount', 'Please enter a valid amount');
                return;
            }
            
            const fromSymbol = AppState.selectedFromAsset.symbol;
            const fromBalance = AppState.assetBalances[fromSymbol] || 0;
            
            if (fromAmount > fromBalance) {
                showNotification('error', 'Insufficient Balance', 
                    `You have ${fromBalance.toFixed(6)} ${fromSymbol.toUpperCase()}`);
                return;
            }
            
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/convert', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        fromAsset: AppState.selectedFromAsset.symbol,
                        toAsset: AppState.selectedToAsset.symbol,
                        amount: fromAmount,
                        fromPrice: AppState.prices[AppState.selectedFromAsset.id]?.usd,
                        toPrice: AppState.prices[AppState.selectedToAsset.id]?.usd
                    })
                });
                
                if (response.ok) {
                    showNotification('success', 'Conversion Successful', 
                        `Converted ${fromAmount} ${fromSymbol.toUpperCase()}`);
                    
                    await Promise.all([loadBalances(), loadAssetBalances(), loadTransactions()]);
                    
                    document.getElementById('from-amount').value = 0;
                    renderFromAssetList();
                    renderToAssetList();
                } else {
                    const error = await response.json();
                    showNotification('error', 'Conversion Failed', error.message || 'Please try again');
                }
            } catch (error) {
                console.error('Conversion error:', error);
                showNotification('error', 'Conversion Failed', 'Network error');
            }
        }

        // =============================================
        // ASSET SELECTOR
        // =============================================

        function openAssetSelector(type) {
            AppState.currentBalanceType = type;
            const modal = document.getElementById('asset-selector-modal');
            
            const list = document.getElementById('selector-asset-list');
            list.innerHTML = '';
            
            topAssets.forEach(asset => {
                const item = document.createElement('div');
                item.className = 'asset-item';
                item.onclick = () => selectDisplayAsset(asset);
                
                item.innerHTML = `
                    <div class="asset-item-left">
                        <img src="${asset.logo}" alt="${asset.symbol}">
                        <div class="asset-item-info">
                            <span class="asset-item-name">${asset.name}</span>
                            <span class="asset-item-balance">${asset.symbol.toUpperCase()}</span>
                        </div>
                    </div>
                `;
                
                list.appendChild(item);
            });
            
            modal.classList.add('active');
        }

        function closeAssetSelector() {
            document.getElementById('asset-selector-modal').classList.remove('active');
            AppState.currentBalanceType = null;
        }

        async function selectDisplayAsset(asset) {
            if (!AppState.currentBalanceType) return;
            
            const type = AppState.currentBalanceType;
            AppState.preferences[`${type}Asset`] = asset.symbol;
            
            updateBalanceForType(type);
            await savePreference(`${type}Asset`, asset.symbol);
            
            closeAssetSelector();
            showNotification('success', 'Preference Saved', `Display asset updated to ${asset.symbol.toUpperCase()}`);
        }

        // =============================================
        // ASSET DETAILS MODAL
        // =============================================

        async function openAssetDetails(asset) {
            const modal = document.getElementById('asset-details-modal');
            
            document.getElementById('modal-asset-name').innerHTML = `
                <img src="${asset.logo}" style="width: 28px; height: 28px; border-radius: 50%; margin-right: 10px;">
                ${asset.name} (${asset.symbol.toUpperCase()})
            `;
            
            const price = AppState.prices[asset.id]?.usd || 0;
            const change24h = AppState.prices[asset.id]?.usd_24h_change || 0;
            const balance = AppState.assetBalances[asset.symbol] || 0;
            const balanceUsd = balance * price;
            
            document.getElementById('asset-details-grid').innerHTML = `
                <div class="detail-item">
                    <div class="detail-label">Price</div>
                    <div class="detail-value">$${formatNumber(price)}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">24h Change</div>
                    <div class="detail-value ${change24h >= 0 ? 'price-positive' : 'price-negative'}">
                        ${change24h >= 0 ? '+' : ''}${change24h.toFixed(2)}%
                    </div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Your Balance</div>
                    <div class="detail-value">${balance.toFixed(6)} ${asset.symbol.toUpperCase()}</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">$${formatNumber(balanceUsd)}</div>
                </div>
            `;
            
            const select = document.getElementById('modal-convert-to');
            select.innerHTML = '<option value="">Select asset</option>';
            topAssets.forEach(a => {
                if (a.id !== asset.id) {
                    select.innerHTML += `<option value="${a.symbol}" data-id="${a.id}">${a.name} (${a.symbol.toUpperCase()})</option>`;
                }
            });
            
            createTradingViewChart(asset.id);
            
            modal.classList.add('active');
            window.currentModalAsset = asset;
        }

        function closeAssetDetails() {
            document.getElementById('asset-details-modal').classList.remove('active');
        }

        function createTradingViewChart(assetId) {
            const container = document.getElementById('tradingview-chart');
            container.innerHTML = '';
            
            const chart = LightweightCharts.createChart(container, {
                width: container.clientWidth,
                height: 300,
                layout: {
                    backgroundColor: 'transparent',
                    textColor: 'rgba(255,255,255,0.9)',
                },
                grid: {
                    vertLines: { color: 'rgba(197,203,206,0.2)' },
                    horzLines: { color: 'rgba(197,203,206,0.2)' },
                },
                timeScale: { timeVisible: true, secondsVisible: false }
            });
            
            const candleSeries = chart.addCandlestickSeries({
                upColor: '#00FF00',
                downColor: '#FF0000',
                borderDownColor: '#FF0000',
                borderUpColor: '#00FF00',
                wickDownColor: '#FF0000',
                wickUpColor: '#00FF00'
            });
            
            // Generate mock data
            const data = [];
            let time = new Date();
            time.setDate(time.getDate() - 30);
            
            let basePrice = 100;
            for (let i = 0; i < 30; i++) {
                basePrice += (Math.random() - 0.5) * 10;
                data.push({
                    time: time.toISOString().split('T')[0],
                    open: basePrice - Math.random() * 5,
                    high: basePrice + Math.random() * 5,
                    low: basePrice - Math.random() * 5,
                    close: basePrice
                });
                time.setDate(time.getDate() + 1);
            }
            
            candleSeries.setData(data);
            chart.timeScale().fitContent();
            
            window.addEventListener('resize', () => {
                chart.applyOptions({ width: container.clientWidth });
            });
        }

        async function modalConvert() {
            const amount = parseFloat(document.getElementById('modal-convert-amount').value) || 0;
            const toSymbol = document.getElementById('modal-convert-to').value;
            
            if (!amount || amount <= 0) {
                showNotification('error', 'Invalid Amount', 'Please enter a valid amount');
                return;
            }
            
            if (!toSymbol) {
                showNotification('error', 'Invalid Asset', 'Please select a target asset');
                return;
            }
            
            const fromAsset = window.currentModalAsset;
            const toAsset = topAssets.find(a => a.symbol === toSymbol);
            
            if (!fromAsset || !toAsset) return;
            
            const fromBalance = AppState.assetBalances[fromAsset.symbol] || 0;
            if (amount > fromBalance) {
                showNotification('error', 'Insufficient Balance', 
                    `You have ${fromBalance.toFixed(6)} ${fromAsset.symbol.toUpperCase()}`);
                return;
            }
            
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/convert', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        fromAsset: fromAsset.symbol,
                        toAsset: toAsset.symbol,
                        amount: amount,
                        fromPrice: AppState.prices[fromAsset.id]?.usd,
                        toPrice: AppState.prices[toAsset.id]?.usd
                    })
                });
                
                if (response.ok) {
                    showNotification('success', 'Conversion Successful', 
                        `Converted ${amount} ${fromAsset.symbol.toUpperCase()} to ${toAsset.symbol.toUpperCase()}`);
                    
                    await Promise.all([loadBalances(), loadAssetBalances(), loadTransactions()]);
                    closeAssetDetails();
                } else {
                    const error = await response.json();
                    showNotification('error', 'Conversion Failed', error.message || 'Please try again');
                }
            } catch (error) {
                console.error('Modal conversion error:', error);
                showNotification('error', 'Conversion Failed', 'Network error');
            }
        }

        // =============================================
        // TRANSACTIONS
        // =============================================

        async function loadTransactions() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/transactions', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const tbody = document.getElementById('transactions-table');
                
                if (response.ok) {
                    const data = await response.json();
                    const transactions = data.data?.transactions || data.transactions || [];
                    
                    if (transactions.length === 0) {
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                    No transactions yet
                                </td>
                            </tr>
                        `;
                        return;
                    }
                    
                    tbody.innerHTML = '';
                    transactions.slice(0, 10).forEach(tx => {
                        const row = document.createElement('tr');
                        row.onclick = () => openTransactionDetails(tx);
                        
                        const date = new Date(tx.date || tx.createdAt);
                        const formattedDate = date.toLocaleDateString('en-US', {
                            month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
                        });
                        
                        const amount = tx.amount || 0;
                        const formattedAmount = tx.type === 'deposit' || tx.type === 'interest' ? 
                            `+$${amount.toFixed(2)}` : `-$${amount.toFixed(2)}`;
                        
                        const statusClass = tx.status === 'completed' ? 'success' : 
                                          tx.status === 'pending' ? 'pending' : 'failed';
                        
                        row.innerHTML = `
                            <td>${formattedDate}</td>
                            <td>${tx.type?.charAt(0).toUpperCase() + tx.type?.slice(1) || 'Transaction'}</td>
                            <td class="${tx.type === 'deposit' || tx.type === 'interest' ? 'price-positive' : 'price-negative'}">
                                ${formattedAmount}
                            </td>
                            <td><span class="status-badge ${statusClass}">${tx.status || 'completed'}</span></td>
                            <td>${tx.description || 'Transaction processed'}</td>
                        `;
                        
                        tbody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Transactions error:', error);
            }
        }

        function openTransactionDetails(tx) {
            const modal = document.getElementById('transaction-details-modal');
            const body = document.getElementById('transaction-details-body');
            
            const date = new Date(tx.date || tx.createdAt).toLocaleString();
            
            body.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <i class="fas fa-receipt" style="font-size: 3rem; color: var(--accent-primary);"></i>
                </div>
                <div class="asset-details-grid" style="grid-template-columns: 1fr;">
                    <div class="detail-item">
                        <div class="detail-label">Transaction ID</div>
                        <div class="detail-value" style="font-size: 0.9rem;">${tx.id || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Date & Time</div>
                        <div class="detail-value" style="font-size: 0.9rem;">${date}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Type</div>
                        <div class="detail-value">${tx.type?.charAt(0).toUpperCase() + tx.type?.slice(1) || 'Transaction'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Amount</div>
                        <div class="detail-value">$${(tx.amount || 0).toFixed(2)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Status</div>
                        <div class="detail-value">
                            <span class="status-badge ${tx.status === 'completed' ? 'success' : tx.status === 'pending' ? 'pending' : 'failed'}">
                                ${tx.status || 'completed'}
                            </span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Description</div>
                        <div class="detail-value" style="font-size: 0.9rem;">${tx.description || 'No description'}</div>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function closeTransactionDetails() {
            document.getElementById('transaction-details-modal').classList.remove('active');
        }

        function refreshTransactions() {
            loadTransactions();
            showNotification('info', 'Refreshing', 'Transaction history updated');
        }

        // =============================================
        // INVESTMENTS
        // =============================================

        async function loadInvestments() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/investments/active', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const tbody = document.getElementById('investments-table');
                
                if (response.ok) {
                    const data = await response.json();
                    const investments = data.data?.investments || data.investments || [];
                    
                    if (investments.length === 0) {
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                    No active mining contracts
                                </td>
                            </tr>
                        `;
                        return;
                    }
                    
                    tbody.innerHTML = '';
                    investments.forEach(inv => {
                        const row = document.createElement('tr');
                        const maturityDate = new Date(inv.endDate || inv.maturityDate);
                        const daysLeft = Math.ceil((maturityDate - new Date()) / (1000 * 60 * 60 * 24));
                        
                        row.innerHTML = `
                            <td>${inv.planName || 'Cloud Mining'}</td>
                            <td>$${(inv.amount || 0).toFixed(2)}</td>
                            <td>${inv.durationDays || 30} days</td>
                            <td>${maturityDate.toLocaleDateString()}</td>
                            <td>
                                <span class="status-badge ${daysLeft > 0 ? 'success' : 'pending'}">
                                    ${daysLeft > 0 ? `${daysLeft}d left` : 'Completed'}
                                </span>
                            </td>
                        `;
                        
                        tbody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Investments error:', error);
            }
        }

        // =============================================
        // MINING STATS
        // =============================================

        async function loadMiningStats() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/mining', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const stats = data.data || data;
                    
                    document.getElementById('hash-rate').textContent = stats.hashRate || '125 TH/s';
                    document.getElementById('btc-mined').textContent = 
                        (stats.btcMined || '0.000000') + ' BTC';
                    document.getElementById('mining-power').textContent = 
                        (stats.miningPower || '78') + '%';
                    
                    const progress = stats.progress || 65;
                    document.getElementById('mining-progress-bar').style.width = progress + '%';
                    document.getElementById('mining-progress-text').textContent = progress + '%';
                }
            } catch (error) {
                console.error('Mining stats error:', error);
            }
        }

        // =============================================
        // REFERRAL
        // =============================================

        async function loadReferralData() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/referrals', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const ref = data.data || data;
                    
                    const baseUrl = window.location.origin;
                    const referralCode = ref.referralCode || 'MINER2024';
                    const referralLink = `${baseUrl}/signup?ref=${referralCode}`;
                    
                    document.getElementById('referral-link').textContent = referralLink;
                    document.getElementById('referral-count').textContent = ref.totalReferrals || 0;
                    document.getElementById('referral-earnings').textContent = 
                        '$' + (ref.totalEarnings || 0).toFixed(2);
                    document.getElementById('referral-pending').textContent = 
                        '$' + (ref.pendingEarnings || 0).toFixed(2);
                }
            } catch (error) {
                console.error('Referral error:', error);
            }
        }

        function copyReferralLink() {
            const link = document.getElementById('referral-link').textContent;
            navigator.clipboard.writeText(link).then(() => {
                showNotification('success', 'Copied!', 'Referral link copied to clipboard');
            });
        }

        // =============================================
        // LOAN
        // =============================================

        async function checkLoanEligibility() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/loans/check-eligibility', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ requestedAmount: 1000 })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    AppState.loanEligibility = data;
                    
                    const termsDisplay = document.getElementById('loan-terms-display');
                    const applyBtn = document.getElementById('loan-application-btn');
                    
                    if (data.eligible) {
                        termsDisplay.innerHTML = `
                            <div class="loan-term-item">
                                <div class="loan-term-label">Max Loan</div>
                                <div class="loan-term-value">$${(data.maxLoanAmount || 5000).toFixed(2)}</div>
                            </div>
                            <div class="loan-term-item">
                                <div class="loan-term-label">Interest Rate</div>
                                <div class="loan-term-value">${data.monthlyInterest || 9.99}%</div>
                            </div>
                            <div class="loan-term-item">
                                <div class="loan-term-label">Credit Score</div>
                                <div class="loan-term-value">${data.creditScore || 750}</div>
                            </div>
                            <div class="loan-term-item">
                                <div class="loan-term-label">Fee</div>
                                <div class="loan-term-value">${data.disbursementFee || 0.99}%</div>
                            </div>
                        `;
                        applyBtn.disabled = false;
                    } else {
                        termsDisplay.innerHTML = `
                            <div class="loan-term-item" style="grid-column: span 2; text-align: center;">
                                <div class="loan-term-label">Status</div>
                                <div class="loan-term-value" style="color: #FFB800;">Not Eligible</div>
                                <div style="font-size: 0.8rem; margin-top: 8px; color: rgba(255,255,255,0.7);">
                                    ${data.reason || 'Requirements not met'}
                                </div>
                            </div>
                        `;
                        applyBtn.disabled = true;
                    }
                }
            } catch (error) {
                console.error('Loan eligibility error:', error);
            }
        }

        function openLoanApplication() {
            if (!AppState.loanEligibility?.eligible) return;
            
            const modal = document.getElementById('loan-application-modal');
            const termsDisplay = document.getElementById('modal-loan-terms');
            const amountInput = document.getElementById('loan-request-amount');
            
            termsDisplay.innerHTML = document.getElementById('loan-terms-display').innerHTML;
            amountInput.value = AppState.loanEligibility.maxLoanAmount || 5000;
            
            modal.classList.add('active');
        }

        function closeLoanApplicationModal() {
            document.getElementById('loan-application-modal').classList.remove('active');
        }

        async function submitLoanApplication() {
            const amount = parseFloat(document.getElementById('loan-request-amount').value);
            const purpose = document.getElementById('loan-purpose').value;
            const term = parseInt(document.getElementById('loan-term').value);
            
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/loans/apply', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        amount: amount,
                        purpose: purpose,
                        term: term,
                        interestRate: AppState.loanEligibility?.monthlyInterest || 9.99,
                        disbursementFee: AppState.loanEligibility?.disbursementFee || 0.99
                    })
                });
                
                if (response.ok) {
                    showNotification('success', 'Application Submitted', 
                        `Your loan application for $${amount.toFixed(2)} has been submitted`);
                    closeLoanApplicationModal();
                    await checkLoanEligibility();
                } else {
                    const error = await response.json();
                    showNotification('error', 'Application Failed', error.message || 'Please try again');
                }
            } catch (error) {
                console.error('Loan application error:', error);
                showNotification('error', 'Application Failed', 'Network error');
            }
        }

        // =============================================
        // NOTIFICATIONS
        // =============================================

        function showNotification(type, title, message) {
            const center = document.getElementById('notification-center');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = type === 'success' ? 'fa-check-circle' : 
                        type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';
            
            notification.innerHTML = `
                <div class="notification-icon"><i class="fas ${icon}"></i></div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">&times;</button>
            `;
            
            center.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // =============================================
        // UTILITIES
        // =============================================

        function setCurrentYear() {
            document.getElementById('current-year').textContent = new Date().getFullYear();
        }

        function logout() {
            localStorage.removeItem('jwtToken');
            window.location.href = 'logout.html';
        }

        // Expose functions globally
        window.openAssetSelector = openAssetSelector;
        window.closeAssetSelector = closeAssetSelector;
        window.openAssetDetails = openAssetDetails;
        window.closeAssetDetails = closeAssetDetails;
        window.closeTransactionDetails = closeTransactionDetails;
        window.openLoanApplication = openLoanApplication;
        window.closeLoanApplicationModal = closeLoanApplicationModal;
        window.submitLoanApplication = submitLoanApplication;
        window.checkLoanEligibility = checkLoanEligibility;
        window.copyReferralLink = copyReferralLink;
        window.refreshTransactions = refreshTransactions;
        window.logout = logout;
    </script>
</body>
</html>
