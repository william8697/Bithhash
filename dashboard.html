<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BitHash | Dashboard</title>
    <meta name="description" content="Manage your Bitcoin cloud mining investments and track earnings in real-time.">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rowdies:wght@300;400;700&family=Inter:wght@300;400;500;600;700&family=Manrope:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik+Dirt&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="https://52ffud2ka0hl9tqv.public.blob.vercel-storage.com/circular_dark_background.png" type="image/png">
    
    <!-- Preload Critical Assets -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- TradingView Widget Library -->
    <script src="https://s3.tradingview.com/tv.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-46S59PXRGK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-46S59PXRGK');
    </script>
    
    <style>
        /* ============================================= */
        /* CRYPTO.COM COLOR THEME IMPLEMENTATION - MATCHING LOGIN.HTML */
        /* ============================================= */
        :root {
            /* Crypto.com inspired colors - dark blue/teal theme */
            --primary: #00D8FF; /* Crypto.com light blue */
            --primary-dark: #00A3CC;
            --primary-light: #33E0FF;
            --secondary: #0A0E17; /* Crypto.com dark blue background */
            --secondary-dark: #05080F;
            --dark: #FFFFFF; /* Light text for dark background */
            --darker: #0A0E17; /* Dark background */
            --light: #0A0E17; /* Main background */
            --lighter: #111827; /* Slightly lighter background */
            --gray: #8E9BAE; /* Crypto.com gray text */
            --gray-light: #1F2937; /* Border/divider color */
            --gray-lighter: #374151;
            --success: #00FF00; /* Pure green */
            --warning: #FFB800;
            --error: #FF0000; /* Pure red */
            --gold: #D4AF37;
            --gold-light: #FFD700;
            --gold-dark: #996515;
            --blue: #003366;
            --blue-dark: #002244;
            --blue-light: #004488;
            --purple: #784FED;
            --pink: #EC4899;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            --gold-gradient: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            --blue-gradient: linear-gradient(135deg, var(--blue) 0%, var(--blue-dark) 100%);
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --box-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --security-blue: #1A73E8;
            --security-green: #34A853;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            overflow-x: hidden;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: var(--dark);
            background-color: var(--light);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Bitcoin Logo Animation - REMOVED FROM ALL ELEMENTS EXCEPT TITLE */
        .bitcoin-animation {
            display: inline-block;
            margin-right: 5px;
            vertical-align: middle;
            color: var(--gold);
            font-weight: bold;
            animation: none;
        }

        /* Security Badge */
        .security-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--darker);
            padding: 12px 16px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 100;
            border-left: 4px solid var(--security-green);
            color: var(--dark);
            border: 1px solid var(--gray-light);
        }
        
        .security-badge i {
            color: var(--security-green);
            font-size: 1rem;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--darker);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loading-logo {
            width: 80px;
            height: 80px;
            animation: pulse 1.5s infinite ease-in-out;
            filter: drop-shadow(0 0 10px rgba(0, 216, 255, 0.3));
        }
        
        .loading-text {
            margin-top: 20px;
            font-weight: 500;
            color: var(--gray);
            font-size: 1rem;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(0.95); opacity: 0.8; }
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Enhanced Header Styles - Smaller and Neater */
        header {
            background-color: var(--darker);
            box-shadow: var(--box-shadow);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            padding: 8px 0;
            transition: var(--transition-slow);
            border-bottom: 1px solid var(--gray-light);
            height: 70px;
        }
        
        header.scrolled {
            background-color: rgba(10, 14, 23, 0.98);
            backdrop-filter: blur(5px);
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            height: 100%;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            z-index: 1001;
        }
        
        .logo img {
            height: 32px;
            width: auto;
            transition: var(--transition);
        }
        
        .logo:hover img {
            transform: scale(1.05);
        }
        
        .logo-text {
            font-family: 'Rowdies', sans-serif;
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--primary);
            background-clip: text;
            position: relative;
        }
        
        /* Auth Buttons - More compact */
        .auth-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .auth-buttons .btn {
            padding: 6px 12px;
            font-size: 0.85rem;
        }
        
        /* User balance button removed - only logout button remains */
        .user-balance {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logout-btn {
            background-color: var(--primary);
            color: var(--darker);
            padding: 6px 12px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            border: none;
        }
        
        .logout-btn:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
        }
        
        .logout-btn i {
            font-size: 0.85rem;
        }
        
        /* Mobile Menu Toggle - Enhanced */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--dark);
            font-size: 1.3rem;
            cursor: pointer;
            padding: 5px;
            z-index: 1001;
            transition: var(--transition);
            position: relative;
            width: 40px;
            height: 40px;
            justify-content: center;
            align-items: center;
        }
        
        .mobile-menu-toggle:hover {
            color: var(--primary);
        }
        
        .mobile-menu-toggle .hamburger {
            width: 24px;
            height: 2px;
            background: currentColor;
            position: relative;
            transition: var(--transition);
        }
        
        .mobile-menu-toggle .hamburger::before,
        .mobile-menu-toggle .hamburger::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            background: currentColor;
            left: 0;
            transition: var(--transition);
        }
        
        .mobile-menu-toggle .hamburger::before {
            top: -8px;
        }
        
        .mobile-menu-toggle .hamburger::after {
            bottom: -8px;
        }
        
        .mobile-menu-toggle.active .hamburger {
            background: transparent;
        }
        
        .mobile-menu-toggle.active .hamburger::before {
            transform: translateY(8px) rotate(45deg);
        }
        
        .mobile-menu-toggle.active .hamburger::after {
            transform: translateY(-8px) rotate(-45deg);
        }
        
        /* Navigation - Enhanced for Mobile */
        nav {
            transition: var(--transition-slow);
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        nav a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            font-size: 0.9rem;
            padding: 3px 0;
        }
        
        nav a:hover {
            color: var(--primary);
        }
        
        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: var(--transition);
        }
        
        nav a:hover::after {
            width: 100%;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: var(--gradient);
            color: var(--darker);
            box-shadow: 0 4px 15px rgba(0, 216, 255, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 216, 255, 0.4);
        }
        
        .btn-outline {
            background-color: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: var(--darker);
            transform: translateY(-2px);
        }
        
        .btn-gold {
            background: var(--gold-gradient);
            color: var(--darker);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }
        
        .btn-gold:hover {
            background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        /* ============================================= */
        /* Enhanced Announcement System - CLASSIC & CLEAR */
        /* ============================================= */

        .announcement-center {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9998;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            width: 100%;
            max-width: 550px;
            padding: 0 15px;
        }

        .announcement {
            width: 100%;
            padding: 18px 22px;
            border-radius: var(--border-radius-lg);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4), 0 2px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: flex-start;
            gap: 16px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(-25px) scale(0.95);
            opacity: 0;
            margin-bottom: 12px;
            font-size: 0.92rem;
            font-weight: 500;
            backdrop-filter: blur(10px);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%);
            border: 1px solid rgba(0, 0, 0, 0.08);
            pointer-events: auto;
            position: relative;
            border-left: 6px solid var(--error);
            color: #1a1a1a;
            min-height: auto;
            max-height: none;
            overflow: visible;
            word-wrap: break-word;
            word-break: break-word;
            white-space: normal;
            line-height: 1.6;
        }

        .announcement.show {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .announcement.error {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(253, 242, 242, 0.98) 100%);
            color: #1a1a1a;
            border-left: 6px solid var(--error);
            box-shadow: 0 8px 30px rgba(255, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .announcement.warning {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 250, 235, 0.98) 100%);
            color: #1a1a1a;
            border-left: 6px solid var(--warning);
            box-shadow: 0 8px 30px rgba(255, 184, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .announcement.info {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(235, 248, 255, 0.98) 100%);
            color: #1a1a1a;
            border-left: 6px solid var(--primary);
            box-shadow: 0 8px 30px rgba(0, 216, 255, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .announcement.success {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(242, 253, 242, 0.98) 100%);
            color: #1a1a1a;
            border-left: 6px solid var(--success);
            box-shadow: 0 8px 30px rgba(0, 255, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .announcement.success i {
            color: var(--success) !important;
        }

        .announcement i {
            font-size: 1.4rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .announcement.error i {
            color: var(--error);
        }

        .announcement.warning i {
            color: var(--warning);
        }

        .announcement.info i {
            color: var(--primary);
        }

        .announcement-content {
            flex: 1;
            padding-right: 12px;
            overflow: visible;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
        }

        .announcement-title {
            font-weight: 700;
            margin-bottom: 0;
            font-size: 1.1rem;
            color: #000000 !important;
            white-space: normal;
            overflow: visible;
            text-overflow: unset;
            line-height: 1.3;
            letter-spacing: -0.01em;
            display: block;
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);
        }

        .announcement-message {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #2d3748 !important;
            white-space: normal;
            overflow: visible;
            text-overflow: unset;
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .announcement-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            margin-top: 16px;
            color: var(--primary) !important;
            white-space: nowrap;
            border-top: 1px solid rgba(0, 216, 255, 0.3);
            padding-top: 16px;
            gap: 0;
            font-weight: 600 !important;
            width: 100%;
        }

        .announcement-sender {
            font-weight: 600 !important;
            color: var(--primary) !important;
            white-space: nowrap;
            overflow: visible;
            text-overflow: unset;
        }

        .announcement-date {
            opacity: 0.9;
            color: var(--primary) !important;
            font-weight: 600 !important;
            white-space: nowrap;
        }

        .announcement-close {
            position: absolute;
            top: 14px;
            right: 14px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            border: none;
            color: #718096;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.95rem;
            padding: 0;
            opacity: 0.8;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .announcement-close:hover {
            background-color: rgba(0, 0, 0, 0.1);
            transform: scale(1.1);
            color: #2d3748;
            opacity: 1;
        }

        /* Auto-sizing based on content */
        .announcement {
            min-height: auto;
            max-height: none;
            height: auto;
        }

        .announcement-content {
            height: auto;
        }

        .announcement-title,
        .announcement-message,
        .announcement-meta {
            height: auto;
            max-height: none;
            overflow: visible;
        }

        /* Force text visibility */
        .announcement * {
            overflow: visible !important;
            text-overflow: unset !important;
            white-space: normal !important;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .announcement-center {
                top: 60px;
                max-width: 90%;
                padding: 0 10px;
            }
            
            .announcement {
                padding: 16px 18px;
                gap: 14px;
                margin-bottom: 10px;
            }
            
            .announcement i {
                font-size: 1.3rem;
            }
            
            .announcement-title {
                font-size: 1.05rem;
            }
            
            .announcement-message {
                font-size: 0.9rem;
            }
            
            .announcement-meta {
                font-size: 0.8rem;
                padding-top: 14px;
                margin-top: 14px;
            }
        }

        @media (max-width: 480px) {
            .announcement-center {
                max-width: 95%;
            }
            
            .announcement {
                padding: 14px 16px;
                gap: 12px;
            }
            
            .announcement-title {
                font-size: 1rem;
            }
            
            .announcement-message {
                font-size: 0.85rem;
            }
            
            .announcement-meta {
                font-size: 0.75rem;
                padding-top: 12px;
                margin-top: 12px;
            }
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0) scale(1); }
            20%, 80% { transform: translate3d(2px, 0, 0) scale(1); }
            30%, 50%, 70% { transform: translate3d(-3px, 0, 0) scale(1); }
            40%, 60% { transform: translate3d(4px, 0, 0) scale(1); }
        }

        .announcement.error.show {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes classicEntrance {
            0% {
                transform: translateY(-20px) scale(0.95);
                opacity: 0;
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .announcement.show {
            animation: classicEntrance 0.4s ease-out forwards;
        }

        .announcement::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: var(--border-radius-lg);
            box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);
            pointer-events: none;
            z-index: -1;
        }
        
        /* Critical Error Notification System */
        .notification-center {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: flex-start;
            pointer-events: none;
            width: 100%;
            max-width: 350px;
        }
        
        .notification {
            width: 100%;
            padding: 12px 16px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            display: flex;
            align-items: start;
            gap: 10px;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform: translateX(30px) scale(0.95);
            opacity: 0;
            margin-bottom: 10px;
            font-size: 0.75rem;
            font-weight: 500;
            backdrop-filter: blur(10px);
            background-color: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: auto;
            position: relative;
        }
        
        .notification.show {
            transform: translateX(0) scale(1);
            opacity: 1;
        }
        
        .notification.error {
            background-color: rgba(255, 0, 0, 0.95);
            color: white;
            border-left: 4px solid #cc0000;
        }
        
        .notification.success {
            background-color: rgba(0, 255, 0, 0.95);
            color: var(--darker);
            border-left: 4px solid #00cc00;
        }
        
        .notification.warning {
            background-color: rgba(255, 184, 0, 0.95);
            color: var(--darker);
            border-left: 4px solid #e6a600;
        }
        
        .notification i {
            font-size: 1rem;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .notification-content {
            flex: 1;
            padding-right: 10px;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.85rem;
        }
        
        .notification-message {
            font-size: 0.75rem;
            line-height: 1.4;
        }
        
        .notification-close {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.7rem;
        }
        
        .notification-close:hover {
            background-color: rgba(0, 0, 0, 0.2);
            transform: rotate(90deg);
        }
        
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        .notification.error.show {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        /* Dashboard Specific Styles - Binance-like smooth block design */
        .dashboard-section {
            padding: 140px 0 60px;
            background-color: var(--light);
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .dashboard-title h1 {
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .dashboard-title p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .dashboard-actions {
            display: flex;
            gap: 12px;
        }
        
        /* Balances Section - Horizontal line across all devices */
        .balances-wrapper {
            display: flex;
            flex-wrap: nowrap;
            gap: 15px;
            margin-bottom: 25px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            padding-bottom: 5px;
        }
        
        .balances-wrapper::-webkit-scrollbar {
            height: 4px;
        }
        
        .balances-wrapper::-webkit-scrollbar-thumb {
            background-color: var(--gray);
            border-radius: 4px;
        }
        
        .balance-card {
            flex: 1;
            min-width: 200px;
            background-color: var(--lighter);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            border: 1px solid var(--gray-light);
        }
        
        .balance-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        
        .balance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .balance-title {
            font-size: 0.95rem;
            color: var(--gray);
        }
        
        .balance-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        
        .balance-icon.main {
            background-color: rgba(0, 216, 255, 0.1);
            color: var(--primary);
        }
        
        .balance-icon.active {
            background-color: rgba(26, 115, 232, 0.1);
            color: var(--security-blue);
        }
        
        .balance-icon.matured {
            background-color: rgba(212, 175, 55, 0.1);
            color: var(--gold);
        }
        
        .balance-amount {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
            font-family: 'Manrope', sans-serif;
        }
        
        .preferred-balance {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 8px;
        }
        
        .preferred-balance img {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .balance-change {
            font-size: 0.85rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .balance-change.positive {
            color: var(--success);
        }
        
        .balance-change.negative {
            color: var(--error);
        }
        
        /* Asset preference selector */
        .asset-preference {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--gray-light);
        }
        
        .asset-preference-label {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .asset-selector {
            background-color: var(--light);
            border: 1px solid var(--gray-light);
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 0.8rem;
            color: var(--dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .asset-selector img {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        /* Cryptocurrency Prices Section */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pagination-btn {
            background-color: var(--lighter);
            border: 1px solid var(--gray-light);
            color: var(--dark);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .pagination-btn:hover:not(:disabled) {
            background-color: var(--primary);
            color: var(--darker);
        }
        
        .pagination-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .pagination-info {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        /* Crypto Table - Mobile optimized with fixed first column */
        .crypto-table-container {
            position: relative;
            margin-bottom: 25px;
            border-radius: var(--border-radius-lg);
            background-color: var(--lighter);
            border: 1px solid var(--gray-light);
            overflow: hidden;
        }
        
        .crypto-table-wrapper {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }
        
        .crypto-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }
        
        .crypto-table th {
            background-color: var(--darker);
            padding: 15px 12px;
            font-size: 0.8rem;
            color: var(--gray);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: left;
            white-space: nowrap;
        }
        
        .crypto-table td {
            padding: 12px;
            font-size: 0.9rem;
            color: var(--dark);
            border-bottom: 1px solid var(--gray-light);
            white-space: nowrap;
        }
        
        .crypto-table tr:last-child td {
            border-bottom: none;
        }
        
        .crypto-table tr:hover td {
            background-color: rgba(255, 255, 255, 0.02);
        }
        
        /* Fixed first column on mobile */
        .crypto-table th:first-child,
        .crypto-table td:first-child {
            position: sticky;
            left: 0;
            background-color: var(--lighter);
            z-index: 2;
        }
        
        .crypto-table th:first-child {
            background-color: var(--darker);
        }
        
        .coin-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .coin-logo {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }
        
        .coin-name {
            font-weight: 600;
        }
        
        .coin-symbol {
            color: var(--gray);
            font-size: 0.8rem;
        }
        
        .price-positive {
            color: var(--success);
        }
        
        .price-negative {
            color: var(--error);
        }
        
        .sparkline {
            width: 100px;
            height: 30px;
        }
        
        /* Convert Section */
        .convert-section {
            margin-bottom: 25px;
            background-color: var(--lighter);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            border: 1px solid var(--gray-light);
        }
        
        .convert-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr auto;
            gap: 15px;
            align-items: center;
        }
        
        .convert-asset {
            background-color: var(--light);
            border-radius: var(--border-radius);
            padding: 15px;
            border: 1px solid var(--gray-light);
        }
        
        .convert-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        .convert-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 12px;
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-light);
        }
        
        .convert-selector img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }
        
        .convert-input {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--dark);
            font-size: 1.5rem;
            font-weight: 600;
            outline: none;
            margin-top: 10px;
        }
        
        .convert-balance {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }
        
        .convert-swap {
            background-color: var(--primary);
            color: var(--darker);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .convert-swap:hover {
            transform: rotate(180deg);
        }
        
        .convert-rate {
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
            padding: 10px;
        }
        
        .convert-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .convert-btn {
            flex: 1;
            padding: 15px;
            background: var(--gradient);
            color: var(--darker);
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .convert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 216, 255, 0.3);
        }
        
        /* Asset Modal */
        .asset-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(10, 14, 23, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-slow);
            backdrop-filter: blur(10px);
            padding: 20px;
        }
        
        .asset-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .asset-modal-content {
            background-color: var(--darker);
            border-radius: 16px;
            width: 100%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
            transform: translateY(30px) scale(0.95);
            transition: var(--transition-slow);
            border: 1px solid var(--gray-light);
        }
        
        .asset-modal.active .asset-modal-content {
            transform: translateY(0) scale(1);
        }
        
        .asset-modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .asset-modal-header h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
        }
        
        .asset-modal-header img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }
        
        .asset-modal-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .asset-modal-close:hover {
            color: var(--primary);
            transform: rotate(90deg);
        }
        
        .asset-modal-body {
            padding: 20px;
        }
        
        .chart-container {
            height: 400px;
            margin-bottom: 20px;
        }
        
        .asset-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .asset-detail-item {
            background-color: var(--light);
            padding: 15px;
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-light);
        }
        
        .asset-detail-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .asset-detail-value {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .modal-convert {
            margin-top: 20px;
            padding: 20px;
            background-color: var(--light);
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-light);
        }
        
        /* Loan Section */
        .loan-card {
            background-color: var(--blue);
            color: white;
            border-radius: var(--border-radius-lg);
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .loan-card .card-title {
            color: white;
        }
        
        .loan-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .loan-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: var(--border-radius);
        }
        
        .loan-terms-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .loan-term-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: var(--border-radius);
            border-left: 3px solid var(--primary);
        }
        
        .loan-term-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 5px;
        }
        
        .loan-term-value {
            font-size: 1.2rem;
            color: white;
            font-weight: 600;
        }
        
        .loan-eligibility-status {
            background: rgba(0, 216, 255, 0.1);
            border: 1px solid rgba(0, 216, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 20px 0;
        }
        
        .eligibility-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }
        
        .eligibility-item:last-child {
            margin-bottom: 0;
        }
        
        .eligibility-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .eligibility-icon.verified {
            background: rgba(0, 216, 255, 0.2);
            color: var(--primary);
        }
        
        .eligibility-icon.pending {
            background: rgba(255, 184, 0, 0.2);
            color: var(--warning);
        }
        
        .eligibility-text {
            color: white;
            font-size: 0.95rem;
        }
        
        .loan-application-btn {
            width: 100%;
            margin-top: 20px;
            background: var(--gold-gradient);
            color: var(--darker);
            font-weight: 600;
            font-size: 1rem;
            padding: 12px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .loan-application-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 100%);
            transform: translateY(-2px);
        }
        
        .loan-application-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Referral Program */
        .referral-card {
            background-color: var(--lighter);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .referral-code {
            background-color: var(--light);
            padding: 12px;
            border-radius: var(--border-radius);
            font-family: monospace;
            font-size: 1.1rem;
            letter-spacing: 1px;
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            overflow-x: auto;
        }
        
        .copy-btn {
            background-color: var(--primary);
            color: var(--darker);
            border: none;
            border-radius: var(--border-radius);
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: var(--transition);
            white-space: nowrap;
        }
        
        .copy-btn:hover {
            background-color: var(--primary-light);
        }
        
        .referral-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 12px;
            background-color: var(--light);
            border-radius: var(--border-radius);
        }
        
        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--gray);
        }
        
        /* Investments Section */
        .investments-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .investments-card, .transactions-card {
            background-color: var(--lighter);
            border-radius: var(--border-radius-lg);
            padding: 20px;
        }
        
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }
        
        th {
            font-size: 0.8rem;
            color: var(--gray);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            font-size: 0.85rem;
            color: var(--dark);
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .status-badge.success {
            background-color: rgba(0, 255, 0, 0.1);
            color: var(--success);
        }
        
        .status-badge.pending {
            background-color: rgba(255, 184, 0, 0.1);
            color: var(--warning);
        }
        
        .status-badge.failed {
            background-color: rgba(255, 0, 0, 0.1);
            color: var(--error);
        }
        
        .transaction-row {
            cursor: pointer;
            transition: var(--transition);
        }
        
        .transaction-row:hover td {
            background-color: rgba(0, 216, 255, 0.05);
        }
        
        /* Footer */
        footer {
            background-color: var(--darker);
            color: white;
            padding: 50px 0 20px;
        }
        
        .footer-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .footer-logo img {
            height: 28px;
            width: auto;
        }
        
        .footer-logo-text {
            font-family: 'Rowdies', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary);
        }
        
        .footer-about p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .footer-social {
            display: flex;
            gap: 10px;
        }
        
        .social-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            color: white;
        }
        
        .social-icon.twitter {
            background-color: #1DA1F2;
        }
        
        .social-icon.linkedin {
            background-color: #0077B5;
        }
        
        .social-icon.facebook {
            background-color: #1877F2;
        }
        
        .social-icon.instagram {
            background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D, #F56040, #F77737, #FCAF45, #FFDC80);
        }
        
        .social-icon:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .footer-title {
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.1rem;
            color: white;
        }
        
        .footer-links ul {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: var(--transition);
            font-size: 0.9rem;
            display: inline-block;
        }
        
        .footer-links a:hover {
            color: var(--primary);
            transform: translateX(3px);
        }
        
        .footer-contact p {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 12px;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .footer-contact i {
            color: var(--primary);
            width: 18px;
            text-align: center;
            margin-top: 2px;
            font-size: 0.9rem;
        }
        
        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
        }
        
        /* Responsive Styles - Enhanced */
        @media (max-width: 1024px) {
            .investments-grid {
                grid-template-columns: 1fr;
            }
            
            .convert-grid {
                grid-template-columns: 1fr;
            }
            
            .convert-swap {
                transform: rotate(90deg);
                margin: 10px auto;
            }
            
            .convert-swap:hover {
                transform: rotate(270deg);
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-section {
                padding: 120px 0 40px;
            }
            
            .balances-wrapper {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            
            .balance-card {
                min-width: 250px;
            }
            
            .loan-content {
                grid-template-columns: 1fr;
            }
            
            .referral-stats {
                grid-template-columns: 1fr;
            }
            
            /* Enhanced Mobile Navigation with Logout in Menu */
            .mobile-menu-toggle {
                display: flex;
            }
            
            nav {
                position: fixed;
                top: 70px;
                left: 0;
                width: 100%;
                background-color: var(--darker);
                padding: 20px;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
                transform: translateY(-100%);
                opacity: 0;
                visibility: hidden;
                transition: var(--transition-slow);
                z-index: 999;
            }
            
            nav.active {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }
            
            nav ul {
                flex-direction: column;
                gap: 15px;
            }
            
            nav a {
                padding: 10px 0;
                font-size: 1rem;
            }
            
            /* Mobile logout button inside nav */
            .mobile-logout {
                display: block;
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid var(--gray-light);
            }
            
            .mobile-logout .logout-btn {
                width: 100%;
                justify-content: center;
            }
            
            .footer-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-section {
                padding: 100px 0 30px;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .dashboard-title h1 {
                font-size: 1.5rem;
            }
            
            .dashboard-actions {
                width: 100%;
            }
            
            .dashboard-actions .btn {
                width: 100%;
            }
            
            .balance-amount {
                font-size: 1.5rem;
            }
            
            .balance-card {
                min-width: 200px;
            }
            
            .crypto-table td {
                padding: 10px 8px;
                font-size: 0.8rem;
            }
            
            .coin-info {
                gap: 5px;
            }
            
            .coin-logo {
                width: 20px;
                height: 20px;
            }
            
            .footer-container {
                grid-template-columns: 1fr;
            }
            
            .asset-modal-content {
                max-height: 95vh;
            }
            
            .chart-container {
                height: 300px;
            }
        }
        
        /* Hide desktop logout on mobile, show mobile logout */
        .desktop-logout {
            display: block;
        }
        
        .mobile-logout {
            display: none;
        }
        
        @media (max-width: 768px) {
            .desktop-logout {
                display: none;
            }
            
            .mobile-logout {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <img src="https://52ffud2ka0hl9tqv.public.blob.vercel-storage.com/circular_dark_background.png" alt="BitHash Logo" class="loading-logo">    
        <div class="loading-text">Establishing Secure Connection</div>
    </div>

    <!-- Security Badge -->
    <div class="security-badge">
        <i class="fas fa-shield-alt"></i>
        <span>256-bit AES & TLS 1.3 Encrypted</span>
    </div>

    <!-- Enhanced Announcement System -->
    <div class="announcement-center" id="announcement-center">
        <!-- Announcements will be dynamically inserted here -->
    </div>

    <!-- Critical Error Notification System -->
    <div class="notification-center" id="notification-center">
        <!-- Critical error notifications will be dynamically inserted here -->
    </div>

    <!-- Enhanced Header - Smaller and Neater with Mobile Toggle -->
    <header id="main-header">
        <div class="container header-container">
            <div class="logo" onclick="window.location.href='index.html'">
                <img src="https://52ffud2ka0hl9tqv.public.blob.vercel-storage.com/circular_dark_background.png" alt="BitHash Logo">
                <span class="logo-text">
                     <span></span>itHash
                </span>
            </div>
            
            <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle navigation">
                <span class="hamburger"></span>
            </button>
            
            <nav id="main-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="index.html#plans">Investment Plans</a></li>
                    <li><a href="index.html#how-it-works">How It Works</a></li>
                    <li><a href="dashboard.html" class="active">Dashboard</a></li>
                    <li><a href="accountsetting.html">Settings</a></li>
                </ul>
                <!-- Mobile Logout Button inside navigation -->
                <div class="mobile-logout">
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </nav>
            
            <div class="auth-buttons" id="auth-buttons" style="display: none;">
                <button class="btn btn-outline" onclick="window.location.href='login.html'">Login</button>
                <button class="btn btn-primary" onclick="window.location.href='signup.html'">Sign Up</button>
            </div>
            
            <div class="user-balance desktop-logout" id="user-balance" style="display: none;">
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Dashboard Section -->
    <section class="dashboard-section">
        <div class="container">
            <div class="dashboard-header">
                <div class="dashboard-title">
                    <h1>Welcome Back, <span id="username">Miner</span></h1>
                    <p>Your cloud mining dashboard and account overview</p>
                </div>
                <div class="dashboard-actions">
                    <button class="btn btn-primary" onclick="window.location.href='deposit.html'">
                        <i class="fas fa-plus-circle"></i> Deposit
                    </button>
                    <button class="btn btn-outline" onclick="window.location.href='withdrawal.html'">
                        <i class="fas fa-wallet"></i> Withdraw
                    </button>
                </div>
            </div>
            
            <!-- Balances Section - Horizontal Line -->
            <div class="balances-wrapper">
                <div class="balance-card">
                    <div class="balance-header">
                        <div class="balance-title">Main Balance</div>
                        <div class="balance-icon main">
                            <i class="fas fa-wallet"></i>
                        </div>
                    </div>
                    <div class="balance-amount" id="main-balance">$0.00</div>
                    <div class="preferred-balance" id="main-balance-preferred">
                        <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" alt="BTC" id="main-balance-logo">
                        <span id="main-balance-preferred-amount">0.000000 BTC</span>
                    </div>
                    <div class="balance-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="main-balance-change">+0.00% (24h)</span>
                    </div>
                </div>
                
                <div class="balance-card">
                    <div class="balance-header">
                        <div class="balance-title">Active Cloud Mining</div>
                        <div class="balance-icon active">
                            <i class="fas fa-cloud"></i>
                        </div>
                    </div>
                    <div class="balance-amount" id="active-balance">$0.00</div>
                    <div class="preferred-balance" id="active-balance-preferred">
                        <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" alt="BTC" id="active-balance-logo">
                        <span id="active-balance-preferred-amount">0.000000 BTC</span>
                    </div>
                    <div class="balance-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="active-balance-change">+0.00% (24h)</span>
                    </div>
                </div>
                
                <div class="balance-card">
                    <div class="balance-header">
                        <div class="balance-title">Matured Returns</div>
                        <div class="balance-icon matured">
                            <i class="fas fa-coins"></i>
                        </div>
                    </div>
                    <div class="balance-amount" id="matured-balance">$0.00</div>
                    <div class="preferred-balance" id="matured-balance-preferred">
                        <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" alt="BTC" id="matured-balance-logo">
                        <span id="matured-balance-preferred-amount">0.000000 BTC</span>
                    </div>
                    <div class="balance-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="matured-balance-change">+0.00% (24h)</span>
                    </div>
                </div>
            </div>
            
            <!-- Asset Preference Selector -->
            <div class="asset-preference">
                <span class="asset-preference-label">Display balances in:</span>
                <div class="asset-selector" id="asset-preference-selector">
                    <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" alt="BTC" id="preferred-asset-logo">
                    <span id="preferred-asset-symbol">BTC</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>

            <!-- Cryptocurrency Prices by Market Cap -->
            <div class="crypto-section">
                <div class="section-header">
                    <h2 class="section-title">Cryptocurrency Prices by Market Cap</h2>
                    <div class="pagination-controls">
                        <button class="pagination-btn" id="crypto-prev" disabled><i class="fas fa-chevron-left"></i></button>
                        <span class="pagination-info" id="crypto-pagination-info">1-5 of 30</span>
                        <button class="pagination-btn" id="crypto-next"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                
                <div class="crypto-table-container">
                    <div class="crypto-table-wrapper">
                        <table class="crypto-table" id="crypto-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Coin</th>
                                    <th>Price</th>
                                    <th>1h</th>
                                    <th>24h</th>
                                    <th>7d</th>
                                    <th>24h Volume</th>
                                    <th>Market Cap</th>
                                    <th>Last 7 Days</th>
                                </tr>
                            </thead>
                            <tbody id="crypto-table-body">
                                <!-- Crypto data will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Convert Section -->
            <div class="convert-section">
                <div class="section-header">
                    <h2 class="section-title">Convert</h2>
                </div>
                
                <div class="convert-grid">
                    <div class="convert-asset" id="convert-from">
                        <div class="convert-header">
                            <span>From</span>
                            <span class="convert-balance" id="from-balance">Balance: $0.00</span>
                        </div>
                        <div class="convert-selector" id="from-asset-selector">
                            <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" alt="BTC" id="from-asset-logo">
                            <span id="from-asset-symbol">BTC</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <input type="number" class="convert-input" id="from-amount" placeholder="0.00" value="0.001">
                        <div class="convert-balance" id="from-usd-value"> $0.00</div>
                    </div>
                    
                    <div class="convert-swap" id="swap-assets">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    
                    <div class="convert-asset" id="convert-to">
                        <div class="convert-header">
                            <span>To</span>
                            <span class="convert-balance" id="to-balance">Balance: $0.00</span>
                        </div>
                        <div class="convert-selector" id="to-asset-selector">
                            <img src="https://cryptologos.cc/logos/ethereum-eth-logo.png" alt="ETH" id="to-asset-logo">
                            <span id="to-asset-symbol">ETH</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <input type="number" class="convert-input" id="to-amount" placeholder="0.00" value="0.00" readonly>
                        <div class="convert-balance" id="to-usd-value"> $0.00</div>
                    </div>
                    
                    <div class="convert-rate" id="conversion-rate">
                        1 BTC  0.00 ETH
                    </div>
                </div>
                
                <div class="convert-actions">
                    <button class="convert-btn" id="convert-now-btn">
                        <i class="fas fa-exchange-alt"></i> Convert Now
                    </button>
                </div>
            </div>

            <!-- BTC Loan Section -->
            <div class="loan-card">
                <div class="card-header">
                    <h3 class="card-title">BitHash Loan Program</h3>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="checkLoanEligibility()">
                            <i class="fas fa-redo"></i> Check Again
                        </button>
                    </div>
                </div>
                
                <div class="loan-content">
                    <div class="loan-info">
                        <h4 style="margin-bottom: 15px; color: white;">Your Loan Terms</h4>
                        <div class="loan-terms-grid" id="loan-terms-display">
                            <!-- Loan terms will be dynamically inserted here -->
                        </div>
                        
                        <div class="loan-eligibility-status" id="loan-eligibility-status">
                            <!-- Eligibility status will be dynamically inserted here -->
                        </div>
                        
                        <button class="loan-application-btn" id="loan-application-btn" onclick="openLoanApplication()">
                            <i class="fas fa-file-contract"></i> Apply for Loan
                        </button>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: 15px; color: white;">How Our Loan Process Works</h4>
                        <div class="eligibility-item">
                            <div class="eligibility-icon verified">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="eligibility-text">
                                <strong>Eligibility Check:</strong> Our system verifies your account status
                            </div>
                        </div>
                        <div class="eligibility-item">
                            <div class="eligibility-icon verified">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="eligibility-text">
                                <strong>Credit Assessment:</strong> Maximum loan amount determined
                            </div>
                        </div>
                        <div class="eligibility-item">
                            <div class="eligibility-icon verified">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="eligibility-text">
                                <strong>Instant Approval:</strong> Apply instantly if eligible
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: var(--border-radius);">
                            <p style="color: rgba(255,255,255,0.9); font-size: 0.9rem;">
                                <i class="fas fa-info-circle" style="color: var(--warning);"></i>
                                <strong>Important:</strong> Loans are designed to help you expand your cloud mining operations. Use funds wisely to grow your mining portfolio.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Referral Program -->
            <div class="referral-card">
                <div class="card-header">
                    <h3 class="card-title">Referral Program</h3>
                    <div class="card-actions">
                        <button class="card-action-btn" onclick="copyReferralLink()">
                            <i class="fas fa-copy"></i> Copy Link
                        </button>
                    </div>
                </div>
                
                <div class="referral-code" id="referral-code">
                    <span id="referral-link-text">Loading referral link...</span>
                    <button class="copy-btn" id="copy-btn">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                </div>
                
                <p style="color: var(--gray); margin-bottom: 15px; font-size: 0.9rem;">
                    Earn 5% of your downline's cloud mining investment in their first three rounds. Share your link and help others start mining!
                </p>
                
                <div class="referral-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="referral-count">0</div>
                        <div class="stat-label">Total Referrals</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="referral-earnings">$0</div>
                        <div class="stat-label">Total Earnings</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="referral-pending">$0</div>
                        <div class="stat-label">Pending Bonus</div>
                    </div>
                </div>
            </div>
            
            <!-- Cloud Mining Investments and Transactions -->
            <div class="investments-grid">
                <div class="investments-card">
                    <div class="card-header">
                        <h3 class="card-title">Active Cloud Mining Contracts</h3>
                        <div class="card-actions">
                            <button class="card-action-btn" onclick="window.location.href='index.html#plans'">
                                <i class="fas fa-plus-circle"></i> New Mining Contract
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Mining Plan</th>
                                    <th>Investment</th>
                                    <th>Duration</th>
                                    <th>Hourly Return</th>
                                    <th>Maturity Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="investments-table">
                                <!-- Investments will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="transactions-card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Transactions</h3>
                        <div class="card-actions">
                            <button class="card-action-btn" onclick="refreshTransactions()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-table">
                                <!-- Transactions will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Loan Application Modal -->
    <div class="loan-application-modal" id="loan-application-modal">
        <div class="loan-application-content">
            <div class="loan-application-header">
                <h3>BitHash Loan Application</h3>
                <button class="loan-application-close" id="loan-application-close">&times;</button>
            </div>
            <div class="loan-application-body">
                <div id="loan-application-form">
                    <div class="loan-terms-grid" id="modal-loan-terms">
                        <!-- Loan terms will be dynamically inserted here -->
                    </div>
                    
                    <div class="loan-disbursement-info">
                        <i class="fas fa-info-circle"></i>
                        <span>A 0.99% disbursement fee will be deducted from the loan amount before funds are released to your account.</span>
                    </div>
                    
                    <div class="loan-application-form">
                        <div class="form-group">
                            <label for="loan-request-amount">Loan Amount Requested ($)</label>
                            <input type="number" id="loan-request-amount" class="form-control" placeholder="Enter desired loan amount" min="1000" step="100" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label for="loan-purpose">Purpose of Loan</label>
                            <select id="loan-purpose" class="form-control">
                                <option value="cloud_mining_expansion">Cloud Mining Expansion</option>
                                <option value="equipment_upgrade">Mining Equipment Upgrade</option>
                                <option value="portfolio_diversification">Portfolio Diversification</option>
                                <option value="emergency_funds">Emergency Funds</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="loan-term-selection">Loan Term</label>
                            <select id="loan-term-selection" class="form-control">
                                <option value="3">3 Months</option>
                                <option value="6">6 Months</option>
                                <option value="12" selected>12 Months</option>
                                <option value="24">24 Months</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-primary" id="submit-loan-application">
                            <i class="fas fa-paper-plane"></i> Submit Loan Application
                        </button>
                        <div class="loan-application-status" id="loan-application-status"></div>
                    </div>
                </div>
                
                <div id="loan-success-message" style="display: none;">
                    <div class="success-message">
                        <i class="fas fa-check-circle"></i>
                        <h4>Congratulations! Loan Application Submitted</h4>
                        <p>Your loan application has been received successfully. You will receive a decision within 24 hours. Funds will be disbursed to your main balance upon approval.</p>
                        <button class="btn btn-primary" onclick="closeLoanApplicationModal()" style="margin-top: 15px;">
                            <i class="fas fa-check"></i> Continue Mining
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Asset Details Modal -->
    <div class="asset-modal" id="asset-modal">
        <div class="asset-modal-content">
            <div class="asset-modal-header">
                <h2 id="modal-asset-title">
                    <img src="" alt="" id="modal-asset-logo">
                    <span id="modal-asset-name"></span>
                    <span id="modal-asset-symbol"></span>
                </h2>
                <button class="asset-modal-close" id="asset-modal-close">&times;</button>
            </div>
            <div class="asset-modal-body">
                <div class="chart-container" id="tradingview-chart"></div>
                
                <div class="asset-details-grid">
                    <div class="asset-detail-item">
                        <div class="asset-detail-label">Price</div>
                        <div class="asset-detail-value" id="modal-price">$0.00</div>
                    </div>
                    <div class="asset-detail-item">
                        <div class="asset-detail-label">24h Change</div>
                        <div class="asset-detail-value" id="modal-change">0.00%</div>
                    </div>
                    <div class="asset-detail-item">
                        <div class="asset-detail-label">24h Volume</div>
                        <div class="asset-detail-value" id="modal-volume">$0</div>
                    </div>
                    <div class="asset-detail-item">
                        <div class="asset-detail-label">Market Cap</div>
                        <div class="asset-detail-value" id="modal-market-cap">$0</div>
                    </div>
                    <div class="asset-detail-item">
                        <div class="asset-detail-label">Your Balance</div>
                        <div class="asset-detail-value" id="modal-balance">0.000000</div>
                    </div>
                    <div class="asset-detail-item">
                        <div class="asset-detail-label">Your Balance (USD)</div>
                        <div class="asset-detail-value" id="modal-balance-usd">$0.00</div>
                    </div>
                </div>
                
                <div class="modal-convert">
                    <h3>Convert</h3>
                    <div class="convert-grid" style="grid-template-columns: 1fr auto 1fr;">
                        <div class="convert-asset">
                            <div class="convert-selector" id="modal-from-selector">
                                <img src="" alt="" id="modal-from-logo">
                                <span id="modal-from-symbol"></span>
                            </div>
                            <input type="number" class="convert-input" id="modal-from-amount" placeholder="0.00" value="0.001">
                            <div class="convert-balance" id="modal-from-balance">Balance: 0.000000</div>
                        </div>
                        
                        <div class="convert-swap" id="modal-swap">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        
                        <div class="convert-asset">
                            <div class="convert-selector" id="modal-to-selector">
                                <img src="https://cryptologos.cc/logos/ethereum-eth-logo.png" alt="" id="modal-to-logo">
                                <span id="modal-to-symbol">ETH</span>
                            </div>
                            <input type="number" class="convert-input" id="modal-to-amount" placeholder="0.00" readonly>
                            <div class="convert-balance" id="modal-to-balance">Balance: 0.000000</div>
                        </div>
                    </div>
                    
                    <button class="convert-btn" id="modal-convert-btn" style="margin-top: 20px;">
                        <i class="fas fa-exchange-alt"></i> Convert Now
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Details Modal -->
    <div class="asset-modal" id="transaction-modal">
        <div class="asset-modal-content" style="max-width: 500px;">
            <div class="asset-modal-header">
                <h2>Transaction Details</h2>
                <button class="asset-modal-close" id="transaction-modal-close">&times;</button>
            </div>
            <div class="asset-modal-body" id="transaction-details-content">
                <!-- Transaction details will be loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Asset Selector Modal (for convert) -->
    <div class="asset-modal" id="asset-selector-modal">
        <div class="asset-modal-content" style="max-width: 400px;">
            <div class="asset-modal-header">
                <h2>Select Asset</h2>
                <button class="asset-modal-close" id="asset-selector-close">&times;</button>
            </div>
            <div class="asset-modal-body">
                <input type="text" class="convert-input" id="asset-search" placeholder="Search assets..." style="margin-bottom: 15px; padding: 10px; background-color: var(--light); border: 1px solid var(--gray-light); border-radius: var(--border-radius);">
                <div id="asset-list" style="max-height: 400px; overflow-y: auto;">
                    <!-- Asset list will be loaded dynamically -->
                </div>
                <div class="pagination-controls" style="margin-top: 15px;">
                    <button class="pagination-btn" id="asset-prev" disabled><i class="fas fa-chevron-left"></i></button>
                    <span class="pagination-info" id="asset-pagination-info">1-5 of 30</span>
                    <button class="pagination-btn" id="asset-next"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer id="contact">
        <div class="container">
            <div class="footer-container">
                <div class="footer-about">
                    <div class="footer-logo">
                        <img src="https://52ffud2ka0hl9tqv.public.blob.vercel-storage.com/circular_dark_background.png" alt="BitHash Logo" class="loading-logo">    
                        <span class="footer-logo-text"> <span></span>itHash</span>
                    </div>
                    <p>Bitcoin mining platform serving investors worldwide with transparent operations and reliable returns.</p>
                    <div class="footer-social">
                        <!-- Social Share Buttons -->
                        <a href="https://twitter.com/intent/tweet?url=https://bithhash.vercel.app/&text=Check%20out%20this%20Bitcoin%20mining%20platform!" 
                           class="social-icon twitter" aria-label="Twitter" target="_blank" rel="noopener">
                           <i class="fab fa-twitter"></i>
                        </a>
                        
                        <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://bithhash.vercel.app/" 
                           class="social-icon linkedin" aria-label="LinkedIn" target="_blank" rel="noopener">
                           <i class="fab fa-linkedin-in"></i>
                        </a>
                        
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://bithhash.vercel.app/" 
                           class="social-icon facebook" aria-label="Facebook" target="_blank" rel="noopener">
                           <i class="fab fa-facebook-f"></i>
                        </a>
                        
                        <a href="https://www.instagram.com" 
                           class="social-icon instagram" aria-label="Instagram" target="_blank" rel="noopener" 
                           onclick="alert('Instagram does not support direct sharing via links. Please share manually.'); return false;">
                           <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                </div>
                
                <div class="footer-links">
                    <h3 class="footer-title">Platform</h3>
                    <ul>
                        <li><a href="#home">Dashboard</a></li>
                        <li><a href="#plans">Investment Plans</a></li>
                        <li><a href="#loans">Loans</a></li>
                        <li><a href="dashboard.html">My Account</a></li>
                        <li><a href="rewards.html">Rewards</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h3 class="footer-title">Company</h3>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="careers.html">Careers</a></li>
                        <li><a href="press.html">Press</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="partners.html">Partners</a></li>
                    </ul>
                </div>
                
                <div class="footer-contact">
                    <h3 class="footer-title">Contact Us</h3>
                    <p><i class="fas fa-envelope"></i> support@bithash.com</p>
                    <p><i class="fas fa-phone"></i> +1 606-363-2032</p>
                    <p><i class="fas fa-map-marker-alt"></i> 800 Plant St, Wilmington, DE 19801, United States</p>
                    <p><i class="fas fa-clock"></i> 24/7 Support</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; <span id="current-year"></span> BitHash LLC. All Rights Reserved. Registered in Delaware, USA. FINRA/SIPC Member.</p>
            </div>
        </div>
    </footer>

    <!-- AOS Animation -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <script>
        // Initialize AOS animation
        AOS.init({
            duration: 800,
            once: true,
            easing: 'ease-in-out'
        });
        
        // Global state
        let currentLoanEligibility = null;
        let currentBTCPrice = 43000;
        let currentETHPrice = 2200;
        let AppState = {
            announcements: [],
            activeAnnouncements: new Map()
        };
        
        // Crypto data state
        let allCryptoData = [];
        let currentCryptoPage = 1;
        const itemsPerPage = 5;
        let selectedAsset = null;
        let userPreferredAsset = 'BTC';
        let userBalances = {
            main: 0,
            active: 0,
            matured: 0
        };
        let exchangeRates = {};
        
        // Asset list for convert
        const assetList = [
            { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin', logo: 'https://cryptologos.cc/logos/bitcoin-btc-logo.png' },
            { id: 'ethereum', symbol: 'ETH', name: 'Ethereum', logo: 'https://cryptologos.cc/logos/ethereum-eth-logo.png' },
            { id: 'binancecoin', symbol: 'BNB', name: 'Binance Coin', logo: 'https://cryptologos.cc/logos/bnb-bnb-logo.png' },
            { id: 'solana', symbol: 'SOL', name: 'Solana', logo: 'https://cryptologos.cc/logos/solana-sol-logo.png' },
            { id: 'ripple', symbol: 'XRP', name: 'XRP', logo: 'https://cryptologos.cc/logos/xrp-xrp-logo.png' },
            { id: 'cardano', symbol: 'ADA', name: 'Cardano', logo: 'https://cryptologos.cc/logos/cardano-ada-logo.png' },
            { id: 'avalanche-2', symbol: 'AVAX', name: 'Avalanche', logo: 'https://cryptologos.cc/logos/avalanche-avax-logo.png' },
            { id: 'dogecoin', symbol: 'DOGE', name: 'Dogecoin', logo: 'https://cryptologos.cc/logos/dogecoin-doge-logo.png' },
            { id: 'polkadot', symbol: 'DOT', name: 'Polkadot', logo: 'https://cryptologos.cc/logos/polkadot-new-dot-logo.png' },
            { id: 'tron', symbol: 'TRX', name: 'TRON', logo: 'https://cryptologos.cc/logos/tron-trx-logo.png' },
            { id: 'chainlink', symbol: 'LINK', name: 'Chainlink', logo: 'https://cryptologos.cc/logos/chainlink-link-logo.png' },
            { id: 'polygon', symbol: 'MATIC', name: 'Polygon', logo: 'https://cryptologos.cc/logos/polygon-matic-logo.png' },
            { id: 'litecoin', symbol: 'LTC', name: 'Litecoin', logo: 'https://cryptologos.cc/logos/litecoin-ltc-logo.png' },
            { id: 'bitcoin-cash', symbol: 'BCH', name: 'Bitcoin Cash', logo: 'https://cryptologos.cc/logos/bitcoin-cash-bch-logo.png' },
            { id: 'stellar', symbol: 'XLM', name: 'Stellar', logo: 'https://cryptologos.cc/logos/stellar-xlm-logo.png' },
            { id: 'uniswap', symbol: 'UNI', name: 'Uniswap', logo: 'https://cryptologos.cc/logos/uniswap-uni-logo.png' },
            { id: 'vechain', symbol: 'VET', name: 'VeChain', logo: 'https://cryptologos.cc/logos/vechain-vet-logo.png' },
            { id: 'theta-token', symbol: 'THETA', name: 'Theta Network', logo: 'https://cryptologos.cc/logos/theta-network-theta-logo.png' },
            { id: 'filecoin', symbol: 'FIL', name: 'Filecoin', logo: 'https://cryptologos.cc/logos/filecoin-fil-logo.png' },
            { id: 'internet-computer', symbol: 'ICP', name: 'Internet Computer', logo: 'https://cryptologos.cc/logos/internet-computer-icp-logo.png' },
            { id: 'ethereum-classic', symbol: 'ETC', name: 'Ethereum Classic', logo: 'https://cryptologos.cc/logos/ethereum-classic-etc-logo.png' },
            { id: 'hedera-hashgraph', symbol: 'HBAR', name: 'Hedera', logo: 'https://cryptologos.cc/logos/hedera-hbar-logo.png' },
            { id: 'near', symbol: 'NEAR', name: 'NEAR Protocol', logo: 'https://cryptologos.cc/logos/near-protocol-near-logo.png' },
            { id: 'monero', symbol: 'XMR', name: 'Monero', logo: 'https://cryptologos.cc/logos/monero-xmr-logo.png' },
            { id: 'cronos', symbol: 'CRO', name: 'Cronos', logo: 'https://cryptologos.cc/logos/cronos-cro-logo.png' },
            { id: 'algorand', symbol: 'ALGO', name: 'Algorand', logo: 'https://cryptologos.cc/logos/algorand-algo-logo.png' },
            { id: 'vechain', symbol: 'VET', name: 'VeChain', logo: 'https://cryptologos.cc/logos/vechain-vet-logo.png' },
            { id: 'apecoin', symbol: 'APE', name: 'ApeCoin', logo: 'https://cryptologos.cc/logos/apecoin-ape-logo.png' },
            { id: 'fantom', symbol: 'FTM', name: 'Fantom', logo: 'https://cryptologos.cc/logos/fantom-ftm-logo.png' },
            { id: 'flow', symbol: 'FLOW', name: 'Flow', logo: 'https://cryptologos.cc/logos/flow-flow-logo.png' }
        ];
        
        // Hide loading overlay when page is loaded
        window.addEventListener('load', function() {
            setTimeout(async function() {
                document.getElementById('loading-overlay').classList.add('hidden');
                
                // Initialize mobile menu
                initMobileMenu();
                
                // Initialize header scroll effect
                initHeaderScrollEffect();
                
                // Load prices from CoinGecko
                await fetchAllPrices();
                
                // Load user data
                await loadUserData();
                await loadBalances();
                await loadUserPreference();
                await loadInvestments();
                await loadTransactions();
                await loadReferralData();
                await checkLoanEligibility();
                
                // Initialize crypto table
                await loadCryptoData();
                
                // Initialize convert section
                initConvertSection();
                
                // Initialize modals
                initializeModals();
                
                // Check auth state
                await checkAuthState();
                
                // Set current year in footer
                document.getElementById('current-year').textContent = new Date().getFullYear();
                
                // Start announcements polling
                startAnnouncementsPolling();
                
            }, 1000);
        });
        
        /* ============================================= */
        /* Mobile Menu Functions */
        /* ============================================= */
        
        function initMobileMenu() {
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mainNav = document.getElementById('main-nav');
            
            if (mobileMenuToggle && mainNav) {
                mobileMenuToggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    mainNav.classList.toggle('active');
                    this.setAttribute('aria-expanded', mainNav.classList.contains('active'));
                    
                    if (mainNav.classList.contains('active')) {
                        document.body.style.overflow = 'hidden';
                    } else {
                        document.body.style.overflow = '';
                    }
                });
                
                document.querySelectorAll('#main-nav a').forEach(link => {
                    link.addEventListener('click', () => {
                        if (window.innerWidth <= 768) {
                            mobileMenuToggle.classList.remove('active');
                            mainNav.classList.remove('active');
                            document.body.style.overflow = '';
                            mobileMenuToggle.setAttribute('aria-expanded', 'false');
                        }
                    });
                });
            }
        }
        
        function initHeaderScrollEffect() {
            window.addEventListener('scroll', function() {
                const header = document.getElementById('main-header');
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });
        }
        
        /* ============================================= */
        /* Price and Data Fetching */
        /* ============================================= */
        
        async function fetchAllPrices() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,binancecoin,solana,ripple,cardano,avalanche-2,dogecoin,polkadot,tron,chainlink,polygon,litecoin,bitcoin-cash,stellar,uniswap,vechain,theta-token,filecoin,internet-computer,ethereum-classic,hedera-hashgraph,near,monero,cronos,algorand,apecoin,fantom,flow&vs_currencies=usd&include_24hr_change=true');
                if (response.ok) {
                    const data = await response.json();
                    exchangeRates = data;
                    currentBTCPrice = data.bitcoin?.usd || 43000;
                    currentETHPrice = data.ethereum?.usd || 2200;
                }
            } catch (error) {
                console.error('Error fetching prices:', error);
            }
        }
        
        async function loadCryptoData() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=30&page=1&sparkline=true&price_change_percentage=1h,24h,7d');
                if (response.ok) {
                    allCryptoData = await response.json();
                    renderCryptoTable();
                }
            } catch (error) {
                console.error('Error loading crypto data:', error);
                // Fallback to mock data if API fails
                generateMockCryptoData();
            }
        }
        
        function generateMockCryptoData() {
            const symbols = ['BTC', 'ETH', 'BNB', 'SOL', 'XRP', 'ADA', 'AVAX', 'DOGE', 'DOT', 'TRX', 'LINK', 'MATIC', 'LTC', 'BCH', 'XLM', 'UNI', 'VET', 'THETA', 'FIL', 'ICP', 'ETC', 'HBAR', 'NEAR', 'XMR', 'CRO', 'ALGO', 'APE', 'FTM', 'FLOW'];
            const names = ['Bitcoin', 'Ethereum', 'Binance Coin', 'Solana', 'XRP', 'Cardano', 'Avalanche', 'Dogecoin', 'Polkadot', 'TRON', 'Chainlink', 'Polygon', 'Litecoin', 'Bitcoin Cash', 'Stellar', 'Uniswap', 'VeChain', 'Theta Network', 'Filecoin', 'Internet Computer', 'Ethereum Classic', 'Hedera', 'NEAR Protocol', 'Monero', 'Cronos', 'Algorand', 'ApeCoin', 'Fantom', 'Flow'];
            
            allCryptoData = [];
            for (let i = 0; i < 30; i++) {
                const price = Math.random() * 50000 + 0.01;
                const change1h = (Math.random() * 10 - 5).toFixed(2);
                const change24h = (Math.random() * 10 - 5).toFixed(2);
                const change7d = (Math.random() * 20 - 10).toFixed(2);
                
                allCryptoData.push({
                    market_cap_rank: i + 1,
                    id: symbols[i].toLowerCase(),
                    symbol: symbols[i].toLowerCase(),
                    name: names[i],
                    image: `https://cryptologos.cc/logos/${symbols[i].toLowerCase()}-${symbols[i].toLowerCase()}-logo.png`,
                    current_price: price,
                    price_change_percentage_1h_in_currency: parseFloat(change1h),
                    price_change_percentage_24h_in_currency: parseFloat(change24h),
                    price_change_percentage_7d_in_currency: parseFloat(change7d),
                    total_volume: Math.floor(Math.random() * 10000000000),
                    market_cap: Math.floor(Math.random() * 1000000000000),
                    sparkline_in_7d: { price: Array(7).fill(0).map(() => price * (1 + (Math.random() * 0.1 - 0.05))) }
                });
            }
            renderCryptoTable();
        }
        
        function renderCryptoTable() {
            const start = (currentCryptoPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = allCryptoData.slice(start, end);
            
            const tbody = document.getElementById('crypto-table-body');
            tbody.innerHTML = '';
            
            pageData.forEach((coin, index) => {
                const row = document.createElement('tr');
                row.style.cursor = 'pointer';
                row.onclick = () => openAssetModal(coin);
                
                const sparklineData = coin.sparkline_in_7d?.price || Array(7).fill(coin.current_price);
                const sparklinePath = generateSparklinePath(sparklineData, coin.price_change_percentage_7d_in_currency >= 0);
                
                row.innerHTML = `
                    <td>${coin.market_cap_rank || start + index + 1}</td>
                    <td>
                        <div class="coin-info">
                            <img src="${coin.image}" alt="${coin.symbol}" class="coin-logo" onerror="this.src='https://cryptologos.cc/logos/bitcoin-btc-logo.png'">
                            <div>
                                <div class="coin-name">${coin.name}</div>
                                <div class="coin-symbol">${coin.symbol.toUpperCase()}</div>
                            </div>
                        </div>
                    </td>
                    <td>$${formatNumber(coin.current_price)}</td>
                    <td class="${coin.price_change_percentage_1h_in_currency >= 0 ? 'price-positive' : 'price-negative'}">
                        ${coin.price_change_percentage_1h_in_currency?.toFixed(2) || '0.00'}%
                    </td>
                    <td class="${coin.price_change_percentage_24h_in_currency >= 0 ? 'price-positive' : 'price-negative'}">
                        ${coin.price_change_percentage_24h_in_currency?.toFixed(2) || '0.00'}%
                    </td>
                    <td class="${coin.price_change_percentage_7d_in_currency >= 0 ? 'price-positive' : 'price-negative'}">
                        ${coin.price_change_percentage_7d_in_currency?.toFixed(2) || '0.00'}%
                    </td>
                    <td>$${formatNumber(coin.total_volume)}</td>
                    <td>$${formatNumber(coin.market_cap)}</td>
                    <td>
                        <svg width="100" height="30" viewBox="0 0 100 30" class="sparkline">
                            <path d="${sparklinePath}" stroke="${coin.price_change_percentage_7d_in_currency >= 0 ? '#00FF00' : '#FF0000'}" fill="none" stroke-width="2"/>
                        </svg>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            updatePagination();
        }
        
        function generateSparklinePath(data, isPositive) {
            if (!data || data.length === 0) return '';
            
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min || 1;
            
            const points = data.map((value, index) => {
                const x = (index / (data.length - 1)) * 100;
                const y = 30 - ((value - min) / range) * 25 - 2.5;
                return `${x},${y}`;
            });
            
            return `M ${points.join(' L ')}`;
        }
        
        function updatePagination() {
            const totalPages = Math.ceil(30 / itemsPerPage);
            document.getElementById('crypto-pagination-info').textContent = 
                `${(currentCryptoPage - 1) * itemsPerPage + 1}-${Math.min(currentCryptoPage * itemsPerPage, 30)} of 30`;
            
            document.getElementById('crypto-prev').disabled = currentCryptoPage === 1;
            document.getElementById('crypto-next').disabled = currentCryptoPage === totalPages;
        }
        
        function formatNumber(num) {
            if (!num) return '0.00';
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toFixed(2);
        }
        
        /* ============================================= */
        /* Balance and Preference Functions */
        /* ============================================= */
        
        async function loadUserPreference() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/users/preference', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    userPreferredAsset = data.preferredAsset || 'BTC';
                } else {
                    // Check deposit history for default asset
                    const depositResponse = await fetch('https://website-backendd-tzep.onrender.com/api/transactions?type=deposit&limit=1', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    if (depositResponse.ok) {
                        const depositData = await depositResponse.json();
                        const deposits = depositData.data?.transactions || depositData.transactions || [];
                        if (deposits.length > 0 && deposits[0].asset) {
                            userPreferredAsset = deposits[0].asset;
                        }
                    }
                }
                
                // Save preference to database
                await saveUserPreference(userPreferredAsset);
                updatePreferredBalances();
            } catch (error) {
                console.error('Error loading user preference:', error);
            }
        }
        
        async function saveUserPreference(asset) {
            try {
                const token = localStorage.getItem('jwtToken');
                await fetch('https://website-backendd-tzep.onrender.com/api/users/preference', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ preferredAsset: asset })
                });
            } catch (error) {
                console.error('Error saving user preference:', error);
            }
        }
        
        function updatePreferredBalances() {
            const asset = assetList.find(a => a.symbol === userPreferredAsset) || assetList[0];
            const price = exchangeRates[asset.id]?.usd || (asset.symbol === 'BTC' ? currentBTCPrice : currentETHPrice);
            
            document.getElementById('preferred-asset-logo').src = asset.logo;
            document.getElementById('preferred-asset-symbol').textContent = asset.symbol;
            
            // Update each balance
            ['main', 'active', 'matured'].forEach(balanceType => {
                const balanceUsd = parseFloat(document.getElementById(`${balanceType}-balance`).textContent.replace('$', '')) || 0;
                const preferredAmount = balanceUsd / price;
                
                document.getElementById(`${balanceType}-balance-logo`).src = asset.logo;
                document.getElementById(`${balanceType}-balance-preferred-amount`).textContent = 
                    `${preferredAmount.toFixed(8)} ${asset.symbol}`;
            });
        }
        
        async function loadBalances() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/users/balances', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const balances = data.data?.balances || data.balances || {};
                    
                    userBalances = {
                        main: balances.main || 0,
                        active: balances.active || 0,
                        matured: balances.matured || 0
                    };
                    
                    // Update balance displays with commas
                    document.getElementById('main-balance').textContent = `$${formatNumberWithCommas(userBalances.main)}`;
                    document.getElementById('active-balance').textContent = `$${formatNumberWithCommas(userBalances.active)}`;
                    document.getElementById('matured-balance').textContent = `$${formatNumberWithCommas(userBalances.matured)}`;
                    
                    // Update balance changes
                    const mainChangeElement = document.querySelector('#main-balance-change');
                    const activeChangeElement = document.querySelector('#active-balance-change');
                    const maturedChangeElement = document.querySelector('#matured-balance-change');
                    
                    mainChangeElement.textContent = '+0.25% (24h)';
                    mainChangeElement.parentElement.className = 'balance-change positive';
                    
                    activeChangeElement.textContent = '+1.50% (24h)';
                    activeChangeElement.parentElement.className = 'balance-change positive';
                    
                    maturedChangeElement.textContent = '+0.75% (24h)';
                    maturedChangeElement.parentElement.className = 'balance-change positive';
                    
                    updatePreferredBalances();
                }
            } catch (error) {
                console.error('Error loading balances:', error);
            }
        }
        
        function formatNumberWithCommas(num) {
            return num.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }
        
        /* ============================================= */
        /* Convert Section Functions */
        /* ============================================= */
        
        function initConvertSection() {
            let fromAsset = assetList[0]; // BTC
            let toAsset = assetList[1]; // ETH
            
            document.getElementById('from-asset-logo').src = fromAsset.logo;
            document.getElementById('from-asset-symbol').textContent = fromAsset.symbol;
            document.getElementById('to-asset-logo').src = toAsset.logo;
            document.getElementById('to-asset-symbol').textContent = toAsset.symbol;
            
            document.getElementById('from-balance').textContent = `Balance: $${formatNumberWithCommas(userBalances.main)}`;
            document.getElementById('to-balance').textContent = `Balance: $${formatNumberWithCommas(userBalances.matured)}`;
            
            // From amount input
            document.getElementById('from-amount').addEventListener('input', updateConversion);
            
            // Swap button
            document.getElementById('swap-assets').addEventListener('click', swapAssets);
            
            // Asset selectors
            document.getElementById('from-asset-selector').addEventListener('click', () => openAssetSelector('from'));
            document.getElementById('to-asset-selector').addEventListener('click', () => openAssetSelector('to'));
            
            // Convert button
            document.getElementById('convert-now-btn').addEventListener('click', performConversion);
            
            updateConversion();
        }
        
        function updateConversion() {
            const fromAmount = parseFloat(document.getElementById('from-amount').value) || 0;
            const fromSymbol = document.getElementById('from-asset-symbol').textContent;
            const toSymbol = document.getElementById('to-asset-symbol').textContent;
            
            const fromAsset = assetList.find(a => a.symbol === fromSymbol);
            const toAsset = assetList.find(a => a.symbol === toSymbol);
            
            const fromPrice = exchangeRates[fromAsset.id]?.usd || (fromSymbol === 'BTC' ? currentBTCPrice : currentETHPrice);
            const toPrice = exchangeRates[toAsset.id]?.usd || (toSymbol === 'BTC' ? currentBTCPrice : currentETHPrice);
            
            const fromUsdValue = fromAmount * fromPrice;
            const toAmount = fromUsdValue / toPrice;
            
            document.getElementById('from-usd-value').textContent = ` $${formatNumber(fromUsdValue)}`;
            document.getElementById('to-amount').value = toAmount.toFixed(8);
            document.getElementById('to-usd-value').textContent = ` $${formatNumber(fromUsdValue)}`;
            document.getElementById('conversion-rate').textContent = 
                `1 ${fromSymbol}  ${(fromPrice / toPrice).toFixed(8)} ${toSymbol}`;
        }
        
        function swapAssets() {
            const fromSymbol = document.getElementById('from-asset-symbol').textContent;
            const toSymbol = document.getElementById('to-asset-symbol').textContent;
            const fromLogo = document.getElementById('from-asset-logo').src;
            const toLogo = document.getElementById('to-asset-logo').src;
            const fromBalance = document.getElementById('from-balance').textContent;
            const toBalance = document.getElementById('to-balance').textContent;
            
            document.getElementById('from-asset-symbol').textContent = toSymbol;
            document.getElementById('to-asset-symbol').textContent = fromSymbol;
            document.getElementById('from-asset-logo').src = toLogo;
            document.getElementById('to-asset-logo').src = fromLogo;
            document.getElementById('from-balance').textContent = toBalance;
            document.getElementById('to-balance').textContent = fromBalance;
            
            updateConversion();
        }
        
        function openAssetSelector(type) {
            window.currentSelectorType = type;
            renderAssetList(1, type);
            document.getElementById('asset-selector-modal').classList.add('active');
        }
        
        function renderAssetList(page, type) {
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageAssets = assetList.slice(start, end);
            
            const assetListDiv = document.getElementById('asset-list');
            assetListDiv.innerHTML = '';
            
            pageAssets.forEach(asset => {
                const assetItem = document.createElement('div');
                assetItem.style.cssText = `
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    padding: 10px;
                    cursor: pointer;
                    border-bottom: 1px solid var(--gray-light);
                    transition: var(--transition);
                `;
                assetItem.onmouseover = () => assetItem.style.backgroundColor = 'rgba(255,255,255,0.05)';
                assetItem.onmouseout = () => assetItem.style.backgroundColor = 'transparent';
                assetItem.onclick = () => selectAsset(asset, type);
                
                assetItem.innerHTML = `
                    <img src="${asset.logo}" alt="${asset.symbol}" style="width: 24px; height: 24px; border-radius: 50%;">
                    <div>
                        <div style="font-weight: 600;">${asset.name}</div>
                        <div style="color: var(--gray); font-size: 0.8rem;">${asset.symbol}</div>
                    </div>
                `;
                assetListDiv.appendChild(assetItem);
            });
            
            document.getElementById('asset-pagination-info').textContent = 
                `${start + 1}-${Math.min(end, 30)} of 30`;
            document.getElementById('asset-prev').disabled = page === 1;
            document.getElementById('asset-next').disabled = page === Math.ceil(30 / itemsPerPage);
        }
        
        function selectAsset(asset, type) {
            if (type === 'from') {
                document.getElementById('from-asset-logo').src = asset.logo;
                document.getElementById('from-asset-symbol').textContent = asset.symbol;
            } else {
                document.getElementById('to-asset-logo').src = asset.logo;
                document.getElementById('to-asset-symbol').textContent = asset.symbol;
            }
            
            document.getElementById('asset-selector-modal').classList.remove('active');
            updateConversion();
        }
        
        async function performConversion() {
            const fromSymbol = document.getElementById('from-asset-symbol').textContent;
            const toSymbol = document.getElementById('to-asset-symbol').textContent;
            const fromAmount = parseFloat(document.getElementById('from-amount').value) || 0;
            const toAmount = parseFloat(document.getElementById('to-amount').value) || 0;
            
            // Check if converting from Main or Matured (Active cannot be converted)
            const fromAsset = assetList.find(a => a.symbol === fromSymbol);
            const fromPrice = exchangeRates[fromAsset.id]?.usd || (fromSymbol === 'BTC' ? currentBTCPrice : currentETHPrice);
            const fromUsdValue = fromAmount * fromPrice;
            
            // Determine which balance to deduct from (Main or Matured)
            let sourceBalance = 'main';
            if (fromUsdValue <= userBalances.main) {
                sourceBalance = 'main';
            } else if (fromUsdValue <= userBalances.matured) {
                sourceBalance = 'matured';
            } else {
                showNotification('error', 'Insufficient Balance', 'You do not have enough balance in Main or Matured accounts');
                return;
            }
            
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/convert', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        fromAsset: fromSymbol,
                        toAsset: toSymbol,
                        fromAmount: fromAmount,
                        toAmount: toAmount,
                        sourceBalance: sourceBalance,
                        rate: fromPrice / (exchangeRates[assetList.find(a => a.symbol === toSymbol).id]?.usd || currentETHPrice)
                    })
                });
                
                if (response.ok) {
                    showNotification('success', 'Conversion Successful', `Converted ${fromAmount} ${fromSymbol} to ${toAmount.toFixed(8)} ${toSymbol}`);
                    await loadBalances();
                } else {
                    throw new Error('Conversion failed');
                }
            } catch (error) {
                console.error('Error performing conversion:', error);
                showNotification('error', 'Conversion Failed', 'Please try again later');
            }
        }
        
        /* ============================================= */
        /* Asset Modal Functions */
        /* ============================================= */
        
        function openAssetModal(coin) {
            selectedAsset = coin;
            
            document.getElementById('modal-asset-logo').src = coin.image;
            document.getElementById('modal-asset-name').textContent = coin.name;
            document.getElementById('modal-asset-symbol').textContent = coin.symbol.toUpperCase();
            document.getElementById('modal-price').textContent = `$${formatNumber(coin.current_price)}`;
            document.getElementById('modal-change').textContent = `${coin.price_change_percentage_24h_in_currency?.toFixed(2) || '0.00'}%`;
            document.getElementById('modal-change').className = coin.price_change_percentage_24h_in_currency >= 0 ? 'price-positive' : 'price-negative';
            document.getElementById('modal-volume').textContent = `$${formatNumber(coin.total_volume)}`;
            document.getElementById('modal-market-cap').textContent = `$${formatNumber(coin.market_cap)}`;
            
            // Calculate user balance in this asset
            const price = coin.current_price;
            const balanceUsd = userBalances.main + userBalances.matured; // Only Main and Matured can be converted
            const balanceInAsset = balanceUsd / price;
            
            document.getElementById('modal-balance').textContent = balanceInAsset.toFixed(8);
            document.getElementById('modal-balance-usd').textContent = `$${formatNumberWithCommas(balanceUsd)}`;
            
            // Initialize modal convert
            document.getElementById('modal-from-logo').src = coin.image;
            document.getElementById('modal-from-symbol').textContent = coin.symbol.toUpperCase();
            document.getElementById('modal-from-balance').textContent = `Balance: ${balanceInAsset.toFixed(8)}`;
            
            document.getElementById('modal-to-logo').src = 'https://cryptologos.cc/logos/ethereum-eth-logo.png';
            document.getElementById('modal-to-symbol').textContent = 'ETH';
            document.getElementById('modal-to-balance').textContent = `Balance: ${(userBalances.main + userBalances.matured) / currentETHPrice} ETH`;
            
            // TradingView chart
            initTradingViewChart(coin.symbol.toUpperCase());
            
            document.getElementById('asset-modal').classList.add('active');
        }
        
        function initTradingViewChart(symbol) {
            const container = document.getElementById('tradingview-chart');
            container.innerHTML = '';
            
            if (typeof TradingView !== 'undefined') {
                new TradingView.widget({
                    container_id: 'tradingview-chart',
                    symbol: `BINANCE:${symbol}USDT`,
                    interval: 'D',
                    theme: 'dark',
                    style: '1',
                    locale: 'en',
                    toolbar_bg: '#0A0E17',
                    enable_publishing: false,
                    hide_top_toolbar: true,
                    hide_legend: true,
                    save_image: false,
                    height: 400,
                    width: '100%'
                });
            } else {
                container.innerHTML = '<p style="color: var(--gray); text-align: center;">Loading chart...</p>';
            }
        }
        
        /* ============================================= */
        /* Transaction Functions */
        /* ============================================= */
        
        async function loadTransactions() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/transactions', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const tableBody = document.getElementById('transactions-table');
                tableBody.innerHTML = '';
                
                if (response.ok) {
                    const data = await response.json();
                    const transactions = data.data?.transactions || data.transactions || [];
                    
                    if (transactions.length === 0) {
                        tableBody.innerHTML = `
                            <tr>
                                <td colspan="4" style="text-align: center; padding: 30px; color: var(--gray);">
                                    No transactions found
                                </td>
                            </tr>
                        `;
                        return;
                    }
                    
                    transactions.slice(0, 10).forEach(transaction => {
                        const row = document.createElement('tr');
                        row.className = 'transaction-row';
                        row.onclick = () => showTransactionDetails(transaction);
                        
                        const date = new Date(transaction.date || transaction.createdAt);
                        const formattedDate = date.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        let statusBadge = '';
                        if (transaction.status === 'completed') {
                            statusBadge = '<span class="status-badge success">Completed</span>';
                        } else if (transaction.status === 'pending') {
                            statusBadge = '<span class="status-badge pending">Processing</span>';
                        } else {
                            statusBadge = '<span class="status-badge failed">Failed</span>';
                        }
                        
                        row.innerHTML = `
                            <td>${formattedDate}</td>
                            <td>${transaction.type?.charAt(0).toUpperCase() + transaction.type?.slice(1) || 'Transaction'}</td>
                            <td>${transaction.type === 'deposit' || transaction.type === 'interest' ? '+' : '-'}$${formatNumberWithCommas(transaction.amount || 0)}</td>
                            <td>${statusBadge}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Error loading transactions:', error);
            }
        }
        
        function showTransactionDetails(transaction) {
            const content = document.getElementById('transaction-details-content');
            const date = new Date(transaction.date || transaction.createdAt);
            
            content.innerHTML = `
                <div style="padding: 10px;">
                    <div style="display: grid; gap: 15px;">
                        <div style="display: flex; justify-content: space-between; padding: 10px; background-color: var(--light); border-radius: var(--border-radius);">
                            <span style="color: var(--gray);">Transaction ID</span>
                            <span style="font-family: monospace;">${transaction.id || 'N/A'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px; background-color: var(--light); border-radius: var(--border-radius);">
                            <span style="color: var(--gray);">Date & Time</span>
                            <span>${date.toLocaleString()}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px; background-color: var(--light); border-radius: var(--border-radius);">
                            <span style="color: var(--gray);">Type</span>
                            <span>${transaction.type || 'Transaction'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px; background-color: var(--light); border-radius: var(--border-radius);">
                            <span style="color: var(--gray);">Amount</span>
                            <span class="${transaction.type === 'deposit' || transaction.type === 'interest' ? 'price-positive' : 'price-negative'}">
                                ${transaction.type === 'deposit' || transaction.type === 'interest' ? '+' : '-'}$${formatNumberWithCommas(transaction.amount || 0)}
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px; background-color: var(--light); border-radius: var(--border-radius);">
                            <span style="color: var(--gray);">Status</span>
                            <span class="status-badge ${transaction.status === 'completed' ? 'success' : transaction.status === 'pending' ? 'pending' : 'failed'}">
                                ${transaction.status || 'pending'}
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px; background-color: var(--light); border-radius: var(--border-radius);">
                            <span style="color: var(--gray);">Description</span>
                            <span>${transaction.description || 'No description'}</span>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('transaction-modal').classList.add('active');
        }
        
        /* ============================================= */
        /* Modal Initialization */
        /* ============================================= */
        
        function initializeModals() {
            // Asset modal close
            document.getElementById('asset-modal-close').addEventListener('click', () => {
                document.getElementById('asset-modal').classList.remove('active');
            });
            
            // Transaction modal close
            document.getElementById('transaction-modal-close').addEventListener('click', () => {
                document.getElementById('transaction-modal').classList.remove('active');
            });
            
            // Asset selector modal close
            document.getElementById('asset-selector-close').addEventListener('click', () => {
                document.getElementById('asset-selector-modal').classList.remove('active');
            });
            
            // Asset selector pagination
            let assetPage = 1;
            document.getElementById('asset-prev').addEventListener('click', () => {
                if (assetPage > 1) {
                    assetPage--;
                    renderAssetList(assetPage, window.currentSelectorType);
                }
            });
            
            document.getElementById('asset-next').addEventListener('click', () => {
                if (assetPage < Math.ceil(30 / itemsPerPage)) {
                    assetPage++;
                    renderAssetList(assetPage, window.currentSelectorType);
                }
            });
            
            // Asset search
            document.getElementById('asset-search').addEventListener('input', (e) => {
                const search = e.target.value.toLowerCase();
                const filtered = assetList.filter(a => 
                    a.name.toLowerCase().includes(search) || 
                    a.symbol.toLowerCase().includes(search)
                );
                // Render filtered list (simplified for demo)
            });
            
            // Modal convert
            document.getElementById('modal-swap').addEventListener('click', () => {
                const fromSymbol = document.getElementById('modal-from-symbol').textContent;
                const toSymbol = document.getElementById('modal-to-symbol').textContent;
                const fromLogo = document.getElementById('modal-from-logo').src;
                const toLogo = document.getElementById('modal-to-logo').src;
                
                document.getElementById('modal-from-symbol').textContent = toSymbol;
                document.getElementById('modal-to-symbol').textContent = fromSymbol;
                document.getElementById('modal-from-logo').src = toLogo;
                document.getElementById('modal-to-logo').src = fromLogo;
            });
            
            document.getElementById('modal-from-amount').addEventListener('input', updateModalConversion);
            document.getElementById('modal-convert-btn').addEventListener('click', performModalConversion);
            
            // Crypto pagination
            document.getElementById('crypto-prev').addEventListener('click', () => {
                if (currentCryptoPage > 1) {
                    currentCryptoPage--;
                    renderCryptoTable();
                }
            });
            
            document.getElementById('crypto-next').addEventListener('click', () => {
                if (currentCryptoPage < Math.ceil(30 / itemsPerPage)) {
                    currentCryptoPage++;
                    renderCryptoTable();
                }
            });
            
            // Asset preference selector
            document.getElementById('asset-preference-selector').addEventListener('click', () => {
                window.currentSelectorType = 'preference';
                renderAssetList(1, 'preference');
                document.getElementById('asset-selector-modal').classList.add('active');
            });
        }
        
        function updateModalConversion() {
            const fromAmount = parseFloat(document.getElementById('modal-from-amount').value) || 0;
            const fromSymbol = document.getElementById('modal-from-symbol').textContent;
            const toSymbol = document.getElementById('modal-to-symbol').textContent;
            
            const fromAsset = assetList.find(a => a.symbol === fromSymbol);
            const toAsset = assetList.find(a => a.symbol === toSymbol);
            
            const fromPrice = exchangeRates[fromAsset.id]?.usd || (fromSymbol === 'BTC' ? currentBTCPrice : currentETHPrice);
            const toPrice = exchangeRates[toAsset.id]?.usd || (toSymbol === 'BTC' ? currentBTCPrice : currentETHPrice);
            
            const fromUsdValue = fromAmount * fromPrice;
            const toAmount = fromUsdValue / toPrice;
            
            document.getElementById('modal-to-amount').value = toAmount.toFixed(8);
        }
        
        async function performModalConversion() {
            const fromSymbol = document.getElementById('modal-from-symbol').textContent;
            const toSymbol = document.getElementById('modal-to-symbol').textContent;
            const fromAmount = parseFloat(document.getElementById('modal-from-amount').value) || 0;
            const toAmount = parseFloat(document.getElementById('modal-to-amount').value) || 0;
            
            const fromAsset = assetList.find(a => a.symbol === fromSymbol);
            const fromPrice = exchangeRates[fromAsset.id]?.usd || (fromSymbol === 'BTC' ? currentBTCPrice : currentETHPrice);
            const fromUsdValue = fromAmount * fromPrice;
            
            let sourceBalance = 'main';
            if (fromUsdValue <= userBalances.main) {
                sourceBalance = 'main';
            } else if (fromUsdValue <= userBalances.matured) {
                sourceBalance = 'matured';
            } else {
                showNotification('error', 'Insufficient Balance', 'You do not have enough balance in Main or Matured accounts');
                return;
            }
            
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/convert', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        fromAsset: fromSymbol,
                        toAsset: toSymbol,
                        fromAmount: fromAmount,
                        toAmount: toAmount,
                        sourceBalance: sourceBalance,
                        rate: fromPrice / (exchangeRates[assetList.find(a => a.symbol === toSymbol).id]?.usd || currentETHPrice)
                    })
                });
                
                if (response.ok) {
                    showNotification('success', 'Conversion Successful', `Converted ${fromAmount} ${fromSymbol} to ${toAmount.toFixed(8)} ${toSymbol}`);
                    await loadBalances();
                    document.getElementById('asset-modal').classList.remove('active');
                } else {
                    throw new Error('Conversion failed');
                }
            } catch (error) {
                console.error('Error performing conversion:', error);
                showNotification('error', 'Conversion Failed', 'Please try again later');
            }
        }
        
        /* ============================================= */
        /* Authentication Functions */
        /* ============================================= */
        
        async function checkAuthState() {
            try {
                const token = localStorage.getItem('jwtToken');
                if (!token) {
                    document.getElementById('auth-buttons').style.display = 'flex';
                    document.getElementById('user-balance').style.display = 'none';
                    window.location.href = 'login.html';
                    return;
                }
                
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/users/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const user = data.data?.user || data.user;
                    
                    document.getElementById('auth-buttons').style.display = 'none';
                    document.getElementById('user-balance').style.display = 'flex';
                } else {
                    localStorage.removeItem('jwtToken');
                    document.getElementById('auth-buttons').style.display = 'flex';
                    document.getElementById('user-balance').style.display = 'none';
                    window.location.href = 'login.html';
                }
            } catch (error) {
                console.error('Authentication check failed:', error);
                localStorage.removeItem('jwtToken');
                document.getElementById('auth-buttons').style.display = 'flex';
                document.getElementById('user-balance').style.display = 'none';
                window.location.href = 'login.html';
            }
        }
        
        async function loadUserData() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/users/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const user = data.data?.user || data.user;
                    if (user) {
                        const displayName = user.firstName || user.email?.split('@')[0] || 'Miner';
                        document.getElementById('username').textContent = displayName;
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }
        
        async function loadInvestments() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/investments/active', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const tableBody = document.getElementById('investments-table');
                tableBody.innerHTML = '';
                
                if (response.ok) {
                    const data = await response.json();
                    const investments = data.data?.investments || data.investments || [];
                    
                    if (investments.length === 0) {
                        tableBody.innerHTML = `
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 30px; color: var(--gray);">
                                    <i class="fas fa-wallet" style="font-size: 2rem; margin-bottom: 10px;"></i>
                                    <p>No active cloud mining contracts</p>
                                    <button class="btn btn-outline" onclick="window.location.href='index.html#plans'" style="margin-top: 10px;">
                                        Start Cloud Mining
                                    </button>
                                </td>
                            </tr>
                        `;
                        return;
                    }
                    
                    investments.forEach(investment => {
                        const row = document.createElement('tr');
                        const maturityDate = new Date(investment.endDate || investment.maturityDate);
                        const hoursLeft = Math.max(0, Math.ceil((maturityDate - new Date()) / (1000 * 60 * 60)));
                        
                        row.innerHTML = `
                            <td>${investment.planName || 'Cloud Mining Plan'}</td>
                            <td>$${formatNumberWithCommas(investment.amount || 0)}</td>
                            <td>${investment.durationHours || 0} hours</td>
                            <td>${getHourlyROIByPlan(investment.planName)}%</td>
                            <td>${maturityDate.toLocaleDateString()}</td>
                            <td>
                                <span class="status-badge ${investment.status === 'active' ? 'success' : 'pending'}">
                                    ${investment.status === 'active' ? `${hoursLeft}h left` : 'Pending'}
                                </span>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Error loading investments:', error);
                showNotification('error', 'Data Error', 'Failed to load investments');
            }
        }
        
        function getHourlyROIByPlan(planName) {
            if (!planName) return 12;
            const normalized = planName.toLowerCase();
            if (normalized.includes('expert')) return 50;
            if (normalized.includes('exclusive')) return 40;
            if (normalized.includes('advance')) return 35;
            if (normalized.includes('gold')) return 20;
            return 12;
        }
        
        async function loadReferralData() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/referrals', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const referralData = data.data || data;
                    
                    document.getElementById('referral-link-text').textContent = referralData.referralLink || 'Not available';
                    document.getElementById('referral-count').textContent = referralData.totalReferrals || 0;
                    document.getElementById('referral-earnings').textContent = `$${formatNumberWithCommas(referralData.totalEarnings || 0)}`;
                    document.getElementById('referral-pending').textContent = `$${formatNumberWithCommas(referralData.pendingEarnings || 0)}`;
                }
            } catch (error) {
                console.error('Error loading referral data:', error);
            }
        }
        
        function copyReferralLink() {
            const referralLink = document.getElementById('referral-link-text').textContent;
            navigator.clipboard.writeText(referralLink).then(() => {
                const copyBtn = document.getElementById('copy-btn');
                copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                setTimeout(() => {
                    copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy';
                }, 2000);
                
                showNotification('success', 'Copied!', 'Referral link copied to clipboard');
            });
        }
        
        /* ============================================= */
        /* Loan Functions */
        /* ============================================= */
        
        async function checkLoanEligibility() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/loans/check-eligibility', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        requestedAmount: 1000
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentLoanEligibility = data;
                    
                    updateLoanDisplay(data);
                }
            } catch (error) {
                console.error('Error checking loan eligibility:', error);
            }
        }
        
        function updateLoanDisplay(eligibilityData) {
            const termsDisplay = document.getElementById('loan-terms-display');
            const eligibilityStatus = document.getElementById('loan-eligibility-status');
            const applyButton = document.getElementById('loan-application-btn');
            
            if (!eligibilityData) {
                termsDisplay.innerHTML = '<p>Loading loan information...</p>';
                return;
            }
            
            termsDisplay.innerHTML = `
                <div class="loan-term-item">
                    <div class="loan-term-label">Maximum Loan Amount</div>
                    <div class="loan-term-value">$${formatNumberWithCommas(eligibilityData.maxLoanAmount || 0)}</div>
                </div>
                <div class="loan-term-item">
                    <div class="loan-term-label">Monthly Interest Rate</div>
                    <div class="loan-term-value">${eligibilityData.monthlyInterest || 9.99}%</div>
                </div>
                <div class="loan-term-item">
                    <div class="loan-term-label">Credit Score</div>
                    <div class="loan-term-value">${eligibilityData.creditScore || 0}</div>
                </div>
                <div class="loan-term-item">
                    <div class="loan-term-label">Disbursement Fee</div>
                    <div class="loan-term-value">${eligibilityData.disbursementFee || 0.99}%</div>
                </div>
            `;
            
            if (eligibilityData.eligible) {
                eligibilityStatus.innerHTML = `
                    <div class="eligibility-item">
                        <div class="eligibility-icon verified">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="eligibility-text">
                            <strong>Congratulations! You qualify for a loan.</strong>
                        </div>
                    </div>
                `;
                applyButton.disabled = false;
                applyButton.innerHTML = '<i class="fas fa-file-contract"></i> Apply for Loan';
            } else {
                eligibilityStatus.innerHTML = `
                    <div class="eligibility-item">
                        <div class="eligibility-icon pending">
                            <i class="fas fa-times"></i>
                        </div>
                        <div class="eligibility-text">
                            <strong>Not Currently Eligible:</strong> ${eligibilityData.reason || 'Requirements not met'}
                        </div>
                    </div>
                `;
                applyButton.disabled = true;
                applyButton.innerHTML = '<i class="fas fa-lock"></i> Not Eligible';
            }
            
            const modalTerms = document.getElementById('modal-loan-terms');
            if (modalTerms) {
                modalTerms.innerHTML = termsDisplay.innerHTML;
            }
        }
        
        function initializeLoanApplicationModal() {
            const modal = document.getElementById('loan-application-modal');
            const closeBtn = document.getElementById('loan-application-close');
            const submitBtn = document.getElementById('submit-loan-application');
            
            closeBtn.addEventListener('click', closeLoanApplicationModal);
            
            modal.addEventListener('click', function(event) {
                if (event.target === modal) {
                    closeLoanApplicationModal();
                }
            });
            
            submitBtn.addEventListener('click', submitLoanApplication);
        }
        
        function openLoanApplication() {
            if (!currentLoanEligibility || !currentLoanEligibility.eligible) {
                showNotification('error', 'Not Eligible', 'You do not meet the eligibility criteria for a loan');
                return;
            }
            
            const modal = document.getElementById('loan-application-modal');
            const amountInput = document.getElementById('loan-request-amount');
            const modalTerms = document.getElementById('modal-loan-terms');
            
            amountInput.value = currentLoanEligibility.maxLoanAmount || 0;
            modalTerms.innerHTML = document.getElementById('loan-terms-display').innerHTML;
            
            document.getElementById('loan-application-form').style.display = 'block';
            document.getElementById('loan-success-message').style.display = 'none';
            document.getElementById('loan-application-status').textContent = '';
            
            modal.classList.add('active');
        }
        
        function closeLoanApplicationModal() {
            const modal = document.getElementById('loan-application-modal');
            modal.classList.remove('active');
        }
        
        async function submitLoanApplication() {
            try {
                const token = localStorage.getItem('jwtToken');
                const amountInput = document.getElementById('loan-request-amount');
                const purposeSelect = document.getElementById('loan-purpose');
                const termSelect = document.getElementById('loan-term-selection');
                const statusElement = document.getElementById('loan-application-status');
                const submitBtn = document.getElementById('submit-loan-application');
                
                const amount = parseFloat(amountInput.value);
                const purpose = purposeSelect.value;
                const term = parseInt(termSelect.value);
                
                if (!amount || amount < 1000) {
                    showNotification('error', 'Invalid Amount', 'Minimum loan amount is $1,000');
                    return;
                }
                
                if (amount > (currentLoanEligibility?.maxLoanAmount || 0)) {
                    showNotification('error', 'Amount Exceeds Limit', `Maximum loan amount is $${formatNumberWithCommas(currentLoanEligibility?.maxLoanAmount || 0)}`);
                    return;
                }
                
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                statusElement.textContent = 'Submitting your loan application...';
                statusElement.style.color = 'var(--primary)';
                
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/loans/apply', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        amount: amount,
                        purpose: purpose,
                        term: term,
                        interestRate: currentLoanEligibility?.monthlyInterest || 9.99,
                        disbursementFee: currentLoanEligibility?.disbursementFee || 0.99,
                        maxAmount: currentLoanEligibility?.maxLoanAmount || 0,
                        eligibilityData: currentLoanEligibility
                    })
                });
                
                if (response.ok) {
                    document.getElementById('loan-application-form').style.display = 'none';
                    document.getElementById('loan-success-message').style.display = 'block';
                    
                    showNotification('success', 'Application Submitted', 
                        `Your loan application for $${formatNumberWithCommas(amount)} has been submitted successfully.`);
                    
                    setTimeout(() => {
                        loadBalances();
                        checkLoanEligibility();
                    }, 2000);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to submit loan application');
                }
            } catch (error) {
                console.error('Error submitting loan application:', error);
                
                const submitBtn = document.getElementById('submit-loan-application');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Loan Application';
                
                const statusElement = document.getElementById('loan-application-status');
                statusElement.textContent = error.message || 'Failed to submit application';
                statusElement.style.color = 'var(--error)';
                
                showNotification('error', 'Application Failed', error.message || 'There was an issue submitting your loan application');
            }
        }
        
        function refreshTransactions() {
            loadTransactions();
            showNotification('info', 'Refreshing', 'Updating transaction history...');
        }
        
        /* ============================================= */
        /* Announcement System */
        /* ============================================= */
        
        function startAnnouncementsPolling() {
            setInterval(async () => {
                await checkAnnouncements();
            }, 30000);
            
            checkAnnouncements();
        }
        
        async function checkAnnouncements() {
            try {
                const token = localStorage.getItem('jwtToken');
                const response = await fetch('https://website-backendd-tzep.onrender.com/api/announcements', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const announcements = data.data || [];
                    
                    const newAnnouncements = announcements.filter(announcement => 
                        !AppState.activeAnnouncements.has(announcement.id) && 
                        !isAnnouncementDismissed(announcement.id)
                    );
                    
                    if (newAnnouncements.length > 0) {
                        clearAllAnnouncements();
                        
                        const announcement = newAnnouncements[0];
                        showAnnouncement(announcement);
                        AppState.activeAnnouncements.set(announcement.id, announcement);
                        
                        localStorage.setItem('activeAnnouncement', JSON.stringify(announcement));
                    }
                    
                    const activeIds = announcements.map(a => a.id);
                    for (const [id, announcement] of AppState.activeAnnouncements.entries()) {
                        if (!activeIds.includes(id)) {
                            removeAnnouncement(id);
                        }
                    }
                }
            } catch (error) {
                console.error('Error checking announcements:', error);
                const storedAnnouncement = localStorage.getItem('activeAnnouncement');
                if (storedAnnouncement && !document.querySelector('.announcement.show')) {
                    try {
                        const announcement = JSON.parse(storedAnnouncement);
                        if (!isAnnouncementDismissed(announcement.id)) {
                            showAnnouncement(announcement);
                            AppState.activeAnnouncements.set(announcement.id, announcement);
                        }
                    } catch (e) {
                        console.error('Error loading stored announcement:', e);
                    }
                }
            }
        }
        
        function isAnnouncementDismissed(announcementId) {
            const dismissedAnnouncements = JSON.parse(localStorage.getItem('dismissedAnnouncements') || '[]');
            return dismissedAnnouncements.includes(announcementId);
        }
        
        function dismissAnnouncement(announcementId) {
            const dismissedAnnouncements = JSON.parse(localStorage.getItem('dismissedAnnouncements') || '[]');
            if (!dismissedAnnouncements.includes(announcementId)) {
                dismissedAnnouncements.push(announcementId);
                localStorage.setItem('dismissedAnnouncements', JSON.stringify(dismissedAnnouncements));
            }
        }
        
        function showAnnouncement(announcement) {
            const announcementCenter = document.getElementById('announcement-center');
            if (!announcementCenter) return;
            
            const announcementEl = document.createElement('div');
            announcementEl.className = 'announcement';
            announcementEl.id = `announcement-${announcement.id}`;
            
            let type = 'info';
            let icon = 'fa-bullhorn';
            
            if (announcement.type === 'success') {
                type = 'success';
                icon = 'fa-check-circle';
            } else if (announcement.type === 'error' || announcement.priority === 'high') {
                type = 'error';
                icon = 'fa-exclamation-circle';
            } else if (announcement.type === 'warning') {
                type = 'warning';
                icon = 'fa-exclamation-triangle';
            }
            
            announcementEl.classList.add(type);
            
            const announcementDate = announcement.createdAt ? formatDate(announcement.createdAt) : '';
            
            announcementEl.innerHTML = `
                <i class="fas ${icon}"></i>
                <div class="announcement-content">
                    <div class="announcement-title">${announcement.title || 'Announcement'}</div>
                    <div class="announcement-message">${announcement.message || ''}</div>
                    <div class="announcement-meta">
                        <span class="announcement-sender">${announcement.sender || 'BitHash Support'}</span>
                        <span class="announcement-date">${announcementDate}</span>
                    </div>
                </div>
                <button class="announcement-close" title="Dismiss this announcement">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            announcementCenter.appendChild(announcementEl);
            
            const closeButton = announcementEl.querySelector('.announcement-close');
            closeButton.addEventListener('click', function() {
                dismissAnnouncement(announcement.id);
                removeAnnouncement(announcement.id);
            });
            
            void announcementEl.offsetWidth;
            announcementEl.classList.add('show');
            
            if ('vibrate' in navigator && type === 'error') {
                navigator.vibrate([200, 100, 200]);
            }
        }
        
        function clearAllAnnouncements() {
            const announcementCenter = document.getElementById('announcement-center');
            if (!announcementCenter) return;
            
            const announcements = announcementCenter.querySelectorAll('.announcement');
            announcements.forEach(announcement => {
                announcement.classList.remove('show');
                setTimeout(() => {
                    if (announcement.parentNode) {
                        announcement.parentNode.removeChild(announcement);
                    }
                }, 400);
            });
        }
        
        function removeAnnouncement(announcementId) {
            const announcementEl = document.getElementById(`announcement-${announcementId}`);
            if (!announcementEl) return;
            
            announcementEl.classList.remove('show');
            
            setTimeout(() => {
                if (announcementEl.parentNode) {
                    announcementEl.parentNode.removeChild(announcementEl);
                }
                AppState.activeAnnouncements.delete(announcementId);
                
                const storedAnnouncement = localStorage.getItem('activeAnnouncement');
                if (storedAnnouncement) {
                    const parsedAnnouncement = JSON.parse(storedAnnouncement);
                    if (parsedAnnouncement.id === announcementId) {
                        localStorage.removeItem('activeAnnouncement');
                    }
                }
            }, 400);
        }
        
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }
        
        /* ============================================= */
        /* Notification System */
        /* ============================================= */
        
        const notificationQueue = [];
        let isNotificationShowing = false;
        
        function showNotification(type, title, message, duration = 5000) {
            notificationQueue.push({ type, title, message, duration });
            
            if (!isNotificationShowing) {
                processNotificationQueue();
            }
        }
        
        function processNotificationQueue() {
            if (notificationQueue.length === 0) {
                isNotificationShowing = false;
                return;
            }
            
            isNotificationShowing = true;
            const { type, title, message, duration } = notificationQueue.shift();
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = type === 'error' ? 'fa-exclamation-circle' : 
                        type === 'success' ? 'fa-check-circle' : 
                        type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
            
            notification.innerHTML = `
                <i class="fas ${icon}"></i>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <div class="notification-close">&times;</div>
            `;
            
            const notificationCenter = document.getElementById('notification-center');
            notificationCenter.appendChild(notification);
            
            void notification.offsetWidth;
            notification.classList.add('show');
            
            if ('vibrate' in navigator && type === 'error') {
                navigator.vibrate([200, 100, 200]);
            }
            
            notification.querySelector('.notification-close').addEventListener('click', () => {
                closeNotification(notification);
            });
            
            if (duration > 0) {
                setTimeout(() => {
                    if (notification.parentNode) {
                        closeNotification(notification);
                    }
                    
                    processNotificationQueue();
                }, duration);
            }
        }
        
        function closeNotification(notification) {
            notification.classList.remove('show');
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
                
                processNotificationQueue();
            }, 400);
        }
        
        function logout() {
            localStorage.removeItem('jwtToken');
            window.location.href = 'logout.html';
        }
        
        // Auto-refresh data every 60 seconds
        setInterval(() => {
            fetchAllPrices();
            loadBalances();
            loadInvestments();
            renderCryptoTable();
        }, 60000);
    </script>
</body>
</html>
