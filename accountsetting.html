<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bithash | Account Settings</title>
    <meta name="description" content="Manage your Bithash account settings, security preferences, and personal information.">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rowdies:wght@300;400;700&family=Inter:wght@300;400;500;600;700&family=Manrope:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" type="image/png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #93c5fd;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --dark: #1e293b;
            --darker: #0f172a;
            --light: #f8fafc;
            --lighter: #ffffff;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --gray-lighter: #f1f5f9;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --gold: #D4AF37;
            --gold-light: #FFD700;
            --gold-dark: #996515;
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
            --box-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.03);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Dark mode variables */
        [data-theme="dark"] {
            --dark: #e2e8f0;
            --darker: #f8fafc;
            --light: #1e293b;
            --lighter: #0f172a;
            --gray: #94a3b8;
            --gray-light: #334155;
            --gray-lighter: #1e293b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            overflow-x: hidden;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: var(--dark);
            background-color: var(--light);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            position: relative;
            transition: var(--transition-slow);
        }
        
        /* Loading animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--light);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loading-logo {
            width: 80px;
            height: 80px;
            animation: pulse 1.5s infinite ease-in-out;
        }
        
        .loading-text {
            margin-top: 20px;
            font-weight: 500;
            color: var(--gray);
            font-size: 1rem;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(0.95); opacity: 0.8; }
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
        }
        
        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Manrope', sans-serif;
            font-weight: 700;
            line-height: 1.2;
            color: var(--darker);
        }
        
        p {
            margin-bottom: 1rem;
            color: var(--gray);
        }
        
        a {
            color: var(--primary);
            text-decoration: none;
            transition: var(--transition);
        }
        
        a:hover {
            color: var(--primary-dark);
        }
        
        /* Header Styles */
        header {
            background-color: var(--lighter);
            box-shadow: var(--box-shadow);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            padding: 15px 0;
            transition: var(--transition-slow);
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        header.scrolled {
            padding: 10px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo img {
            height: 40px;
            width: auto;
            transition: var(--transition);
        }
        
        .logo-text {
            font-family: 'Rowdies', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--gold);
            transition: var(--transition);
        }
        
        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--dark);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            z-index: 1001;
        }
        
        nav {
            transition: var(--transition-slow);
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }
        
        nav a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            font-size: 0.95rem;
            padding: 5px 0;
        }
        
        nav a:hover {
            color: var(--gold);
        }
        
        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--gold);
            transition: var(--transition);
        }
        
        nav a:hover::after {
            width: 100%;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .btn-primary {
            background-color: var(--gold);
            color: var(--darker);
        }
        
        .btn-primary:hover {
            background-color: var(--gold-dark);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow-lg);
            color: white;
        }
        
        .btn-outline {
            background-color: transparent;
            color: var(--gold);
            border: 1px solid var(--gold);
        }
        
        .btn-outline:hover {
            background-color: var(--gold);
            color: var(--darker);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow-lg);
        }
        
        .btn-danger {
            background-color: var(--error);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
            box-shadow: var(--box-shadow-lg);
        }
        
        /* Settings Section */
        .settings-section {
            padding: 160px 0 80px;
            background-color: var(--light);
            min-height: 100vh;
        }
        
        .settings-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 40px;
        }
        
        .settings-sidebar {
            position: sticky;
            top: 120px;
            height: fit-content;
        }
        
        .settings-nav {
            background-color: var(--lighter);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        .settings-nav-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-light);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--gray);
        }
        
        .settings-nav-item:last-child {
            border-bottom: none;
        }
        
        .settings-nav-item:hover {
            color: var(--gold);
            background-color: rgba(212, 175, 55, 0.05);
        }
        
        .settings-nav-item.active {
            color: var(--gold);
            background-color: rgba(212, 175, 55, 0.1);
            border-left: 3px solid var(--gold);
        }
        
        .settings-nav-item i {
            width: 20px;
            text-align: center;
        }
        
        .settings-content {
            background-color: var(--lighter);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow);
            padding: 40px;
        }
        
        .settings-section-title {
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: var(--darker);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .settings-section-title i {
            color: var(--gold);
        }
        
        /* Settings Card */
        .settings-card {
            margin-bottom: 40px;
            border-bottom: 1px solid var(--gray-light);
            padding-bottom: 40px;
        }
        
        .settings-card:last-child {
            margin-bottom: 0;
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .settings-card-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--darker);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-card-title i {
            color: var(--gold);
            font-size: 1.2rem;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--gray-lighter);
            color: var(--dark);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
            background-color: var(--lighter);
        }
        
        .form-control.error {
            border-color: var(--error);
        }
        
        .form-control.success {
            border-color: var(--success);
        }
        
        .form-feedback {
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
        }
        
        .form-feedback.error {
            color: var(--error);
            display: block;
        }
        
        .form-feedback.success {
            color: var(--success);
            display: block;
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 38px;
            color: var(--gray);
            cursor: pointer;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-submit {
            width: auto;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 10px;
        }
        
        /* Referral Section */
        .referral-container {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            margin-bottom: 30px;
        }
        
        .referral-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--darker);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .referral-title i {
            color: var(--gold);
        }
        
        .referral-description {
            margin-bottom: 20px;
            color: var(--gray);
        }
        
        .referral-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .referral-stat {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            box-shadow: var(--box-shadow);
        }
        
        .referral-stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 5px;
        }
        
        .referral-stat-label {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .referral-link-container {
            display: flex;
            margin-bottom: 25px;
        }
        
        .referral-link-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius) 0 0 var(--border-radius);
            background-color: var(--gray-lighter);
            color: var(--dark);
            font-size: 0.9rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .referral-link-btn {
            padding: 12px 20px;
            background-color: var(--gold);
            color: var(--darker);
            border: none;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .referral-link-btn:hover {
            background-color: var(--gold-dark);
            color: white;
        }
        
        .referral-history {
            margin-top: 30px;
        }
        
        .referral-history-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--darker);
        }
        
        .referral-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .referral-table th {
            text-align: left;
            padding: 12px 15px;
            background-color: rgba(212, 175, 55, 0.1);
            color: var(--darker);
            font-weight: 600;
        }
        
        .referral-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--gray-light);
            color: var(--gray);
        }
        
        .referral-table tr:last-child td {
            border-bottom: none;
        }
        
        .referral-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .referral-status.active {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .referral-status.pending {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .theme-toggle-label {
            font-weight: 500;
            color: var(--dark);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray-light);
            transition: var(--transition-slow);
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition-slow);
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--gold);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .toggle-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 0.8rem;
        }
        
        .toggle-icon.sun {
            left: 8px;
            display: none;
        }
        
        .toggle-icon.moon {
            right: 8px;
        }
        
        [data-theme="dark"] .toggle-icon.sun {
            display: block;
        }
        
        [data-theme="dark"] .toggle-icon.moon {
            display: none;
        }
        
        /* KYC Section */
        .kyc-status {
            display: inline-block;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .kyc-status.pending {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        .kyc-status.approved {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .kyc-status.rejected {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }
        
        .kyc-upload {
            border: 2px dashed var(--gray-light);
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .kyc-upload:hover {
            border-color: var(--gold);
        }
        
        .kyc-upload-icon {
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 10px;
        }
        
        .kyc-upload-text {
            margin-bottom: 15px;
            color: var(--gray);
        }
        
        .kyc-upload-hint {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .kyc-document-preview {
            margin-top: 20px;
            display: none;
        }
        
        .kyc-document-preview img {
            max-width: 100%;
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-light);
        }
        
        /* 2FA Section */
        .twofa-status {
            display: inline-block;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .twofa-status.enabled {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .twofa-status.disabled {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }
        
        .twofa-setup {
            background-color: var(--gray-lighter);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-top: 20px;
            display: none;
        }
        
        .twofa-qr-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .twofa-qr-code {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            background-color: white;
            padding: 10px;
            border-radius: var(--border-radius);
        }
        
        .twofa-recovery-codes {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
        }
        
        .twofa-recovery-codes-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--darker);
        }
        
        .twofa-recovery-codes-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-family: monospace;
            margin-bottom: 15px;
        }
        
        /* Notification Preferences */
        .notification-preference {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .notification-preference:last-child {
            border-bottom: none;
        }
        
        .notification-preference-label {
            font-weight: 500;
            color: var(--dark);
        }
        
        .notification-toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .notification-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .notification-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray-light);
            transition: var(--transition);
            border-radius: 34px;
        }
        
        .notification-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }
        
        input:checked + .notification-slider {
            background-color: var(--gold);
        }
        
        input:checked + .notification-slider:before {
            transform: translateX(26px);
        }
        
        /* Security Log */
        .security-log-item {
            display: flex;
            padding: 15px 0;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .security-log-item:last-child {
            border-bottom: none;
        }
        
        .security-log-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(212, 175, 55, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gold);
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .security-log-content {
            flex: 1;
        }
        
        .security-log-title {
            font-weight: 600;
            color: var(--darker);
            margin-bottom: 5px;
        }
        
        .security-log-details {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Deactivation Section */
        .deactivation-warning {
            background-color: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--error);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
        }
        
        .deactivation-warning-title {
            font-weight: 600;
            color: var(--error);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .deactivation-warning-text {
            color: var(--gray);
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-slow);
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: var(--lighter);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            box-shadow: var(--box-shadow-lg);
            transform: translateY(20px);
            transition: var(--transition-slow);
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--darker);
        }
        
        .modal-body {
            margin-bottom: 30px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* Notification Popups */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 350px;
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            padding: 20px;
            display: flex;
            gap: 15px;
            z-index: 1001;
            opacity: 0;
            transform: translateY(-20px);
            transition: var(--transition);
            border-left: 4px solid var(--error);
        }
        
        .notification.success {
            border-left-color: var(--success);
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            background-color: var(--error);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
            font-size: 1.2rem;
        }
        
        .notification.success .notification-icon {
            background-color: var(--success);
        }
        
        .notification-content h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--darker);
        }
        
        .notification-content p {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 0;
        }
        
        .notification-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1rem;
        }
        
        /* Footer */
        footer {
            background-color: var(--darker);
            color: white;
            padding: 40px 0 20px;
        }
        
        .footer-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .footer-logo img {
            height: 30px;
            width: auto;
        }
        
        .footer-logo-text {
            font-family: 'Rowdies', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            color: white;
        }
        
        .footer-about p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        .footer-social {
            display: flex;
            gap: 12px;
        }
        
        .social-icon {
            width: 38px;
            height: 38px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            color: white;
        }
        
        .social-icon.twitter { background-color: #1DA1F2; }
        .social-icon.linkedin { background-color: #0077B5; }
        .social-icon.facebook { background-color: #4267B2; }
        .social-icon.instagram { 
            background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
        }
        
        .social-icon:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }
        
        .footer-title {
            font-weight: 700;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .footer-links ul {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .footer-links a:hover {
            color: var(--gold);
            padding-left: 5px;
        }
        
        .footer-contact p {
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .footer-contact i {
            color: var(--gold);
            width: 20px;
            text-align: center;
        }
        
        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
        }
        
        /* Responsive Styles */
        @media (max-width: 1024px) {
            .settings-container {
                grid-template-columns: 220px 1fr;
                gap: 30px;
            }
            
            .referral-stats {
                grid-template-columns: 1fr 1fr;
            }
            
            .footer-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 30px;
            }
        }
        
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            nav {
                position: fixed;
                top: 80px;
                left: 0;
                width: 100%;
                background-color: var(--lighter);
                box-shadow: var(--box-shadow);
                padding: 20px;
                transform: translateY(-150%);
                opacity: 0;
            }
            
            nav.active {
                transform: translateY(0);
                opacity: 1;
            }
            
            nav ul {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-container {
                flex-wrap: wrap;
            }
            
            .settings-section {
                padding: 140px 0 60px;
            }
            
            .settings-container {
                grid-template-columns: 1fr;
            }
            
            .settings-sidebar {
                position: static;
                margin-bottom: 30px;
            }
            
            .settings-content {
                padding: 30px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .referral-stats {
                grid-template-columns: 1fr;
            }
            
            .twofa-recovery-codes-list {
                grid-template-columns: 1fr;
            }
            
            .footer-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .settings-content {
                padding: 20px 15px;
            }
            
            .settings-section-title {
                font-size: 1.5rem;
            }
            
            .settings-card-title {
                font-size: 1.2rem;
            }
            
            .referral-link-container {
                flex-direction: column;
            }
            
            .referral-link-input {
                border-radius: var(--border-radius) var(--border-radius) 0 0;
            }
            
            .referral-link-btn {
                border-radius: 0 0 var(--border-radius) var(--border-radius);
            }
            
            .modal {
                padding: 20px;
                margin: 0 15px;
            }
            
            .modal-footer {
                flex-direction: column;
            }
            
            .modal-footer .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="Bithash Logo" class="loading-logo">
        <div class="loading-text">Loading Secure Platform...</div>
    </div>

    <!-- Header -->
    <header id="main-header">
        <div class="container header-container">
            <div class="logo">
                <a href="index.html">
                    <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="Bithash Logo">
                    <span class="logo-text">Bithash</span>
                </a>
            </div>
            
            <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <nav id="main-nav">
                <ul>
                    <li><a href="index.html#home">Home</a></li>
                    <li><a href="index.html#about">About</a></li>
                    <li><a href="index.html#plans">Plans</a></li>
                    <li><a href="index.html#how-it-works">How It Works</a></li>
                    <li><a href="index.html#testimonials">Testimonials</a></li>
                    <li><a href="index.html#contact">Contact</a></li>
                    <li><a href="dashboard.html" class="btn btn-outline">Dashboard</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Settings Section -->
    <section class="settings-section">
        <div class="container">
            <div class="settings-container">
                <div class="settings-sidebar">
                    <div class="settings-nav">
                        <div class="settings-nav-item active" data-section="profile">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </div>
                        <div class="settings-nav-item" data-section="security">
                            <i class="fas fa-lock"></i>
                            <span>Security</span>
                        </div>
                        <div class="settings-nav-item" data-section="referral">
                            <i class="fas fa-user-friends"></i>
                            <span>Referral Program</span>
                        </div>
                        <div class="settings-nav-item" data-section="kyc">
                            <i class="fas fa-id-card"></i>
                            <span>KYC Verification</span>
                        </div>
                        <div class="settings-nav-item" data-section="twofa">
                            <i class="fas fa-shield-alt"></i>
                            <span>Two-Factor Auth</span>
                        </div>
                        <div class="settings-nav-item" data-section="notifications">
                            <i class="fas fa-bell"></i>
                            <span>Notifications</span>
                        </div>
                        <div class="settings-nav-item" data-section="activity">
                            <i class="fas fa-history"></i>
                            <span>Activity Log</span>
                        </div>
                        <div class="settings-nav-item" data-section="deactivate">
                            <i class="fas fa-user-slash"></i>
                            <span>Deactivate Account</span>
                        </div>
                    </div>
                </div>
                
                <div class="settings-content">
                    <!-- Profile Section -->
                    <div class="settings-section-content" id="profile-section">
                        <h2 class="settings-section-title">
                            <i class="fas fa-user"></i>
                            <span>Profile Information</span>
                        </h2>
                        
                        <div class="settings-card">
                            <h3 class="settings-card-title">
                                <i class="fas fa-user-edit"></i>
                                <span>Personal Details</span>
                            </h3>
                            
                            <form id="profile-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="first-name" class="form-label">First Name</label>
                                        <input type="text" id="first-name" class="form-control" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="last-name" class="form-label">Last Name</label>
                                        <input type="text" id="last-name" class="form-control" required>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="email" class="form-label">Email Address</label>
                                    <input type="email" id="email" class="form-control" disabled>
                                    <div class="form-feedback" id="email-feedback"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="city" class="form-label">Nearest City</label>
                                    <input type="text" id="city" class="form-control">
                                </div>
                                
                                <button type="submit" class="btn btn-primary form-submit" id="profile-submit">
                                    <span id="profile-submit-text">Update Profile</span>
                                    <span id="profile-submit-spinner" style="display: none;">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </span>
                                </button>
                            </form>
                        </div>
                        
                        <div class="settings-card">
                            <h3 class="settings-card-title">
                                <i class="fas fa-palette"></i>
                                <span>Theme Preferences</span>
                            </h3>
                            
                            <div class="theme-toggle">
                                <span class="theme-toggle-label">Dark Mode</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="theme-toggle">
                                    <span class="toggle-slider"></span>
                                    <span class="toggle-icon sun"><i class="fas fa-sun"></i></span>
                                    <span class="toggle-icon moon"><i class="fas fa-moon"></i></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Security Section -->
                    <div class="settings-section-content" id="security-section" style="display: none;">
                        <h2 class="settings-section-title">
                            <i class="fas fa-lock"></i>
                            <span>Security Settings</span>
                        </h2>
                        
                        <div class="settings-card">
                            <h3 class="settings-card-title">
                                <i class="fas fa-key"></i>
                                <span>Change Password</span>
                            </h3>
                            
                            <form id="password-form">
                                <div class="form-group">
                                    <label for="current-password" class="form-label">Current Password</label>
                                    <input type="password" id="current-password" class="form-control" required>
                                    <i class="fas fa-eye password-toggle" id="current-password-toggle"></i>
                                    <div class="form-feedback error" id="current-password-error"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="new-password" class="form-label">New Password</label>
                                    <input type="password" id="new-password" class="form-control" required>
                                    <i class="fas fa-eye password-toggle" id="new-password-toggle"></i>
                                    <div class="form-feedback error" id="new-password-error"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="confirm-password" class="form-label">Confirm New Password</label>
                                    <input type="password" id="confirm-password" class="form-control" required>
                                    <i class="fas fa-eye password-toggle" id="confirm-password-toggle"></i>
                                    <div class="form-feedback error" id="confirm-password-error"></div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary form-submit" id="password-submit">
                                    <span id="password-submit-text">Change Password</span>
                                    <span id="password-submit-spinner" style="display: none;">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </span>
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Referral Section -->
                    <div class="settings-section-content" id="referral-section" style="display: none;">
                        <h2 class="settings-section-title">
                            <i class="fas fa-user-friends"></i>
                            <span>Referral Program</span>
                        </h2>
                        
                        <div class="referral-container">
                            <h3 class="referral-title">
                                <i class="fas fa-gift"></i>
                                <span>Earn With Our Referral Program</span>
                            </h3>
                            
                            <p class="referral-description">
                                Invite friends to join Bithash and earn 5% of their mining rewards for life. 
                                Share your unique referral link and start earning today.
                            </p>
                            
                            <div class="referral-stats">
                                <div class="referral-stat">
                                    <div class="referral-stat-value" id="referral-count">0</div>
                                    <div class="referral-stat-label">Referred Users</div>
                                </div>
                                
                                <div class="referral-stat">
                                    <div class="referral-stat-value" id="referral-earnings">$0.00</div>
                                    <div class="referral-stat-label">Total Earnings</div>
                                </div>
                                
                                <div class="referral-stat">
                                    <div class="referral-stat-value" id="referral-pending">$0.00</div>
                                    <div class="referral-stat-label">Pending Earnings</div>
                                </div>
                            </div>
                            
                            <div class="referral-link-container">
                                <input type="text" id="referral-link" class="referral-link-input" readonly>
                                <button class="referral-link-btn" id="copy-referral-link">
                                    <i class="fas fa-copy"></i>
                                    <span>Copy</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="referral-history">
                            <h3 class="referral-history-title">Referral History</h3>
                            
                            <div class="table-responsive">
                                <table class="referral-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Referred User</th>
                                            <th>Status</th>
                                            <th>Earnings</th>
                                        </tr>
                                    </thead>
                                    <tbody id="referral-history-body">
                                        <!-- Referral history will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- KYC Section -->
                    <div class="settings-section-content" id="kyc-section" style="display: none;">
                        <h2 class="settings-section-title">
                            <i class="fas fa-id-card"></i>
                            <span>KYC Verification</span>
                        </h2>
                        
                        <div class="settings-card">
                            <h3 class="settings-card-title">
                                <i class="fas fa-passport"></i>
                                <span>Identity Verification</span>
                            </h3>
                            
                            <div class="kyc-status pending" id="kyc-status">Pending Verification</div>
                            
                            <p>To comply with financial regulations, we require all users to complete identity verification (KYC).</p>
                            <p>Please upload a clear photo of one of the following documents:</p>
                            
                            <ul style="margin-bottom: 20px; color: var(--gray);">
                                <li>Passport</li>
                                <li>National ID Card</li>
                                <li>Driver's License</li>
                            </ul>
                            
                            <form id="kyc-form">
                                <div class="form-group">
                                    <label for="document-type" class="form-label">Document Type</label>
                                    <select id="document-type" class="form-control" required>
                                        <option value="">Select document type</option>
                                        <option value="passport">Passport</option>
                                        <option value="national_id">National ID</option>
                                        <option value="drivers_license">Driver's License</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Document Upload</label>
                                    <div class="kyc-upload" id="kyc-upload-area">
                                        <div class="kyc-upload-icon">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                        </div>
                                        <div class="kyc-upload-text">
                                            Click to upload or drag and drop your document
                                        </div>
                                        <div class="kyc-upload-hint">
                                            PDF, JPG or PNG (Max 5MB)
                                        </div>
                                        <input type="file" id="kyc-document" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
                                    </div>
                                    
                                    <div class="kyc-document-preview" id="kyc-document-preview">
                                        <img id="kyc-document-preview-img" src="" alt="Document Preview">
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary form-submit" id="kyc-submit">
                                    <span id="kyc-submit-text">Submit for Verification</span>
                                    <span id="kyc-submit-spinner" style="display: none;">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </span>
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- 2FA Section -->
                    <div class="settings-section-content" id="twofa-section" style="display: none;">
                        <h2 class="settings-section-title">
                            <i class="fas fa-shield-alt"></i>
                            <span>Two-Factor Authentication</span>
                        </h2>
                        
                        <div class="settings-card">
                            <h3 class="settings-card-title">
                                <i class="fas fa-mobile-alt"></i>
                                <span>Security Settings</span>
                            </h3>
                            
                            <div class="twofa-status disabled" id="twofa-status">2FA Disabled</div>
                            
                            <p>Two-factor authentication adds an extra layer of security to your account. 
                            When enabled, you'll be required to enter a verification code each time you log in.</p>
                            
                            <button class="btn btn-primary" id="enable-twofa-btn">Enable 2FA</button>
                            
                            <div class="twofa-setup" id="twofa-setup">
                                <h4>Setup Authenticator App</h4>
                                <p>Scan the QR code below with your authenticator app (Google Authenticator, Authy, etc.)</p>
                                
                                <div class="twofa-qr-container">
                                    <div class="twofa-qr-code" id="twofa-qr-code"></div>
                                    <p>Or enter this code manually: <strong id="twofa-secret-key"></strong></p>
                                </div>
                                
                                <div class="form-group">
                                    <label for="twofa-code" class="form-label">Enter Verification Code</label>
                                    <input type="text" id="twofa-code" class="form-control" placeholder="6-digit code">
                                    <div class="form-feedback error" id="twofa-code-error"></div>
                                </div>
                                
                                <button class="btn btn-primary" id="verify-twofa-btn">Verify and Enable</button>
                                <button class="btn btn-outline" id="cancel-twofa-btn">Cancel</button>
                                
                                <div class="twofa-recovery-codes">
                                    <h4 class="twofa-recovery-codes-title">Recovery Codes</h4>
                                    <p>Save these codes in a secure place. Each code can be used only once.</p>
                                    
                                    <div class="twofa-recovery-codes-list" id="twofa-recovery-codes">
                                        <!-- Recovery codes will be displayed here -->
                                    </div>
                                    
                                    <button class="btn btn-outline" id="download-recovery-codes">
                                        <i class="fas fa-download"></i>
                                        <span>Download Codes</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notifications Section -->
                    <div class="settings-section-content" id="notifications-section" style="display: none;">
                        <h2 class="settings-section-title">
                            <i class="fas fa-bell"></i>
                            <span>Notification Preferences</span>
                        </h2>
                        
                        <div class="settings-card">
                            <h3 class="settings-card-title">
                                <i class="fas fa-envelope"></i>
                                <span>Email Notifications</span>
                            </h3>
                            
                            <div class="notification-preference">
                                <span class="notification-preference-label">Account Notifications</span>
                                <label class="notification-toggle">
                                    <input type="checkbox" id="account-notifications" checked>
                                    <span class="notification-slider"></span>
                                </label>
                            </div>
                            
                            <div class="notification-preference">
                                <span class="notification-preference-label">Investment Updates</span>
                                <label class="notification-toggle">
                                    <input type="checkbox" id="investment-notifications" checked>
                                    <span class="notification-slider"></span>
                                </label>
                            </div>
                            
                            <div class="notification-preference">
                                <span class="notification-preference-label">Withdrawal Alerts</span>
                                <label class="notification-toggle">
                                    <input type="checkbox" id="withdrawal-notifications" checked>
                                    <span class="notification-slider"></span>
                                </label>
                            </div>
                            
                            <div class="notification-preference">
                                <span class="notification-preference-label">Promotional Offers</span>
                                <label class="notification-toggle">
                                    <input type="checkbox" id="promotional-notifications">
                                    <span class="notification-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="settings-card">
                            <h3 class="settings-card-title">
                                <i class="fas fa-sms"></i>
                                <span>SMS Notifications</span>
                            </h3>
                            
                            <div class="form-group">
                                <label for="phone-number" class="form-label">Phone Number</label>
                                <input type="tel" id="phone-number" class="form-control" placeholder="+1 (555) 123-4567">
                            </div>
                            
                            <div class="notification-preference">
                                <span class="notification-preference-label">SMS Alerts</span>
                                <label class="notification-toggle">
                                    <input type="checkbox" id="sms-notifications">
                                    <span class="notification-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Activity Log Section -->
                    <div class="settings-section-content" id="activity-section" style="display: none;">
                        <h2 class="settings-section-title">
                            <i class="fas fa-history"></i>
                            <span>Security Activity Log</span>
                        </h2>
                        
                        <div class="settings-card">
                            <h3 class="settings-card-title">
                                <i class="fas fa-shield-alt"></i>
                                <span>Recent Account Activity</span>
                            </h3>
                            
                            <div id="security-log">
                                <!-- Activity items will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Deactivate Account Section -->
                    <div class="settings-section-content" id="deactivate-section" style="display: none;">
                        <h2 class="settings-section-title">
                            <i class="fas fa-user-slash"></i>
                            <span>Account Deactivation</span>
                        </h2>
                        
                        <div class="settings-card">
                            <div class="deactivation-warning">
                                <h3 class="deactivation-warning-title">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <span>Warning</span>
                                </h3>
                                <p class="deactivation-warning-text">
                                    Deactivating your account will suspend all mining operations and disable access to your dashboard. 
                                    Any pending withdrawals will be canceled. You can reactivate your account within 30 days by logging in.
                                </p>
                            </div>
                            
                            <button class="btn btn-danger" id="request-deactivation-btn">
                                <i class="fas fa-user-slash"></i>
                                <span>Request Account Deactivation</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contact">
        <div class="container">
            <div class="footer-container">
                <div class="footer-about">
                    <div class="footer-logo">
                        <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="Bithash Logo">
                        <span class="footer-logo-text">Bithash</span>
                    </div>
                    <p>Premium Bitcoin mining platform serving investors worldwide with transparent, secure operations and daily payouts.</p>
                    <div class="footer-social">
                        <a href="#" class="social-icon twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-icon linkedin"><i class="fab fa-linkedin"></i></a>
                        <a href="#" class="social-icon facebook"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="social-icon instagram"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                
                <div class="footer-links">
                    <h3 class="footer-title">Quick Links</h3>
                    <ul>
                        <li><a href="index.html#home">Home</a></li>
                        <li><a href="index.html#about">About Us</a></li>
                        <li><a href="index.html#plans">Investment Plans</a></li>
                        <li><a href="index.html#how-it-works">How It Works</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h3 class="footer-title">Legal</h3>
                    <ul>
                        <li><a href="terms.html">Terms of Service</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="aml.html">AML Policy</a></li>
                        <li><a href="risk.html">Risk Disclosure</a></li>
                    </ul>
                </div>
                
                <div class="footer-contact">
                    <h3 class="footer-title">Contact Us</h3>
                    <p><i class="fas fa-envelope"></i> support@bithash.com</p>
                    <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                    <p><i class="fas fa-map-marker-alt"></i> 123 Blockchain Ave, Crypto City, CC 10001</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; <span id="current-year"></span> Bithash. All Rights Reserved. Bithash LLC is registered in Delaware, USA.</p>
            </div>
        </div>
    </footer>

    <!-- Deactivation Modal -->
    <div class="modal-overlay" id="deactivation-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Account Deactivation</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to deactivate your account? This action will:</p>
                <ul style="margin: 15px 0; padding-left: 20px; color: var(--gray);">
                    <li>Suspend all mining operations</li>
                    <li>Disable access to your dashboard</li>
                    <li>Cancel any pending withdrawals</li>
                </ul>
                <p>You can reactivate your account within 30 days by logging in. After 30 days, your account will be permanently deleted.</p>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="deactivation-reason" class="form-label">Reason for leaving (optional)</label>
                    <select id="deactivation-reason" class="form-control">
                        <option value="">Select a reason</option>
                        <option value="privacy_concerns">Privacy concerns</option>
                        <option value="not_enough_profit">Not enough profit</option>
                        <option value="found_better_service">Found a better service</option>
                        <option value="too_complicated">Platform too complicated</option>
                        <option value="other">Other reason</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-deactivation">Cancel</button>
                <button class="btn btn-danger" id="confirm-deactivation">Deactivate Account</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <button class="notification-close" id="notification-close">&times;</button>
        <div class="notification-icon">
            <i class="fas fa-exclamation"></i>
        </div>
        <div class="notification-content">
            <h4 id="notification-title">Error</h4>
            <p id="notification-message">An error occurred while processing your request.</p>
        </div>
    </div>

    <!-- QR Code Generator Library -->
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    
    <!-- AOS Animation -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <script>
        // API Base URL
        const API_BASE_URL = 'https://website-backendd-1.onrender.com';
        
        // Initialize AOS animation
        AOS.init({
            duration: 800,
            once: true,
            easing: 'ease-in-out'
        });
        
        // Hide loading overlay when page is loaded
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('loading-overlay').classList.add('hidden');
                loadUserData();
            }, 1000);
        });
        
        // Current year in footer
        document.getElementById('current-year').textContent = new Date().getFullYear();
        
        // Header scroll effect
        window.addEventListener('scroll', function() {
            const header = document.getElementById('main-header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
        
        // Mobile menu toggle
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mainNav = document.getElementById('main-nav');
        
        mobileMenuToggle.addEventListener('click', function() {
            mainNav.classList.toggle('active');
            this.innerHTML = mainNav.classList.contains('active') ? 
                '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
        });
        
        // Close mobile menu when clicking a link
        document.querySelectorAll('#main-nav a').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    mainNav.classList.remove('active');
                    mobileMenuToggle.innerHTML = '<i class="fas fa-bars"></i>';
                }
            });
        });
        
        // Settings navigation
        document.querySelectorAll('.settings-nav-item').forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all items
                document.querySelectorAll('.settings-nav-item').forEach(navItem => {
                    navItem.classList.remove('active');
                });
                
                // Add active class to clicked item
                this.classList.add('active');
                
                // Hide all sections
                document.querySelectorAll('.settings-section-content').forEach(section => {
                    section.style.display = 'none';
                });
                
                // Show selected section
                const sectionId = this.getAttribute('data-section') + '-section';
                document.getElementById(sectionId).style.display = 'block';
            });
        });
        
        // Password toggle functionality
        function setupPasswordToggle(inputId, toggleId) {
            const toggle = document.getElementById(toggleId);
            const input = document.getElementById(inputId);
            
            if (toggle && input) {
                toggle.addEventListener('click', function() {
                    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                    input.setAttribute('type', type);
                    this.classList.toggle('fa-eye');
                    this.classList.toggle('fa-eye-slash');
                });
            }
        }
        
        // Initialize password toggles
        setupPasswordToggle('current-password', 'current-password-toggle');
        setupPasswordToggle('new-password', 'new-password-toggle');
        setupPasswordToggle('confirm-password', 'confirm-password-toggle');
        
        // Theme toggle
        const themeToggle = document.getElementById('theme-toggle');
        
        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        if (savedTheme === 'dark') {
            themeToggle.checked = true;
        }
        
        themeToggle.addEventListener('change', function() {
            if (this.checked) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                updateThemePreference('dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
                updateThemePreference('light');
            }
        });
        
        // Update theme preference on backend
        async function updateThemePreference(theme) {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            try {
                await fetch(`${API_BASE_URL}/api/users/theme`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ theme })
                });
            } catch (error) {
                console.error('Failed to update theme preference:', error);
            }
        }
        
        // Show notification
        function showNotification(title, message, isSuccess = false) {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notification-title');
            const notificationMessage = document.getElementById('notification-message');
            const notificationIcon = notification.querySelector('.notification-icon i');
            
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            if (isSuccess) {
                notification.classList.add('success');
                notificationIcon.className = 'fas fa-check';
            } else {
                notification.classList.remove('success');
                notificationIcon.className = 'fas fa-exclamation';
            }
            
            notification.classList.add('show');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
        
        // Close notification
        document.getElementById('notification-close').addEventListener('click', function() {
            document.getElementById('notification').classList.remove('show');
        });
        
        // Load user data from backend
        async function loadUserData() {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            try {
                // Fetch user profile
                const profileResponse = await fetch(`${API_BASE_URL}/api/users/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!profileResponse.ok) {
                    throw new Error('Failed to fetch user data');
                }
                
                const userData = await profileResponse.json();
                
                // Populate profile form
                document.getElementById('first-name').value = userData.firstName || '';
                document.getElementById('last-name').value = userData.lastName || '';
                document.getElementById('email').value = userData.email || '';
                document.getElementById('city').value = userData.city || '';
                
                // Set theme if available
                if (userData.theme) {
                    document.documentElement.setAttribute('data-theme', userData.theme);
                    themeToggle.checked = userData.theme === 'dark';
                    localStorage.setItem('theme', userData.theme);
                }
                
                // Load referral data
                loadReferralData(token);
                
                // Load KYC status
                loadKYCStatus(token);
                
                // Load 2FA status
                load2FAStatus(token);
                
                // Load notification preferences
                loadNotificationPreferences(token);
                
                // Load security activity log
                loadSecurityActivityLog(token);
                
            } catch (error) {
                console.error('Error loading user data:', error);
                showNotification('Error', 'Failed to load user data. Please try again.');
            }
        }
        
        // Update profile
        document.getElementById('profile-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            const submitBtn = document.getElementById('profile-submit');
            const submitText = document.getElementById('profile-submit-text');
            const submitSpinner = document.getElementById('profile-submit-spinner');
            
            submitText.style.display = 'none';
            submitSpinner.style.display = 'inline-block';
            submitBtn.disabled = true;
            
            const profileData = {
                firstName: document.getElementById('first-name').value.trim(),
                lastName: document.getElementById('last-name').value.trim(),
                city: document.getElementById('city').value.trim()
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/users/profile`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(profileData)
                });
                
                if (response.ok) {
                    showNotification('Success', 'Profile updated successfully', true);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to update profile');
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                showNotification('Error', error.message || 'Failed to update profile');
            } finally {
                submitText.style.display = 'inline';
                submitSpinner.style.display = 'none';
                submitBtn.disabled = false;
            }
        });
        
        // Change password
        document.getElementById('password-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            // Frontend validation
            if (newPassword.length < 8) {
                document.getElementById('new-password-error').textContent = 'Password must be at least 8 characters';
                document.getElementById('new-password').classList.add('error');
                return;
            } else {
                document.getElementById('new-password-error').textContent = '';
                document.getElementById('new-password').classList.remove('error');
            }
            
            if (newPassword !== confirmPassword) {
                document.getElementById('confirm-password-error').textContent = 'Passwords do not match';
                document.getElementById('confirm-password').classList.add('error');
                return;
            } else {
                document.getElementById('confirm-password-error').textContent = '';
                document.getElementById('confirm-password').classList.remove('error');
            }
            
            const submitBtn = document.getElementById('password-submit');
            const submitText = document.getElementById('password-submit-text');
            const submitSpinner = document.getElementById('password-submit-spinner');
            
            submitText.style.display = 'none';
            submitSpinner.style.display = 'inline-block';
            submitBtn.disabled = true;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/users/change-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        currentPassword,
                        newPassword
                    })
                });
                
                if (response.ok) {
                    showNotification('Success', 'Password changed successfully', true);
                    document.getElementById('password-form').reset();
                } else {
                    const errorData = await response.json();
                    
                    if (errorData.field === 'currentPassword') {
                        document.getElementById('current-password-error').textContent = errorData.message;
                        document.getElementById('current-password').classList.add('error');
                    } else {
                        throw new Error(errorData.message || 'Failed to change password');
                    }
                }
            } catch (error) {
                console.error('Error changing password:', error);
                showNotification('Error', error.message || 'Failed to change password');
            } finally {
                submitText.style.display = 'inline';
                submitSpinner.style.display = 'none';
                submitBtn.disabled = false;
            }
        });
        
        // Load referral data
        async function loadReferralData(token) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/referrals`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load referral data');
                }
                
                const referralData = await response.json();
                
                // Update referral stats
                document.getElementById('referral-count').textContent = referralData.totalReferrals || 0;
                document.getElementById('referral-earnings').textContent = `$${(referralData.totalEarnings || 0).toFixed(2)}`;
                document.getElementById('referral-pending').textContent = `$${(referralData.pendingEarnings || 0).toFixed(2)}`;
                
                // Set referral link
                document.getElementById('referral-link').value = referralData.referralLink || '';
                
                // Populate referral history
                const historyBody = document.getElementById('referral-history-body');
                historyBody.innerHTML = '';
                
                if (referralData.history && referralData.history.length > 0) {
                    referralData.history.forEach(referral => {
                        const row = document.createElement('tr');
                        
                        const dateCell = document.createElement('td');
                        dateCell.textContent = new Date(referral.date).toLocaleDateString();
                        
                        const userCell = document.createElement('td');
                        userCell.textContent = referral.email || 'Anonymous';
                        
                        const statusCell = document.createElement('td');
                        const statusSpan = document.createElement('span');
                        statusSpan.className = `referral-status ${referral.status}`;
                        statusSpan.textContent = referral.status.charAt(0).toUpperCase() + referral.status.slice(1);
                        statusCell.appendChild(statusSpan);
                        
                        const earningsCell = document.createElement('td');
                        earningsCell.textContent = `$${referral.amount?.toFixed(2) || '0.00'}`;
                        
                        row.appendChild(dateCell);
                        row.appendChild(userCell);
                        row.appendChild(statusCell);
                        row.appendChild(earningsCell);
                        
                        historyBody.appendChild(row);
                    });
                } else {
                    const row = document.createElement('tr');
                    const cell = document.createElement('td');
                    cell.colSpan = 4;
                    cell.textContent = 'No referral history yet';
                    cell.style.textAlign = 'center';
                    cell.style.padding = '20px';
                    cell.style.color = 'var(--gray)';
                    row.appendChild(cell);
                    historyBody.appendChild(row);
                }
                
            } catch (error) {
                console.error('Error loading referral data:', error);
            }
        }
        
        // Copy referral link
        document.getElementById('copy-referral-link').addEventListener('click', function() {
            const referralLink = document.getElementById('referral-link');
            referralLink.select();
            document.execCommand('copy');
            
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-check"></i> <span>Copied!</span>';
            
            setTimeout(() => {
                this.innerHTML = originalText;
            }, 2000);
        });
        
        // Load KYC status
        async function loadKYCStatus(token) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/kyc`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load KYC status');
                }
                
                const kycData = await response.json();
                
                // Update KYC status display
                const kycStatusElement = document.getElementById('kyc-status');
                kycStatusElement.className = `kyc-status ${kycData.status}`;
                kycStatusElement.textContent = kycData.status === 'pending' ? 'Pending Verification' : 
                                              kycData.status === 'approved' ? 'Verified' : 
                                              kycData.status === 'rejected' ? 'Rejected - Please Resubmit' : 
                                              'Not Submitted';
                
                // If document is uploaded, show preview
                if (kycData.documentUrl) {
                    const previewContainer = document.getElementById('kyc-document-preview');
                    const previewImg = document.getElementById('kyc-document-preview-img');
                    
                    previewImg.src = kycData.documentUrl;
                    previewContainer.style.display = 'block';
                }
                
                // Set document type if available
                if (kycData.documentType) {
                    document.getElementById('document-type').value = kycData.documentType;
                }
                
            } catch (error) {
                console.error('Error loading KYC status:', error);
            }
        }
        
        // KYC document upload
        document.getElementById('kyc-upload-area').addEventListener('click', function() {
            document.getElementById('kyc-document').click();
        });
        
        document.getElementById('kyc-document').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Check file type
            const validTypes = ['image/jpeg', 'image/png', 'application/pdf'];
            if (!validTypes.includes(file.type)) {
                showNotification('Error', 'Please upload a JPG, PNG, or PDF file');
                return;
            }
            
            // Check file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Error', 'File size must be less than 5MB');
                return;
            }
            
            // Show preview for images
            if (file.type.includes('image')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewContainer = document.getElementById('kyc-document-preview');
                    const previewImg = document.getElementById('kyc-document-preview-img');
                    
                    previewImg.src = e.target.result;
                    previewContainer.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                // For PDFs, just show a message
                const previewContainer = document.getElementById('kyc-document-preview');
                previewContainer.innerHTML = '<p>PDF document selected: ' + file.name + '</p>';
                previewContainer.style.display = 'block';
            }
        });
        
        // Submit KYC form
        document.getElementById('kyc-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            const documentType = document.getElementById('document-type').value;
            const fileInput = document.getElementById('kyc-document');
            const file = fileInput.files[0];
            
            if (!documentType) {
                showNotification('Error', 'Please select a document type');
                return;
            }
            
            if (!file) {
                showNotification('Error', 'Please upload a document');
                return;
            }
            
            const submitBtn = document.getElementById('kyc-submit');
            const submitText = document.getElementById('kyc-submit-text');
            const submitSpinner = document.getElementById('kyc-submit-spinner');
            
            submitText.style.display = 'none';
            submitSpinner.style.display = 'inline-block';
            submitBtn.disabled = true;
            
            try {
                const formData = new FormData();
                formData.append('documentType', documentType);
                formData.append('document', file);
                
                const response = await fetch(`${API_BASE_URL}/api/kyc`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                if (response.ok) {
                    showNotification('Success', 'KYC document submitted for verification', true);
                    loadKYCStatus(token);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to submit KYC document');
                }
            } catch (error) {
                console.error('Error submitting KYC:', error);
                showNotification('Error', error.message || 'Failed to submit KYC document');
            } finally {
                submitText.style.display = 'inline';
                submitSpinner.style.display = 'none';
                submitBtn.disabled = false;
            }
        });
        
        // Load 2FA status
        async function load2FAStatus(token) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/auth/twofa`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load 2FA status');
                }
                
                const twofaData = await response.json();
                
                // Update 2FA status display
                const twofaStatusElement = document.getElementById('twofa-status');
                if (twofaData.enabled) {
                    twofaStatusElement.className = 'twofa-status enabled';
                    twofaStatusElement.textContent = '2FA Enabled';
                    document.getElementById('enable-twofa-btn').textContent = 'Disable 2FA';
                    document.getElementById('twofa-setup').style.display = 'none';
                } else {
                    twofaStatusElement.className = 'twofa-status disabled';
                    twofaStatusElement.textContent = '2FA Disabled';
                    document.getElementById('enable-twofa-btn').textContent = 'Enable 2FA';
                }
                
            } catch (error) {
                console.error('Error loading 2FA status:', error);
            }
        }
        
        // Enable/disable 2FA
        document.getElementById('enable-twofa-btn').addEventListener('click', async function() {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            // Check current 2FA status
            const twofaStatusElement = document.getElementById('twofa-status');
            const isEnabled = twofaStatusElement.classList.contains('enabled');
            
            if (isEnabled) {
                // Disable 2FA
                try {
                    const response = await fetch(`${API_BASE_URL}/api/auth/twofa/disable`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (response.ok) {
                        showNotification('Success', 'Two-factor authentication has been disabled', true);
                        load2FAStatus(token);
                    } else {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to disable 2FA');
                    }
                } catch (error) {
                    console.error('Error disabling 2FA:', error);
                    showNotification('Error', error.message || 'Failed to disable 2FA');
                }
            } else {
                // Enable 2FA - show setup form
                try {
                    const response = await fetch(`${API_BASE_URL}/api/auth/twofa/setup`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to setup 2FA');
                    }
                    
                    const setupData = await response.json();
                    
                    // Display QR code
                    const qrContainer = document.getElementById('twofa-qr-code');
                    qrContainer.innerHTML = '';
                    new QRCode(qrContainer, {
                        text: setupData.otpauthUrl,
                        width: 200,
                        height: 200
                    });
                    
                    // Display secret key
                    document.getElementById('twofa-secret-key').textContent = setupData.secret;
                    
                    // Show setup form
                    document.getElementById('twofa-setup').style.display = 'block';
                    
                } catch (error) {
                    console.error('Error setting up 2FA:', error);
                    showNotification('Error', error.message || 'Failed to setup 2FA');
                }
            }
        });
        
        // Cancel 2FA setup
        document.getElementById('cancel-twofa-btn').addEventListener('click', function() {
            document.getElementById('twofa-setup').style.display = 'none';
        });
        
        // Verify 2FA code
        document.getElementById('verify-twofa-btn').addEventListener('click', async function() {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            const code = document.getElementById('twofa-code').value.trim();
            if (!code || code.length !== 6) {
                document.getElementById('twofa-code-error').textContent = 'Please enter a valid 6-digit code';
                document.getElementById('twofa-code').classList.add('error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/auth/twofa/verify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ code })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // Display recovery codes
                    const codesList = document.getElementById('twofa-recovery-codes');
                    codesList.innerHTML = '';
                    
                    result.recoveryCodes.forEach(code => {
                        const codeElement = document.createElement('div');
                        codeElement.textContent = code;
                        codesList.appendChild(codeElement);
                    });
                    
                    showNotification('Success', 'Two-factor authentication has been enabled', true);
                    load2FAStatus(token);
                    
                } else {
                    const errorData = await response.json();
                    document.getElementById('twofa-code-error').textContent = errorData.message || 'Invalid verification code';
                    document.getElementById('twofa-code').classList.add('error');
                }
            } catch (error) {
                console.error('Error verifying 2FA code:', error);
                showNotification('Error', 'Failed to verify 2FA code');
            }
        });
        
        // Download recovery codes
        document.getElementById('download-recovery-codes').addEventListener('click', function() {
            const codes = Array.from(document.querySelectorAll('#twofa-recovery-codes div')).map(div => div.textContent);
            if (codes.length === 0) return;
            
            const text = `Bithash 2FA Recovery Codes\n\n` +
                         `Save these codes in a secure place. Each code can be used only once.\n\n` +
                         codes.join('\n') + `\n\nGenerated on: ${new Date().toLocaleString()}`;
            
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bithash-recovery-codes.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
        
        // Load notification preferences
        async function loadNotificationPreferences(token) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/users/notifications`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load notification preferences');
                }
                
                const preferences = await response.json();
                
                // Set toggle states
                document.getElementById('account-notifications').checked = preferences.accountNotifications !== false;
                document.getElementById('investment-notifications').checked = preferences.investmentNotifications !== false;
                document.getElementById('withdrawal-notifications').checked = preferences.withdrawalNotifications !== false;
                document.getElementById('promotional-notifications').checked = preferences.promotionalNotifications === true;
                document.getElementById('sms-notifications').checked = preferences.smsNotifications === true;
                document.getElementById('phone-number').value = preferences.phoneNumber || '';
                
            } catch (error) {
                console.error('Error loading notification preferences:', error);
            }
        }
        
        // Save notification preferences
        function setupNotificationToggle(toggleId, preferenceKey) {
            const toggle = document.getElementById(toggleId);
            if (!toggle) return;
            
            toggle.addEventListener('change', async function() {
                const token = localStorage.getItem('jwtToken');
                if (!token) return;
                
                try {
                    await fetch(`${API_BASE_URL}/api/users/notifications`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            [preferenceKey]: this.checked
                        })
                    });
                } catch (error) {
                    console.error('Error updating notification preference:', error);
                    // Revert toggle on error
                    this.checked = !this.checked;
                }
            });
        }
        
        // Initialize notification toggles
        setupNotificationToggle('account-notifications', 'accountNotifications');
        setupNotificationToggle('investment-notifications', 'investmentNotifications');
        setupNotificationToggle('withdrawal-notifications', 'withdrawalNotifications');
        setupNotificationToggle('promotional-notifications', 'promotionalNotifications');
        setupNotificationToggle('sms-notifications', 'smsNotifications');
        
        // Save phone number
        document.getElementById('phone-number').addEventListener('blur', async function() {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            try {
                await fetch(`${API_BASE_URL}/api/users/notifications`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        phoneNumber: this.value
                    })
                });
            } catch (error) {
                console.error('Error updating phone number:', error);
            }
        });
        
        // Load security activity log
        async function loadSecurityActivityLog(token) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/users/activity`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load activity log');
                }
                
                const activities = await response.json();
                const logContainer = document.getElementById('security-log');
                logContainer.innerHTML = '';
                
                if (activities.length === 0) {
                    const emptyMessage = document.createElement('p');
                    emptyMessage.textContent = 'No recent activity found';
                    emptyMessage.style.textAlign = 'center';
                    emptyMessage.style.color = 'var(--gray)';
                    emptyMessage.style.padding = '20px';
                    logContainer.appendChild(emptyMessage);
                    return;
                }
                
                activities.forEach(activity => {
                    const activityItem = document.createElement('div');
                    activityItem.className = 'security-log-item';
                    
                    const icon = document.createElement('div');
                    icon.className = 'security-log-icon';
                    
                    // Set appropriate icon based on activity type
                    let iconClass = 'fa-history';
                    if (activity.type.includes('login')) iconClass = 'fa-sign-in-alt';
                    if (activity.type.includes('password')) iconClass = 'fa-key';
                    if (activity.type.includes('2fa')) iconClass = 'fa-shield-alt';
                    if (activity.type.includes('kyc')) iconClass = 'fa-id-card';
                    
                    icon.innerHTML = `<i class="fas ${iconClass}"></i>`;
                    
                    const content = document.createElement('div');
                    content.className = 'security-log-content';
                    
                    const title = document.createElement('div');
                    title.className = 'security-log-title';
                    title.textContent = activity.description || activity.type;
                    
                    const details = document.createElement('div');
                    details.className = 'security-log-details';
                    
                    const date = document.createElement('span');
                    date.textContent = new Date(activity.timestamp).toLocaleString();
                    
                    const ip = document.createElement('span');
                    ip.textContent = activity.ipAddress || '';
                    
                    details.appendChild(date);
                    details.appendChild(ip);
                    
                    content.appendChild(title);
                    content.appendChild(details);
                    
                    activityItem.appendChild(icon);
                    activityItem.appendChild(content);
                    
                    logContainer.appendChild(activityItem);
                });
                
            } catch (error) {
                console.error('Error loading activity log:', error);
                
                const errorMessage = document.createElement('p');
                errorMessage.textContent = 'Failed to load activity log';
                errorMessage.style.textAlign = 'center';
                errorMessage.style.color = 'var(--error)';
                errorMessage.style.padding = '20px';
                document.getElementById('security-log').appendChild(errorMessage);
            }
        }
        
        // Account deactivation
        document.getElementById('request-deactivation-btn').addEventListener('click', function() {
            document.getElementById('deactivation-modal').classList.add('active');
        });
        
        document.getElementById('cancel-deactivation').addEventListener('click', function() {
            document.getElementById('deactivation-modal').classList.remove('active');
        });
        
        document.getElementById('confirm-deactivation').addEventListener('click', async function() {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            const reason = document.getElementById('deactivation-reason').value;
            
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/users/deactivate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ reason })
                });
                
                if (response.ok) {
                    showNotification('Success', 'Account deactivation request submitted. Our team will process your request shortly.', true);
                    document.getElementById('deactivation-modal').classList.remove('active');
                    
                    // Redirect to home page after delay
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 3000);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to submit deactivation request');
                }
            } catch (error) {
                console.error('Error submitting deactivation request:', error);
                showNotification('Error', error.message || 'Failed to submit deactivation request');
                this.disabled = false;
                this.innerHTML = 'Deactivate Account';
            }
        });
    </script>
</body>
</html>
