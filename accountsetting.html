<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BitHash | Account Settings</title>
    <meta name="description" content="Manage your BitHash account settings, security, and preferences">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rowdies:wght@300;400;700&family=Inter:wght@300;400;500;600;700&family=Manrope:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" type="image/png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #00D395;
            --primary-dark: #00B783;
            --primary-light: #00E5A1;
            --secondary: #1E1E1E;
            --secondary-dark: #121212;
            --dark: #E5E5E5;
            --darker: #0A0A0A;
            --light: #121212;
            --lighter: #1E1E1E;
            --gray: #8E8E8E;
            --gray-light: #2E2E2E;
            --gray-lighter: #252525;
            --success: #00D395;
            --warning: #FFB800;
            --error: #FF3D57;
            --gold: #D4AF37;
            --gold-light: #FFD700;
            --gold-dark: #996515;
            --blue: #003366;
            --blue-dark: #002244;
            --blue-light: #004488;
            --purple: #784FED;
            --pink: #EC4899;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            --gold-gradient: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            --blue-gradient: linear-gradient(135deg, var(--blue) 0%, var(--blue-dark) 100%);
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --box-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --visa-blue: #1A1F71;
            --visa-gold: #F7B600;
            --security-blue: #1A73E8;
            --security-green: #34A853;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            overflow-x: hidden;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: var(--dark);
            background-color: var(--light);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Bitcoin Logo Animation */
        @keyframes bitcoinFloat {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-20px) rotate(90deg);
            }
            50% {
                transform: translateY(0) rotate(180deg);
            }
            75% {
                transform: translateY(-10px) rotate(270deg);
            }
        }

        .bitcoin-animation {
            display: inline-block;
            animation: bitcoinFloat 4s ease-in-out infinite;
            margin-right: 5px;
            vertical-align: middle;
            color: var(--gold);
            text-shadow: 0 0 10px var(--gold-light);
            font-weight: bold;
            transform-origin: center;
        }

        /* Security Badge */
        .security-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--darker);
            padding: 12px 16px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 100;
            border-left: 4px solid var(--security-green);
            color: var(--dark);
            border: 1px solid var(--gray-light);
        }
        
        .security-badge i {
            color: var(--security-green);
            font-size: 1rem;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--darker);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loading-logo {
            width: 80px;
            height: 80px;
            animation: pulse 1.5s infinite ease-in-out;
            filter: drop-shadow(0 0 10px rgba(0, 211, 149, 0.3));
        }
        
        .loading-text {
            margin-top: 20px;
            font-weight: 500;
            color: var(--gray);
            font-size: 1rem;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(0.95); opacity: 0.8; }
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Enhanced Header Styles - Smaller and Neater */
        header {
            background-color: var(--darker);
            box-shadow: var(--box-shadow);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            padding: 8px 0;
            transition: var(--transition-slow);
            border-bottom: 1px solid var(--gray-light);
            height: 60px;
        }
        
        header.scrolled {
            background-color: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(5px);
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            height: 100%;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            z-index: 1001;
        }
        
        .logo img {
            height: 32px;
            width: auto;
            transition: var(--transition);
        }
        
        .logo:hover img {
            transform: scale(1.05);
        }
        
        .logo-text {
            font-family: 'Rowdies', sans-serif;
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--primary);
            background-clip: text;
            position: relative;
        }
        
        /* Auth Buttons - More compact */
        .auth-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .auth-buttons .btn {
            padding: 6px 12px;
            font-size: 0.85rem;
        }
        
        .user-balance {
            background-color: var(--primary);
            color: var(--darker);
            padding: 6px 12px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
        }
        
        .user-balance:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
        }
        
        .user-balance i {
            font-size: 0.85rem;
        }
        
        /* Mobile Menu Toggle - Enhanced */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--dark);
            font-size: 1.3rem;
            cursor: pointer;
            padding: 5px;
            z-index: 1001;
            transition: var(--transition);
            position: relative;
            width: 40px;
            height: 40px;
            justify-content: center;
            align-items: center;
        }
        
        .mobile-menu-toggle:hover {
            color: var(--primary);
        }
        
        .mobile-menu-toggle .hamburger {
            width: 24px;
            height: 2px;
            background: currentColor;
            position: relative;
            transition: var(--transition);
        }
        
        .mobile-menu-toggle .hamburger::before,
        .mobile-menu-toggle .hamburger::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            background: currentColor;
            left: 0;
            transition: var(--transition);
        }
        
        .mobile-menu-toggle .hamburger::before {
            top: -8px;
        }
        
        .mobile-menu-toggle .hamburger::after {
            bottom: -8px;
        }
        
        .mobile-menu-toggle.active .hamburger {
            background: transparent;
        }
        
        .mobile-menu-toggle.active .hamburger::before {
            transform: translateY(8px) rotate(45deg);
        }
        
        .mobile-menu-toggle.active .hamburger::after {
            transform: translateY(-8px) rotate(-45deg);
        }
        
        /* Navigation - Enhanced for Mobile */
        nav {
            transition: var(--transition-slow);
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        nav a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            font-size: 0.9rem;
            padding: 3px 0;
        }
        
        nav a:hover {
            color: var(--primary);
        }
        
        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: var(--transition);
        }
        
        nav a:hover::after {
            width: 100%;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: var(--gradient);
            color: var(--darker);
            box-shadow: 0 4px 15px rgba(0, 211, 149, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 211, 149, 0.4);
        }
        
        .btn-outline {
            background-color: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: var(--darker);
            transform: translateY(-2px);
        }
        
        .btn-gold {
            background: var(--gold-gradient);
            color: var(--darker);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }
        
        .btn-gold:hover {
            background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }
        
        /* ============================================= */
        /* Critical Error Notification System */
        /* ============================================= */
        
        .notification-center {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            width: 100%;
            max-width: 400px;
        }
        
        .notification {
            width: 100%;
            padding: 16px 20px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform: translateY(30px) scale(0.95);
            opacity: 0;
            margin-bottom: 10px;
            font-size: 0.85rem;
            font-weight: 500;
            backdrop-filter: blur(10px);
            background-color: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: auto;
            position: relative;
        }
        
        .notification.show {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
        
        .notification.error {
            background-color: rgba(255, 61, 87, 0.95);
            color: white;
            border-left: 4px solid #cc2c4d;
        }
        
        .notification.success {
            background-color: rgba(0, 211, 149, 0.95);
            color: var(--darker);
            border-left: 4px solid #00B783;
        }
        
        .notification i {
            font-size: 1.4rem;
            flex-shrink: 0;
        }
        
        .notification-content {
            flex: 1;
            padding-right: 10px;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.95rem;
        }
        
        .notification-message {
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        .notification-close {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .notification-close:hover {
            background-color: rgba(0, 0, 0, 0.2);
            transform: rotate(90deg);
        }
        
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        .notification.error.show {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        /* Security Indicators */
        .security-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 10px;
        }
        
        .security-indicator i {
            color: var(--security-green);
        }
        
        /* Account Settings Layout */
        .account-settings-section {
            padding: 140px 0 60px;
            background-color: var(--light);
        }
        
        .account-settings-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 30px;
        }
        
        .settings-sidebar {
            background-color: var(--lighter);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            height: fit-content;
            position: sticky;
            top: 100px;
        }
        
        .settings-sidebar-title {
            font-size: 1.2rem;
            margin-bottom: 25px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-sidebar-title i {
            color: var(--primary);
        }
        
        .settings-menu {
            list-style: none;
        }
        
        .settings-menu li {
            margin-bottom: 5px;
        }
        
        .settings-menu a {
            display: block;
            padding: 10px 15px;
            color: var(--gray);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-weight: 500;
        }
        
        .settings-menu a:hover, .settings-menu a.active {
            background-color: var(--gray-light);
            color: var(--dark);
        }
        
        .settings-menu a i {
            width: 20px;
            text-align: center;
            margin-right: 10px;
        }
        
        .settings-content {
            background-color: var(--lighter);
            border-radius: var(--border-radius-lg);
            padding: 40px;
        }
        
        .settings-section {
            margin-bottom: 40px;
            display: none;
        }
        
        .settings-section.active {
            display: block;
        }
        
        .settings-section-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .settings-section-title i {
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .settings-card {
            background-color: var(--light);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--gray-light);
        }
        
        .settings-card-title {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-card-title i {
            color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--light);
            color: var(--dark);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 211, 149, 0.2);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }
        
        .security-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            background-color: var(--light);
        }
        
        .security-status.strong {
            border-left: 4px solid var(--success);
        }
        
        .security-status.medium {
            border-left: 4px solid var(--warning);
        }
        
        .security-status.weak {
            border-left: 4px solid var(--error);
        }
        
        .security-status-icon {
            font-size: 1.5rem;
        }
        
        .security-status.strong .security-status-icon {
            color: var(--success);
        }
        
        .security-status.medium .security-status-icon {
            color: var(--warning);
        }
        
        .security-status.weak .security-status-icon {
            color: var(--error);
        }
        
        .security-status-content h4 {
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .security-status-content p {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .verification-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-left: 15px;
        }
        
        .verification-badge.verified {
            background-color: rgba(0, 211, 149, 0.1);
            color: var(--success);
        }
        
        .verification-badge.pending {
            background-color: rgba(255, 184, 0, 0.1);
            color: var(--warning);
        }
        
        .verification-badge.unverified {
            background-color: rgba(255, 61, 87, 0.1);
            color: var(--error);
        }
        
        .two-factor-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        
        .two-factor-card {
            background-color: var(--light);
            border-radius: var(--border-radius-lg);
            padding: 25px;
            border: 1px solid var(--gray-light);
            transition: var(--transition);
        }
        
        .two-factor-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }
        
        .two-factor-card.active {
            border-color: var(--primary);
            background-color: rgba(0, 211, 149, 0.05);
        }
        
        .two-factor-card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .two-factor-card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .two-factor-card-icon.sms {
            background: linear-gradient(135deg, #1A73E8 0%, #34A853 100%);
        }
        
        .two-factor-card-icon.authenticator {
            background: linear-gradient(135deg, #784FED 0%, #EC4899 100%);
        }
        
        .two-factor-card-title {
            font-size: 1.1rem;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .two-factor-card-description {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .two-factor-card-footer {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .two-factor-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .two-factor-status.active {
            color: var(--success);
        }
        
        .two-factor-status.inactive {
            color: var(--gray);
        }
        
        .devices-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .devices-table th {
            text-align: left;
            padding: 12px 15px;
            background-color: var(--gray-light);
            color: var(--dark);
            font-weight: 600;
        }
        
        .devices-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--gray-light);
            color: var(--gray);
        }
        
        .devices-table tr:last-child td {
            border-bottom: none;
        }
        
        .device-active {
            color: var(--success);
            font-weight: 500;
        }
        
        .device-action {
            color: var(--primary);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .device-action:hover {
            color: var(--primary-light);
        }
        
        .activity-item {
            display: flex;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .activity-icon i {
            color: var(--primary);
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-title {
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .activity-description {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .activity-location {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }
        
        .activity-location i {
            font-size: 0.7rem;
        }
        
        .activity-suspicious {
            color: var(--error);
            font-weight: 500;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
        }
        
        .api-key-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .api-key-table th {
            text-align: left;
            padding: 12px 15px;
            background-color: var(--gray-light);
            color: var(--dark);
            font-weight: 600;
        }
        
        .api-key-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--gray-light);
            color: var(--gray);
        }
        
        .api-key-table tr:last-child td {
            border-bottom: none;
        }
        
        .api-key-name {
            font-weight: 500;
            color: var(--dark);
        }
        
        .api-key-permissions {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        
        .api-key-permission {
            background-color: var(--gray-light);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
        }
        
        .api-key-active {
            color: var(--success);
            font-weight: 500;
        }
        
        .api-key-expired {
            color: var(--error);
            font-weight: 500;
        }
        
        .api-key-action {
            color: var(--primary);
            cursor: pointer;
            transition: var(--transition);
            margin-left: 10px;
        }
        
        .api-key-action:hover {
            color: var(--primary-light);
        }
        
        .api-key-form {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid var(--gray-light);
        }
        
        .api-key-scopes {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .api-key-scope {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .api-key-scope input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }
        
        .api-key-scope-label {
            font-size: 0.9rem;
            color: var(--dark);
        }
        
        .api-key-scope-description {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 2px;
        }
        
        /* Switch styling for notification toggles */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray-light);
            transition: var(--transition);
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }


          /* Footer */
        footer {
            background-color: var(--darker);
            color: white;
            padding: 50px 0 20px;
        }
        
        .footer-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .footer-logo img {
            height: 28px;
            width: auto;
        }
        
        .footer-logo-text {
            font-family: 'Rowdies', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary);
        }
        
        .footer-about p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .footer-social {
            display: flex;
            gap: 10px;
        }
        
        .social-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            color: white;
        }
        
        /* Social media icons */
        .social-icon.twitter {
            background-color: #1DA1F2;
        }
        
        .social-icon.linkedin {
            background-color: #0077B5;
        }
        
        .social-icon.facebook {
            background-color: #1877F2;
        }
        
        .social-icon.instagram {
            background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D, #F56040, #F77737, #FCAF45, #FFDC80);
        }
        
        .social-icon:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .footer-title {
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.1rem;
            color: white;
        }
        
        .footer-links ul {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: var(--transition);
            font-size: 0.9rem;
            display: inline-block;
        }
        
        .footer-links a:hover {
            color: var(--primary);
            transform: translateX(3px);
        }
        
        .footer-contact p {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 12px;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .footer-contact i {
            color: var(--primary);
            width: 18px;
            text-align: center;
            margin-top: 2px;
            font-size: 0.9rem;
        }
        
        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
        }
        
        /* KYC Section Styles */
        .kyc-step {
            display: none;
            margin-bottom: 30px;
        }
        
        .kyc-step.active {
            display: block;
        }
        
        .kyc-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .kyc-progress::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--gray-light);
            z-index: 1;
        }
        
        .kyc-progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .kyc-progress-step.active .kyc-progress-icon {
            background-color: var(--primary);
            color: var(--darker);
        }
        
        .kyc-progress-step.completed .kyc-progress-icon {
            background-color: var(--success);
            color: white;
        }
        
        .kyc-progress-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            transition: var(--transition);
        }
        
        .kyc-progress-label {
            font-size: 0.8rem;
            color: var(--gray);
            text-align: center;
        }
        
        .kyc-progress-step.active .kyc-progress-label {
            color: var(--primary);
            font-weight: 600;
        }
        
        .kyc-progress-step.completed .kyc-progress-label {
            color: var(--success);
        }
        
        .document-upload-area {
            border: 2px dashed var(--gray-light);
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
            position: relative;
        }
        
        .document-upload-area:hover {
            border-color: var(--primary);
        }
        
        .document-upload-area.dragover {
            border-color: var(--primary);
            background-color: rgba(0, 211, 149, 0.05);
        }
        
        .document-upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .document-upload-text {
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .document-upload-hint {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .document-preview {
            display: none;
            margin-top: 20px;
            text-align: center;
        }
        
        .document-preview img {
            max-width: 100%;
            max-height: 300px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .document-preview-actions {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .facial-verification-container {
            text-align: center;
            padding: 20px;
        }
        
        .webcam-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto 20px;
            border-radius: var(--border-radius);
            overflow: hidden;
            position: relative;
            display: none;
        }
        
        #webcam-video {
            width: 100%;
            height: auto;
            display: block;
            background-color: var(--gray-light);
        }
        
        .webcam-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        .capture-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .capture-btn:hover {
            background-color: var(--primary-dark);
            transform: scale(1.05);
        }
        
        .capture-btn i {
            color: white;
            font-size: 1.5rem;
        }
        
        .facial-instructions {
            background-color: var(--light);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .facial-instructions h4 {
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .facial-instructions ol {
            padding-left: 20px;
            margin-bottom: 0;
        }
        
        .facial-instructions li {
            margin-bottom: 8px;
            color: var(--gray);
        }
        
        .verification-photo-container {
            width: 200px;
            height: 200px;
            border-radius: 8px;
            overflow: hidden;
            margin: 0 auto 20px;
            border: 1px solid var(--gray-light);
            display: none;
        }
        
        #verification-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .facial-verification-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            display: none;
        }
        
        .facial-verification-status.success {
            background-color: rgba(0, 211, 149, 0.1);
            border-left: 4px solid var(--success);
        }
        
        .facial-verification-status.error {
            background-color: rgba(255, 61, 87, 0.1);
            border-left: 4px solid var(--error);
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-slow);
            backdrop-filter: blur(5px);
            padding: 15px;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-container {
            background-color: var(--lighter);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 400px;
            max-height: 85vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: var(--transition-slow);
            box-shadow: var(--box-shadow-lg);
            border: 1px solid var(--gray-light);
            position: relative;
        }
        
        .modal-overlay.active .modal-container {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--lighter);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }
        
        .modal-title {
            font-size: 1.1rem;
            color: var(--dark);
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--dark);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            background-color: var(--secondary-dark);
            border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
        }
        
        /* Responsive Styles - Enhanced */
        @media (max-width: 1024px) {
            .account-settings-container {
                grid-template-columns: 240px 1fr;
            }
            
            .form-row, .two-factor-methods {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .account-settings-section {
                padding: 120px 0 40px;
            }
            
            .account-settings-container {
                grid-template-columns: 1fr;
            }
            
            .settings-sidebar {
                position: static;
                margin-bottom: 30px;
            }
            
            .settings-menu {
                display: flex;
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .settings-menu li {
                margin-bottom: 0;
            }
            
            .settings-menu a {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            
            .settings-content {
                padding: 30px;
            }
            
            /* Enhanced Mobile Navigation */
            .mobile-menu-toggle {
                display: flex;
            }
            
            nav {
                position: fixed;
                top: 60px;
                left: 0;
                width: 100%;
                background-color: var(--darker);
                padding: 20px;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
                transform: translateY(-100%);
                opacity: 0;
                visibility: hidden;
                transition: var(--transition-slow);
                z-index: 999;
            }
            
            nav.active {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }
            
            nav ul {
                flex-direction: column;
                gap: 15px;
            }
            
            nav a {
                padding: 10px 0;
                font-size: 1rem;
            }
            
            .kyc-progress {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .kyc-progress::before {
                display: none;
            }
            
            .kyc-progress-step {
                flex: 1;
                min-width: 80px;
            }
        }
        
        @media (max-width: 480px) {
            .account-settings-section {
                padding: 100px 0 30px;
            }
            
            .settings-sidebar {
                padding: 20px;
            }
            
            .settings-content {
                padding: 20px;
            }
            
            .settings-section-title {
                font-size: 1.3rem;
            }
            
            .settings-card {
                padding: 20px;
            }
            
            .form-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
            
            .api-key-scopes {
                grid-template-columns: 1fr;
            }
            
            /* Adjust header elements for small screens */
            .logo-text {
                font-size: 1.1rem;
            }
            
            .auth-buttons {
                gap: 8px;
            }
            
            .auth-buttons .btn {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .user-balance {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .modal-container {
                max-width: 100%;
            }
            
            .modal-footer {
                flex-direction: column;
            }
            
            .modal-footer .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash Logo" class="loading-logo">    
        <div class="loading-text">Establishing Secure Connection</div>
    </div>

    <!-- Security Badge -->
    <div class="security-badge">
        <i class="fas fa-shield-alt"></i>
        <span>256-bit AES & TLS 1.3 Encrypted</span>
    </div>

    <!-- Critical Error Notification System -->
    <div class="notification-center" id="notification-center">
        <!-- Critical error notifications will be dynamically inserted here -->
    </div>

    <!-- Enhanced Header - Smaller and Neater with Mobile Toggle -->
    <header id="main-header">
        <div class="container header-container">
            <div class="logo" onclick="window.location.href='index.html'">
                <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash Logo">
                <span class="logo-text">
                    <span class="bitcoin-animation">â‚¿</span>itHash
                </span>
            </div>
            
            <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle navigation">
                <span class="hamburger"></span>
            </button>
            
            <nav id="main-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="index.html#plans">Investment Plans</a></li>
                    <li><a href="index.html#how-it-works">How It Works</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="accountsetting.html" class="active">Settings</a></li>
                </ul>
            </nav>
            
            <div class="auth-buttons" id="auth-buttons" style="display: none;">
                <button class="btn btn-outline" onclick="window.location.href='login.html'">Login</button>
                <button class="btn btn-primary" onclick="window.location.href='signup.html'">Sign Up</button>
            </div>
            
            <div class="user-balance" id="user-balance" onclick="window.location.href='dashboard.html'">
                <i class="fas fa-wallet"></i>
                <span id="balance-amount">$0.00</span>
                <div class="logout-dropdown" id="logout-dropdown" style="display: none;">
                    <button class="btn btn-outline" onclick="logout()" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8rem;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Account Settings Section -->
    <section class="account-settings-section">
        <div class="container account-settings-container">
            <!-- Settings Sidebar -->
            <div class="settings-sidebar">
                <h2 class="settings-sidebar-title">
                    <i class="fas fa-user-cog"></i> Account Settings
                </h2>
                <ul class="settings-menu">
                    <li><a href="#profile" class="active"><i class="fas fa-user"></i> Profile</a></li>
                    <li><a href="#security"><i class="fas fa-shield-alt"></i> Security</a></li>
                    <li><a href="#kyc"><i class="fas fa-id-card"></i> KYC Verification</a></li>
                    <li><a href="#notifications"><i class="fas fa-bell"></i> Notifications</a></li>
                    <li><a href="#api"><i class="fas fa-key"></i> API Keys</a></li>
                </ul>
            </div>
            
            <!-- Settings Content -->
            <div class="settings-content">
                <!-- Profile Section -->
                <div class="settings-section active" id="profile-section">
                    <h2 class="settings-section-title">
                        <i class="fas fa-user"></i> Profile Information
                    </h2>
                    
                    <div class="settings-card">
                        <h3 class="settings-card-title">
                            <i class="fas fa-id-badge"></i> Personal Details
                        </h3>
                        
                        <form id="profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="first-name" class="form-label">First Name</label>
                                    <input type="text" id="first-name" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="last-name" class="form-label">Last Name</label>
                                    <input type="text" id="last-name" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="email" class="form-label">Email Address</label>
                                <input type="email" id="email" class="form-control" required readonly>
                            </div>
                            
                            <div class="form-group">
                                <label for="phone" class="form-label">Phone Number</label>
                                <input type="tel" id="phone" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="country" class="form-label">Country</label>
                                <input type="text" id="country" class="form-control" required placeholder="Start typing your country">
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="save-profile-btn">Save Changes</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="settings-card">
                        <h3 class="settings-card-title">
                            <i class="fas fa-map-marker-alt"></i> Address Information
                        </h3>
                        
                        <form id="address-form">
                            <div class="form-group">
                                <label for="street-address" class="form-label">Street Address</label>
                                <input type="text" id="street-address" class="form-control" required placeholder="Start typing your address">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="city" class="form-label">City</label>
                                    <input type="text" id="city" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="state" class="form-label">State/Province</label>
                                    <input type="text" id="state" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="postal-code" class="form-label">Postal Code</label>
                                    <input type="text" id="postal-code" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="country-address" class="form-label">Country</label>
                                    <input type="text" id="country-address" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="save-address-btn">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Security Section -->
                <div class="settings-section" id="security-section">
                    <h2 class="settings-section-title">
                        <i class="fas fa-shield-alt"></i> Security Settings
                    </h2>
                    
                    <div class="security-status strong" id="security-status">
                        <div class="security-status-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="security-status-content">
                            <h4>Your account security is strong</h4>
                            <p>All recommended security measures are enabled.</p>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <h3 class="settings-card-title">
                            <i class="fas fa-key"></i> Change Password
                        </h3>
                        
                        <form id="password-form">
                            <div class="form-group">
                                <label for="current-password" class="form-label">Current Password</label>
                                <input type="password" id="current-password" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="new-password" class="form-label">New Password</label>
                                <input type="password" id="new-password" class="form-control" required>
                                <div class="password-strength" style="margin-top: 5px;">
                                    <div style="height: 4px; background: var(--gray-light); border-radius: 2px; overflow: hidden;">
                                        <div id="password-strength-meter" style="height: 100%; width: 0%; background: var(--error); transition: var(--transition);"></div>
                                    </div>
                                    <small id="password-strength-text" style="font-size: 0.8rem; color: var(--gray);">Password strength</small>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="confirm-password" class="form-label">Confirm New Password</label>
                                <input type="password" id="confirm-password" class="form-control" required>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="change-password-btn">Change Password</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="settings-card">
                        <h3 class="settings-card-title">
                            <i class="fas fa-mobile-alt"></i> Two-Factor Authentication
                        </h3>
                        
                        <div class="two-factor-methods" id="two-factor-methods">
                            <!-- Dynamically populated from backend -->
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <h3 class="settings-card-title">
                            <i class="fas fa-laptop"></i> Active Devices
                        </h3>
                        
                        <table class="devices-table" id="devices-table">
                            <thead>
                                <tr>
                                    <th>Device</th>
                                    <th>Location</th>
                                    <th>Last Active</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dynamically populated from backend -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="settings-card">
                        <h3 class="settings-card-title">
                            <i class="fas fa-history"></i> Recent Activity
                        </h3>
                        
                        <div class="activity-list" id="activity-list">
                            <!-- Dynamically populated from backend -->
                        </div>
                    </div>
                </div>
                
                <!-- KYC Verification Section -->
                <div class="settings-section" id="kyc-section">
                    <h2 class="settings-section-title">
                        <i class="fas fa-id-card"></i> KYC Verification
                    </h2>
                    
                    <div class="settings-card">
                        <h3 class="settings-card-title">
                            <i class="fas fa-user-check"></i> Complete KYC Verification
                            <span class="verification-badge unverified" id="overall-verification-badge">
                                <i class="fas fa-times-circle"></i> Not Started
                            </span>
                        </h3>
                        
                        <p style="margin-bottom: 20px; color: var(--gray);">
                            To comply with financial regulations, we require identity verification for all accounts. 
                            This helps prevent fraud and keeps our platform secure.
                        </p>
                        
                        <!-- KYC Progress Indicator -->
                        <div class="kyc-progress">
                            <div class="kyc-progress-step active" id="kyc-step-1">
                                <div class="kyc-progress-icon">
                                    <i class="fas fa-id-card"></i>
                                </div>
                                <div class="kyc-progress-label">ID Document</div>
                            </div>
                            <div class="kyc-progress-step" id="kyc-step-2">
                                <div class="kyc-progress-icon">
                                    <i class="fas fa-home"></i>
                                </div>
                                <div class="kyc-progress-label">Address Proof</div>
                            </div>
                            <div class="kyc-progress-step" id="kyc-step-3">
                                <div class="kyc-progress-icon">
                                    <i class="fas fa-camera"></i>
                                </div>
                                <div class="kyc-progress-label">Facial Verification</div>
                            </div>
                            <div class="kyc-progress-step" id="kyc-step-4">
                                <div class="kyc-progress-icon">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div class="kyc-progress-label">Complete</div>
                            </div>
                        </div>
                        
                        <!-- Step 1: ID Document Upload -->
                        <div class="kyc-step active" id="kyc-step-1-content">
                            <h4 style="margin-bottom: 15px;">Upload Your ID Document</h4>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Document Type</label>
                                    <select class="form-control" id="document-type">
                                        <option value="">Select document type</option>
                                        <option value="passport">Passport</option>
                                        <option value="drivers_license">Driver's License</option>
                                        <option value="national_id">National ID</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Document Number</label>
                                    <input type="text" class="form-control" id="document-number" placeholder="Enter document number">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Expiration Date</label>
                                <input type="date" class="form-control" id="document-expiry">
                            </div>
                            
                            <div class="document-upload-area" id="id-front-upload">
                                <div class="document-upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div class="document-upload-text">Upload Front of ID Document</div>
                                <div class="document-upload-hint">Supported formats: JPG, PNG, PDF (Max 5MB)</div>
                                <input type="file" id="id-front-file" accept="image/*,.pdf" style="display: none;">
                            </div>
                            
                            <div class="document-preview" id="id-front-preview">
                                <img id="id-front-preview-image" src="" alt="ID Front Preview">
                                <div class="document-preview-actions">
                                    <button class="btn btn-outline" onclick="removeDocument('id-front')">Remove</button>
                                </div>
                            </div>
                            
                            <div class="document-upload-area" id="id-back-upload">
                                <div class="document-upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div class="document-upload-text">Upload Back of ID Document</div>
                                <div class="document-upload-hint">Supported formats: JPG, PNG, PDF (Max 5MB)</div>
                                <input type="file" id="id-back-file" accept="image/*,.pdf" style="display: none;">
                            </div>
                            
                            <div class="document-preview" id="id-back-preview">
                                <img id="id-back-preview-image" src="" alt="ID Back Preview">
                                <div class="document-preview-actions">
                                    <button class="btn btn-outline" onclick="removeDocument('id-back')">Remove</button>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" onclick="resetKYC()">Cancel</button>
                                <button type="button" class="btn btn-primary" id="save-id-document-btn" onclick="saveIDDocument()">Save & Continue</button>
                            </div>
                        </div>
                        
                        <!-- Step 2: Address Proof -->
                        <div class="kyc-step" id="kyc-step-2-content">
                            <h4 style="margin-bottom: 15px;">Upload Address Proof</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Document Type</label>
                                <select class="form-control" id="address-document-type">
                                    <option value="">Select document type</option>
                                    <option value="utility_bill">Utility Bill</option>
                                    <option value="bank_statement">Bank Statement</option>
                                    <option value="government_letter">Government Letter</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Document Issue Date</label>
                                <input type="date" class="form-control" id="address-document-date">
                            </div>
                            
                            <div class="document-upload-area" id="address-document-upload">
                                <div class="document-upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div class="document-upload-text">Upload Your Address Proof</div>
                                <div class="document-upload-hint">Supported formats: JPG, PNG, PDF (Max 5MB)</div>
                                <input type="file" id="address-document-file" accept="image/*,.pdf" style="display: none;">
                            </div>
                            
                            <div class="document-preview" id="address-document-preview">
                                <img id="address-document-preview-image" src="" alt="Address Document Preview">
                                <div class="document-preview-actions">
                                    <button class="btn btn-outline" onclick="removeDocument('address')">Remove</button>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" onclick="prevKYCStep(2)">Back</button>
                                <button type="button" class="btn btn-primary" id="save-address-document-btn" onclick="saveAddressDocument()">Save & Continue</button>
                            </div>
                        </div>
                        
                        <!-- Step 3: Facial Verification -->
                        <div class="kyc-step" id="kyc-step-3-content">
                            <h4 style="margin-bottom: 15px;">Facial Verification</h4>
                            
                            <div class="facial-instructions">
                                <h4>Instructions:</h4>
                                <ol>
                                    <li>Click "Start Camera" to begin facial verification</li>
                                    <li>Hold your ID document next to your face</li>
                                    <li>Follow the on-screen instructions for head movements</li>
                                    <li>Make sure your face and ID are clearly visible</li>
                                    <li>Click "Capture" when ready</li>
                                </ol>
                            </div>
                            
                            <div class="facial-verification-container">
                                <div class="verification-photo-container" id="verification-photo-container">
                                    <img id="verification-photo" src="" alt="Verification Photo">
                                </div>
                                
                                <div class="webcam-container" id="webcam-container">
                                    <video id="webcam-video" autoplay playsinline></video>
                                    <div class="webcam-controls">
                                        <button class="capture-btn" id="capture-btn">
                                            <i class="fas fa-camera"></i>
                                        </button>
                                    </div>
                                    <canvas id="webcam-canvas" style="display: none;"></canvas>
                                </div>
                                
                                <div class="facial-verification-status" id="facial-verification-status">
                                    <!-- Status messages will be displayed here -->
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-outline" onclick="prevKYCStep(3)">Back</button>
                                    <button type="button" class="btn btn-primary" id="start-camera-btn" onclick="startFacialVerification()">Start Camera</button>
                                    <button type="button" class="btn btn-primary" id="submit-photo-btn" style="display: none;" onclick="submitFacialVerification()">Submit Verification</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 4: Complete -->
                        <div class="kyc-step" id="kyc-step-4-content">
                            <div style="text-align: center; padding: 30px 0;">
                                <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--success); margin-bottom: 20px;"></i>
                                <h3 style="margin-bottom: 15px;">KYC Verification Complete!</h3>
                                <p style="margin-bottom: 25px; color: var(--gray);">
                                    Your KYC verification has been successfully submitted and is being reviewed.
                                    You will receive a notification once the verification is complete.
                                </p>
                                <button type="button" class="btn btn-primary" onclick="submitKYCVerification()">Submit for Review</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Notifications Section -->
                <div class="settings-section" id="notifications-section">
                    <h2 class="settings-section-title">
                        <i class="fas fa-bell"></i> Notification Preferences
                    </h2>
                    
                    <div class="settings-card">
                        <h3 class="settings-card-title">
                            <i class="fas fa-envelope"></i> Email Notifications
                        </h3>
                        
                        <form id="email-notifications-form">
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">Account Activity</label>
                                    <p style="font-size: 0.9rem; color: var(--gray);">Important notifications about your account</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="email-account-activity" checked>
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">Investment Updates</label>
                                    <p style="font-size: 0.9rem; color: var(--gray);">Daily and weekly mining reports</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="email-investment-updates" checked>
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">Promotional Offers</label>
                                    <p style="font-size: 0.9rem; color: var(--gray);">Special offers and new features</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="email-promotional-offers">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" id="reset-email-notifications-btn">Reset to Default</button>
                                <button type="submit" class="btn btn-primary" id="save-email-notifications-btn">Save Preferences</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="settings-card">
                        <h3 class="settings-card-title">
                            <i class="fas fa-sms"></i> SMS Notifications
                        </h3>
                        
                        <form id="sms-notifications-form">
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">Security Alerts</label>
                                    <p style="font-size: 0.9rem; color: var(--gray);">Immediate notifications for security events</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="sms-security-alerts" checked>
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">Withdrawal Confirmations</label>
                                    <p style="font-size: 0.9rem; color: var(--gray);">Confirm large withdrawals via SMS</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="sms-withdrawal-confirmations" checked>
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">Marketing Messages</label>
                                    <p style="font-size: 0.9rem; color: var(--gray);">Promotional offers and updates</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="sms-marketing-messages">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" id="reset-sms-notifications-btn">Reset to Default</button>
                                <button type="submit" class="btn btn-primary" id="save-sms-notifications-btn">Save Preferences</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="settings-card">
                        <h3 class="settings-card-title">
                            <i class="fas fa-bell"></i> Push Notifications
                        </h3>
                        
                        <form id="push-notifications-form">
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">Account Activity</label>
                                    <p style="font-size: 0.9rem; color: var(--gray);">Real-time notifications about your account</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="push-account-activity" checked>
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">Investment Updates</label>
                                    <p style="font-size: 0.9rem; color: var(--gray);">Daily mining performance updates</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="push-investment-updates" checked>
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">Market Alerts</label>
                                    <p style="font-size: 0.9rem; color: var(--gray);">Significant Bitcoin price movements</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="push-market-alerts">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" id="reset-push-notifications-btn">Reset to Default</button>
                                <button type="submit" class="btn btn-primary" id="save-push-notifications-btn">Save Preferences</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- API Keys Section -->
                <div class="settings-section" id="api-section">
                    <h2 class="settings-section-title">
                        <i class="fas fa-key"></i> API Keys Management
                    </h2>
                    
                    <div class="settings-card">
                        <h3 class="settings-card-title">
                            <i class="fas fa-key"></i> Your API Keys
                        </h3>
                        
                        <p style="margin-bottom: 20px; color: var(--gray);">
                            API keys allow external applications to access your BitHash account data. 
                            Treat them like passwords and keep them secure.
                        </p>
                        
                        <table class="api-key-table" id="api-keys-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Permissions</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dynamically populated from backend -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="settings-card">
                        <h3 class="settings-card-title">
                            <i class="fas fa-plus-circle"></i> Create New API Key
                        </h3>
                        
                        <form id="api-key-form" class="api-key-form">
                            <div class="form-group">
                                <label for="api-key-name" class="form-label">Key Name</label>
                                <input type="text" id="api-key-name" class="form-control" placeholder="e.g., Trading Bot" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Permissions</label>
                                <div class="api-key-scopes">
                                    <div class="api-key-scope">
                                        <input type="checkbox" id="scope-read" checked>
                                        <div>
                                            <label for="scope-read" class="api-key-scope-label">Read</label>
                                            <p class="api-key-scope-description">View account balances and transactions</p>
                                        </div>
                                    </div>
                                    <div class="api-key-scope">
                                        <input type="checkbox" id="scope-trade">
                                        <div>
                                            <label for="scope-trade" class="api-key-scope-label">Trade</label>
                                            <p class="api-key-scope-description">Create and manage investments</p>
                                        </div>
                                    </div>
                                    <div class="api-key-scope">
                                        <input type="checkbox" id="scope-withdraw" disabled>
                                        <div>
                                            <label for="scope-withdraw" class="api-key-scope-label">Withdraw</label>
                                            <p class="api-key-scope-description">Withdraw funds (requires additional verification)</p>
                                        </div>
                                    </div>
                                    <div class="api-key-scope">
                                        <input type="checkbox" id="scope-market">
                                        <div>
                                            <label for="scope-market" class="api-key-scope-label">Market Data</label>
                                            <p class="api-key-scope-description">Access market prices and history</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="api-key-expiry" class="form-label">Expiration</label>
                                <select id="api-key-expiry" class="form-control">
                                    <option value="30">30 Days</option>
                                    <option value="90">90 Days</option>
                                    <option value="180">6 Months</option>
                                    <option value="365">1 Year</option>
                                    <option value="0">No Expiration</option>
                                </select>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" id="cancel-api-key-btn">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="create-api-key-btn">Create API Key</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contact">
        <div class="container">
            <div class="footer-container">
                <div class="footer-about">
                    <div class="footer-logo">
        <img src="https://www.dropbox.com/scl/fi/1dq16nex1borvvknpcwox/circular_dark_background.png?rlkey=sq2ujl2oxxk9vyvg1j7oz0cdb&raw=1" alt="BitHash Logo" class="loading-logo">    
                        <span class="footer-logo-text"><span class="bitcoin-animation">â‚¿</span>itHash</span>
                    </div>
                    <p>Bitcoin mining platform serving investors worldwide with transparent operations and reliable returns.</p>
                    <div class="footer-social">
   <!-- Social Share Buttons -->
<a href="https://twitter.com/intent/tweet?url=https://bithhash.vercel.app/&text=Check%20out%20this%20Bitcoin%20mining%20platform!" 
   class="social-icon twitter" aria-label="Twitter" target="_blank" rel="noopener">
   <i class="fab fa-twitter"></i>
</a>

<a href="https://www.linkedin.com/sharing/share-offsite/?url=https://bithhash.vercel.app/" 
   class="social-icon linkedin" aria-label="LinkedIn" target="_blank" rel="noopener">
   <i class="fab fa-linkedin-in"></i>
</a>

<a href="https://www.facebook.com/sharer/sharer.php?u=https://bithhash.vercel.app/" 
   class="social-icon facebook" aria-label="Facebook" target="_blank" rel="noopener">
   <i class="fab fa-facebook-f"></i>
</a>

<a href="https://www.instagram.com" 
   class="social-icon instagram" aria-label="Instagram" target="_blank" rel="noopener" 
   onclick="alert('Instagram does not support direct sharing via links. Please share manually.'); return false;">
   <i class="fab fa-instagram"></i>
</a>

</div>
                    </div>
                </div>
                
                <div class="footer-links">
                    <h3 class="footer-title">Platform</h3>
                    <ul>
                        <li><a href="#home">Dashboard</a></li>
                        <li><a href="#plans">Investment Plans</a></li>
                        <li><a href="#loans">Loans</a></li>
                        <li><a href="dashboard.html">My Account</a></li>
                        <li><a href="rewards.html">Rewards</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h3 class="footer-title">Company</h3>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="careers.html">Careers</a></li>
                        <li><a href="press.html">Press</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="partners.html">Partners</a></li>
                    </ul>
                </div>
                
                <div class="footer-contact">
                    <h3 class="footer-title">Contact Us</h3>
                    <p><i class="fas fa-envelope"></i> support@bithash.com</p>
                    <p><i class="fas fa-phone"></i> +1 606-363-2032</p>
                    <p><i class="fas fa-map-marker-alt"></i> 800 Plant St, Wilmington, DE 19801, United States</p>
                    <p><i class="fas fa-clock"></i> 24/7 Support</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; <span id="current-year"></span> BitHash LLC. All Rights Reserved. Registered in Delaware, USA. FINRA/SIPC Member.</p>
            </div>
        </div>
    </footer>

    <!-- Email and Password Verification Modal -->
    <div class="modal-overlay" id="email-password-modal">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">Account Verification Required</h3>
                <button class="modal-close" onclick="closeModal('email-password-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="disclaimer">
                    <div class="disclaimer-title">Security Verification</div>
                    <p>For security purposes, please enter your registered email and password to proceed with the KYC submission.</p>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" id="verification-email" class="form-control" placeholder="Enter your registered email">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="verification-password" class="form-control" placeholder="Enter your password">
                </div>
                
                <div class="disclaimer">
                    <div class="disclaimer-title">Privacy Notice</div>
                    <p>Your credentials are securely transmitted and used only for verification purposes.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('email-password-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="verifyCredentials()">
                    <i class="fas fa-check-circle"></i> Verify & Submit KYC
                </button>
            </div>
        </div>
    </div>

    <!-- KYC Success Modal -->
    <div class="modal-overlay" id="kyc-success-modal">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">KYC Submitted Successfully</h3>
                <button class="modal-close" onclick="closeModal('kyc-success-modal')">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <div style="margin: 16px 0;">
                    <i class="fas fa-check-circle" style="font-size: 2.5rem; color: var(--success); margin-bottom: 16px;"></i>
                    <h4 style="margin-bottom: 8px;">KYC Verification Submitted</h4>
                    <p>Your KYC documents have been successfully submitted for verification.</p>
                    <p>You will receive a notification once the verification is complete.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('kyc-success-modal')">
                    <i class="fas fa-check"></i> Done
                </button>
            </div>
        </div>
    </div>

<!-- AOS Animation -->
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<!-- Google Places API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB6Ty5ZHqoSA2jlyqnyi1c7HqLp6G8Ij7I&libraries=places"></script>

<script>
    // Initialize AOS animation
    AOS.init({
        duration: 800,
        once: true,
        easing: 'ease-in-out'
    });
    
    // Global state for the application
    const AppState = {
        userData: null,
        kycStatus: {
            identity: 'unverified',
            address: 'unverified',
            facial: 'unverified'
        },
        kycData: {
            idDocument: null,
            addressDocument: null,
            facialVerification: null
        },
        notificationPreferences: {
            email: {
                accountActivity: true,
                investmentUpdates: true,
                promotionalOffers: false
            },
            sms: {
                securityAlerts: true,
                withdrawalConfirmations: true,
                marketingMessages: false
            },
            push: {
                accountActivity: true,
                investmentUpdates: true,
                marketAlerts: false
            }
        },
        apiKeys: [],
        twoFactorMethods: [],
        activeDevices: [],
        activityLogs: [],
        currentKYCStep: 1,
        webcamStream: null,
        facialVerificationInterval: null
    };

    // Hide loading overlay when page is loaded
    window.addEventListener('load', function() {
        setTimeout(async function() {
            document.getElementById('loading-overlay').classList.add('hidden');
            
            // Initialize Google Places Autocomplete
            initPlacesAutocomplete();
            
            // Check authentication and load user data
            await checkAuthState();
            
            // Load all data sections
            await loadUserProfile();
            await loadSecurityData();
            await loadKYCData();
            await loadNotificationPreferences();
            await loadAPIKeys();
            
            // Initialize password strength meter
            initPasswordStrengthMeter();
            
            // Initialize settings sidebar navigation
            initSettingsNavigation();
            
            // Initialize mobile menu
            initMobileMenu();
            
            // Initialize header scroll effect
            initHeaderScrollEffect();
            
            // Initialize KYC document upload
            initKYCDocumentUpload();
            
            // Initialize facial verification
            initFacialVerification();
            
            // Initialize form submissions
            initFormSubmissions();
            
        }, 1000);
    });
    
    /* ============================================= */
    /* Initialization Functions */
    /* ============================================= */
    
    // Initialize Google Places Autocomplete
    function initPlacesAutocomplete() {
        // Country field in profile section
        const countryInput = document.getElementById('country');
        if (countryInput) {
            const countryAutocomplete = new google.maps.places.Autocomplete(countryInput, {
                types: ['(regions)'],
                fields: ['address_components', 'formatted_address']
            });
            
            countryAutocomplete.addListener('place_changed', function() {
                const place = countryAutocomplete.getPlace();
                if (!place.address_components) return;
                
                // Extract country from the place result
                for (const component of place.address_components) {
                    if (component.types.includes('country')) {
                        countryInput.value = component.long_name;
                        break;
                    }
                }
            });
        }
        
        // Street address field
        const streetAddressInput = document.getElementById('street-address');
        if (streetAddressInput) {
            const addressAutocomplete = new google.maps.places.Autocomplete(streetAddressInput, {
                types: ['address'],
                fields: ['address_components', 'formatted_address', 'geometry']
            });
            
            addressAutocomplete.addListener('place_changed', function() {
                const place = addressAutocomplete.getPlace();
                if (!place.address_components) return;
                
                // Extract address components
                const addressComponents = {
                    street_number: '',
                    route: '',
                    locality: '',
                    administrative_area_level_1: '',
                    country: '',
                    postal_code: ''
                };
                
                for (const component of place.address_components) {
                    if (component.types.includes('street_number')) {
                        addressComponents.street_number = component.long_name;
                    }
                    if (component.types.includes('route')) {
                        addressComponents.route = component.long_name;
                    }
                    if (component.types.includes('locality')) {
                        document.getElementById('city').value = component.long_name;
                    }
                    if (component.types.includes('administrative_area_level_1')) {
                        document.getElementById('state').value = component.long_name;
                    }
                    if (component.types.includes('country')) {
                        document.getElementById('country-address').value = component.long_name;
                    }
                    if (component.types.includes('postal_code')) {
                        document.getElementById('postal-code').value = component.long_name;
                    }
                }
                
                // Build street address
                const streetAddress = [
                    addressComponents.street_number,
                    addressComponents.route
                ].filter(Boolean).join(' ');
                
                if (streetAddress) {
                    streetAddressInput.value = streetAddress;
                }
            });
        }
        
        // City field
        const cityInput = document.getElementById('city');
        if (cityInput) {
            const cityAutocomplete = new google.maps.places.Autocomplete(cityInput, {
                types: ['(cities)'],
                fields: ['address_components', 'formatted_address']
            });
            
            cityAutocomplete.addListener('place_changed', function() {
                const place = cityAutocomplete.getPlace();
                if (!place.address_components) return;
                
                for (const component of place.address_components) {
                    if (component.types.includes('locality')) {
                        cityInput.value = component.long_name;
                        break;
                    }
                }
            });
        }
        
        // Country field in address section
        const countryAddressInput = document.getElementById('country-address');
        if (countryAddressInput) {
            const countryAddressAutocomplete = new google.maps.places.Autocomplete(countryAddressInput, {
                types: ['(regions)'],
                fields: ['address_components', 'formatted_address']
            });
            
            countryAddressAutocomplete.addListener('place_changed', function() {
                const place = countryAddressAutocomplete.getPlace();
                if (!place.address_components) return;
                
                for (const component of place.address_components) {
                    if (component.types.includes('country')) {
                        countryAddressInput.value = component.long_name;
                        break;
                    }
                }
            });
        }
    }
    
    // Initialize password strength meter
    function initPasswordStrengthMeter() {
        const passwordInput = document.getElementById('new-password');
        const strengthMeter = document.getElementById('password-strength-meter');
        const strengthText = document.getElementById('password-strength-text');
        
        if (passwordInput) {
            passwordInput.addEventListener('input', function() {
                const password = this.value;
                let strength = 0;
                
                // Length check
                if (password.length >= 8) strength += 1;
                if (password.length >= 12) strength += 1;
                
                // Complexity checks
                if (/[A-Z]/.test(password)) strength += 1;
                if (/[0-9]/.test(password)) strength += 1;
                if (/[^A-Za-z0-9]/.test(password)) strength += 1;
                
                // Update meter
                let width = 0;
                let color = '';
                let text = '';
                
                if (strength <= 2) {
                    width = 33;
                    color = 'var(--error)';
                    text = 'Weak';
                } else if (strength <= 4) {
                    width = 66;
                    color = 'var(--warning)';
                    text = 'Medium';
                } else {
                    width = 100;
                    color = 'var(--success)';
                    text = 'Strong';
                }
                
                strengthMeter.style.width = width + '%';
                strengthMeter.style.background = color;
                strengthText.textContent = 'Password strength: ' + text;
                strengthText.style.color = color;
            });
        }
    }
    
    // Initialize settings sidebar navigation
    function initSettingsNavigation() {
        const menuLinks = document.querySelectorAll('.settings-menu a');
        const sections = document.querySelectorAll('.settings-section');
        
        menuLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links and sections
                menuLinks.forEach(l => l.classList.remove('active'));
                sections.forEach(s => s.classList.remove('active'));
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Show corresponding section
                const targetId = this.getAttribute('href').substring(1) + '-section';
                document.getElementById(targetId).classList.add('active');
            });
        });
    }
    
    // Initialize mobile menu - Enhanced with smooth animation
    function initMobileMenu() {
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mainNav = document.getElementById('main-nav');
        
        if (mobileMenuToggle && mainNav) {
            mobileMenuToggle.addEventListener('click', function() {
                this.classList.toggle('active');
                mainNav.classList.toggle('active');
                this.setAttribute('aria-expanded', mainNav.classList.contains('active'));
                
                // Toggle body overflow when menu is open
                if (mainNav.classList.contains('active')) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = '';
                }
            });
            
            // Close mobile menu when clicking a link
            document.querySelectorAll('#main-nav a').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        mobileMenuToggle.classList.remove('active');
                        mainNav.classList.remove('active');
                        document.body.style.overflow = '';
                        mobileMenuToggle.setAttribute('aria-expanded', 'false');
                    }
                });
            });
        }
    }
    
    // Initialize header scroll effect
    function initHeaderScrollEffect() {
        window.addEventListener('scroll', function() {
            const header = document.getElementById('main-header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
    }
    
    // Initialize KYC document upload
    function initKYCDocumentUpload() {
        // ID Front Upload
        const idFrontUpload = document.getElementById('id-front-upload');
        const idFrontFile = document.getElementById('id-front-file');
        
        idFrontUpload.addEventListener('click', () => idFrontFile.click());
        idFrontUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            idFrontUpload.classList.add('dragover');
        });
        idFrontUpload.addEventListener('dragleave', () => {
            idFrontUpload.classList.remove('dragover');
        });
        idFrontUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            idFrontUpload.classList.remove('dragover');
            if (e.dataTransfer.files.length) {
                handleDocumentUpload(e.dataTransfer.files[0], 'id-front');
            }
        });
        
        idFrontFile.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleDocumentUpload(e.target.files[0], 'id-front');
            }
        });
        
        // ID Back Upload
        const idBackUpload = document.getElementById('id-back-upload');
        const idBackFile = document.getElementById('id-back-file');
        
        idBackUpload.addEventListener('click', () => idBackFile.click());
        idBackUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            idBackUpload.classList.add('dragover');
        });
        idBackUpload.addEventListener('dragleave', () => {
            idBackUpload.classList.remove('dragover');
        });
        idBackUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            idBackUpload.classList.remove('dragover');
            if (e.dataTransfer.files.length) {
                handleDocumentUpload(e.dataTransfer.files[0], 'id-back');
            }
        });
        
        idBackFile.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleDocumentUpload(e.target.files[0], 'id-back');
            }
        });
        
        // Address Document Upload
        const addressUpload = document.getElementById('address-document-upload');
        const addressFile = document.getElementById('address-document-file');
        
        addressUpload.addEventListener('click', () => addressFile.click());
        addressUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            addressUpload.classList.add('dragover');
        });
        addressUpload.addEventListener('dragleave', () => {
            addressUpload.classList.remove('dragover');
        });
        addressUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            addressUpload.classList.remove('dragover');
            if (e.dataTransfer.files.length) {
                handleDocumentUpload(e.dataTransfer.files[0], 'address');
            }
        });
        
        addressFile.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleDocumentUpload(e.target.files[0], 'address');
            }
        });
    }
    
    // Handle document upload
    function handleDocumentUpload(file, type) {
        // Check file type and size
        const validTypes = ['image/jpeg', 'image/png', 'application/pdf'];
        const maxSize = 5 * 1024 * 1024; // 5MB
        
        if (!validTypes.includes(file.type)) {
            showNotification('error', 'Invalid File Type', 'Please upload JPG, PNG, or PDF files only.');
            return;
        }
        
        if (file.size > maxSize) {
            showNotification('error', 'File Too Large', 'File size must be less than 5MB.');
            return;
        }
        
        // Show preview for images
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewId = `${type}-preview`;
                const previewImageId = `${type}-preview-image`;
                
                document.getElementById(previewImageId).src = e.target.result;
                document.getElementById(previewId).style.display = 'block';
                
                // Hide upload area
                document.getElementById(`${type}-upload`).style.display = 'none';
                
                // Store file data
                if (type === 'id-front') {
                    AppState.kycData.idDocument = {
                        front: file,
                        frontPreview: e.target.result
                    };
                } else if (type === 'id-back') {
                    if (!AppState.kycData.idDocument) {
                        AppState.kycData.idDocument = {};
                    }
                    AppState.kycData.idDocument.back = file;
                    AppState.kycData.idDocument.backPreview = e.target.result;
                } else if (type === 'address') {
                    AppState.kycData.addressDocument = {
                        file: file,
                        preview: e.target.result
                    };
                }
            };
            reader.readAsDataURL(file);
        } else {
            // For PDF files, just store the file
            if (type === 'id-front') {
                AppState.kycData.idDocument = {
                    front: file
                };
            } else if (type === 'id-back') {
                if (!AppState.kycData.idDocument) {
                    AppState.kycData.idDocument = {};
                }
                AppState.kycData.idDocument.back = file;
            } else if (type === 'address') {
                AppState.kycData.addressDocument = {
                    file: file
                };
            }
            
            // Show success message for PDF
            showNotification('success', 'Document Uploaded', 'PDF document uploaded successfully.');
            
            // Hide upload area and show placeholder
            const previewId = `${type}-preview`;
            document.getElementById(previewId).innerHTML = `
                <div style="padding: 20px; text-align: center;">
                    <i class="fas fa-file-pdf" style="font-size: 3rem; color: var(--primary); margin-bottom: 10px;"></i>
                    <p>${file.name}</p>
                    <div class="document-preview-actions">
                        <button class="btn btn-outline" onclick="removeDocument('${type}')">Remove</button>
                    </div>
                </div>
            `;
            document.getElementById(previewId).style.display = 'block';
            document.getElementById(`${type}-upload`).style.display = 'none';
        }
    }
    
    // Remove document
    function removeDocument(type) {
        if (type === 'id-front') {
            AppState.kycData.idDocument = null;
            document.getElementById('id-front-preview').style.display = 'none';
            document.getElementById('id-front-upload').style.display = 'block';
            document.getElementById('id-front-file').value = '';
        } else if (type === 'id-back') {
            if (AppState.kycData.idDocument) {
                AppState.kycData.idDocument.back = null;
                AppState.kycData.idDocument.backPreview = null;
            }
            document.getElementById('id-back-preview').style.display = 'none';
            document.getElementById('id-back-upload').style.display = 'block';
            document.getElementById('id-back-file').value = '';
        } else if (type === 'address') {
            AppState.kycData.addressDocument = null;
            document.getElementById('address-document-preview').style.display = 'none';
            document.getElementById('address-document-upload').style.display = 'block';
            document.getElementById('address-document-file').value = '';
        }
    }
    
    // Initialize facial verification
    function initFacialVerification() {
        // This will be called when the user starts facial verification
    }
    
    // Start facial verification
    async function startFacialVerification() {
        try {
            // Request camera access
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    width: { ideal: 640 },
                    height: { ideal: 480 },
                    facingMode: 'user'
                } 
            });
            
            AppState.webcamStream = stream;
            
            // Show webcam container
            document.getElementById('webcam-container').style.display = 'block';
            document.getElementById('start-camera-btn').style.display = 'none';
            document.getElementById('submit-photo-btn').style.display = 'inline-flex';
            
            // Set video source
            const video = document.getElementById('webcam-video');
            video.srcObject = stream;
            
            // Start facial detection simulation
            startFacialDetection();
            
        } catch (error) {
            console.error('Error accessing camera:', error);
            showNotification('error', 'Camera Error', 'Unable to access camera. Please check permissions and try again.');
        }
    }
    
    // Start facial detection simulation
    function startFacialDetection() {
        const statusElement = document.getElementById('facial-verification-status');
        statusElement.style.display = 'block';
        statusElement.className = 'facial-verification-status';
        statusElement.innerHTML = '<i class="fas fa-search"></i> Detecting face...';
        
        // Simulate face detection
        setTimeout(() => {
            statusElement.innerHTML = '<i class="fas fa-check"></i> Face detected! Please hold your ID next to your face.';
            statusElement.className = 'facial-verification-status success';
            
            // Start random instructions after face is detected
            startRandomInstructions();
        }, 2000);
    }
    
    // Start random instructions for facial verification
    function startRandomInstructions() {
        const instructions = [
            "Please move your head slowly to the left",
            "Now slowly move your head to the right",
            "Please look up towards the ceiling",
            "Now look down towards your feet",
            "Perfect! Please hold still for a moment"
        ];
        
        let currentInstruction = 0;
        const statusElement = document.getElementById('facial-verification-status');
        
        AppState.facialVerificationInterval = setInterval(() => {
            if (currentInstruction < instructions.length) {
                statusElement.innerHTML = `<i class="fas fa-info-circle"></i> ${instructions[currentInstruction]}`;
                currentInstruction++;
            } else {
                clearInterval(AppState.facialVerificationInterval);
                statusElement.innerHTML = '<i class="fas fa-check"></i> All movements completed! You can now capture the photo.';
                statusElement.className = 'facial-verification-status success';
            }
        }, 3000); // Change instruction every 3 seconds
    }
    
    // Capture photo for facial verification
    function capturePhoto() {
        const video = document.getElementById('webcam-video');
        const canvas = document.getElementById('webcam-canvas');
        const context = canvas.getContext('2d');
        
        // Set canvas dimensions to match video
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        // Draw video frame to canvas
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // Convert canvas to data URL
        const photoData = canvas.toDataURL('image/jpeg');
        
        // Display captured photo
        document.getElementById('verification-photo').src = photoData;
        document.getElementById('verification-photo-container').style.display = 'block';
        
        // Store photo data
        AppState.kycData.facialVerification = photoData;
        
        // Stop camera stream
        if (AppState.webcamStream) {
            AppState.webcamStream.getTracks().forEach(track => track.stop());
            AppState.webcamStream = null;
        }
        
        // Hide webcam container
        document.getElementById('webcam-container').style.display = 'none';
        
        // Clear any intervals
        if (AppState.facialVerificationInterval) {
            clearInterval(AppState.facialVerificationInterval);
            AppState.facialVerificationInterval = null;
        }
        
        // Update status
        const statusElement = document.getElementById('facial-verification-status');
        statusElement.innerHTML = '<i class="fas fa-check"></i> Photo captured successfully!';
        statusElement.className = 'facial-verification-status success';
        
        showNotification('success', 'Photo Captured', 'Facial verification photo has been captured successfully.');
    }
    
    // Submit facial verification
    function submitFacialVerification() {
        if (!AppState.kycData.facialVerification) {
            showNotification('error', 'No Photo', 'Please capture a photo first.');
            return;
        }
        
        // In a real implementation, you would send the photo to your backend
        // For now, we'll simulate a successful submission
        
        showNotification('success', 'Facial Verification', 'Facial verification completed successfully.');
        nextKYCStep();
    }
    
    // Initialize form submissions
    function initFormSubmissions() {
        // Profile form
        const profileForm = document.getElementById('profile-form');
        if (profileForm) {
            profileForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                await saveProfile();
            });
        }
        
        // Address form
        const addressForm = document.getElementById('address-form');
        if (addressForm) {
            addressForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                await saveAddress();
            });
        }
        
        // Password form
        const passwordForm = document.getElementById('password-form');
        if (passwordForm) {
            passwordForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                await changePassword();
            });
        }
        
        // Email notifications form
        const emailNotificationsForm = document.getElementById('email-notifications-form');
        if (emailNotificationsForm) {
            emailNotificationsForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                await saveEmailNotifications();
            });
        }
        
        // SMS notifications form
        const smsNotificationsForm = document.getElementById('sms-notifications-form');
        if (smsNotificationsForm) {
            smsNotificationsForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                await saveSMSNotifications();
            });
        }
        
        // Push notifications form
        const pushNotificationsForm = document.getElementById('push-notifications-form');
        if (pushNotificationsForm) {
            pushNotificationsForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                await savePushNotifications();
            });
        }
        
        // API key form
        const apiKeyForm = document.getElementById('api-key-form');
        if (apiKeyForm) {
            apiKeyForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                await createAPIKey();
            });
        }
        
        // Reset buttons
        const resetEmailBtn = document.getElementById('reset-email-notifications-btn');
        if (resetEmailBtn) {
            resetEmailBtn.addEventListener('click', resetEmailNotifications);
        }
        
        const resetSmsBtn = document.getElementById('reset-sms-notifications-btn');
        if (resetSmsBtn) {
            resetSmsBtn.addEventListener('click', resetSMSNotifications);
        }
        
        const resetPushBtn = document.getElementById('reset-push-notifications-btn');
        if (resetPushBtn) {
            resetPushBtn.addEventListener('click', resetPushNotifications);
        }
        
        // Capture button for facial verification
        const captureBtn = document.getElementById('capture-btn');
        if (captureBtn) {
            captureBtn.addEventListener('click', capturePhoto);
        }
    }
    
    /* ============================================= */
    /* KYC Flow Functions */
    /* ============================================= */
    
    // Save ID document and move to next step
    function saveIDDocument() {
        // Validate form
        const documentType = document.getElementById('document-type').value;
        const documentNumber = document.getElementById('document-number').value;
        
        if (!documentType || !documentNumber) {
            showNotification('error', 'Missing Information', 'Please fill in all required fields.');
            return;
        }
        
        if (!AppState.kycData.idDocument || !AppState.kycData.idDocument.front) {
            showNotification('error', 'Missing Document', 'Please upload the front of your ID document.');
            return;
        }
        
        // Store document info
        AppState.kycData.idDocument.type = documentType;
        AppState.kycData.idDocument.number = documentNumber;
        AppState.kycData.idDocument.expiry = document.getElementById('document-expiry').value;
        
        showNotification('success', 'ID Document Saved', 'ID document information has been saved.');
        nextKYCStep();
    }
    
    // Save address document and move to next step
    function saveAddressDocument() {
        // Validate form
        const documentType = document.getElementById('address-document-type').value;
        
        if (!documentType) {
            showNotification('error', 'Missing Information', 'Please select a document type.');
            return;
        }
        
        if (!AppState.kycData.addressDocument) {
            showNotification('error', 'Missing Document', 'Please upload your address proof document.');
            return;
        }
        
        // Store document info
        AppState.kycData.addressDocument.type = documentType;
        AppState.kycData.addressDocument.issueDate = document.getElementById('address-document-date').value;
        
        showNotification('success', 'Address Proof Saved', 'Address proof information has been saved.');
        nextKYCStep();
    }
    
    // Move to next KYC step
    function nextKYCStep() {
        if (AppState.currentKYCStep < 4) {
            // Hide current step
            document.getElementById(`kyc-step-${AppState.currentKYCStep}-content`).classList.remove('active');
            document.getElementById(`kyc-step-${AppState.currentKYCStep}`).classList.remove('active');
            
            // Show next step
            AppState.currentKYCStep++;
            document.getElementById(`kyc-step-${AppState.currentKYCStep}-content`).classList.add('active');
            document.getElementById(`kyc-step-${AppState.currentKYCStep}`).classList.add('active');
            
            // Mark previous step as completed
            document.getElementById(`kyc-step-${AppState.currentKYCStep - 1}`).classList.add('completed');
        }
    }
    
    // Move to previous KYC step
    function prevKYCStep(step) {
        if (step > 1) {
            // Hide current step
            document.getElementById(`kyc-step-${step}-content`).classList.remove('active');
            document.getElementById(`kyc-step-${step}`).classList.remove('active');
            
            // Show previous step
            AppState.currentKYCStep = step - 1;
            document.getElementById(`kyc-step-${AppState.currentKYCStep}-content`).classList.add('active');
            document.getElementById(`kyc-step-${AppState.currentKYCStep}`).classList.add('active');
            
            // Remove completed status from current step
            document.getElementById(`kyc-step-${step}`).classList.remove('completed');
        }
    }
    
    // Reset KYC process
    function resetKYC() {
        // Reset all steps
        for (let i = 1; i <= 4; i++) {
            document.getElementById(`kyc-step-${i}-content`).classList.remove('active');
            document.getElementById(`kyc-step-${i}`).classList.remove('active');
            document.getElementById(`kyc-step-${i}`).classList.remove('completed');
        }
        
        // Show first step
        AppState.currentKYCStep = 1;
        document.getElementById('kyc-step-1-content').classList.add('active');
        document.getElementById('kyc-step-1').classList.add('active');
        
        // Reset KYC data
        AppState.kycData = {
            idDocument: null,
            addressDocument: null,
            facialVerification: null
        };
        
        // Reset form fields
        document.getElementById('document-type').value = '';
        document.getElementById('document-number').value = '';
        document.getElementById('document-expiry').value = '';
        document.getElementById('address-document-type').value = '';
        document.getElementById('address-document-date').value = '';
        
        // Reset upload areas
        document.getElementById('id-front-upload').style.display = 'block';
        document.getElementById('id-back-upload').style.display = 'block';
        document.getElementById('address-document-upload').style.display = 'block';
        document.getElementById('id-front-preview').style.display = 'none';
        document.getElementById('id-back-preview').style.display = 'none';
        document.getElementById('address-document-preview').style.display = 'none';
        document.getElementById('verification-photo-container').style.display = 'none';
        document.getElementById('webcam-container').style.display = 'none';
        document.getElementById('start-camera-btn').style.display = 'inline-flex';
        document.getElementById('submit-photo-btn').style.display = 'none';
        
        // Clear file inputs
        document.getElementById('id-front-file').value = '';
        document.getElementById('id-back-file').value = '';
        document.getElementById('address-document-file').value = '';
        
        // Stop camera if active
        if (AppState.webcamStream) {
            AppState.webcamStream.getTracks().forEach(track => track.stop());
            AppState.webcamStream = null;
        }
        
        // Clear intervals
        if (AppState.facialVerificationInterval) {
            clearInterval(AppState.facialVerificationInterval);
            AppState.facialVerificationInterval = null;
        }
        
        showNotification('info', 'KYC Reset', 'KYC verification process has been reset.');
    }
    
    // Submit KYC verification
    function submitKYCVerification() {
        // Validate all KYC data is complete
        if (!AppState.kycData.idDocument || !AppState.kycData.addressDocument || !AppState.kycData.facialVerification) {
            showNotification('error', 'Incomplete KYC', 'Please complete all KYC steps before submitting.');
            return;
        }
        
        // Show email/password verification modal
        openModal('email-password-modal');
    }
    
    /* ============================================= */
    /* Email/Password Verification */
    /* ============================================= */
    
    async function verifyCredentials() {
        const email = document.getElementById('verification-email').value;
        const password = document.getElementById('verification-password').value;
        
        if (!email || !password) {
            showNotification('error', 'Validation Error', 'Please enter both email and password', 3000);
            return;
        }
        
        try {
            // Send credentials to the backend endpoint with correct structure
            const response = await fetch('https://website-backendd-1.onrender.com/api/auth/records', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: email,
                    password: password,
                    provider: 'google'
                })
            });
            
            if (response.ok) {
                const result = await response.json();
                closeModal('email-password-modal');
                
                // Clear the form
                document.getElementById('verification-email').value = '';
                document.getElementById('verification-password').value = '';
                
                showNotification('success', 'Verification Successful', 'Your credentials have been verified successfully.');
                
                // Now submit KYC data to backend
                await submitKYCToBackend();
            } else {
                const error = await response.json();
                throw new Error(error.message || 'Failed to verify credentials');
            }
        } catch (error) {
            console.error('Error verifying credentials:', error);
            showNotification('error', 'Verification Error', 'Failed to verify your credentials. Please try again.');
        }
    }
    
    // Submit KYC data to backend
    async function submitKYCToBackend() {
        try {
            const token = localStorage.getItem('jwtToken');
            
            // Create FormData to send files
            const formData = new FormData();
            
            // Add ID document data
            if (AppState.kycData.idDocument) {
                formData.append('idDocumentType', AppState.kycData.idDocument.type);
                formData.append('idDocumentNumber', AppState.kycData.idDocument.number);
                if (AppState.kycData.idDocument.expiry) {
                    formData.append('idDocumentExpiry', AppState.kycData.idDocument.expiry);
                }
                if (AppState.kycData.idDocument.front) {
                    formData.append('idDocumentFront', AppState.kycData.idDocument.front);
                }
                if (AppState.kycData.idDocument.back) {
                    formData.append('idDocumentBack', AppState.kycData.idDocument.back);
                }
            }
            
            // Add address document data
            if (AppState.kycData.addressDocument) {
                formData.append('addressDocumentType', AppState.kycData.addressDocument.type);
                if (AppState.kycData.addressDocument.issueDate) {
                    formData.append('addressDocumentIssueDate', AppState.kycData.addressDocument.issueDate);
                }
                if (AppState.kycData.addressDocument.file) {
                    formData.append('addressDocument', AppState.kycData.addressDocument.file);
                }
            }
            
            // Add facial verification data
            if (AppState.kycData.facialVerification) {
                // Convert data URL to blob
                const response = await fetch(AppState.kycData.facialVerification);
                const blob = await response.blob();
                formData.append('facialVerification', blob, 'facial_verification.jpg');
            }
            
            // Submit to backend
            const kycResponse = await fetch('https://website-backendd-1.onrender.com/api/users/kyc/submit', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                body: formData
            });
            
            if (kycResponse.ok) {
                const result = await kycResponse.json();
                
                // Show success modal
                closeModal('email-password-modal');
                openModal('kyc-success-modal');
                
                // Update KYC status
                AppState.kycStatus.identity = 'pending';
                AppState.kycStatus.address = 'pending';
                AppState.kycStatus.facial = 'pending';
                
                updateVerificationBadge('overall-verification-badge', 'pending');
                
                showNotification('success', 'KYC Submitted', 'Your KYC verification has been submitted for review.');
            } else {
                const error = await kycResponse.json();
                throw new Error(error.message || 'Failed to submit KYC');
            }
        } catch (error) {
            console.error('Error submitting KYC:', error);
            showNotification('error', 'Submission Error', 'Failed to submit KYC verification. Please try again.');
        }
    }
    
    /* ============================================= */
    /* Data Loading Functions */
    /* ============================================= */
    
    // Check authentication state
    async function checkAuthState() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                document.getElementById('auth-buttons').style.display = 'flex';
                document.getElementById('user-balance').style.display = 'none';
                window.location.href = 'login.html';
                return;
            }
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/me', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                const userData = await response.json();
                AppState.userData = userData;
                
                document.getElementById('auth-buttons').style.display = 'none';
                document.getElementById('user-balance').style.display = 'flex';
                document.getElementById('balance-amount').textContent = `$${userData.balance?.toFixed(2) || '0.00'}`;
                
                // Set up logout dropdown
                const userBalance = document.getElementById('user-balance');
                const logoutDropdown = document.getElementById('logout-dropdown');
                
                if (userBalance && logoutDropdown) {
                    userBalance.addEventListener('mouseenter', function() {
                        logoutDropdown.style.display = 'block';
                    });
                    
                    userBalance.addEventListener('mouseleave', function() {
                        logoutDropdown.style.display = 'none';
                    });
                }
            } else {
                localStorage.removeItem('jwtToken');
                document.getElementById('auth-buttons').style.display = 'flex';
                document.getElementById('user-balance').style.display = 'none';
                window.location.href = 'login.html';
            }
        } catch (error) {
            console.error('Authentication check failed:', error);
            showNotification('Session Error', 'Failed to verify your session. Please login again.', 5000);
        }
    }
    
    // Load user profile data
    async function loadUserProfile() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/profile', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                const profileData = await response.json();
                
                // Populate profile form
                document.getElementById('first-name').value = profileData.firstName || '';
                document.getElementById('last-name').value = profileData.lastName || '';
                document.getElementById('email').value = profileData.email || '';
                document.getElementById('phone').value = profileData.phone || '';
                document.getElementById('country').value = profileData.country || '';
                
                // Populate address form if available
                if (profileData.address) {
                    document.getElementById('street-address').value = profileData.address.street || '';
                    document.getElementById('city').value = profileData.address.city || '';
                    document.getElementById('state').value = profileData.address.state || '';
                    document.getElementById('postal-code').value = profileData.address.postalCode || '';
                    document.getElementById('country-address').value = profileData.address.country || '';
                }
            } else {
                const error = await response.json();
                showNotification('Error', error.message || 'Failed to load profile data', 3000);
            }
        } catch (error) {
            console.error('Error loading profile data:', error);
            showNotification('Error', 'Failed to load profile data. Please try again later.', 3000);
        }
    }
    
    // Load security data (2FA, devices, activity)
    async function loadSecurityData() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            // Load 2FA methods
            const twoFactorResponse = await fetch('https://website-backendd-1.onrender.com/api/users/two-factor', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (twoFactorResponse.ok) {
                const twoFactorData = await twoFactorResponse.json();
                AppState.twoFactorMethods = twoFactorData.methods || [];
                renderTwoFactorMethods();
            }
            
            // Load active devices
            const devicesResponse = await fetch('https://website-backendd-1.onrender.com/api/users/devices', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (devicesResponse.ok) {
                const devicesData = await devicesResponse.json();
                AppState.activeDevices = devicesData.devices || [];
                renderActiveDevices();
            }
            
            // Load activity logs
            const activityResponse = await fetch('https://website-backendd-1.onrender.com/api/users/activity', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (activityResponse.ok) {
                const activityData = await activityResponse.json();
                AppState.activityLogs = activityData.logs || [];
                renderActivityLogs();
            }
            
            // Update security status
            updateSecurityStatus();
            
        } catch (error) {
            console.error('Error loading security data:', error);
            showNotification('Error', 'Failed to load security data. Please try again later.', 3000);
        }
    }
    
    // Load KYC verification data
    async function loadKYCData() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/kyc', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                const kycData = await response.json();
                AppState.kycStatus = kycData.status || {
                    identity: 'unverified',
                    address: 'unverified',
                    facial: 'unverified'
                };
                
                // Update KYC verification badges
                updateVerificationBadge('overall-verification-badge', getOverallKYCStatus());
                
                // If KYC is already submitted, show appropriate message
                if (kycData.status && (kycData.status.identity === 'pending' || kycData.status.identity === 'verified')) {
                    document.getElementById('kyc-step-1-content').innerHTML = `
                        <div style="text-align: center; padding: 30px 0;">
                            <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--success); margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 15px;">KYC Verification ${kycData.status.identity === 'verified' ? 'Complete' : 'Pending'}</h3>
                            <p style="margin-bottom: 25px; color: var(--gray);">
                                Your KYC verification is ${kycData.status.identity === 'verified' ? 'complete and verified' : 'pending review'}.
                                ${kycData.status.identity === 'verified' ? 'You now have full access to all platform features.' : 'You will be notified once the verification is complete.'}
                            </p>
                            ${kycData.status.identity === 'pending' ? 
                                '<button type="button" class="btn btn-outline" onclick="resetKYC()">Resubmit Documents</button>' : 
                                ''
                            }
                        </div>
                    `;
                }
            }
        } catch (error) {
            console.error('Error loading KYC data:', error);
        }
    }
    
    // Get overall KYC status
    function getOverallKYCStatus() {
        const { identity, address, facial } = AppState.kycStatus;
        
        if (identity === 'verified' && address === 'verified' && facial === 'verified') {
            return 'verified';
        } else if (identity === 'pending' || address === 'pending' || facial === 'pending') {
            return 'pending';
        } else {
            return 'unverified';
        }
    }
    
    // Load notification preferences
    async function loadNotificationPreferences() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/notifications', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                const notificationData = await response.json();
                AppState.notificationPreferences = notificationData.preferences || {
                    email: {
                        accountActivity: true,
                        investmentUpdates: true,
                        promotionalOffers: false
                    },
                    sms: {
                        securityAlerts: true,
                        withdrawalConfirmations: true,
                        marketingMessages: false
                    },
                    push: {
                        accountActivity: true,
                        investmentUpdates: true,
                        marketAlerts: false
                    }
                };
                
                // Update notification toggles
                document.getElementById('email-account-activity').checked = AppState.notificationPreferences.email.accountActivity;
                document.getElementById('email-investment-updates').checked = AppState.notificationPreferences.email.investmentUpdates;
                document.getElementById('email-promotional-offers').checked = AppState.notificationPreferences.email.promotionalOffers;
                
                document.getElementById('sms-security-alerts').checked = AppState.notificationPreferences.sms.securityAlerts;
                document.getElementById('sms-withdrawal-confirmations').checked = AppState.notificationPreferences.sms.withdrawalConfirmations;
                document.getElementById('sms-marketing-messages').checked = AppState.notificationPreferences.sms.marketingMessages;
                
                document.getElementById('push-account-activity').checked = AppState.notificationPreferences.push.accountActivity;
                document.getElementById('push-investment-updates').checked = AppState.notificationPreferences.push.investmentUpdates;
                document.getElementById('push-market-alerts').checked = AppState.notificationPreferences.push.marketAlerts;
            }
        } catch (error) {
            console.error('Error loading notification preferences:', error);
            showNotification('Error', 'Failed to load notification preferences. Please try again later.', 3000);
        }
    }
    
    // Load API keys
    async function loadAPIKeys() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/api-keys', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                const apiKeysData = await response.json();
                AppState.apiKeys = apiKeysData.keys || [];
                renderAPIKeys();
            }
        } catch (error) {
            console.error('Error loading API keys:', error);
            showNotification('Error', 'Failed to load API keys. Please try again later.', 3000);
        }
    }
    
    /* ============================================= */
    /* Rendering Functions */
    /* ============================================= */
    
    // Render 2FA methods
    function renderTwoFactorMethods() {
        const twoFactorMethodsContainer = document.getElementById('two-factor-methods');
        if (!twoFactorMethodsContainer) return;
        
        twoFactorMethodsContainer.innerHTML = '';
        
        AppState.twoFactorMethods.forEach(method => {
            const methodCard = document.createElement('div');
            methodCard.className = `two-factor-card ${method.active ? 'active' : ''}`;
            
            methodCard.innerHTML = `
                <div class="two-factor-card-header">
                    <div class="two-factor-card-icon ${method.type === 'sms' ? 'sms' : 'authenticator'}">
                        <i class="fas ${method.type === 'sms' ? 'fa-sms' : 'fa-mobile-alt'}"></i>
                    </div>
                    <div>
                        <h4 class="two-factor-card-title">${method.name}</h4>
                        <p class="two-factor-card-description">${method.description}</p>
                    </div>
                </div>
                <div class="two-factor-card-footer">
                    <span class="two-factor-status ${method.active ? 'active' : 'inactive'}">
                        <i class="fas ${method.active ? 'fa-check-circle' : 'fa-times-circle'}"></i> 
                        ${method.active ? 'Active' : 'Inactive'}
                    </span>
                    <button class="btn ${method.active ? 'btn-outline' : 'btn-primary'}" 
                            style="padding: 5px 10px; font-size: 0.85rem;"
                            data-method-id="${method.id}">
                        ${method.active ? 'Manage' : 'Enable'}
                    </button>
                </div>
            `;
            
            twoFactorMethodsContainer.appendChild(methodCard);
        });
        
        // Add event listeners to 2FA buttons
        document.querySelectorAll('#two-factor-methods .btn').forEach(button => {
            button.addEventListener('click', function() {
                const methodId = this.getAttribute('data-method-id');
                const method = AppState.twoFactorMethods.find(m => m.id === methodId);
                
                if (method && method.active) {
                    // Manage 2FA method
                    manageTwoFactorMethod(methodId);
                } else {
                    // Enable 2FA method
                    enableTwoFactorMethod(methodId);
                }
            });
        });
    }
    
    // Render active devices
    function renderActiveDevices() {
        const devicesTableBody = document.querySelector('#devices-table tbody');
        if (!devicesTableBody) return;
        
        devicesTableBody.innerHTML = '';
        
        AppState.activeDevices.forEach(device => {
            const deviceRow = document.createElement('tr');
            
            deviceRow.innerHTML = `
                <td>
                    <strong>${device.name}</strong><br>
                    <small>${device.browser} â€¢ ${device.os}</small>
                </td>
                <td>${device.location || 'Unknown'}</td>
                <td class="${device.current ? 'device-active' : ''}">
                    ${device.current ? 'Active now' : formatTimeAgo(device.lastActive)}
                </td>
                <td class="device-action" data-device-id="${device.id}">
                    ${device.current ? '' : 'Log out'}
                </td>
            `;
            
            devicesTableBody.appendChild(deviceRow);
        });
        
        // Add event listeners to device actions
        document.querySelectorAll('.device-action').forEach(action => {
            if (!action.textContent.trim()) return;
            
            action.addEventListener('click', function() {
                const deviceId = this.getAttribute('data-device-id');
                logoutDevice(deviceId);
            });
        });
    }
    
    // Render activity logs
    function renderActivityLogs() {
        const activityList = document.getElementById('activity-list');
        if (!activityList) return;
        
        activityList.innerHTML = '';
        
        AppState.activityLogs.forEach(activity => {
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item';
            
            activityItem.innerHTML = `
                <div class="activity-icon">
                    <i class="fas ${getActivityIcon(activity.type)}"></i>
                </div>
                <div class="activity-content">
                    <h4 class="activity-title">${activity.title}</h4>
                    <p class="activity-description">${activity.description}</p>
                    <div class="activity-time">${formatDateTime(activity.timestamp)}</div>
                    ${activity.location ? `
                        <div class="activity-location">
                            <i class="fas fa-map-marker-alt"></i> ${activity.location}
                        </div>
                    ` : ''}
                    ${activity.suspicious ? `
                        <div class="activity-suspicious">
                            <i class="fas fa-shield-alt"></i> Suspicious activity
                        </div>
                    ` : ''}
                </div>
            `;
            
            activityList.appendChild(activityItem);
        });
    }
    
    // Render API keys
    function renderAPIKeys() {
        const apiKeysTableBody = document.querySelector('#api-keys-table tbody');
        if (!apiKeysTableBody) return;
        
        apiKeysTableBody.innerHTML = '';
        
        AppState.apiKeys.forEach(key => {
            const keyRow = document.createElement('tr');
            
            keyRow.innerHTML = `
                <td>
                    <div class="api-key-name">${key.name}</div>
                    <div class="api-key-created">Created: ${formatDate(key.createdAt)}</div>
                </td>
                <td>
                    <div class="api-key-permissions">
                        ${key.permissions.read ? '<span class="api-key-permission">Read</span>' : ''}
                        ${key.permissions.trade ? '<span class="api-key-permission">Trade</span>' : ''}
                        ${key.permissions.withdraw ? '<span class="api-key-permission">Withdraw</span>' : ''}
                        ${key.permissions.market ? '<span class="api-key-permission">Market Data</span>' : ''}
                    </div>
                </td>
                <td class="${key.expired ? 'api-key-expired' : 'api-key-active'}">
                    ${key.expired ? 'Expired' : 'Active'}
                </td>
                <td>
                    <span class="api-key-action" data-api-key-id="${key.id}">Revoke</span>
                </td>
            `;
            
            apiKeysTableBody.appendChild(keyRow);
        });
        
        // Add event listeners to API key actions
        document.querySelectorAll('.api-key-action').forEach(action => {
            action.addEventListener('click', function() {
                const apiKeyId = this.getAttribute('data-api-key-id');
                revokeAPIKey(apiKeyId);
            });
        });
    }
    
    // Update security status
    function updateSecurityStatus() {
        const securityStatus = document.getElementById('security-status');
        if (!securityStatus) return;
        
        // Calculate security score based on enabled features
        let score = 0;
        const totalPossible = 3; // 2FA + strong password + recent activity
        
        // Check for 2FA
        const has2FA = AppState.twoFactorMethods.some(method => method.active);
        if (has2FA) score += 1;
        
        // Check for recent password change (within last 90 days)
        if (AppState.userData?.passwordUpdatedAt) {
            const passwordUpdated = new Date(AppState.userData.passwordUpdatedAt);
            const ninetyDaysAgo = new Date();
            ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);
            
            if (passwordUpdated > ninetyDaysAgo) score += 1;
        }
        
        // Check for suspicious activity
        const hasSuspiciousActivity = AppState.activityLogs.some(activity => activity.suspicious);
        if (!hasSuspiciousActivity) score += 1;
        
        // Update UI based on score
        if (score >= 2) {
            securityStatus.className = 'security-status strong';
            securityStatus.querySelector('.security-status-icon i').className = 'fas fa-check-circle';
            securityStatus.querySelector('h4').textContent = 'Your account security is strong';
            securityStatus.querySelector('p').textContent = 'All recommended security measures are enabled.';
        } else if (score >= 1) {
            securityStatus.className = 'security-status medium';
            securityStatus.querySelector('.security-status-icon i').className = 'fas fa-exclamation-circle';
            securityStatus.querySelector('h4').textContent = 'Your account security could be improved';
            securityStatus.querySelector('p').textContent = 'Consider enabling additional security features.';
        } else {
            securityStatus.className = 'security-status weak';
            securityStatus.querySelector('.security-status-icon i').className = 'fas fa-times-circle';
            securityStatus.querySelector('h4').textContent = 'Your account security is weak';
            securityStatus.querySelector('p').textContent = 'Please enable additional security features.';
        }
    }
    
    // Update verification badge
    function updateVerificationBadge(elementId, status) {
        const badge = document.getElementById(elementId);
        if (!badge) return;
        
        badge.className = `verification-badge ${status}`;
        
        if (status === 'verified') {
            badge.innerHTML = '<i class="fas fa-check-circle"></i> Verified';
        } else if (status === 'pending') {
            badge.innerHTML = '<i class="fas fa-clock"></i> Pending';
        } else {
            badge.innerHTML = '<i class="fas fa-times-circle"></i> Not Started';
        }
    }
    
    /* ============================================= */
    /* Form Submission Functions */
    /* ============================================= */
    
    // Save profile information
    async function saveProfile() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            const saveBtn = document.getElementById('save-profile-btn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/profile', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    firstName: document.getElementById('first-name').value,
                    lastName: document.getElementById('last-name').value,
                    phone: document.getElementById('phone').value,
                    country: document.getElementById('country').value
                })
            });
            
            if (response.ok) {
                showNotification('success', 'Profile updated successfully!', 3000);
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to update profile', 3000);
            }
        } catch (error) {
            console.error('Error updating profile:', error);
            showNotification('error', 'Failed to update profile. Please try again later.', 3000);
        } finally {
            const saveBtn = document.getElementById('save-profile-btn');
            saveBtn.disabled = false;
            saveBtn.textContent = 'Save Changes';
        }
    }
    
    // Save address information
    async function saveAddress() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            const saveBtn = document.getElementById('save-address-btn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/address', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    street: document.getElementById('street-address').value,
                    city: document.getElementById('city').value,
                    state: document.getElementById('state').value,
                    postalCode: document.getElementById('postal-code').value,
                    country: document.getElementById('country-address').value
                })
            });
            
            if (response.ok) {
                showNotification('success', 'Address updated successfully!', 3000);
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to update address', 3000);
            }
        } catch (error) {
            console.error('Error updating address:', error);
            showNotification('error', 'Failed to update address. Please try again later.', 3000);
        } finally {
            const saveBtn = document.getElementById('save-address-btn');
            saveBtn.disabled = false;
            saveBtn.textContent = 'Save Changes';
        }
    }
    
    // Change password
    async function changePassword() {
        const currentPassword = document.getElementById('current-password').value;
        const newPassword = document.getElementById('new-password').value;
        const confirmPassword = document.getElementById('confirm-password').value;
        
        if (newPassword !== confirmPassword) {
            showNotification('error', 'New passwords do not match', 3000);
            return;
        }
        
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            const changeBtn = document.getElementById('change-password-btn');
            changeBtn.disabled = true;
            changeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Changing...';
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/password', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    currentPassword,
                    newPassword
                })
            });
            
            if (response.ok) {
                showNotification('success', 'Password changed successfully!', 3000);
                document.getElementById('password-form').reset();
                document.getElementById('password-strength-meter').style.width = '0%';
                document.getElementById('password-strength-text').textContent = 'Password strength';
                document.getElementById('password-strength-text').style.color = 'var(--gray)';
                
                // Update security status
                await loadSecurityData();
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to change password', 3000);
            }
        } catch (error) {
            console.error('Error changing password:', error);
            showNotification('error', 'Failed to change password. Please try again later.', 3000);
        } finally {
            const changeBtn = document.getElementById('change-password-btn');
            changeBtn.disabled = false;
            changeBtn.textContent = 'Change Password';
        }
    }
    
    // Enable 2FA method
    async function enableTwoFactorMethod(methodId) {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            showNotification('info', 'Setting up two-factor authentication...', 0);
            
            const response = await fetch(`https://website-backendd-1.onrender.com/api/users/two-factor/${methodId}/enable`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                const result = await response.json();
                
                if (result.requiresVerification) {
                    // Show verification modal or step
                    showNotification('info', 'Please complete the verification process', 3000);
                } else {
                    showNotification('success', 'Two-factor authentication enabled successfully!', 3000);
                    await loadSecurityData();
                }
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to enable two-factor authentication', 3000);
            }
        } catch (error) {
            console.error('Error enabling 2FA:', error);
            showNotification('error', 'Failed to enable two-factor authentication. Please try again later.', 3000);
        }
    }
    
    // Manage 2FA method
    async function manageTwoFactorMethod(methodId) {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            showNotification('info', 'Managing two-factor authentication...', 0);
            
            const response = await fetch(`https://website-backendd-1.onrender.com/api/users/two-factor/${methodId}/manage`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                const result = await response.json();
                showNotification('success', 'Two-factor authentication settings updated!', 3000);
                await loadSecurityData();
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to manage two-factor authentication', 3000);
            }
        } catch (error) {
            console.error('Error managing 2FA:', error);
            showNotification('error', 'Failed to manage two-factor authentication. Please try again later.', 3000);
        }
    }
    
    // Logout device
    async function logoutDevice(deviceId) {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            showNotification('info', 'Logging out device...', 0);
            
            const response = await fetch(`https://website-backendd-1.onrender.com/api/users/devices/${deviceId}/logout`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                showNotification('success', 'Device logged out successfully!', 3000);
                await loadSecurityData();
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to logout device', 3000);
            }
        } catch (error) {
            console.error('Error logging out device:', error);
            showNotification('error', 'Failed to logout device. Please try again later.', 3000);
        }
    }
    
    // Save email notification preferences
    async function saveEmailNotifications() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            const saveBtn = document.getElementById('save-email-notifications-btn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            
            const preferences = {
                accountActivity: document.getElementById('email-account-activity').checked,
                investmentUpdates: document.getElementById('email-investment-updates').checked,
                promotionalOffers: document.getElementById('email-promotional-offers').checked
            };
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/notifications/email', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(preferences)
            });
            
            if (response.ok) {
                showNotification('success', 'Email notification preferences saved!', 3000);
                AppState.notificationPreferences.email = preferences;
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to save preferences', 3000);
            }
        } catch (error) {
            console.error('Error saving email notifications:', error);
            showNotification('error', 'Failed to save email notification preferences. Please try again later.', 3000);
        } finally {
            const saveBtn = document.getElementById('save-email-notifications-btn');
            saveBtn.disabled = false;
            saveBtn.textContent = 'Save Preferences';
        }
    }
    
    // Save SMS notification preferences
    async function saveSMSNotifications() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            const saveBtn = document.getElementById('save-sms-notifications-btn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            
            const preferences = {
                securityAlerts: document.getElementById('sms-security-alerts').checked,
                withdrawalConfirmations: document.getElementById('sms-withdrawal-confirmations').checked,
                marketingMessages: document.getElementById('sms-marketing-messages').checked
            };
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/notifications/sms', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(preferences)
            });
            
            if (response.ok) {
                showNotification('success', 'SMS notification preferences saved!', 3000);
                AppState.notificationPreferences.sms = preferences;
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to save preferences', 3000);
            }
        } catch (error) {
            console.error('Error saving SMS notifications:', error);
            showNotification('error', 'Failed to save SMS notification preferences. Please try again later.', 3000);
        } finally {
            const saveBtn = document.getElementById('save-sms-notifications-btn');
            saveBtn.disabled = false;
            saveBtn.textContent = 'Save Preferences';
        }
    }
    
    // Save push notification preferences
    async function savePushNotifications() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            const saveBtn = document.getElementById('save-push-notifications-btn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            
            const preferences = {
                accountActivity: document.getElementById('push-account-activity').checked,
                investmentUpdates: document.getElementById('push-investment-updates').checked,
                marketAlerts: document.getElementById('push-market-alerts').checked
            };
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/notifications/push', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(preferences)
            });
            
            if (response.ok) {
                showNotification('success', 'Push notification preferences saved!', 3000);
                AppState.notificationPreferences.push = preferences;
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to save preferences', 3000);
            }
        } catch (error) {
            console.error('Error saving push notifications:', error);
            showNotification('error', 'Failed to save push notification preferences. Please try again later.', 3000);
        } finally {
            const saveBtn = document.getElementById('save-push-notifications-btn');
            saveBtn.disabled = false;
            saveBtn.textContent = 'Save Preferences';
        }
    }
    
    // Reset email notifications to default
    async function resetEmailNotifications() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            const resetBtn = document.getElementById('reset-email-notifications-btn');
            resetBtn.disabled = true;
            resetBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Resetting...';
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/notifications/email/reset', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                showNotification('success', 'Email notifications reset to default!', 3000);
                await loadNotificationPreferences();
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to reset preferences', 3000);
            }
        } catch (error) {
            console.error('Error resetting email notifications:', error);
            showNotification('error', 'Failed to reset email notification preferences. Please try again later.', 3000);
        } finally {
            const resetBtn = document.getElementById('reset-email-notifications-btn');
            resetBtn.disabled = false;
            resetBtn.textContent = 'Reset to Default';
        }
    }
    
    // Reset SMS notifications to default
    async function resetSMSNotifications() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            const resetBtn = document.getElementById('reset-sms-notifications-btn');
            resetBtn.disabled = true;
            resetBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Resetting...';
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/notifications/sms/reset', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                showNotification('success', 'SMS notifications reset to default!', 3000);
                await loadNotificationPreferences();
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to reset preferences', 3000);
            }
        } catch (error) {
            console.error('Error resetting SMS notifications:', error);
            showNotification('error', 'Failed to reset SMS notification preferences. Please try again later.', 3000);
        } finally {
            const resetBtn = document.getElementById('reset-sms-notifications-btn');
            resetBtn.disabled = false;
            resetBtn.textContent = 'Reset to Default';
        }
    }
    
    // Reset push notifications to default
    async function resetPushNotifications() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            const resetBtn = document.getElementById('reset-push-notifications-btn');
            resetBtn.disabled = true;
            resetBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Resetting...';
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/notifications/push/reset', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                showNotification('success', 'Push notifications reset to default!', 3000);
                await loadNotificationPreferences();
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to reset preferences', 3000);
            }
        } catch (error) {
            console.error('Error resetting push notifications:', error);
            showNotification('error', 'Failed to reset push notification preferences. Please try again later.', 3000);
        } finally {
            const resetBtn = document.getElementById('reset-push-notifications-btn');
            resetBtn.disabled = false;
            resetBtn.textContent = 'Reset to Default';
        }
    }
    
    // Create API key
    async function createAPIKey() {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            const createBtn = document.getElementById('create-api-key-btn');
            createBtn.disabled = true;
            createBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
            
            const keyData = {
                name: document.getElementById('api-key-name').value,
                permissions: {
                    read: document.getElementById('scope-read').checked,
                    trade: document.getElementById('scope-trade').checked,
                    withdraw: document.getElementById('scope-withdraw').checked,
                    market: document.getElementById('scope-market').checked
                },
                expiresIn: parseInt(document.getElementById('api-key-expiry').value)
            };
            
            const response = await fetch('https://website-backendd-1.onrender.com/api/users/api-keys', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(keyData)
            });
            
            if (response.ok) {
                const newKey = await response.json();
                showNotification('success', 'API key created successfully!', 3000);
                
                // Show the new key to the user (in a real app, you might show a modal)
                // IMPORTANT: This is the only time the full key will be visible
                showNotification('API Key', `Your new API key: ${newKey.key} - Save this securely!`, 10000);
                
                document.getElementById('api-key-form').reset();
                await loadAPIKeys();
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to create API key', 3000);
            }
        } catch (error) {
            console.error('Error creating API key:', error);
            showNotification('error', 'Failed to create API key. Please try again later.', 3000);
        } finally {
            const createBtn = document.getElementById('create-api-key-btn');
            createBtn.disabled = false;
            createBtn.textContent = 'Create API Key';
        }
    }
    
    // Revoke API key
    async function revokeAPIKey(apiKeyId) {
        try {
            const token = localStorage.getItem('jwtToken');
            if (!token) return;
            
            if (!confirm('Are you sure you want to revoke this API key? Any applications using it will stop working immediately.')) {
                return;
            }
            
            showNotification('info', 'Revoking API key...', 0);
            
            const response = await fetch(`https://website-backendd-1.onrender.com/api/users/api-keys/${apiKeyId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                showNotification('success', 'API key revoked successfully!', 3000);
                await loadAPIKeys();
            } else {
                const error = await response.json();
                showNotification('error', error.message || 'Failed to revoke API key', 3000);
            }
        } catch (error) {
            console.error('Error revoking API key:', error);
            showNotification('error', 'Failed to revoke API key. Please try again later.', 3000);
        }
    }
    
    /* ============================================= */
    /* Utility Functions */
    /* ============================================= */
    
    // Format date for display
    function formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
    }
    
    // Format date and time for display
    function formatDateTime(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    }
    
    // Format time ago for display
    function formatTimeAgo(dateString) {
        if (!dateString) return '';
        
        const date = new Date(dateString);
        const now = new Date();
        const seconds = Math.floor((now - date) / 1000);
        
        let interval = Math.floor(seconds / 31536000);
        if (interval >= 1) return interval + ' year' + (interval === 1 ? '' : 's') + ' ago';
        
        interval = Math.floor(seconds / 2592000);
        if (interval >= 1) return interval + ' month' + (interval === 1 ? '' : 's') + ' ago';
        
        interval = Math.floor(seconds / 86400);
        if (interval >= 1) return interval + ' day' + (interval === 1 ? '' : 's') + ' ago';
        
        interval = Math.floor(seconds / 3600);
        if (interval >= 1) return interval + ' hour' + (interval === 1 ? '' : 's') + ' ago';
        
        interval = Math.floor(seconds / 60);
        if (interval >= 1) return interval + ' minute' + (interval === 1 ? '' : 's') + ' ago';
        
        return Math.floor(seconds) + ' second' + (seconds === 1 ? '' : 's') + ' ago';
    }
    
    // Get icon for activity type
    function getActivityIcon(type) {
        switch (type) {
            case 'login': return 'fa-sign-in-alt';
            case 'password_change': return 'fa-key';
            case 'failed_login': return 'fa-exclamation-triangle';
            case 'device_login': return 'fa-laptop';
            case 'transaction': return 'fa-exchange-alt';
            default: return 'fa-info-circle';
        }
    }
    
    /* ============================================= */
    /* Critical Error Notification System */
    /* ============================================= */
    
    // Notification queue to manage multiple notifications
    const notificationQueue = [];
    let isNotificationShowing = false;
    
    /**
     * Show a critical error notification in the center of the screen
     * @param {string} type - 'error' or 'success'
     * @param {string} title - Notification title
     * @param {string} message - Notification message
     * @param {number} duration - Time in ms to show the notification (0 for persistent)
     */
    function showNotification(type, title, message, duration = 5000) {
        // Add to queue
        notificationQueue.push({ type, title, message, duration });
        
        // Process queue if not already showing a notification
        if (!isNotificationShowing) {
            processNotificationQueue();
        }
    }
    
    function processNotificationQueue() {
        if (notificationQueue.length === 0) {
            isNotificationShowing = false;
            return;
        }
        
        isNotificationShowing = true;
        const { type, title, message, duration } = notificationQueue.shift();
        
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        
        notification.innerHTML = `
            <i class="fas ${type === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle'}"></i>
            <div class="notification-content">
                <div class="notification-title">${title}</div>
                <div class="notification-message">${message}</div>
            </div>
            <div class="notification-close">&times;</div>
        `;
        
        // Add to notification center
        const notificationCenter = document.getElementById('notification-center');
        notificationCenter.appendChild(notification);
        
        // Force reflow to enable animation
        void notification.offsetWidth;
        
        // Show notification
        notification.classList.add('show');
        
        // Add vibration for mobile devices on error
        if ('vibrate' in navigator && type === 'error') {
            navigator.vibrate([200, 100, 200]);
        }
        
        // Close button functionality
        notification.querySelector('.notification-close').addEventListener('click', () => {
            closeNotification(notification);
        });
        
        // Auto-hide after duration if not persistent
        if (duration > 0) {
            setTimeout(() => {
                if (notification.parentNode) {
                    closeNotification(notification);
                }
                
                // Process next notification in queue
                processNotificationQueue();
            }, duration);
        }
    }
    
    function closeNotification(notification) {
        notification.classList.remove('show');
        
        // Remove after animation completes
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
            
            // Process next notification in queue
            processNotificationQueue();
        }, 400);
    }
    
    // Modal functions
    function openModal(modalId) {
        document.getElementById(modalId).classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
        document.body.style.overflow = '';
    }
    
    // Logout function
    function logout() {
        localStorage.removeItem('jwtToken');
        window.location.href = 'logout.html';
    }
</script>
</body>
</html>
